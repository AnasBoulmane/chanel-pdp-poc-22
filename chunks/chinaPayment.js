(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1061:function(e,t,n){"use strict";n.r(t);n(7),n(134),n(14);var a=n(4),o=n.n(a),c=n(5),i=n(0),r=n(6),s=n(3),p=n(2),l=n(13);let d=!1,u=!0;function m(e){const t=e.target;e.preventDefault();const n=Object(i.select)("#paymentError");n&&(u=!0,n.remove());const a=Object(i.select)(".js-wechat-pay-option");if(d&&a.classList.contains("selected"))return function(){const e='<div id="errPopin" class="wechat-error-popin" data-close-label="'.concat(s.a.wechat.qrCodePopin.close," - ").concat(s.a.wechat.errPopin.title,'">\n                          <div class="wechat-error-popin__header has-text-centered">\n                            <div class="heading is-7 text-center" role="heading" aria-level="1">\n                              ').concat(s.a.wechat.errPopin.title,'\n                            </div>\n                          </div>\n                          <p class="has-text-centered summary">\n                            ').concat(s.a.wechat.errPopin.summary,'\n                          </p>\n                          <p class="has-text-centered description">\n                            ').concat(s.a.wechat.errPopin.description,"\n                          </p>\n                        </div>");r.a.open({html:e,modifiers:"is-big is-relative errPopin",modal:!0,role:"dialog",label:s.a.wechat.errPopin.title,opener:Object(i.select)(".js-wechat-btn"),forceInert:!0,manageFocus:!0,outerClose:!0}).then(()=>{window.addEventListener("click",b)})}(),!1;t.checkValidity()&&c.submit(t,{}).then(e=>{e.isSuccess?"alipay"===e.pspname?v(e):"wechatpay"===e.pspname?h(e):"unionpay"===e.pspname&&w(e):window.location.replace(s.a.currentLocale+e.url)}).catch(e=>{console.error(e)})}function h(e){c.get(s.a.currentLocale+e.url,{}).then(e=>{var t;e.isSuccess&&("wechatpay"===e.pspname?(y((t=e).orderCode),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.packageName,signType:t.signType,paySign:t.paySign},(function(e){var n=e.err_msg.split(":")[1];"ok"===n?y(t.orderCode):"fail"!==n&&"cancel"!==n||function(e){u=!1,Object(i.select)(".js-wechat-btn").classList.remove("is-disabled");const t=Object(i.select)("#wechat-agreement"),n=document.createElement("p");n.classList.add("error"),n.setAttribute("id","paymentError"),n.setAttribute("tabindex",-1),n.innerHTML="fail"===e?s.a.wechat.error.failed:s.a.wechat.error.cancelled,t.parentNode.insertBefore(n,t.nextSibling)}(n)}))):"wechatpay_native"===e.pspname&&function(e){const t="data:image/png;base64,".concat(e.url);!function(e,t){r.a.open({html:e,modifiers:"is-big is-relative qrCodePopin",modal:!0,label:s.a.wechat.qrCodePopin.title,opener:Object(i.select)(".js-wechat-btn"),forceInert:!0,manageFocus:!0,outerClose:!0}).then(()=>{y(t.orderCode),d=!0;Object(i.select)(".js-wechat-btn").classList.remove("is-disabled"),window.addEventListener("click",b)})}('<div id="qrCodePopin" class="qr-code-popin" data-close-label="'.concat(s.a.wechat.qrCodePopin.close," - ").concat(s.a.wechat.qrCodePopin.title,'">\n                      <div class="qr-code-popin__header has-text-centered">\n                        <div class="heading is-7 text-center" role="heading" aria-level="1">\n                          ').concat(s.a.wechat.qrCodePopin.title,'\n                        </div>\n                      </div>\n                      <div id="qrCode"><img id="qr-code" alt="').concat(s.a.wechat.qrCodePopin.altImgText,'" src ="').concat(t,'" /></div>\n                      <p class="has-text-centered">\n                      ').concat(s.a.wechat.qrCodePopin.orderTitle,"</br>\n                        ").concat(e.orderCode,'\n                      </p>\n                      <p class="msg">\n                        ').concat(s.a.wechat.qrCodePopin.msg,"</br>\n                      </p>\n                    </div>"),e)}(e))}).catch(e=>{console.error(e)})}function b(e){const t=Object(i.select)(".popin__col");t&&!t.contains(e.target)&&(r.a.hide(),window.removeEventListener("click",b))}function y(e){u&&c.get(s.a.webservices.checkout.cnCheckPaymentStatus+e).then(t=>{t.retry?setTimeout(()=>{y(e)},1e4):window.location.href=s.a.currentLocale+t.redirectUrl})}function v(e){window.location.href=e.url}function w(e){const t=document.createElement("form");t.setAttribute("method","post"),t.setAttribute("action",e.frontTransUrl),t.setAttribute("id","payForm");for(const[n,a]of Object.entries(e.submitFromDataMap)){const e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name",n),e.setAttribute("id",n),e.setAttribute("value",a),t.appendChild(e)}let n=Object(i.select)("#unionPay-method");n=null===n?Object(i.select)(".proceed-payment"):n,n.after(t),t.submit()}function g(e){let t=Object(i.select)("#order-code").innerHTML,n=Object(i.select)("#payment-method").innerHTML,a="";if(!Object(p.W)()&&(e.delegateTarget.classList.contains("order-history")&&(dataLayer.push({eventCategory:"order history",eventAction:"proceed_to_payment",eventLabel:t,event:"uaevent"}),a="order-history"),e.delegateTarget.classList.contains("order-summary")&&(dataLayer.push({eventCategory:"order summary",eventAction:"proceed_to_payment",eventLabel:t,event:"uaevent"}),a="order-summary"),("alipay"===n||"unionpay"===n&&"mobile"!==Object(p.r)())&&function(e,t,n){let a,o;Object(i["selectAll"])("button.place-order").forEach(e=>{e.classList.contains(n)&&(o=e)}),o&&o.classList.contains("button")&&(a=new l.a(o,{button:!0}),a.init(),a.create());c.post(s.a.webservices.checkout.placeOrderFromHistory,{data:{paymentProvider:t,orderCode:e}}).then(e=>{a&&a.destroy((function(){o.classList.remove("is-disabled")})),"alipay"===e.pspname?v(e):"wechatpay"===e.pspname?h(e):"unionpay"===e.pspname&&w(e)}).catch(e=>{console.error(e)})}(t,n,a),"unionpay"===n&&"mobile"===Object(p.r)())){!function(e,t,n){let a,o;"alipay"===t&&(a=s.a.popUpMessages.aliPay);"unionpay"===e&&(o=s.a.popUpMessages.unionPay);const c='\n                  <div role="dialog" aria-label="'.concat(s.a.popUpMessages.title,'" id="nonPaymentPopin" class="non-payment-popin has-text-centered" data-close-label="').concat(s.a.popUpMessages.close," - ").concat(s.a.popUpMessages.title,'">\n                    <div class="non-payment-popin__header">\n                       <div class="heading is-7 text-center" role="heading" aria-level="1">\n                       ').concat(s.a.popUpMessages.title,"\n                       </div>\n                      </div>\n                     <br/> \n                     <p>\n                     ").concat(s.a.popUpMessages.description1," ").concat(a," ").concat(s.a.popUpMessages.description2," ").concat(o," ").concat(s.a.popUpMessages.description3,"\n                      </p>\n                      <br/>\n                      <form id='alipayPaymentForm' action=\"").concat(s.a.webservices.checkout.placeOrderFromHistory,'" method="POST" novalidate="true">\n                        <input type ="hidden" name=\'paymentProvider\' value ="').concat(t,'">\n                        <input type ="hidden" name=\'orderCode\' value ="').concat(n,'">\n                        <button type="submit" class="button is-primary">')+s.a.popUpMessages.continueButtonText+" "+a+"</button>\n                      </form>\n                  </div>";r.a.open({html:c,modifiers:"is-big is-relative nonPaymentPopin",modal:!0,label:s.a.wechat.qrCodePopin.title,opener:null,forceInert:!0,manageFocus:!0,outerClose:!0}).then(()=>{window.addEventListener("click",b)})}(n,"alipay",t)}}function f(e){const t=e.target;e.preventDefault(),c.submit(t,{}).then(e=>{e.isSuccess?v(e):window.location.replace(s.a.currentLocale+e.url)}).catch(e=>{console.error(e)})}t.default={init:function(){o()(document.body,"#cnPlaceOrderForm","submit",m),o()(document.body,".proceed-payment","click",g),o()(document.body,"#alipayPaymentForm","submit",f)}}}}]);