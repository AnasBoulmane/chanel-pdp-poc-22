(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1054:function(e,t,n){"use strict";n.r(t);n(134),n(7),n(34);var c=n(0),a=n(2),i=n(1),s=n(6),o=n(5),r=n(31),l=n(4),d=n.n(l),b=n(13),u=n(28),g=n(145),p=n(198);const f=Object(c.select)(".js-giftcard"),m=Object(c.select)(".js-giftcard-header"),h=Object(c.select)(".js-giftcard-phys-header"),v=Object(c.select)(".js-giftcard-elec-header"),j=Object(c.select)(".js-card-type-section",f),w=Object(c.select)(".js-step-container",f),L=Object(c.select)(".js-giftcard-amount-section",f),O=Object(c.select)(".js-message-section",f),y=Object(c.select)(".js-beneficiary-section",f),C=Object(c.selectAll)(".js-card-selector",f),A=Object(c.selectAll)(".js-card-title",f),x=Object(c.select)(".js-mobile-phys-desc",f),k=Object(c.select)(".js-mobile-elec-desc",f),E=Object(c.select)(".js-cards-button",f),_=Object(c.select)(".js-giftcard-form",f),N=Object(c.select)(".js-valid-message",f),T=Object(c.selectAll)(".js-mail-selection",f),M=Object(c.select)(".js-valid-email",f),I=Object(c.select)(".js-giftcard-email-form",f),P=Object(c.selectAll)(".js-card-amount",f),S=Object(c.select)(".js-custom-amount",f),q=Object(c.select)(".js-valid-amount",f),H=Object(c.selectAll)(".js-change-card",f),B=Object(c.select)(".currency-symbol"),D=Object(c.select)(".header .cart"),F=Object(c.select)(".js-giftcard-stepper",f),G=Object(c.select)(".js-textarea",f),K=Object(c.select)(".js-giftcard-lines",f),V=Object(c.select)(".js-giftcard-chars",f),R=Object(c.select)(".js-giftcard-message-counter",f),J=Object(c.select)(".js-giftcad-message-label",f),Q=Object(c.selectAll)("li",F);let U=null,W=null,X=!1,z=1,Y="";const Z=window.config.giftcardMinAmount,$=window.config.giftcardMaxAmount,ee=window.config.locales.errors.form.global.giftcard.maxAmount,te=window.config.locales.errors.form.global.giftcard.minAmount,ne=window.config.giftcardBalancePopin;let ce,ae,ie=window.config.isStandardProductPresent,se=(window.config.isOABServiceProductPresent,Q?Q[2]:null);function oe(){(function(){function e(){me(),C.forEach(e=>{n(e,e===this)})}function t(e){if(13===e.keyCode||32===e.keyCode){const e=new MouseEvent("click");this.dispatchEvent(e)}}function n(e,t){Ie(L),V.innerHTML=window.config.giftcardMessageMaxChars*window.config.giftcardMessageMaxLines,K.innerHTML=window.config.giftcardMessageMaxLines,X=!1,e.classList.toggle("selected",t);const n=Object(c.select)("input[type=radio]",e);n.checked=t,t&&U!==n.value&&(U=n.value,_.reset(),G.value="",window.localStorage.setItem("giftcard-message",""),G.parentNode.classList.remove("has-content"),G.style.height="29px",I.reset(),T.forEach((e,t)=>{const n=Object(c.select)(".js-show-email",e),a=Object(c.select)("input",n);e.classList.toggle("is-selected",0===t),n.classList.toggle("is-hidden",0!==t),a.required=0===t,a.checked=0===t}),P.forEach(e=>{e.classList.toggle("is-primary",!1),e.classList.toggle("is-quaternary",!0),e.setAttribute("aria-pressed",!1),S.value=""}),Object(c.selectAll)(".has-content",w).forEach(e=>{e.classList.toggle("has-content",!1)}),1!=z&&Ee(),"physical"===n.value?(x&&x.classList.toggle("is-hidden",!1),h&&h.classList.toggle("is-hidden",!1),k&&k.classList.toggle("is-hidden",!0),v&&v.classList.toggle("is-hidden",!0),J.setAttribute("data-test","lblAddACustomMessage_GiftCard"),he(!0)):(k&&k.classList.toggle("is-hidden",!1),v&&v.classList.toggle("is-hidden",!1),x&&x.classList.toggle("is-hidden",!0),h&&h.classList.toggle("is-hidden",!0),J.setAttribute("data-test","lblAddACustomMessage_TheE-GiftCard"),he(!1)),Se("physical"===n.value,"select"))}TweenLite.set(document.body,{delay:1,onComplete:()=>{G.value="",window.localStorage.setItem("giftcard-message",""),G.parentNode.classList.remove("has-content"),G.style.height="29px"}}),Object(a.X)()||(A.forEach(e=>{e.setAttribute("aria-hidden","true")}),w.setAttribute("hidden","")),C.forEach((i,s)=>{0===s&&n(i,!0),i.addEventListener("click",e),i.addEventListener("keydown",t),Object(a.X)()||Object(c.select)("h2",i).setAttribute("aria-hidden",!0)})})(),G.addEventListener("input",Pe),window.addEventListener("unload",()=>{const e=Object(c.select)(".radio-big[value=physical]",Object(c.select)(".js-main-content"));e&&(e.checked=!0)},!1),d()(document.body,".js-balance-submit-cta","click",ue),P.forEach(e=>{e.addEventListener("click",()=>{X=!0,je(e)})}),S.addEventListener("input",()=>{X=!1,je()}),N.addEventListener("click",Oe),E.addEventListener("click",Le),H.forEach(e=>{e.addEventListener("click",Ee)}),q.addEventListener("click",_e),T.forEach(e=>{Object(c.select)("[type=radio]",e).addEventListener("change",ke)}),M.addEventListener("click",xe),Object(c.selectAll)("button",F).forEach((e,t)=>{e.addEventListener("click",()=>{me(),function(e){switch(e){case 1:e<z&&(m.classList.toggle("is-hidden-mobile",!0),j.classList.toggle("is-hidden-mobile",!0),w.classList.toggle("is-hidden-mobile",!1),E.setAttribute("hidden",""),O.setAttribute("hidden",""),y.setAttribute("hidden",""),L.classList.toggle("is-hidden",!1),L.removeAttribute("hidden"),ve(1),we(1));break;case 2:e<z&&_e()}}(t+1)})});const e=Object(c.select)(".js-balance-information-phone");if(e)if(-1!==e.getAttribute("href").indexOf("tel:")){const t=e.cloneNode(!0);t.removeAttribute("hidden"),Y=t.outerHTML}else{const t=Object(c.select)("span",e);Y=t.innerText}const t=Object(c.select)(".js-open-balance-cta");t&&t.addEventListener("click",()=>{re()}),d()(document.body,".js-open-other-balance-cta","click",()=>{window.document.DLKit.push("on-giftcard-check-other-card-number",{eventCategory:"card balance",eventAction:"check another",eventLabel:"",event:"uaevent"}),s.a.hide(),i.C.subscribe(i.B,re)}),i.C.subscribe(i.i,ge)}const re=()=>{let e;e="gb"==config.country.toLowerCase()?ne.numbersHelpDescriptionUk:ne.numbersHelpDescription;const t='<div class="popin-text text-center balance-popin-content" data-close-label="'.concat(ne.closeBtn,'">\n                              <h1 class="js-balance-popin-title balance-popin-title text-center">').concat(ne.title,'</h1>\n                              <p class="js-balance-popin-description balance-popin-description">').concat(ne.description,'</p>\n                              <form novalidate method="post" class="js-verify-balance-form" id="verify-balance-form">\n                                <div class="balance-form">\n                                    <div class="field card-number-field">\n                                        <div class="label-input js-label-input is-ready">\n                                            <label class="label-input__label" for="balance-card-number">').concat(ne.formCardNumberLabel,'</label>\n                                            <input class="label-input__input js-balance-card-number js-verify-balance-input" type="number" aria-required="true" id="balance-card-number" data-error-message="emptyCardNumber">\n                                        </div>\n                                    </div>\n                                    <div class="field pin-field">\n                                        <div class="label-input js-label-input is-ready">\n                                            <label class="label-input__label" for="balance-pin">').concat(ne.formCardPinLabel,'</label>\n                                            <input class="label-input__input js-balance-pin js-verify-balance-input" type="number"  aria-required="true" id="balance-pin" data-error-message="emptyCardPin">\n                                        </div>\n                                    </div>\n                                    <div class="balance-number-container">\n                                        <button type="button" class="js-balance-numbers-help-cta balance-numbers-help-cta link is-underline"><span>').concat(ne.formNumbersHelp,'</span></button>\n                                        <div class="js-balance-numbers-help-container balance-numbers-help-container is-hidden">\n                                            <button class="button is-icon js-balance-help-conainer-close balance-help-conainer-close" type="button">\n                                                <svg class="icon is-small is-next" focusable="false" viewBox="0 0 1 1" aria-hidden="true">\n                                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="').concat(window.config.paths.icons,"icons.svg").concat(window.config.targetVersion,'#close"></use>\n                                                </svg>\n                                                <span class="is-sr-only">').concat(ne.numbersHelpCloseCta,'</span>\n                                            </button>\n                                            <p class="balance-numbers-help-description">').concat(e,'</p>\n                                            <div class="js-balance-numbers-help-image-container balance-numbers-help-image-container"></div>\n                                        </div>\n                                    </div>\n                                    <div class="g_recaptcha" id="g_recaptcha"></div>\n                                    ').concat(Object(a.Q)()?'<p class="balance-information">'.concat(ne.formInformations.replace("{1}",Y),"</p>"):"",'\n                                    <div class="balance-submit-container">\n                                      <button type="button" class="button is-primary js-balance-submit-cta balance-submit-cta" aria-label=\'').concat(ne.formSubmitCtaAriaLabel,"'>\n                                        <span>\n                                            <span>").concat(ne.formSubmitCta,"</span>\n                                        </span>\n                                      </button>\n                                    </div>\n                                </div>\n                              </form>\n                              ").concat(Object(a.Q)()?"":'<p class="balance-information">'.concat(ne.formInformations.replace("{1}",Y),"</p>"),"\n                         </div>");s.a.open({html:t,modifiers:"balance-popin js-balance-popin",modal:!0,role:"dialog",label:ne.title,forceInert:!0,manageFocus:!0,outerClose:!0}).then(e=>{be(),ae=Object(c.select)(".js-popin-close",e.modal.el),Object(a.m)(ae,{notChangeTabIndex:!0});const t=Object(c.select)(".js-balance-numbers-help-cta",e.modal.el),n=Object(c.select)(".js-balance-numbers-help-container",e.modal.el),i=Object(c.select)(".js-balance-help-conainer-close",e.modal.el),o=Object(c.select)(".js-balance-numbers-help-image-container",e.modal.el),r=Object(c.select)(".js-balance-popin .popin__col"),l=Object(c.select)(".js-balance-popin-title");t&&t.addEventListener("click",()=>{o&&(o.innerHTML='<img src="'.concat(window.config.paths.icons,"/media/giftcard_back.png").concat(window.config.targetVersion,'" class="balance-numbers-help-image" alt=""/>')),n&&n.classList.toggle("is-hidden"),t.classList.toggle("is-hidden"),i&&Object(a.m)(i,{notChangeTabIndex:!0}),Object(a.Q)()&&l.getBoundingClientRect().top<45&&(r.classList.add("balance-popin-ios"),ae.classList.add("balance-popin-close-ios")),le()}),i&&i.addEventListener("click",()=>{r.classList.remove("balance-popin-ios"),ae.classList.remove("balance-popin-close-ios"),o&&(o.innerHTML=""),n&&n.classList.toggle("is-hidden"),t&&t.classList.toggle("is-hidden"),t&&Object(a.m)(t)}),e.modal.el.addEventListener("click",e=>{Object(c.closest)(e.target,".popin__row")||s.a.hide()})}),window.document.DLKit.push("on-giftcard-balance",{eventCategory:"card balance",eventAction:"open pop in",eventLabel:"",event:"uaevent"}),i.C.unsubscribe(i.B)},le=()=>{window.document.DLKit.push("on-giftcard-find-number",{eventCategory:"card balance",eventAction:"find numbers",eventLabel:""})},de=()=>{TweenLite.set(document.body,{delay:.6,onComplete:()=>{const e=Object(c.select)(".js-balance-popin"),t=Object(c.select)("iframe[title='recaptcha challenge']");if(e&&t&&Object(a.Q)()){const n=t.parentNode.parentNode;document.body.insertBefore(e,n)}}})},be=()=>{const e=window.config.currentLanguage.substring(0,2),t=document.createElement("script");t.setAttribute("src",window.config.recaptchaCdn.replace("{0}",e)),t.setAttribute("async",!0),t.setAttribute("defer",!0);const n=Object(c.select)(".js-balance-popin");n&&document.body.insertBefore(t,n),window.onloadCallback=()=>{grecaptcha.render("g_recaptcha",{sitekey:window.config.gReCaptchaKey});const e=Object(c.select)("#g-recaptcha-response");e&&e.setAttribute("required","")},de()},ue=e=>{e.preventDefault();const t=Object(c.select)(".js-verify-balance-form");t&&(Ie(t),Me(t));const n=Object(c.select)(".js-balance-submit-cta");n&&(pe(n,!0),n.classList.add("is-disabled"));const i=Object(c.select)(".js-balance-pin"),s=Object(c.select)(".js-balance-card-number"),r=Object(c.getCollection)(".js-verify-balance-input").filter(e=>""===e.value);0===r.length&&0!==grecaptcha.getResponse().length?i&&s&&o.post(window.config.webservices.giftCardBalance,{data:{gcNumber:s.value,gcCVC:i.value}}).then(e=>{const t=()=>{const t=Object(c.select)(".balance-information");Object(c.getCollection)("p.js-balance-popin-description, .js-verify-balance-form").forEach(e=>{e.parentNode.removeChild(e)});const n=Object(c.select)(".js-balance-popin");n&&n.setAttribute("aria-label",ne.balanceSecondPopinAriaLabel);const i=Object(c.select)(".js-balance-popin-title");let s;i&&(i.innerText=ne.secondPopinTitle,i.classList.add("second-popin-title")),s="gb"==config.country.toLowerCase()?"".concat(window.config.gifcardCurrency).concat(e.amount):"nl"==config.country.toLowerCase()?"".concat(window.config.gifcardCurrency,"&nbsp;").concat(e.amount):"".concat(e.amount).concat(window.config.gifcardCurrency);const o=document.createElement("p");o.classList.add("amount-section"),o.innerHTML='<span class="balance-amount">'.concat(s,' </span><br><span class="balance-validity">').concat(ne.balanceValidity," ").concat(e.expiryDate,"</span>"),i.parentNode.insertBefore(o,i.nextSibling);const r=document.createElement("button");r.setAttribute("class","link has-icon is-cta js-open-other-balance-cta open-other-balance-cta"),r.setAttribute("type","button"),r.innerHTML="<span><span>".concat(ne.otherCardCta,"</span></span>"),Object(a.m)(ae,{notChangeTabIndex:!0}),Object(a.Q)()?(i.parentNode.insertBefore(t,i.lastElementChild),i.parentNode.insertBefore(r,i.lastElementChild)):t.parentNode.insertBefore(r,t)};if(e.amount&&(()=>{if(Object(c.select)(".g_recaptcha")&&Object(c.select)(".g_recaptcha").hasChildNodes())return!0})()&&grecaptcha){if(0===grecaptcha.getResponse().length)return fe(),void(n&&n.classList.remove("is-disabled"));t()}else null===e.error?t():(grecaptcha.reset(),de(),e.error&&"41"===e.error.errorCode?(ye(i.parentNode,window.config.locales.errors.form.global.giftcard.wrongCardPin,"wrongCardPin"),i.setAttribute("aria-describedby","wrongCardPin"),i.setAttribute("aria-invalid","true"),Object(a.m)(i,{notChangeTabIndex:!0})):e.error&&"2"===e.error.errorCode?(ye(s.parentNode,window.config.locales.errors.form.global.giftcard.wrongCardNumber,"wrongCardNumberError"),s.setAttribute("aria-describedby","wrongCardNumberError"),s.setAttribute("aria-invalid","true"),ye(i.parentNode,window.config.locales.errors.form.global.giftcard.wrongCardPin,"wrongCardPin"),i.setAttribute("aria-describedby","wrongCardPin"),i.setAttribute("aria-invalid","true"),Object(a.m)(s,{notChangeTabIndex:!0})):u.a.show({name:window.config.locales.notifier.request.label,message:window.config.locales.notifier.request.message,close:window.config.locales.notifier.request.close}));fe(),n&&n.classList.remove("is-disabled")}).catch(()=>{fe(),n&&n.classList.remove("is-disabled"),u.a.show({name:window.config.locales.notifier.request.label,message:window.config.locales.notifier.request.message,close:window.config.locales.notifier.request.close})}):(r.forEach(e=>{ye(e.parentNode,window.config.locales.errors.form.global.giftcard[e.getAttribute("data-error-message")],e.getAttribute("data-error-message"),n),e.setAttribute("aria-describedby",e.getAttribute("data-error-message")),e.setAttribute("aria-invalid","true")}),Object(a.m)(r[0],{notChangeTabIndex:!0}),fe(),n&&n.classList.remove("is-disabled")),window.document.DLKit.push("on-giftcard-check-balance",{eventCategory:"card balance",eventAction:"check",eventLabel:"",event:"uaevent"})};function ge(){1!==z||j.classList.contains("is-hidden-mobile")||(Object(a.X)()?w.removeAttribute("hidden"):w.setAttribute("hidden",""))}const pe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;ce=new b.a(e,{referenceEl:e,delay:n,button:t}),ce.init(),ce.create(c)},fe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;ce&&ce.destroy(e)},me=()=>{[L,I,L,_].forEach(e=>{Ie(e)})};function he(e){e?(F.classList.toggle("is-binary",!0),Q[2].remove()):(F.classList.toggle("is-binary",!1),se&&F.appendChild(se))}function ve(e){z=e,--e;Object(c.selectAll)("li",F).forEach((t,n)=>{const a=Object(c.select)(".step",t),i=Object(c.select)(".is-sr-only",t);n===e?(a.className="step active-step",i.innerHTML=window.config.locales.giftcard.activeStep,a.parentNode.disabled=!0):n===e-1?(a.className="step previous-active-step",i.innerHTML=window.config.locales.giftcard.previousStep,a.parentNode.disabled=!1):n>e?(a.className="step future-step",i.innerHTML=window.config.locales.giftcard.nextStep,a.parentNode.disabled=!0):(a.className="step",i.innerHTML=window.config.locales.giftcard.previousStep,a.parentNode.disabled=!1)})}function je(e){W=null,P.forEach(t=>{t===e?(W=e,W.setAttribute("aria-pressed",!0),t.classList.toggle("is-primary",!0),t.classList.toggle("is-quaternary",!1),S.value="",S.closest(".label-input").classList.toggle("has-content",!1)):t!==S&&(t.classList.toggle("is-primary",!1),t.classList.toggle("is-quaternary",!0),t.setAttribute("aria-pressed",!1))}),Ie(L)}function we(e){switch(e){case 1:case 2:case 3:document.title="".concat(window.config.locales.giftcard.title," ").concat(window.config.locales.giftcard.step," ").concat(e," ").concat(window.config.locales.giftcard.extra);break;default:document.title="".concat(window.config.locales.giftcard.title," ").concat(window.config.locales.giftcard.extra)}}function Le(){w.classList.toggle("is-hidden-mobile",!1),w.removeAttribute("hidden"),E.classList.toggle("is-hidden",!1),E.removeAttribute("hidden"),j.classList.toggle("is-hidden-mobile",!0),m.classList.toggle("is-hidden-mobile",!0),document.body.scrollTop=0;const e=Object(c.select)("h3",w);e.setAttribute("tabindex","-1"),e.focus(),ve(1),we(1)}function Oe(e){e.preventDefault(),Ie(_);const t=Object(c.getCollection)("input[data-required=true]",O).filter(e=>""===e.value);if(0===t.length)if("electronic"===U){if(!0===_.checkValidity()){let e;O.classList.toggle("is-hidden",!0),O.setAttribute("hidden",""),m.classList.toggle("is-hidden-mobile",!0),w.classList.toggle("is-hidden-mobile",!1),j.classList.toggle("is-hidden-mobile",!0),y.classList.toggle("is-hidden",!1),y.removeAttribute("hidden"),L.classList.toggle("is-hidden",!0),L.setAttribute("hidden",""),e=Object(c.select)("h3",y),e.setAttribute("tabindex","-1"),Se(!0,"add_custom_message","next_step"),ve(3),e.focus();const t=Object(c.select)(".js-egiftcard-sender"),n=Object(c.select)(".js-egiftcard-receiver"),a=Object(c.select)("#giftcard-sender"),i=Object(c.select)("#giftcard-receiver"),s=Object(c.select)(".js-giftcard-form-message"),o=Object(c.select)(".js-textarea");t&&a&&(t.value=a.value),n&&i&&(n.value=i.value),s&&o&&(s.value=o.value)}}else!0===_.checkValidity()&&Ce(_,"giftCard");else{const e={giftCardSender:window.config.locales.errors.form.global.giftcard.emptySenderInput,giftCardReceiver:window.config.locales.errors.form.global.giftcard.emptyReceiverInput};t.forEach(t=>{ye(t.parentNode,e[t.getAttribute("name")])}),Object(a.m)(t[0],{notChangeTabIndex:!0})}}const ye=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=document.createElement("p"),i=document.createTextNode(t);e.classList.add("has-error"),n&&c&&c.setAttribute("aria-describedby",n),a.classList.add("error"),a.setAttribute("id",n),a.dataset.errorMessage="true",a.appendChild(i);const s=e.parentNode;return s.appendChild(a),a},Ce=(e,t)=>{let n="giftCard"===t?giftCardProductData:eGiftCardProductData,i="eGiftCard"===t?Object(c.select)(".js-egiftcard-code"):Object(c.select)(".js-giftCard-code");const r=Object(c.select)(".js-giftcard-form-price",e);let l={eventLabel:n.product_name,eventAction:"regular quickbuy",eventCategory:"add to cart",event:"uaevent",ecommerce:{currencyCode:window.config.currentCurrency,add:{products:[{name:n.product_name,id:n.id,brand:n.brand,category:n.category,variant:n.variant,quantity:1,dimension18:n.collection,dimension19:n.sub_collection,dimension20:n.product_line,dimension21:n.outOfStockStatus,dimension22:n.fsh_modelcode,dimension23:n.fsh_articlecode,dimension25:n.product_axis,dimension26:n.fsh_sku_luxotica,dimension45:""}]}}};r&&(l.ecommerce.add.products[0].price=r.value),i&&(l.ecommerce.add.products[0].dimension8=i.value),window.document.DLKit.push("on-giftcard-add-to-bag",l,!1),"giftCard"===t?o.post(window.config.webservices.checkAddToBag).then(t=>{t.isWFJCnCPossible;let i=t.isWFJHDPossible,o=t.isNonWFJPossible,r=t.isOABServiceProductPresent;if(o&&!r)Ae(e);else{let t=n.product_name,o=i?"wfj.fnb":"cnc.hd";function l(e){"Escape"!==e.key&&"Esc"!==e.key&&27!==e.keyCode||(window.removeEventListener("keydown",l),s.a.hide())}Object(p.a)(o).then(n=>{window.document.DLKit.push("on-tracking",{eventCategory:"click and collect",eventAction:"mixed_cart_display",eventLabel:t,event:"nievent"});const i=Object(c.select)(".js-popin-close",n.modal.el);i&&Object(a.m)(i,{notChangeTabIndex:!0}),i.addEventListener("click",()=>{window.document.DLKit.push("on-tracking",{eventCategory:"click and collect",eventAction:"mixed_cart_close",eventLabel:t,event:"uaevent"})}),n.modal.el.addEventListener("click",e=>{Object(c.closest)(e.target,".popin__row")||s.a.hide()}),window.addEventListener("keydown",l);const o=Object(c.select)(".js-mixed-cart-confirmation-cancel-cta");o&&o.addEventListener("click",()=>{window.document.DLKit.push("on-tracking",{eventCategory:"click and collect",eventAction:"mixed_cart_cancel",eventLabel:t,event:"uaevent"}),s.a.hide()});const r=Object(c.select)(".js-mixed-cart-confirmation-popin-cta");r&&r.addEventListener("click",()=>{window.document.DLKit.push("on-tracking",{eventCategory:"click and collect",eventAction:"mixed_cart_continue",eventLabel:t,event:"uaevent"}),Ae(e),s.a.hide()})})}}):Ae(e)};function Ae(e){o.submit(e).then(()=>{r.a.open(window.config.popups["mini-cart"],e.querySelector('[type="submit"]'),()=>{const e=Object(c.select)(".js-cartItem-giftCard",r.a.currentModal.el);if(e){const t=Object(c.select)("a[href]",e);t&&(t.setAttribute("href",window.location.pathname),t.setAttribute("data-test","lnkGiftCard"));const n=Object(c.select)(".js-cart-price-item",e);n&&n.setAttribute("data-test","lblAmount")}}),D&&(D.classList.remove("has-product"),D.offsetHeight,D.classList.add("has-product"))}).catch(e=>{if(e.gcFormError){I&&Ie(I);const t=document.createElement("p");t.classList.add("error","giftcard-unit-error"),t.setAttribute("id","giftcard-unit-error");const n=Object(c.select)(".js-valid-message"),i=Object(c.select)(".js-valid-email");n&&n.setAttribute("aria-describedby","giftcard-unit-error"),i&&i.setAttribute("aria-describedby","giftcard-unit-error"),t.innerHTML=e.gcFormError,N.insertAdjacentHTML("afterend",t.outerHTML),M.parentNode.insertBefore(t,M.nextSibling),Object(a.m)(t)}else u.a.show({name:window.config.locales.notifier.request.label,message:window.config.locales.notifier.request.message,close:window.config.locales.notifier.request.close})})}function xe(e){e.preventDefault(),Ie(I);const t=Object(c.select)("#gc-myemail",I);t&&""===t.value?(ye(t.parentNode,window.config.locales.errors.form.global.giftcard.emptyMailInput),Object(a.m)(t,{notChangeTabIndex:!0})):I.checkValidity()?o.post(window.config.webservices.checkForGiftCard,{data:{isEGiftCard:!0}}).then(e=>{if(!0===e.isStandardProductPresent||!0===e.isOABServiceProductPresent){const t=e.isOABServiceProductPresent?"oab-giftcard-content":"content";Object(g.a)(t).then(e=>{ae=Object(c.select)(".js-popin-close",e.modal.el),Object(a.m)(ae,{notChangeTabIndex:!0}),e.modal.el.addEventListener("click",e=>{Object(c.closest)(e.target,".popin__row")||s.a.hide()});const t=Object(c.select)(".js-confirmation-cancel-cta");t&&t.addEventListener("click",()=>{s.a.hide()});const n=Object(c.select)(".js-confirmation-popin-cta");n&&n.addEventListener("click",()=>{Ce(I,"eGiftCard"),ie="false",s.a.hide()})})}else Ce(I,"eGiftCard")}):Object(a.m)(t,{notChangeTabIndex:!0})}function ke(){T.forEach(e=>{const t=Object(c.select)(".js-show-email",e),n=Object(c.select)("input",t);e===this.parentNode?(e.classList.toggle("is-selected",!0),t.classList.toggle("is-hidden",!1),n.required=!0):(e.classList.toggle("is-selected",!1),t.classList.toggle("is-hidden",!0),n.required=!1,n.value="")}),Ie(I)}function Ee(){m.classList.toggle("is-hidden-mobile",!1),j.classList.toggle("is-hidden-mobile",!1),w.classList.toggle("is-hidden-mobile",!0),E.classList.toggle("is-hidden",!1),E.removeAttribute("hidden"),L.classList.toggle("is-hidden",!1),L.removeAttribute("hidden"),y.classList.toggle("is-hidden",!0),y.setAttribute("hidden",""),O.classList.toggle("is-hidden",!0),O.setAttribute("hidden",""),ve(1),we(1);const e=Object(c.select)(".radio-big:checked",Object(c.select)(".js-main-content"));e.scrollIntoView(),e.focus(),Ie(L),Ie(I)}function _e(e){if(Ie(L),P.forEach(e=>{e.removeAttribute("aria-describedby")}),S.setAttribute("aria-describedby","currency-symbol"),e&&e.preventDefault(),G.value=window.localStorage.getItem("giftcard-message"),G.value.length>0&&G.parentNode.classList.add("has-content"),!0===X||""!==S.value&&parseInt(S.value)>=Z&&parseInt(S.value)<=$){O.classList.toggle("is-hidden",!1),O.removeAttribute("hidden");Object(c.select)(".button__wrapper span",N).innerHTML="physical"===U?window.config.locales.giftcard.addToBag:window.config.locales.giftcard.nextStep,L.setAttribute("hidden",""),L.classList.toggle("is-hidden",!0),y.setAttribute("hidden",""),y.classList.toggle("is-hidden",!0);const e=Object(c.select)(".js-card-amount[aria-pressed=true] .js-card-amount-number"),t=Object(c.select)(".js-giftcard-form-price",_);t&&(t.value=e?e.innerText.replace(/\s/g,""):S.value);const n=Object(c.select)(".js-giftcard-form-price",I);n&&(n.value=e?e.innerText.replace(/\s/g,""):S.value),ve(2);const a=Object(c.select)("h3",O);if(a&&(a.setAttribute("tabindex","-1"),a.focus()),W){const e="".concat(W.children[0].textContent.trim(),"_").concat(B.textContent.toUpperCase());Se("physical"===U,e,"next_step")}else Se("physical"===U,"".concat(S.value,"_").concat(B.textContent.toUpperCase()),"next_step")}else if(!1===X&&""===S.value){const e=ye(S.parentNode,window.config.locales.errors.form.global.giftcard.base);P.forEach(t=>{Te(e,t,"error-amount-value")}),Te(e,S,"error-amount-value"),S.focus()}else!1===X&&parseInt(S.value)<Z?("gb"===window.config.country.toLocaleLowerCase()?Te(Ne(S.parentNode,"".concat(te," ").concat(window.config.gifcardCurrency).concat(parseInt(Z).toFixed(0))),S,"error-min-amount-value"):Te(Ne(S.parentNode,"".concat(te," ").concat(parseInt(Z).toFixed(0))),S,"error-min-amount-value"),S.focus()):!1===X&&parseInt(S.value)>$&&("gb"===window.config.country.toLocaleLowerCase()?Te(Ne(S.parentNode,"".concat(ee," ").concat(window.config.gifcardCurrency).concat(parseInt($).toFixed(0))),S,"error-max-amount-value"):Te(Ne(S.parentNode,"".concat(ee," ").concat(parseInt($).toFixed(0))),S,"error-max-amount-value"),S.focus())}function Ne(e,t){const n=document.createElement("p"),c=document.createTextNode(t);n.classList.add("error","has-error"),n.dataset.errorMessage="true",n.appendChild(c),n.setAttribute("data-test","lblGlobalErrorMessageOrEnterAnAmount_TheGiftCard");return e.parentNode.appendChild(n),e.focus(),n}function Te(e,t,n){e.id=n;const c=t.getAttribute("aria-describedby");c&&(n+=" ".concat(c)),t.setAttribute("aria-describedby",n)}const Me=e=>{Object(c.getCollection)("input[type=number]",e).forEach(e=>{e.removeAttribute("aria-describedby"),e.removeAttribute("aria-invalid")})};function Ie(e){const t=e.querySelectorAll(".invalid-field"),n=e.querySelectorAll(".has-error"),c=e.querySelectorAll(".error");for(let e=0;e<t.length;++e)t[e].classList.remove("invalid-field"),t[e].removeAttribute("tabindex");for(let e=0;e<n.length;++e)n[e].classList.remove("has-error");for(let e=0;e<c.length;++e)c[e].parentNode.removeChild(c[e])}const Pe=e=>{V&&(V.innerHTML=window.config.giftcardMessageMaxChars*window.config.giftcardMessageMaxLines-e.target.value.length),K&&(K.innerHTML=window.config.giftcardMessageMaxLines-G.value.split("\n").length),G.value.length-G.value.split("\n").length+1>=190?(R.setAttribute("aria-live","assertive"),R.setAttribute("aria-atomic","false")):(R.removeAttribute("aria-live"),R.removeAttribute("aria-atomic")),window.localStorage.setItem("giftcard-message",e.target.value),e.target.checkValidity()};function Se(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";window.document.DLKit.push("on-giftcard-event",{eventCategory:e?"gift_card":"e_gift_card",eventAction:t,eventLabel:n,event:"uaevent"})}t.default=function(e){return new oe(e)}}}]);