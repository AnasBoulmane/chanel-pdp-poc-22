{"version":3,"sources":["webpack:///./patterns/scripts/pages/giftcard/index.js"],"names":["MODULE_SELECTOR","select","GIFTCARD_HEADER","CARD_PHYS_HEADER","CARD_ELEC_HEADER","CARD_SECTION","STEP_SECTION","AMOUNT_SECTION","MESSAGE_SECTION","MAIL_SECTION","CARD_SELECTORS","selectAll","CARD_TITLES","CARD_MOBILE_PHYS_DESCRIPTION","CARD_MOBILE_ELEC_DESCRIPTION","CARD_BUTTON","MESSAGE_FORM","MESSAGE_VALID_BUTTON","MAIL_CHOICES","MAIL_VALID_BUTTON","MAIL_FORM","CARD_AMOUNTS","CARD_CUSTOM_AMOUNT","AMOUNT_VALID_BUTTON","CARD_CHANGE_BUTTON","AMOUNT_SYMBOL","HEADER_CART_BTN","GIFT_CARD_STEPPER","GIFT_CARD_MESSAGE","GIFT_CARD_MESSAGE_LINES","GIFT_CARD_MESSAGE_CHARS","GIFT_CARD_MESSAGE_COUNTER","GIFT_CARD_MESSAGE_LABEL","OPEN_BALANCE_POPIN_CTA","BALANCE_POPIN_NUMBERS_HELP_CTA","BALANCE_INFORMATION_PHONE_NUMBER","BALANCE_NUMBER_HELP_CONTAINER","BALANCE_HELP_CONTAINER_CLOSE","BALANCE_HELP_IMAGE_CONTAINER","GIFTCARD_FORM_PRICE","VERIFY_BALANCE_CTA","BALANCE_PIN_INPUT","BALANCE_CARD_NUMBER_INPUT","OPEN_OTHER_CARD_BALANCE_CTA","PIN_FIELD_LABEL","CARDNUMBER_FIELD_LABEL","LIST_ELEMENTS","cardSelected","amountSelected","cardAmountSelected","currentStep","balancePhoneNumber","giftcardMinAmount","window","config","giftcardMaxAmount","giftcardMaxAmountError","locales","errors","form","global","giftcard","maxAmount","giftcardMinAmountError","minAmount","popinBalanceTexts","giftcardBalancePopin","loader","popinCloseBtn","isStandardProductPresent","isOABServiceProductPresent","egiftcardStep","GiftCard","init","addEventListener","input","checked","bind","document","body","verifyBalance","forEach","element","highlightAmountCardEvent","validCustomMessage","displayStepSection","resetToCardSelection","validateAmountStep","radioButton","toggleEmailSelection","validEGiftCardBeneficiary","idx","cleanAllFormsErrors","goToStep","phoneNumberLink","getAttribute","indexOf","newEl","cloneNode","removeAttribute","outerHTML","phoneNumberText","innerText","openBalancePopinCta","openBalancePopin","DLKit","push","eventCategory","eventAction","eventLabel","event","popin","hide","Manager","subscribe","MODAL_TRANSITION_END","BREAKPOINT_CHANGE","handleDesktopResize","popinBalanceHelpText","country","toLowerCase","numbersHelpDescriptionUk","numbersHelpDescription","popinTemplate","closeBtn","title","description","formCardNumberLabel","formCardPinLabel","formNumbersHelp","paths","icons","targetVersion","numbersHelpCloseCta","isMobileScreen","formInformations","replace","formSubmitCtaAriaLabel","formSubmitCta","open","html","modifiers","modal","role","label","forceInert","manageFocus","outerClose","then","createReCaptcha","el","focusElement","notChangeTabIndex","balanceNumbersHelpCta","balanceNumberHelpContainer","balanceNumbersHelpClose","balanceNumberHelpImageContainer","popinCol","popinTitle","innerHTML","classList","toggle","getBoundingClientRect","top","add","findNumberAnalytics","remove","e","closest","target","unsubscribe","isRecaptchaExists","hasChildNodes","moveBalancePopin","TweenLite","set","delay","onComplete","balancePopin","captchaEl","captchaParent","parentNode","insertBefore","currentCountry","currentLanguage","substring","recaptchaCdn","createElement","setAttribute","onloadCallback","grecaptcha","render","sitekey","gReCaptchaKey","captcha","preventDefault","balanceForm","cleanErrors","cleanBalanceAriaDescribedBy","balanceSubmit","showLoader","balancePinInput","balanceCardInput","requiredInputs","getCollection","filter","value","length","getResponse","xhr","webservices","giftCardBalance","data","gcNumber","gcCVC","res","showGiftCardBalance","balanceInformation","elementsToRemove","removeChild","balanceSecondPopinAriaLabel","secondPopinTitle","giftcardBalanceAmount","gifcardCurrency","amount","amountSection","balanceValidity","expiryDate","nextSibling","otherCardBalanceCta","otherCardCta","lastElementChild","destroyLoader","error","reset","errorCode","createErrorMessage","wrongCardPin","wrongCardNumber","notifier","show","name","request","message","close","catch","contains","isWideScreen","step","displayFirstStep","isButton","callback","Loader","referenceEl","button","create","destroy","availableForms","cardManagement","localStorage","setItem","style","height","toggleRadioButton","selectorCheckedCallback","handleKeyboard","keyCode","evt","MouseEvent","dispatchEvent","resetData","mailType","emailDiv","emailInput","required","giftcardMessageMaxChars","giftcardMessageMaxLines","radio","switchStepperDesign","bindAnalytics","binary","appendChild","setState","state","liElements","stepElement","isSrOnly","className","activeStep","disabled","previousStep","nextStep","elem","setPageTitle","extra","scrollTop","h3","focus","checkValidity","h2","egiftcardSenderInput","egiftcardReceiverInput","egiftCardSenderValue","egiftCardReceiverValue","egiftcardMessage","giftCardMessage","addToBag","messageFormErrors","giftCardSender","emptySenderInput","giftCardReceiver","emptyReceiverInput","domElement","id","elementDescribedBy","errorMsg","createTextNode","dataset","errorMessage","parent","formType","giftCardProduct","giftCardProductData","eGiftCardProductData","productSku","productPrice","addToCartAnalyticsObject","product_name","ecommerce","currencyCode","currentCurrency","products","brand","category","variant","quantity","dimension18","collection","dimension19","sub_collection","dimension20","product_line","dimension21","outOfStockStatus","dimension22","fsh_modelcode","dimension23","fsh_articlecode","dimension25","product_axis","dimension26","fsh_sku_luxotica","dimension45","price","dimension8","checkAddToBag","isWFJCnCPossible","isWFJHDPossible","isNonWFJPossible","submitGiftCardForm","productName","params","closeMergedModal","removeEventListener","onEscapeKeyMergedClicked","key","openMixedCartconfirmationPopin","confirmationPopinCancelCta","confirmationPopinCta","sidePanel","popups","querySelector","giftCardElementCart","currentModal","giftCardLink","location","pathname","giftCardAmount","offsetHeight","gcFormError","ctaDescribedBy","ctaEGCDescribedBy","insertAdjacentHTML","mailInput","emptyMailInput","checkForGiftCard","isEGiftCard","popinParam","openAddToBagConfirmationPopin","scrollIntoView","cleanAriaDescribedBy","getItem","parseInt","buttonText","cardAmountSlotValue","giftcardFormPrice","eGiftcardFormPrice","children","textContent","trim","toUpperCase","base","createAriaDescriptionOnError","toLocaleLowerCase","createErrorNode","toFixed","errorHTMLelement","inputHTMLelement","ariaID","aria","inputs","invalidClasses","querySelectorAll","hasErrorClasses","errorMessages","i","getMessageValue","countMessage","split","physicalCard"],"mappings":"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","file":"chunks/giftcard.js?v=3.23","sourcesContent":["import { select, selectAll, closest, getCollection } from 'lib/selectors'\nimport { isWideScreen, focusElement, isMobileScreen, isiOS } from 'lib/helpers'\nimport { Manager, BREAKPOINT_CHANGE, ADD_TO_BAG, SIDEPANEL_QUICKVIEW_OPEN, MODAL_TRANSITION_END} from 'lib/events'\nimport popin from 'modules/popin'\nimport * as xhr from 'modules/fetch'\nimport sidePanel from 'modules/sidepanel'\nimport bind from 'delegate'\nimport Loader from 'ui/widgets/loader'\nimport notifier from 'modules/notifier'\nimport openAddToBagConfirmationPopin from 'lib/add-to-bag-confirmation-popin'\nimport openMixedCartconfirmationPopin from \"../../lib/mixed-cart-confirmation-popin\";\n\n// CONST VALUES\nconst MODULE_SELECTOR = select('.js-giftcard')\nconst GIFTCARD_HEADER = select('.js-giftcard-header')\nconst CARD_PHYS_HEADER = select('.js-giftcard-phys-header')\nconst CARD_ELEC_HEADER = select('.js-giftcard-elec-header')\n\nconst CARD_SECTION = select('.js-card-type-section', MODULE_SELECTOR)\nconst STEP_SECTION = select('.js-step-container', MODULE_SELECTOR)\nconst AMOUNT_SECTION = select('.js-giftcard-amount-section', MODULE_SELECTOR)\nconst MESSAGE_SECTION = select('.js-message-section', MODULE_SELECTOR)\nconst MAIL_SECTION = select('.js-beneficiary-section', MODULE_SELECTOR)\n\nconst CARD_SELECTORS = selectAll('.js-card-selector', MODULE_SELECTOR)\nconst CARD_TITLES = selectAll('.js-card-title', MODULE_SELECTOR)\nconst CARD_MOBILE_PHYS_DESCRIPTION = select('.js-mobile-phys-desc', MODULE_SELECTOR)\nconst CARD_MOBILE_ELEC_DESCRIPTION = select('.js-mobile-elec-desc', MODULE_SELECTOR)\nconst CARD_BUTTON = select('.js-cards-button', MODULE_SELECTOR)\n\nconst MESSAGE_FORM = select('.js-giftcard-form', MODULE_SELECTOR)\nconst MESSAGE_VALID_BUTTON = select('.js-valid-message', MODULE_SELECTOR)\n\nconst MAIL_CHOICES = selectAll('.js-mail-selection', MODULE_SELECTOR)\nconst MAIL_VALID_BUTTON = select('.js-valid-email', MODULE_SELECTOR)\nconst MAIL_FORM = select('.js-giftcard-email-form', MODULE_SELECTOR)\n\nconst CARD_AMOUNTS = selectAll('.js-card-amount', MODULE_SELECTOR)\nconst CARD_CUSTOM_AMOUNT = select('.js-custom-amount', MODULE_SELECTOR)\nconst AMOUNT_VALID_BUTTON = select('.js-valid-amount', MODULE_SELECTOR)\nconst CARD_CHANGE_BUTTON = selectAll('.js-change-card', MODULE_SELECTOR)\nconst AMOUNT_SYMBOL = select('.currency-symbol')\nconst HEADER_CART_BTN = select('.header .cart')\n\nconst GIFT_CARD_STEPPER = select('.js-giftcard-stepper', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE = select('.js-textarea', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_LINES = select('.js-giftcard-lines', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_CHARS = select('.js-giftcard-chars', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_COUNTER = select('.js-giftcard-message-counter', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_LABEL = select('.js-giftcad-message-label', MODULE_SELECTOR)\nconst OPEN_BALANCE_POPIN_CTA = '.js-open-balance-cta'\nconst BALANCE_POPIN_NUMBERS_HELP_CTA = '.js-balance-numbers-help-cta'\nconst BALANCE_INFORMATION_PHONE_NUMBER = '.js-balance-information-phone'\nconst BALANCE_NUMBER_HELP_CONTAINER = '.js-balance-numbers-help-container'\nconst BALANCE_HELP_CONTAINER_CLOSE = '.js-balance-help-conainer-close'\nconst BALANCE_HELP_IMAGE_CONTAINER = '.js-balance-numbers-help-image-container'\nconst GIFTCARD_FORM_PRICE = '.js-giftcard-form-price'\nconst VERIFY_BALANCE_CTA = '.js-balance-submit-cta'\nconst BALANCE_PIN_INPUT = '.js-balance-pin'\nconst BALANCE_CARD_NUMBER_INPUT = '.js-balance-card-number'\nconst OPEN_OTHER_CARD_BALANCE_CTA = '.js-open-other-balance-cta'\nconst PIN_FIELD_LABEL = '.js-verify-balance-form .pin-field .js-label-input'\nconst CARDNUMBER_FIELD_LABEL = '.js-verify-balance-form .card-number-field .js-label-input'\nconst LIST_ELEMENTS = selectAll('li', GIFT_CARD_STEPPER)\n\nlet cardSelected = null\nlet amountSelected = null\nlet cardAmountSelected = false\nlet currentStep = 1\nlet balancePhoneNumber = ''\nconst giftcardMinAmount = window.config.giftcardMinAmount\nconst giftcardMaxAmount = window.config.giftcardMaxAmount\nconst giftcardMaxAmountError = window.config.locales.errors.form.global.giftcard.maxAmount\nconst giftcardMinAmountError = window.config.locales.errors.form.global.giftcard.minAmount\nconst popinBalanceTexts = window.config.giftcardBalancePopin\nlet loader\nlet popinCloseBtn\nlet isStandardProductPresent = window.config.isStandardProductPresent\nlet isOABServiceProductPresent = window.config.isOABServiceProductPresent\nlet egiftcardStep = LIST_ELEMENTS ? LIST_ELEMENTS[2] : null\n\nfunction GiftCard() {\n  init()\n  window.addEventListener('unload', () => {\n    const input = select('.radio-big[value=physical]', select('.js-main-content'))\n    if (input) input.checked = true\n  }, false)\n\n  bind(document.body, VERIFY_BALANCE_CTA, 'click', verifyBalance)\n  CARD_AMOUNTS.forEach(element => {\n    element.addEventListener('click', () => {\n      cardAmountSelected = true\n      highlightAmountCardEvent(element)\n    })\n  })\n  CARD_CUSTOM_AMOUNT.addEventListener('input', () => {\n    cardAmountSelected = false\n    highlightAmountCardEvent()\n  })\n  MESSAGE_VALID_BUTTON.addEventListener('click', validCustomMessage)\n  CARD_BUTTON.addEventListener('click', displayStepSection)\n  CARD_CHANGE_BUTTON.forEach(element => {\n    element.addEventListener('click', resetToCardSelection)\n  })\n  AMOUNT_VALID_BUTTON.addEventListener('click', validateAmountStep)\n  MAIL_CHOICES.forEach(element => {\n    const radioButton = select('[type=radio]', element)\n    radioButton.addEventListener('change', toggleEmailSelection)\n  })\n  MAIL_VALID_BUTTON.addEventListener('click', validEGiftCardBeneficiary)\n\n  selectAll('button', GIFT_CARD_STEPPER).forEach((element, idx) => {\n    element.addEventListener('click', () => {\n      cleanAllFormsErrors()\n      goToStep(idx + 1)\n    })\n  })\n  const phoneNumberLink = select(BALANCE_INFORMATION_PHONE_NUMBER)\n  if (phoneNumberLink) {\n    if (phoneNumberLink.getAttribute('href').indexOf('tel:') !== -1) {\n      const newEl = phoneNumberLink.cloneNode(true)\n      newEl.removeAttribute('hidden')\n      balancePhoneNumber = newEl.outerHTML\n    } else {\n      const phoneNumberText = select('span', phoneNumberLink)\n      balancePhoneNumber = phoneNumberText.innerText\n    }\n  }\n  const openBalancePopinCta = select(OPEN_BALANCE_POPIN_CTA)\n  if (openBalancePopinCta) {\n    openBalancePopinCta.addEventListener('click', () => {\n      openBalancePopin()\n    })\n  }\n\n  bind(document.body, OPEN_OTHER_CARD_BALANCE_CTA, 'click', () => {\n    window.document.DLKit.push('on-giftcard-check-other-card-number', {\n      eventCategory: 'card balance',\n      eventAction: 'check another',\n      eventLabel: '',\n      event: 'uaevent'\n    })\n    popin.hide()\n    Manager.subscribe(MODAL_TRANSITION_END, openBalancePopin)\n  })\n\n  Manager.subscribe(BREAKPOINT_CHANGE, handleDesktopResize)\n}\n\n\nconst openBalancePopin = () => {\n  let popinBalanceHelpText;\n  if(config.country.toLowerCase() == 'gb'){\n    popinBalanceHelpText = popinBalanceTexts.numbersHelpDescriptionUk;\n  }else{\n    popinBalanceHelpText = popinBalanceTexts.numbersHelpDescription;\n  }\n  const popinTemplate = `<div class=\"popin-text text-center balance-popin-content\" data-close-label=\"${popinBalanceTexts.closeBtn}\">\n                              <h1 class=\"js-balance-popin-title balance-popin-title text-center\">${popinBalanceTexts.title}</h1>\n                              <p class=\"js-balance-popin-description balance-popin-description\">${popinBalanceTexts.description}</p>\n                              <form novalidate method=\"post\" class=\"js-verify-balance-form\" id=\"verify-balance-form\">\n                                <div class=\"balance-form\">\n                                    <div class=\"field card-number-field\">\n                                        <div class=\"label-input js-label-input is-ready\">\n                                            <label class=\"label-input__label\" for=\"balance-card-number\">${popinBalanceTexts.formCardNumberLabel}</label>\n                                            <input class=\"label-input__input js-balance-card-number js-verify-balance-input\" type=\"number\" aria-required=\"true\" id=\"balance-card-number\" data-error-message=\"emptyCardNumber\">\n                                        </div>\n                                    </div>\n                                    <div class=\"field pin-field\">\n                                        <div class=\"label-input js-label-input is-ready\">\n                                            <label class=\"label-input__label\" for=\"balance-pin\">${popinBalanceTexts.formCardPinLabel}</label>\n                                            <input class=\"label-input__input js-balance-pin js-verify-balance-input\" type=\"number\"  aria-required=\"true\" id=\"balance-pin\" data-error-message=\"emptyCardPin\">\n                                        </div>\n                                    </div>\n                                    <div class=\"balance-number-container\">\n                                        <button type=\"button\" class=\"js-balance-numbers-help-cta balance-numbers-help-cta link is-underline\"><span>${popinBalanceTexts.formNumbersHelp}</span></button>\n                                        <div class=\"js-balance-numbers-help-container balance-numbers-help-container is-hidden\">\n                                            <button class=\"button is-icon js-balance-help-conainer-close balance-help-conainer-close\" type=\"button\">\n                                                <svg class=\"icon is-small is-next\" focusable=\"false\" viewBox=\"0 0 1 1\" aria-hidden=\"true\">\n                                                    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${window.config.paths.icons}icons.svg${window.config.targetVersion}#close\"></use>\n                                                </svg>\n                                                <span class=\"is-sr-only\">${popinBalanceTexts.numbersHelpCloseCta}</span>\n                                            </button>\n                                            <p class=\"balance-numbers-help-description\">${popinBalanceHelpText}</p>\n                                            <div class=\"js-balance-numbers-help-image-container balance-numbers-help-image-container\"></div>\n                                        </div>\n                                    </div>\n                                    <div class=\"g_recaptcha\" id=\"g_recaptcha\"></div>\n                                    ${isMobileScreen() ? `<p class=\"balance-information\">${popinBalanceTexts.formInformations.replace('{1}', balancePhoneNumber)}</p>` : ''}\n                                    <div class=\"balance-submit-container\">\n                                      <button type=\"button\" class=\"button is-primary js-balance-submit-cta balance-submit-cta\" aria-label='${popinBalanceTexts.formSubmitCtaAriaLabel}'>\n                                        <span>\n                                            <span>${popinBalanceTexts.formSubmitCta}</span>\n                                        </span>\n                                      </button>\n                                    </div>\n                                </div>\n                              </form>\n                              ${!isMobileScreen() ? `<p class=\"balance-information\">${popinBalanceTexts.formInformations.replace('{1}', balancePhoneNumber)}</p>` : ''}\n                         </div>`\n\n  popin.open({\n    html: popinTemplate,\n    modifiers: 'balance-popin js-balance-popin',\n    modal: true,\n    role: 'dialog',\n    label: popinBalanceTexts.title,\n    forceInert: true,\n    manageFocus: true,\n    outerClose: true\n  }).then((modal) => {\n    createReCaptcha()\n    popinCloseBtn = select('.js-popin-close', modal.modal.el)\n    focusElement(popinCloseBtn, {notChangeTabIndex: true})\n    const balanceNumbersHelpCta = select(BALANCE_POPIN_NUMBERS_HELP_CTA, modal.modal.el)\n    const balanceNumberHelpContainer = select(BALANCE_NUMBER_HELP_CONTAINER, modal.modal.el)\n    const balanceNumbersHelpClose = select(BALANCE_HELP_CONTAINER_CLOSE, modal.modal.el)\n    const balanceNumberHelpImageContainer = select(BALANCE_HELP_IMAGE_CONTAINER, modal.modal.el)\n    const popinCol = select('.js-balance-popin .popin__col')\n    const popinTitle = select('.js-balance-popin-title')\n    if (balanceNumbersHelpCta) {\n      balanceNumbersHelpCta.addEventListener('click', () => {\n        if (balanceNumberHelpImageContainer) balanceNumberHelpImageContainer.innerHTML = `<img src=\"${window.config.paths.icons}/media/giftcard_back.png${window.config.targetVersion}\" class=\"balance-numbers-help-image\" alt=\"\"/>`\n        if (balanceNumberHelpContainer) balanceNumberHelpContainer.classList.toggle('is-hidden')\n        balanceNumbersHelpCta.classList.toggle('is-hidden')\n        if (balanceNumbersHelpClose) focusElement(balanceNumbersHelpClose, {notChangeTabIndex: true})\n        if (isMobileScreen() && popinTitle.getBoundingClientRect().top < 45) {\n          popinCol.classList.add('balance-popin-ios')\n          popinCloseBtn.classList.add('balance-popin-close-ios')\n        }\n        findNumberAnalytics()\n      })\n    }\n\n    if (balanceNumbersHelpClose) {\n      balanceNumbersHelpClose.addEventListener('click', () => {\n        popinCol.classList.remove('balance-popin-ios')\n        popinCloseBtn.classList.remove('balance-popin-close-ios')\n        if (balanceNumberHelpImageContainer) balanceNumberHelpImageContainer.innerHTML = ''\n        if (balanceNumberHelpContainer) balanceNumberHelpContainer.classList.toggle('is-hidden')\n        if (balanceNumbersHelpCta) balanceNumbersHelpCta.classList.toggle('is-hidden')\n        if (balanceNumbersHelpCta) focusElement(balanceNumbersHelpCta)\n      })\n    }\n    modal.modal.el.addEventListener('click', (e) => {\n      if (closest(e.target, '.popin__row')) return\n      popin.hide()\n    })\n  })\n\n  window.document.DLKit.push('on-giftcard-balance', {\n    eventCategory: 'card balance',\n    eventAction: 'open pop in',\n    eventLabel: '',\n    event: 'uaevent'\n  })\n  Manager.unsubscribe(MODAL_TRANSITION_END)\n}\n\nconst findNumberAnalytics = () => {\n  window.document.DLKit.push('on-giftcard-find-number', {\n    eventCategory: 'card balance',\n    eventAction: 'find numbers',\n    eventLabel: ''\n  })\n}\n\nconst isRecaptchaExists = () => {\n  if(select('.g_recaptcha') && select('.g_recaptcha').hasChildNodes()) {\n    return true\n  }\n}\n\nconst moveBalancePopin = () => {\n  TweenLite.set(document.body, {\n    delay: 0.6,\n    onComplete: () => {\n      const balancePopin = select('.js-balance-popin')\n      const captchaEl = select(\"iframe[title='recaptcha challenge']\")\n      if (balancePopin && captchaEl && isMobileScreen()) {\n        const captchaParent = captchaEl.parentNode.parentNode\n        document.body.insertBefore(balancePopin, captchaParent)\n      }\n    }\n  })\n}\n\nconst createReCaptcha = () => {\n  const currentCountry = window.config.currentLanguage.substring(0, 2)\n  const recaptchaCdn = document.createElement('script')\n  recaptchaCdn.setAttribute('src', window.config.recaptchaCdn.replace('{0}', currentCountry))\n  recaptchaCdn.setAttribute('async', true)\n  recaptchaCdn.setAttribute('defer', true)\n  const balancePopin = select('.js-balance-popin')\n  if (balancePopin) document.body.insertBefore(recaptchaCdn, balancePopin)\n  window.onloadCallback = () => {\n    grecaptcha.render('g_recaptcha', {\n     sitekey: window.config.gReCaptchaKey // when testing on local, replace window.config.gReCaptchaKey by this testing sitekey: '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI'\n    })\n    const captcha = select('#g-recaptcha-response')\n    if (captcha) {\n      captcha.setAttribute('required', '')\n    }\n  }\n  moveBalancePopin()\n}\n\nconst verifyBalance = (event) => {\n  event.preventDefault()\n  const balanceForm = select('.js-verify-balance-form')\n  if (balanceForm) {\n    cleanErrors(balanceForm)\n    cleanBalanceAriaDescribedBy(balanceForm)\n  }\n  const balanceSubmit = select(VERIFY_BALANCE_CTA)\n  if (balanceSubmit) {\n    showLoader(balanceSubmit, true)\n    balanceSubmit.classList.add('is-disabled')\n  }\n  const balancePinInput = select(BALANCE_PIN_INPUT)\n  const balanceCardInput = select(BALANCE_CARD_NUMBER_INPUT)\n  const requiredInputs = getCollection('.js-verify-balance-input').filter((e) => {\n    return e.value === ''\n  })\n  if (requiredInputs.length === 0 && grecaptcha.getResponse().length !== 0) {\n    if (balancePinInput && balanceCardInput) {\n      xhr.post(window.config.webservices.giftCardBalance, {\n        data: {\n          gcNumber: balanceCardInput.value,\n          gcCVC: balancePinInput.value\n        }\n      }).then(res => {\n        const showGiftCardBalance = () => {\n          const balanceInformation = select('.balance-information')\n          const elementsToRemove = getCollection('p.js-balance-popin-description, .js-verify-balance-form')\n          elementsToRemove.forEach(element => {\n            element.parentNode.removeChild(element)\n          })\n          const balancePopin = select('.js-balance-popin')\n          if (balancePopin) balancePopin.setAttribute('aria-label', popinBalanceTexts.balanceSecondPopinAriaLabel)\n          const popinTitle = select('.js-balance-popin-title')\n          if (popinTitle) {\n            popinTitle.innerText = popinBalanceTexts.secondPopinTitle\n            popinTitle.classList.add('second-popin-title')\n          }\n          let giftcardBalanceAmount;\n          if(config.country.toLowerCase() == 'gb'){\n            giftcardBalanceAmount=`${window.config.gifcardCurrency}${res.amount}`\n           }\n           else if(config.country.toLowerCase() == 'nl'){\n            giftcardBalanceAmount=`${window.config.gifcardCurrency}&nbsp;${res.amount}`\n           }\n           else{\n            giftcardBalanceAmount=`${res.amount}${window.config.gifcardCurrency}`\n           }\n          const amountSection = document.createElement('p')\n          amountSection.classList.add('amount-section')\n          amountSection.innerHTML = `<span class=\"balance-amount\">${giftcardBalanceAmount} </span><br><span class=\"balance-validity\">${popinBalanceTexts.balanceValidity} ${res.expiryDate}</span>`                           \n          popinTitle.parentNode.insertBefore(amountSection, popinTitle.nextSibling)\n          const otherCardBalanceCta = document.createElement('button')\n          otherCardBalanceCta.setAttribute('class', 'link has-icon is-cta js-open-other-balance-cta open-other-balance-cta')\n          otherCardBalanceCta.setAttribute('type', 'button')\n          otherCardBalanceCta.innerHTML = `<span><span>${popinBalanceTexts.otherCardCta}</span></span>`\n          focusElement(popinCloseBtn, {notChangeTabIndex: true})\n          if (isMobileScreen()) {\n            popinTitle.parentNode.insertBefore(balanceInformation, popinTitle.lastElementChild)\n            popinTitle.parentNode.insertBefore(otherCardBalanceCta, popinTitle.lastElementChild)\n          } else {\n            balanceInformation.parentNode.insertBefore(otherCardBalanceCta, balanceInformation)\n          }\n        }\n        if (res.amount && isRecaptchaExists() && grecaptcha) {\n          if (grecaptcha.getResponse().length === 0) {\n            destroyLoader()\n            if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n            return\n          }\n          showGiftCardBalance()\n        }\n        else if (res.error === null) {\n          showGiftCardBalance()\n        } else {\n          grecaptcha.reset()\n          moveBalancePopin()\n          if (res.error && res.error.errorCode === \"41\") {\n            createErrorMessage(balancePinInput.parentNode, window.config.locales.errors.form.global.giftcard.wrongCardPin, 'wrongCardPin')\n            balancePinInput.setAttribute('aria-describedby', 'wrongCardPin')\n            balancePinInput.setAttribute('aria-invalid', 'true')\n            focusElement(balancePinInput, {notChangeTabIndex: true} )\n          } else if (res.error && res.error.errorCode === \"2\") {\n            createErrorMessage(balanceCardInput.parentNode, window.config.locales.errors.form.global.giftcard.wrongCardNumber, 'wrongCardNumberError')\n            balanceCardInput.setAttribute('aria-describedby', 'wrongCardNumberError')\n            balanceCardInput.setAttribute('aria-invalid', 'true')\n            createErrorMessage(balancePinInput.parentNode, window.config.locales.errors.form.global.giftcard.wrongCardPin, 'wrongCardPin')\n            balancePinInput.setAttribute('aria-describedby', 'wrongCardPin')\n            balancePinInput.setAttribute('aria-invalid', 'true')\n            focusElement(balanceCardInput, {notChangeTabIndex: true})\n          } else {\n            notifier.show({\n              name: window.config.locales.notifier.request.label,\n              message: window.config.locales.notifier.request.message,\n              close: window.config.locales.notifier.request.close\n            })\n          }\n        }\n        destroyLoader()\n        if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n      }).catch(() => {\n        destroyLoader()\n        if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n        notifier.show({\n          name: window.config.locales.notifier.request.label,\n          message: window.config.locales.notifier.request.message,\n          close: window.config.locales.notifier.request.close\n        })\n\n      })\n    }\n  } else {\n    requiredInputs.forEach((element) => {\n      createErrorMessage(element.parentNode, window.config.locales.errors.form.global.giftcard[element.getAttribute('data-error-message')], element.getAttribute('data-error-message'), balanceSubmit)\n      element.setAttribute('aria-describedby', element.getAttribute('data-error-message'))\n      element.setAttribute('aria-invalid', 'true')\n    })\n    focusElement(requiredInputs[0], {notChangeTabIndex: true})\n    destroyLoader()\n    if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n  }\n  window.document.DLKit.push('on-giftcard-check-balance', {\n    eventCategory: 'card balance',\n    eventAction: 'check',\n    eventLabel: '',\n    event: 'uaevent'\n  })\n}\n\nfunction handleDesktopResize() {\n  if (currentStep === 1 && !CARD_SECTION.classList.contains('is-hidden-mobile')) {\n    (isWideScreen()) ? STEP_SECTION.removeAttribute('hidden') : STEP_SECTION.setAttribute('hidden', '')\n  }\n}\n\nfunction goToStep(step) {\n  switch (step) {\n    case 1:\n      if (step < currentStep) displayFirstStep()\n      break\n    case 2:\n      if (step < currentStep) validateAmountStep()\n      break\n  }\n}\n\nconst showLoader = (element, isButton = false, delay = 0, callback = null) => {\n  loader = new Loader(element, {\n    referenceEl: element,\n    delay: delay,\n    button: isButton\n  })\n  loader.init()\n  loader.create(callback)\n}\n\nconst destroyLoader = (callback = null) => {\n  if (loader) {\n    loader.destroy(callback)\n  }\n\n}\n\nconst cleanAllFormsErrors = () => {\n  const availableForms = [AMOUNT_SECTION, MAIL_FORM, AMOUNT_SECTION, MESSAGE_FORM]\n  availableForms.forEach(form => {\n    cleanErrors(form)\n  })\n}\n\nfunction cardManagement() {\n  TweenLite.set(document.body, {\n    delay: 1,\n    onComplete: () => {\n      GIFT_CARD_MESSAGE.value = ''\n      window.localStorage.setItem('giftcard-message', '')\n      GIFT_CARD_MESSAGE.parentNode.classList.remove('has-content')\n      GIFT_CARD_MESSAGE.style.height = '29px'\n    }\n  })\n  if (!isWideScreen()) {\n    CARD_TITLES.forEach(element => {\n      element.setAttribute('aria-hidden', 'true')\n    })\n    STEP_SECTION.setAttribute('hidden', '')\n  }\n\n  CARD_SELECTORS.forEach((element, idx) => {\n    if (idx === 0) {\n      toggleRadioButton(element, true)\n    }\n    element.addEventListener('click', selectorCheckedCallback)\n    element.addEventListener('keydown', handleKeyboard)\n\n    if (!isWideScreen()) {\n      select('h2', element).setAttribute('aria-hidden', true)\n    }\n  })\n\n  function selectorCheckedCallback() {\n    cleanAllFormsErrors()\n    CARD_SELECTORS.forEach(element => {\n      if (element === this) {\n        toggleRadioButton(element, true)\n      } else {\n        toggleRadioButton(element, false)\n      }\n    })\n  }\n\n  function handleKeyboard(e) {\n    // Space or Enter\n    if (e.keyCode === 13 || e.keyCode === 32) {\n      const evt = new MouseEvent('click')\n      this.dispatchEvent(evt)\n    }\n  }\n\n  function resetData() {\n    MESSAGE_FORM.reset()\n    GIFT_CARD_MESSAGE.value = ''\n    window.localStorage.setItem('giftcard-message', '')\n    GIFT_CARD_MESSAGE.parentNode.classList.remove('has-content')\n    GIFT_CARD_MESSAGE.style.height ='29px'\n\n    MAIL_FORM.reset()\n\n    MAIL_CHOICES.forEach((mailType, idx) => {\n      const emailDiv = select('.js-show-email', mailType)\n      const emailInput = select('input', emailDiv)\n      mailType.classList.toggle('is-selected', (idx === 0))\n      emailDiv.classList.toggle('is-hidden', idx !== 0)\n      emailInput.required = (idx === 0)\n      emailInput.checked = (idx === 0)\n    })\n\n\n    CARD_AMOUNTS.forEach(element => {\n      element.classList.toggle('is-primary', false)\n      element.classList.toggle('is-quaternary', true)\n      element.setAttribute('aria-pressed', false)\n      CARD_CUSTOM_AMOUNT.value = ''\n    })\n\n    selectAll('.has-content', STEP_SECTION).forEach(element => {\n      element.classList.toggle('has-content', false)\n    })\n  }\n\n  function toggleRadioButton(element, value) {\n    cleanErrors(AMOUNT_SECTION)\n    GIFT_CARD_MESSAGE_CHARS.innerHTML = (window.config.giftcardMessageMaxChars * window.config.giftcardMessageMaxLines)\n    GIFT_CARD_MESSAGE_LINES.innerHTML = window.config.giftcardMessageMaxLines\n    cardAmountSelected = false\n    element.classList.toggle('selected', value)\n    const radio = select('input[type=radio]', element)\n    radio.checked = value\n    if (value && cardSelected !== radio.value) {\n      cardSelected = radio.value\n      resetData()\n      if (currentStep != 1) {\n        resetToCardSelection()\n      }\n\n      if (radio.value === 'physical') {\n        if (CARD_MOBILE_PHYS_DESCRIPTION) CARD_MOBILE_PHYS_DESCRIPTION.classList.toggle('is-hidden', false)\n        if (CARD_PHYS_HEADER) CARD_PHYS_HEADER.classList.toggle('is-hidden', false)\n\n        if (CARD_MOBILE_ELEC_DESCRIPTION) CARD_MOBILE_ELEC_DESCRIPTION.classList.toggle('is-hidden', true)\n        if (CARD_ELEC_HEADER) CARD_ELEC_HEADER.classList.toggle('is-hidden', true)\n\n        GIFT_CARD_MESSAGE_LABEL.setAttribute('data-test', 'lblAddACustomMessage_GiftCard')\n        switchStepperDesign(true)\n      } else {\n        if (CARD_MOBILE_ELEC_DESCRIPTION) CARD_MOBILE_ELEC_DESCRIPTION.classList.toggle('is-hidden', false)\n        if (CARD_ELEC_HEADER) CARD_ELEC_HEADER.classList.toggle('is-hidden', false)\n\n        if (CARD_MOBILE_PHYS_DESCRIPTION) CARD_MOBILE_PHYS_DESCRIPTION.classList.toggle('is-hidden', true)\n        if (CARD_PHYS_HEADER) CARD_PHYS_HEADER.classList.toggle('is-hidden', true)\n\n        GIFT_CARD_MESSAGE_LABEL.setAttribute('data-test', 'lblAddACustomMessage_TheE-GiftCard')\n        switchStepperDesign(false)\n      }\n      bindAnalytics(radio.value === 'physical', 'select')\n    }\n  }\n}\n\nfunction switchStepperDesign(binary) {\n  if (binary) {\n    GIFT_CARD_STEPPER.classList.toggle('is-binary', true)\n    LIST_ELEMENTS[2].remove()\n  } else {\n    GIFT_CARD_STEPPER.classList.toggle('is-binary', false)\n    if (egiftcardStep) GIFT_CARD_STEPPER.appendChild(egiftcardStep)\n  }\n}\n\nfunction setState(state) {\n  currentStep = state\n  --state\n  const liElements = selectAll('li', GIFT_CARD_STEPPER)\n  liElements.forEach((element, idx) => {\n    const stepElement = select('.step', element)\n    const isSrOnly = select('.is-sr-only', element)\n\n    if (idx === state) {\n      stepElement.className = 'step active-step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.activeStep\n      stepElement.parentNode.disabled = true\n    }\n    else if (idx === state - 1) {\n      stepElement.className = 'step previous-active-step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.previousStep\n      stepElement.parentNode.disabled = false\n    }\n    else if (idx > state) {\n      stepElement.className = 'step future-step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.nextStep\n      stepElement.parentNode.disabled = true\n    }\n    else {\n      stepElement.className = 'step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.previousStep\n      stepElement.parentNode.disabled = false\n    }\n  })\n}\n\nfunction highlightAmountCardEvent(elem) {\n  amountSelected = null\n  CARD_AMOUNTS.forEach(element => {\n    if (element === elem) {\n      amountSelected = elem\n      amountSelected.setAttribute('aria-pressed', true)\n      element.classList.toggle('is-primary', true)\n      element.classList.toggle('is-quaternary', false)\n      CARD_CUSTOM_AMOUNT.value = ''\n      CARD_CUSTOM_AMOUNT.closest('.label-input').classList.toggle('has-content', false)\n    } else if (element !== CARD_CUSTOM_AMOUNT) {\n      element.classList.toggle('is-primary', false)\n      element.classList.toggle('is-quaternary', true)\n      element.setAttribute('aria-pressed', false)\n    }\n  })\n  cleanErrors(AMOUNT_SECTION)\n}\n\nfunction setPageTitle(step) {\n  switch (step) {\n    case 1:\n    case 2:\n    case 3:\n      document.title = `${window.config.locales.giftcard.title} ${window.config.locales.giftcard.step} ${step} ${window.config.locales.giftcard.extra}`\n      break\n    default:\n      document.title = `${window.config.locales.giftcard.title} ${window.config.locales.giftcard.extra}`\n      break\n  }\n}\n\nfunction displayStepSection() {\n  STEP_SECTION.classList.toggle('is-hidden-mobile', false)\n  STEP_SECTION.removeAttribute('hidden')\n  CARD_BUTTON.classList.toggle('is-hidden', false)\n  CARD_BUTTON.removeAttribute('hidden')\n  CARD_SECTION.classList.toggle('is-hidden-mobile', true)\n  GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', true)\n  document.body.scrollTop = 0\n  const h3 = select('h3', STEP_SECTION)\n  h3.setAttribute('tabindex', '-1')\n  h3.focus()\n  setState(1)\n  setPageTitle(1)\n}\n\nfunction validCustomMessage(event) {\n  event.preventDefault()\n  cleanErrors(MESSAGE_FORM)\n  const requiredInputs = getCollection('input[data-required=true]', MESSAGE_SECTION).filter((e) => {\n    return e.value === ''\n  })\n\n  if (requiredInputs.length === 0) {\n    if (cardSelected === 'electronic') {\n      if (MESSAGE_FORM.checkValidity() === true) {\n        MESSAGE_SECTION.classList.toggle('is-hidden', true)\n        MESSAGE_SECTION.setAttribute('hidden', '')\n        GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', true)\n        STEP_SECTION.classList.toggle('is-hidden-mobile', false)\n        CARD_SECTION.classList.toggle('is-hidden-mobile', true)\n        let h2\n        MAIL_SECTION.classList.toggle('is-hidden', false)\n        MAIL_SECTION.removeAttribute('hidden')\n        AMOUNT_SECTION.classList.toggle('is-hidden', true)\n        AMOUNT_SECTION.setAttribute('hidden', '')\n        h2 = select('h3', MAIL_SECTION)\n        h2.setAttribute('tabindex', '-1')\n        bindAnalytics(true, 'add_custom_message', 'next_step')\n        setState(3)\n        h2.focus()\n        const egiftcardSenderInput = select('.js-egiftcard-sender')\n        const egiftcardReceiverInput = select('.js-egiftcard-receiver')\n        const egiftCardSenderValue = select('#giftcard-sender')\n        const egiftCardReceiverValue = select('#giftcard-receiver')\n        const egiftcardMessage = select('.js-giftcard-form-message')\n        const giftCardMessage = select('.js-textarea')\n        if (egiftcardSenderInput && egiftCardSenderValue) egiftcardSenderInput.value = egiftCardSenderValue.value\n        if (egiftcardReceiverInput && egiftCardReceiverValue) egiftcardReceiverInput.value = egiftCardReceiverValue.value\n        if (egiftcardMessage && giftCardMessage) egiftcardMessage.value = giftCardMessage.value\n      }\n    } else {\n      if (MESSAGE_FORM.checkValidity() === true) {\n        addToBag(MESSAGE_FORM, 'giftCard')\n      }\n    }\n  }\n  else {\n    const messageFormErrors = {\n      giftCardSender: window.config.locales.errors.form.global.giftcard.emptySenderInput,\n      giftCardReceiver: window.config.locales.errors.form.global.giftcard.emptyReceiverInput\n    }\n    requiredInputs.forEach((e) => {\n      createErrorMessage(e.parentNode, messageFormErrors[e.getAttribute('name')])\n    })\n    focusElement(requiredInputs[0], {notChangeTabIndex: true})\n  }\n}\n\nconst createErrorMessage = (domElement, message, id = null, elementDescribedBy = null) => {\n  const elem = document.createElement('p')\n  const errorMsg = document.createTextNode(message)\n  domElement.classList.add('has-error')\n  if (id && elementDescribedBy) elementDescribedBy.setAttribute('aria-describedby', id)\n  elem.classList.add('error')\n  elem.setAttribute('id', id)\n  elem.dataset.errorMessage = 'true'\n  elem.appendChild(errorMsg)\n  const parent = domElement.parentNode\n  parent.appendChild(elem)\n  return elem\n}\n\nconst addToBag = (form, formType) => {\n  let giftCardProduct = (formType ==='giftCard') ? giftCardProductData : eGiftCardProductData\n  let productSku = (formType === 'eGiftCard') ? select('.js-egiftcard-code') : select('.js-giftCard-code')\n  const productPrice = select('.js-giftcard-form-price', form)\n  let addToCartAnalyticsObject = {\n    eventLabel: giftCardProduct.product_name,\n    eventAction: 'regular quickbuy',\n    eventCategory: 'add to cart',\n    event: 'uaevent',\n    ecommerce: {\n      currencyCode: window.config.currentCurrency,\n      add: {\n        products: [{\n          name: giftCardProduct.product_name,\n          id: giftCardProduct.id,\n          brand: giftCardProduct.brand,\n          category: giftCardProduct.category,\n          variant: giftCardProduct.variant,\n          quantity: 1,\n          dimension18: giftCardProduct.collection,\n          dimension19: giftCardProduct.sub_collection,\n          dimension20: giftCardProduct.product_line,\n          dimension21: giftCardProduct.outOfStockStatus,\n          dimension22: giftCardProduct.fsh_modelcode,\n          dimension23: giftCardProduct.fsh_articlecode,\n          dimension25: giftCardProduct.product_axis,\n          dimension26: giftCardProduct.fsh_sku_luxotica,\n          dimension45: ''\n        }]\n      }\n    }\n  }\n  if (productPrice) addToCartAnalyticsObject.ecommerce.add.products[0].price = productPrice.value\n  if (productSku) addToCartAnalyticsObject.ecommerce.add.products[0].dimension8 = productSku.value\n  window.document.DLKit.push('on-giftcard-add-to-bag', addToCartAnalyticsObject, false)\n\n  if (formType === 'giftCard') {\n\n    xhr.post(window.config.webservices.checkAddToBag)\n      .then((res) => {\n        let isWFJCnCPossible = res.isWFJCnCPossible\n        let isWFJHDPossible = res.isWFJHDPossible\n        let isNonWFJPossible = res.isNonWFJPossible\n        let isOABServiceProductPresent = res.isOABServiceProductPresent\n\n        if (isNonWFJPossible && !isOABServiceProductPresent) {\n          submitGiftCardForm(form)\n        } else {\n          let productName = giftCardProduct.product_name\n          let params = isWFJHDPossible ? 'wfj.fnb' : 'cnc.hd'\n\n          function closeMergedModal() {\n            window.removeEventListener('keydown', onEscapeKeyMergedClicked)\n            popin.hide()\n          }\n\n          function onEscapeKeyMergedClicked(e) {\n            if ((e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27)) {\n              closeMergedModal()\n            }\n          }\n\n          openMixedCartconfirmationPopin(params).then((modal) => {\n            window.document.DLKit.push('on-tracking', {\n              'eventCategory': 'click and collect',\n              'eventAction': 'mixed_cart_display',\n              'eventLabel': productName,\n              'event': 'nievent'\n            })\n            const popinCloseBtn = select('.js-popin-close', modal.modal.el)\n            if (popinCloseBtn) focusElement(popinCloseBtn, { notChangeTabIndex: true })\n            popinCloseBtn.addEventListener('click', () => {\n              window.document.DLKit.push('on-tracking', {\n                'eventCategory': 'click and collect',\n                'eventAction': 'mixed_cart_close',\n                'eventLabel': productName,\n                'event': 'uaevent'\n              })\n            })\n            modal.modal.el.addEventListener('click', (e) => {\n              if (closest(e.target, '.popin__row')) return\n              popin.hide()\n            })\n            window.addEventListener('keydown', onEscapeKeyMergedClicked)\n\n            const confirmationPopinCancelCta = select('.js-mixed-cart-confirmation-cancel-cta')\n            if (confirmationPopinCancelCta) confirmationPopinCancelCta.addEventListener('click', () => {\n              window.document.DLKit.push('on-tracking', {\n                'eventCategory': 'click and collect',\n                'eventAction': 'mixed_cart_cancel',\n                'eventLabel': productName,\n                'event': 'uaevent'\n              })\n              popin.hide()\n            })\n\n            const confirmationPopinCta = select('.js-mixed-cart-confirmation-popin-cta')\n            if (confirmationPopinCta) confirmationPopinCta.addEventListener('click', () => {\n              window.document.DLKit.push('on-tracking', {\n                'eventCategory': 'click and collect',\n                'eventAction': 'mixed_cart_continue',\n                'eventLabel': productName,\n                'event': 'uaevent'\n              })\n              submitGiftCardForm(form)\n              popin.hide()\n            })\n          })\n        }\n      })\n  } else {\n    submitGiftCardForm(form)\n  }\n}\n\nfunction submitGiftCardForm(form) {\n  xhr.submit(form).then(() => {\n    sidePanel.open(window.config.popups['mini-cart'], form.querySelector('[type=\"submit\"]'), () => {\n      const giftCardElementCart = select('.js-cartItem-giftCard', sidePanel.currentModal.el)\n      if (giftCardElementCart) {\n        const giftCardLink = select('a[href]', giftCardElementCart)\n        if (giftCardLink) {\n          giftCardLink.setAttribute('href', window.location.pathname)\n          giftCardLink.setAttribute('data-test', 'lnkGiftCard')\n        }\n        const giftCardAmount = select('.js-cart-price-item', giftCardElementCart)\n        if (giftCardAmount) giftCardAmount.setAttribute('data-test', 'lblAmount')\n      }\n\n    })\n    if (HEADER_CART_BTN) {\n      HEADER_CART_BTN.classList.remove('has-product')\n      // trigger a reflow to restart the animation\n      void HEADER_CART_BTN.offsetHeight\n      HEADER_CART_BTN.classList.add('has-product')\n    }\n  }).catch(e => {\n    if (e.gcFormError) {\n      if (MAIL_FORM) cleanErrors(MAIL_FORM)\n      const errorMsg = document.createElement('p')\n      errorMsg.classList.add('error', 'giftcard-unit-error')\n      errorMsg.setAttribute('id', 'giftcard-unit-error')\n      const ctaDescribedBy = select('.js-valid-message')\n      const ctaEGCDescribedBy = select('.js-valid-email')\n      if (ctaDescribedBy) ctaDescribedBy.setAttribute('aria-describedby', 'giftcard-unit-error')\n      if (ctaEGCDescribedBy) ctaEGCDescribedBy.setAttribute('aria-describedby', 'giftcard-unit-error')\n      errorMsg.innerHTML = e.gcFormError\n      MESSAGE_VALID_BUTTON.insertAdjacentHTML(\"afterend\", errorMsg.outerHTML)\n      MAIL_VALID_BUTTON.parentNode.insertBefore(errorMsg, MAIL_VALID_BUTTON.nextSibling)\n      focusElement(errorMsg)\n    } else {\n      notifier.show({\n        name: window.config.locales.notifier.request.label,\n        message: window.config.locales.notifier.request.message,\n        close: window.config.locales.notifier.request.close\n      })\n    }\n  })\n}\n\nfunction validEGiftCardBeneficiary(event) {\n  event.preventDefault()\n  cleanErrors(MAIL_FORM)\n  const mailInput = select('#gc-myemail', MAIL_FORM)\n  if (mailInput && mailInput.value === '') {\n    createErrorMessage(mailInput.parentNode, window.config.locales.errors.form.global.giftcard.emptyMailInput)\n    focusElement(mailInput, {notChangeTabIndex: true})\n  } else if (!MAIL_FORM.checkValidity()) {\n    focusElement(mailInput, {notChangeTabIndex: true})\n  } else {\n    xhr.post(window.config.webservices.checkForGiftCard, {\n      data: {\n        isEGiftCard: true\n      }\n    }).then((res) => {\n      if (res.isStandardProductPresent === true || res.isOABServiceProductPresent === true) {\n        const popinParam = res.isOABServiceProductPresent ? 'oab-giftcard-content' : 'content'\n        openAddToBagConfirmationPopin(popinParam).then((modal) => {\n          popinCloseBtn = select('.js-popin-close', modal.modal.el)\n          focusElement(popinCloseBtn, {notChangeTabIndex: true})\n          modal.modal.el.addEventListener('click', (e) => {\n            if (closest(e.target, '.popin__row')) return\n            popin.hide()\n          })\n\n          const confirmationPopinCancelCta = select('.js-confirmation-cancel-cta')\n          if (confirmationPopinCancelCta) confirmationPopinCancelCta.addEventListener('click', () => {\n            popin.hide()\n          })\n\n          const confirmationPopinCta = select('.js-confirmation-popin-cta')\n          if (confirmationPopinCta) confirmationPopinCta.addEventListener('click', () => {\n            addToBag(MAIL_FORM, 'eGiftCard')\n            isStandardProductPresent = 'false'\n            popin.hide()\n          })\n        })\n      } else {\n        addToBag(MAIL_FORM, 'eGiftCard')\n      }\n    })\n  }\n}\n\n\nfunction toggleEmailSelection() {\n  MAIL_CHOICES.forEach(element => {\n    const emailDiv = select('.js-show-email', element)\n    const emailInput = select('input', emailDiv)\n    if (element === this.parentNode) {\n      element.classList.toggle('is-selected', true)\n      emailDiv.classList.toggle('is-hidden', false)\n      emailInput.required = true\n    } else {\n      element.classList.toggle('is-selected', false)\n      emailDiv.classList.toggle('is-hidden', true)\n      emailInput.required = false\n      emailInput.value = ''\n    }\n  })\n  cleanErrors(MAIL_FORM)\n}\n\nfunction displayFirstStep() {\n  GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', true)\n  CARD_SECTION.classList.toggle('is-hidden-mobile', true)\n  STEP_SECTION.classList.toggle('is-hidden-mobile', false)\n  CARD_BUTTON.setAttribute('hidden', '')\n  MESSAGE_SECTION.setAttribute('hidden', '')\n  MAIL_SECTION.setAttribute('hidden', '')\n  AMOUNT_SECTION.classList.toggle('is-hidden', false)\n  AMOUNT_SECTION.removeAttribute('hidden')\n  setState(1)\n  setPageTitle(1)\n}\n\nfunction resetToCardSelection() {\n  GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', false)\n  CARD_SECTION.classList.toggle('is-hidden-mobile', false)\n  STEP_SECTION.classList.toggle('is-hidden-mobile', true)\n  CARD_BUTTON.classList.toggle('is-hidden', false)\n  CARD_BUTTON.removeAttribute('hidden')\n  AMOUNT_SECTION.classList.toggle('is-hidden', false)\n  AMOUNT_SECTION.removeAttribute('hidden')\n  MAIL_SECTION.classList.toggle('is-hidden', true)\n  MAIL_SECTION.setAttribute('hidden', '')\n  MESSAGE_SECTION.classList.toggle('is-hidden', true)\n  MESSAGE_SECTION.setAttribute('hidden', '')\n  setState(1)\n  setPageTitle(1)\n  const input = select('.radio-big:checked', select('.js-main-content'))\n  input.scrollIntoView()\n  input.focus()\n  cleanErrors(AMOUNT_SECTION)\n  cleanErrors(MAIL_FORM)\n}\n\nfunction validateAmountStep(event) {\n  cleanErrors(AMOUNT_SECTION)\n  cleanAriaDescribedBy()\n  if (event) event.preventDefault()\n  GIFT_CARD_MESSAGE.value = window.localStorage.getItem('giftcard-message')\n  if (GIFT_CARD_MESSAGE.value.length > 0) GIFT_CARD_MESSAGE.parentNode.classList.add('has-content')\n  if (cardAmountSelected === true || (CARD_CUSTOM_AMOUNT.value !== '' && parseInt(CARD_CUSTOM_AMOUNT.value) >= giftcardMinAmount && parseInt(CARD_CUSTOM_AMOUNT.value) <= giftcardMaxAmount)) {\n    //    validate step\n    MESSAGE_SECTION.classList.toggle('is-hidden', false)\n    MESSAGE_SECTION.removeAttribute('hidden')\n\n    const buttonText = select('.button__wrapper span', MESSAGE_VALID_BUTTON)\n    buttonText.innerHTML = (cardSelected === 'physical') ? window.config.locales.giftcard.addToBag : window.config.locales.giftcard.nextStep\n\n    AMOUNT_SECTION.setAttribute('hidden', '')\n    AMOUNT_SECTION.classList.toggle('is-hidden', true)\n    MAIL_SECTION.setAttribute('hidden', '')\n    MAIL_SECTION.classList.toggle('is-hidden', true)\n    const cardAmountSlotValue = select('.js-card-amount[aria-pressed=true] .js-card-amount-number')\n    // giftCarddataObject.cardAmount = cardAmountSlotValue ? cardAmountSlotValue.innerText.replace(/\\s/g,'') : CARD_CUSTOM_AMOUNT.value\n    const giftcardFormPrice = select(GIFTCARD_FORM_PRICE, MESSAGE_FORM)\n    if (giftcardFormPrice) giftcardFormPrice.value = cardAmountSlotValue ? cardAmountSlotValue.innerText.replace(/\\s/g,'') : CARD_CUSTOM_AMOUNT.value\n    const eGiftcardFormPrice = select(GIFTCARD_FORM_PRICE, MAIL_FORM)\n    if (eGiftcardFormPrice) eGiftcardFormPrice.value = cardAmountSlotValue ? cardAmountSlotValue.innerText.replace(/\\s/g,'') : CARD_CUSTOM_AMOUNT.value\n    setState(2)\n\n    const h3 = select('h3', MESSAGE_SECTION)\n    if (h3) {\n      h3.setAttribute('tabindex', '-1')\n      h3.focus()\n    }\n    if (amountSelected) {\n      const value = `${amountSelected.children[0].textContent.trim()}_${AMOUNT_SYMBOL.textContent.toUpperCase()}`\n      bindAnalytics(cardSelected === 'physical', value, 'next_step')\n    }\n    else bindAnalytics(cardSelected === 'physical', `${CARD_CUSTOM_AMOUNT.value}_${AMOUNT_SYMBOL.textContent.toUpperCase()}`, 'next_step')\n  } else if (cardAmountSelected === false && CARD_CUSTOM_AMOUNT.value === '') {\n\n    const error = createErrorMessage(CARD_CUSTOM_AMOUNT.parentNode, window.config.locales.errors.form.global.giftcard.base)\n    CARD_AMOUNTS.forEach((element) => {\n      createAriaDescriptionOnError(error, element, 'error-amount-value')\n    })\n    createAriaDescriptionOnError(error, CARD_CUSTOM_AMOUNT, 'error-amount-value')\n    CARD_CUSTOM_AMOUNT.focus()\n  } else if (cardAmountSelected === false && parseInt(CARD_CUSTOM_AMOUNT.value) < giftcardMinAmount) {\n    if (window.config.country.toLocaleLowerCase() === 'gb') {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMinAmountError} ${window.config.gifcardCurrency}${parseInt(giftcardMinAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-min-amount-value')\n    } else {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMinAmountError} ${parseInt(giftcardMinAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-min-amount-value')\n    }\n    CARD_CUSTOM_AMOUNT.focus()\n  } else if (cardAmountSelected === false && parseInt(CARD_CUSTOM_AMOUNT.value) > giftcardMaxAmount) {\n    if (window.config.country.toLocaleLowerCase() === 'gb') {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMaxAmountError} ${window.config.gifcardCurrency}${parseInt(giftcardMaxAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-max-amount-value')\n    } else {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMaxAmountError} ${parseInt(giftcardMaxAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-max-amount-value')\n    }\n    CARD_CUSTOM_AMOUNT.focus()\n  }\n}\n\nfunction createErrorNode(domElement, message) {\n  const elem = document.createElement('p')\n  const errorMsg = document.createTextNode(message)\n  elem.classList.add('error', 'has-error')\n  elem.dataset.errorMessage = 'true'\n  elem.appendChild(errorMsg)\n  elem.setAttribute('data-test', 'lblGlobalErrorMessageOrEnterAnAmount_TheGiftCard')\n  const parent = domElement.parentNode\n  parent.appendChild(elem)\n  domElement.focus()\n  return elem\n}\n\nfunction createAriaDescriptionOnError(errorHTMLelement, inputHTMLelement, ariaID) {\n  errorHTMLelement.id = ariaID\n  const aria = inputHTMLelement.getAttribute('aria-describedby')\n  if (aria) ariaID += ` ${aria}`\n  inputHTMLelement.setAttribute('aria-describedby', ariaID)\n}\n\nfunction cleanAriaDescribedBy() {\n  CARD_AMOUNTS.forEach((element) => {\n    element.removeAttribute('aria-describedby')\n  })\n  CARD_CUSTOM_AMOUNT.setAttribute('aria-describedby', 'currency-symbol')\n}\n\nconst cleanBalanceAriaDescribedBy = (balanceForm) => {\n  const inputs = getCollection('input[type=number]', balanceForm)\n  inputs.forEach((element) => {\n    element.removeAttribute('aria-describedby')\n    element.removeAttribute('aria-invalid')\n  })\n}\n\nfunction cleanErrors(element) {\n  const invalidClasses = element.querySelectorAll('.invalid-field')\n  const hasErrorClasses = element.querySelectorAll('.has-error')\n  const errorMessages = element.querySelectorAll('.error')\n\n  for (let i = 0; i < invalidClasses.length; ++i) {\n    invalidClasses[i].classList.remove('invalid-field')\n    invalidClasses[i].removeAttribute('tabindex')\n  }\n  for (let i = 0; i < hasErrorClasses.length; ++i) {\n    hasErrorClasses[i].classList.remove('has-error')\n  }\n\n  // Remove any existing messages\n  for (let i = 0; i < errorMessages.length; ++i) {\n    errorMessages[i].parentNode.removeChild(errorMessages[i])\n  }\n}\n\nconst getMessageValue = () => {\n  GIFT_CARD_MESSAGE.addEventListener('input', countMessage)\n}\n\nconst countMessage = (e) => {\n  if (GIFT_CARD_MESSAGE_CHARS) {\n    GIFT_CARD_MESSAGE_CHARS.innerHTML = (window.config.giftcardMessageMaxChars * window.config.giftcardMessageMaxLines) - e.target.value.length\n  }\n  if (GIFT_CARD_MESSAGE_LINES) {\n    GIFT_CARD_MESSAGE_LINES.innerHTML = window.config.giftcardMessageMaxLines - GIFT_CARD_MESSAGE.value.split('\\n').length\n  }\n\n  if ((GIFT_CARD_MESSAGE.value.length - GIFT_CARD_MESSAGE.value.split('\\n').length + 1) >= 190) {\n    GIFT_CARD_MESSAGE_COUNTER.setAttribute('aria-live', 'assertive')\n    GIFT_CARD_MESSAGE_COUNTER.setAttribute('aria-atomic', 'false')\n  } else {\n    GIFT_CARD_MESSAGE_COUNTER.removeAttribute('aria-live')\n    GIFT_CARD_MESSAGE_COUNTER.removeAttribute('aria-atomic')\n  }\n  window.localStorage.setItem('giftcard-message', e.target.value)\n  e.target.checkValidity()\n}\n\nfunction bindAnalytics(physicalCard = true, eventAction = '', eventLabel = '') {\n  window.document.DLKit.push('on-giftcard-event', {\n    eventCategory: (physicalCard) ? 'gift_card' : 'e_gift_card',\n    eventAction,\n    eventLabel,\n    event: 'uaevent'\n  })\n}\n\nfunction init() {\n  cardManagement()\n  getMessageValue()\n}\n\nexport default function (el) {\n  return new GiftCard(el)\n}\n"],"sourceRoot":""}