{"version":3,"sources":["webpack:///./node_modules/flatpickr/dist/l10n lazy ^\\.\\/.*\\.js$ namespace object","webpack:///./patterns/scripts/pages/giftcard/index.js"],"names":["MODULE_SELECTOR","select","GIFTCARD_HEADER","CARD_PHYS_HEADER","CARD_ELEC_HEADER","CARD_SECTION","STEP_SECTION","AMOUNT_SECTION","MESSAGE_SECTION","MAIL_SECTION","CARD_SELECTORS","selectAll","CARD_TITLES","CARD_MOBILE_PHYS_DESCRIPTION","CARD_MOBILE_ELEC_DESCRIPTION","CARD_BUTTON","MESSAGE_FORM","MESSAGE_VALID_BUTTON","MAIL_CHOICES","MAIL_VALID_BUTTON","MAIL_FORM","CARD_AMOUNTS","CARD_CUSTOM_AMOUNT","AMOUNT_VALID_BUTTON","CARD_CHANGE_BUTTON","AMOUNT_SYMBOL","HEADER_CART_BTN","GIFT_CARD_STEPPER","GIFT_CARD_MESSAGE","GIFT_CARD_MESSAGE_LINES","GIFT_CARD_MESSAGE_CHARS","GIFT_CARD_MESSAGE_COUNTER","GIFT_CARD_MESSAGE_LABEL","OPEN_BALANCE_POPIN_CTA","BALANCE_POPIN_NUMBERS_HELP_CTA","BALANCE_INFORMATION_PHONE_NUMBER","BALANCE_NUMBER_HELP_CONTAINER","BALANCE_HELP_CONTAINER_CLOSE","BALANCE_HELP_IMAGE_CONTAINER","GIFTCARD_FORM_PRICE","VERIFY_BALANCE_CTA","BALANCE_PIN_INPUT","BALANCE_CARD_NUMBER_INPUT","OPEN_OTHER_CARD_BALANCE_CTA","PIN_FIELD_LABEL","CARDNUMBER_FIELD_LABEL","LIST_ELEMENTS","CALENDAR_CONTAINER","INPUT_FIELD","CALENDAR_YEAR_INPUT","CALENDAR_DATE_LABEL","LABEL_INPUT","CALENDAR_BUTTON","COUNTRY_SELECTED","window","config","currentLanguage","split","cardSelected","amountSelected","cardAmountSelected","currentStep","balancePhoneNumber","giftcardMinAmount","giftcardMaxAmount","giftcardMaxAmountError","locales","errors","form","global","giftcard","maxAmount","giftcardMinAmountError","minAmount","popinBalanceTexts","giftcardBalancePopin","loader","popinCloseBtn","isStandardProductPresent","isOABServiceProductPresent","egiftcardStep","calendarDateLabel","labelInput","isAtDateLinePosition","CalendarInstance","inputField","GiftCard","init","addEventListener","input","checked","bind","document","body","verifyBalance","forEach","element","highlightAmountCardEvent","validCustomMessage","displayStepSection","resetToCardSelection","validateAmountStep","radioButton","toggleEmailSelection","validEGiftCardBeneficiary","idx","cleanAllFormsErrors","goToStep","phoneNumberLink","getAttribute","indexOf","newEl","cloneNode","removeAttribute","outerHTML","phoneNumberText","innerText","openBalancePopinCta","openBalancePopin","DLKit","push","eventCategory","eventAction","eventLabel","event","popin","hide","Manager","subscribe","MODAL_TRANSITION_END","BREAKPOINT_CHANGE","handleDesktopResize","bindEvents","calendarContainer","flatpickr","dateFormat","country","minDate","clickOpens","allowInput","disableMobile","appendTo","wrap","locale","firstDayOfWeek","disable","date","onOpen","focus","isMobileScreen","setSelectionRange","onClose","setAttribute","activeElement","onReady","calendarYearInput","maxLength","onCalenderYearInput","xhr","webservices","eGCGiftCardAvailableDates","then","res","handleDateTimeResponse","onMonthChange","addBackground","elClone","parentNode","replaceChild","onInput","e","inputYear","value","replace","dateInputSelector","startPos","selectionStart","cursorPosition","classList","toggle","length","regex","values","map","v","test","toggleClearSubmit","add","join","isFilled","remove","popinBalanceHelpText","toLowerCase","numbersHelpDescriptionUk","numbersHelpDescription","popinTemplate","closeBtn","title","description","formCardNumberLabel","formCardPinLabel","formNumbersHelp","paths","icons","targetVersion","numbersHelpCloseCta","formInformations","formSubmitCtaAriaLabel","formSubmitCta","open","html","modifiers","modal","role","label","forceInert","manageFocus","outerClose","createReCaptcha","el","focusElement","notChangeTabIndex","balanceNumbersHelpCta","balanceNumberHelpContainer","balanceNumbersHelpClose","balanceNumberHelpImageContainer","popinCol","popinTitle","innerHTML","getBoundingClientRect","top","findNumberAnalytics","closest","target","unsubscribe","isRecaptchaExists","hasChildNodes","moveBalancePopin","TweenLite","set","delay","onComplete","balancePopin","captchaEl","captchaParent","insertBefore","currentCountry","substring","recaptchaCdn","createElement","onloadCallback","grecaptcha","render","sitekey","gReCaptchaKey","captcha","preventDefault","balanceForm","cleanErrors","cleanBalanceAriaDescribedBy","balanceSubmit","showLoader","balancePinInput","balanceCardInput","requiredInputs","getCollection","filter","getResponse","giftCardBalance","data","gcNumber","gcCVC","showGiftCardBalance","balanceInformation","elementsToRemove","removeChild","balanceSecondPopinAriaLabel","secondPopinTitle","giftcardBalanceAmount","gifcardCurrency","amount","amountSection","balanceValidity","expiryDate","nextSibling","otherCardBalanceCta","otherCardCta","lastElementChild","destroyLoader","error","reset","errorCode","createErrorMessage","wrongCardPin","wrongCardNumber","notifier","show","name","request","message","close","catch","contains","isWideScreen","step","displayFirstStep","isButton","callback","Loader","referenceEl","button","create","destroy","availableForms","cardManagement","localStorage","setItem","style","height","toggleRadioButton","selectorCheckedCallback","handleKeyboard","keyCode","evt","MouseEvent","dispatchEvent","resetData","mailType","emailDiv","emailInput","required","giftcardMessageMaxChars","giftcardMessageMaxLines","radio","switchStepperDesign","bindAnalytics","binary","appendChild","setState","state","liElements","stepElement","isSrOnly","className","activeStep","disabled","previousStep","nextStep","elem","setPageTitle","extra","scrollTop","h3","loadCalendar","localize","l10ns","console","log","err","checkValidity","sessionStorage","h2","SEND_LATER_RADIO","sendLaterCalendar","onScheduleEGCChanged","id","egiftcardSenderInput","egiftcardReceiverInput","egiftCardSenderValue","egiftCardReceiverValue","egiftcardMessage","giftCardMessage","addToBag","messageFormErrors","giftCardSender","emptySenderInput","giftCardReceiver","emptyReceiverInput","response","region","availableDates","Date","item","selectedDates","dateStr","instance","isOpen","getInputValueDate","domElement","elementDescribedBy","errorMsg","createTextNode","dataset","errorMessage","parent","formType","giftCardProduct","giftCardProductData","eGiftCardProductData","productSku","productPrice","addToCartAnalyticsObject","product_name","ecommerce","currencyCode","currentCurrency","products","brand","category","variant","quantity","dimension18","collection","dimension19","sub_collection","dimension20","product_line","dimension21","outOfStockStatus","dimension22","fsh_modelcode","dimension23","fsh_articlecode","dimension25","product_axis","dimension26","fsh_sku_luxotica","dimension45","price","dimension8","checkAddToBag","isWFJCnCPossible","isWFJHDPossible","isNonWFJPossible","submitGiftCardForm","productName","params","closeMergedModal","removeEventListener","onEscapeKeyMergedClicked","key","openMixedCartconfirmationPopin","confirmationPopinCancelCta","confirmationPopinCta","sidePanel","popups","querySelector","giftCardElementCart","currentModal","giftCardLink","location","pathname","giftCardAmount","offsetHeight","gcFormError","ctaDescribedBy","ctaEGCDescribedBy","insertAdjacentHTML","isDateSelected","firstAvailableDate","ariaLabel","allDates","getItem","dateString","newDate","month","getMonth","slice","day","getDate","year","getFullYear","mailInput","emptyMailInput","checkForGiftCard","isEGiftCard","popinParam","openAddToBagConfirmationPopin","scrollIntoView","cleanAriaDescribedBy","parseInt","buttonText","cardAmountSlotValue","giftcardFormPrice","eGiftcardFormPrice","children","textContent","trim","toUpperCase","base","createAriaDescriptionOnError","toLocaleLowerCase","createErrorNode","toFixed","errorHTMLelement","inputHTMLelement","ariaID","aria","inputs","invalidClasses","querySelectorAll","hasErrorClasses","errorMessages","i","getMessageValue","countMessage","physicalCard"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,qC;;;;;;;;;;;;;;;;;;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","file":"chunks/giftcard.js?v=3.23.0","sourcesContent":["var map = {\n\t\"./ar.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ar.js\",\n\t\t9\n\t],\n\t\"./at.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/at.js\",\n\t\t10\n\t],\n\t\"./be.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/be.js\",\n\t\t11\n\t],\n\t\"./bg.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/bg.js\",\n\t\t12\n\t],\n\t\"./bn.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/bn.js\",\n\t\t13\n\t],\n\t\"./cat.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/cat.js\",\n\t\t14\n\t],\n\t\"./cs.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/cs.js\",\n\t\t15\n\t],\n\t\"./cy.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/cy.js\",\n\t\t16\n\t],\n\t\"./da.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/da.js\",\n\t\t17\n\t],\n\t\"./de.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/de.js\",\n\t\t18\n\t],\n\t\"./default.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/default.js\",\n\t\t19\n\t],\n\t\"./eo.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/eo.js\",\n\t\t20\n\t],\n\t\"./es.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/es.js\",\n\t\t21\n\t],\n\t\"./et.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/et.js\",\n\t\t22\n\t],\n\t\"./fa.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/fa.js\",\n\t\t23\n\t],\n\t\"./fi.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/fi.js\",\n\t\t24\n\t],\n\t\"./fr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/fr.js\",\n\t\t25\n\t],\n\t\"./gr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/gr.js\",\n\t\t26\n\t],\n\t\"./he.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/he.js\",\n\t\t27\n\t],\n\t\"./hi.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/hi.js\",\n\t\t28\n\t],\n\t\"./hr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/hr.js\",\n\t\t29\n\t],\n\t\"./hu.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/hu.js\",\n\t\t30\n\t],\n\t\"./id.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/id.js\",\n\t\t31\n\t],\n\t\"./index.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/index.js\",\n\t\t32\n\t],\n\t\"./it.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/it.js\",\n\t\t33\n\t],\n\t\"./ja.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ja.js\",\n\t\t34\n\t],\n\t\"./km.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/km.js\",\n\t\t35\n\t],\n\t\"./ko.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ko.js\",\n\t\t36\n\t],\n\t\"./kz.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/kz.js\",\n\t\t37\n\t],\n\t\"./lt.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/lt.js\",\n\t\t38\n\t],\n\t\"./lv.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/lv.js\",\n\t\t39\n\t],\n\t\"./mk.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/mk.js\",\n\t\t40\n\t],\n\t\"./mn.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/mn.js\",\n\t\t41\n\t],\n\t\"./ms.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ms.js\",\n\t\t42\n\t],\n\t\"./my.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/my.js\",\n\t\t43\n\t],\n\t\"./nl.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/nl.js\",\n\t\t44\n\t],\n\t\"./no.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/no.js\",\n\t\t45\n\t],\n\t\"./pa.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/pa.js\",\n\t\t46\n\t],\n\t\"./pl.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/pl.js\",\n\t\t47\n\t],\n\t\"./pt.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/pt.js\",\n\t\t48\n\t],\n\t\"./ro.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ro.js\",\n\t\t49\n\t],\n\t\"./ru.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ru.js\",\n\t\t50\n\t],\n\t\"./si.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/si.js\",\n\t\t51\n\t],\n\t\"./sk.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sk.js\",\n\t\t52\n\t],\n\t\"./sl.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sl.js\",\n\t\t53\n\t],\n\t\"./sq.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sq.js\",\n\t\t54\n\t],\n\t\"./sr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sr.js\",\n\t\t55\n\t],\n\t\"./sv.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sv.js\",\n\t\t56\n\t],\n\t\"./th.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/th.js\",\n\t\t57\n\t],\n\t\"./tr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/tr.js\",\n\t\t58\n\t],\n\t\"./uk.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/uk.js\",\n\t\t59\n\t],\n\t\"./vn.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/vn.js\",\n\t\t60\n\t],\n\t\"./zh.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/zh.js\",\n\t\t61\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__.t(id, 7);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = \"./node_modules/flatpickr/dist/l10n lazy recursive ^\\\\.\\\\/.*\\\\.js$\";\nmodule.exports = webpackAsyncContext;","import { select, selectAll, closest, getCollection } from 'lib/selectors'\nimport { isWideScreen, focusElement, isMobileScreen, isiOS } from 'lib/helpers'\nimport { Manager, BREAKPOINT_CHANGE, ADD_TO_BAG, SIDEPANEL_QUICKVIEW_OPEN, MODAL_TRANSITION_END} from 'lib/events'\nimport popin from 'modules/popin'\nimport * as xhr from 'modules/fetch'\nimport sidePanel from 'modules/sidepanel'\nimport bind from 'delegate'\nimport Loader from 'ui/widgets/loader'\nimport notifier from 'modules/notifier'\nimport openAddToBagConfirmationPopin from 'lib/add-to-bag-confirmation-popin'\nimport openMixedCartconfirmationPopin from \"../../lib/mixed-cart-confirmation-popin\";\nimport flatpickr from \"flatpickr\"\n\n// CONST VALUES\nconst MODULE_SELECTOR = select('.js-giftcard')\nconst GIFTCARD_HEADER = select('.js-giftcard-header')\nconst CARD_PHYS_HEADER = select('.js-giftcard-phys-header')\nconst CARD_ELEC_HEADER = select('.js-giftcard-elec-header')\n\nconst CARD_SECTION = select('.js-card-type-section', MODULE_SELECTOR)\nconst STEP_SECTION = select('.js-step-container', MODULE_SELECTOR)\nconst AMOUNT_SECTION = select('.js-giftcard-amount-section', MODULE_SELECTOR)\nconst MESSAGE_SECTION = select('.js-message-section', MODULE_SELECTOR)\nconst MAIL_SECTION = select('.js-beneficiary-section', MODULE_SELECTOR)\n\nconst CARD_SELECTORS = selectAll('.js-card-selector', MODULE_SELECTOR)\nconst CARD_TITLES = selectAll('.js-card-title', MODULE_SELECTOR)\nconst CARD_MOBILE_PHYS_DESCRIPTION = select('.js-mobile-phys-desc', MODULE_SELECTOR)\nconst CARD_MOBILE_ELEC_DESCRIPTION = select('.js-mobile-elec-desc', MODULE_SELECTOR)\nconst CARD_BUTTON = select('.js-cards-button', MODULE_SELECTOR)\n\nconst MESSAGE_FORM = select('.js-giftcard-form', MODULE_SELECTOR)\nconst MESSAGE_VALID_BUTTON = select('.js-valid-message', MODULE_SELECTOR)\n\nconst MAIL_CHOICES = selectAll('.js-mail-selection', MODULE_SELECTOR)\nconst MAIL_VALID_BUTTON = select('.js-valid-email', MODULE_SELECTOR)\nconst MAIL_FORM = select('.js-giftcard-email-form', MODULE_SELECTOR)\n\nconst CARD_AMOUNTS = selectAll('.js-card-amount', MODULE_SELECTOR)\nconst CARD_CUSTOM_AMOUNT = select('.js-custom-amount', MODULE_SELECTOR)\nconst AMOUNT_VALID_BUTTON = select('.js-valid-amount', MODULE_SELECTOR)\nconst CARD_CHANGE_BUTTON = selectAll('.js-change-card', MODULE_SELECTOR)\nconst AMOUNT_SYMBOL = select('.currency-symbol')\nconst HEADER_CART_BTN = select('.header .cart')\n\nconst GIFT_CARD_STEPPER = select('.js-giftcard-stepper', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE = select('.js-textarea', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_LINES = select('.js-giftcard-lines', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_CHARS = select('.js-giftcard-chars', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_COUNTER = select('.js-giftcard-message-counter', MODULE_SELECTOR)\nconst GIFT_CARD_MESSAGE_LABEL = select('.js-giftcad-message-label', MODULE_SELECTOR)\nconst OPEN_BALANCE_POPIN_CTA = '.js-open-balance-cta'\nconst BALANCE_POPIN_NUMBERS_HELP_CTA = '.js-balance-numbers-help-cta'\nconst BALANCE_INFORMATION_PHONE_NUMBER = '.js-balance-information-phone'\nconst BALANCE_NUMBER_HELP_CONTAINER = '.js-balance-numbers-help-container'\nconst BALANCE_HELP_CONTAINER_CLOSE = '.js-balance-help-conainer-close'\nconst BALANCE_HELP_IMAGE_CONTAINER = '.js-balance-numbers-help-image-container'\nconst GIFTCARD_FORM_PRICE = '.js-giftcard-form-price'\nconst VERIFY_BALANCE_CTA = '.js-balance-submit-cta'\nconst BALANCE_PIN_INPUT = '.js-balance-pin'\nconst BALANCE_CARD_NUMBER_INPUT = '.js-balance-card-number'\nconst OPEN_OTHER_CARD_BALANCE_CTA = '.js-open-other-balance-cta'\nconst PIN_FIELD_LABEL = '.js-verify-balance-form .pin-field .js-label-input'\nconst CARDNUMBER_FIELD_LABEL = '.js-verify-balance-form .card-number-field .js-label-input'\nconst LIST_ELEMENTS = selectAll('li', GIFT_CARD_STEPPER)\nconst CALENDAR_CONTAINER = '.calendar-container'\nconst INPUT_FIELD = '.js-select-date-input'\nconst CALENDAR_YEAR_INPUT = '.flatpickr-current-month > div input'\nconst CALENDAR_DATE_LABEL = '.giftcard-visible-submit > div label'\nconst LABEL_INPUT = '.giftcard-visible-submit .js-label-input'\nconst CALENDAR_BUTTON = '.giftcard-visible-submit .calendar-button'\nconst COUNTRY_SELECTED = window.config.currentLanguage.split('_')[0]\n\nlet cardSelected = null\nlet amountSelected = null\nlet cardAmountSelected = false\nlet currentStep = 1\nlet balancePhoneNumber = ''\nconst giftcardMinAmount = window.config.giftcardMinAmount\nconst giftcardMaxAmount = window.config.giftcardMaxAmount\nconst giftcardMaxAmountError = window.config.locales.errors.form.global.giftcard.maxAmount\nconst giftcardMinAmountError = window.config.locales.errors.form.global.giftcard.minAmount\nconst popinBalanceTexts = window.config.giftcardBalancePopin\nlet loader\nlet popinCloseBtn\nlet isStandardProductPresent = window.config.isStandardProductPresent\nlet isOABServiceProductPresent = window.config.isOABServiceProductPresent\nlet egiftcardStep = LIST_ELEMENTS ? LIST_ELEMENTS[2] : null\nlet calendarDateLabel = select(CALENDAR_DATE_LABEL)\nlet labelInput = select(LABEL_INPUT)\nlet isAtDateLinePosition = 0\nlet CalendarInstance\nlet inputField\n\nfunction GiftCard() {\n  init()\n  window.addEventListener('unload', () => {\n    const input = select('.radio-big[value=physical]', select('.js-main-content'))\n    if (input) input.checked = true\n  }, false)\n\n  bind(document.body, VERIFY_BALANCE_CTA, 'click', verifyBalance)\n  CARD_AMOUNTS.forEach(element => {\n    element.addEventListener('click', () => {\n      cardAmountSelected = true\n      highlightAmountCardEvent(element)\n    })\n  })\n  CARD_CUSTOM_AMOUNT.addEventListener('input', () => {\n    cardAmountSelected = false\n    highlightAmountCardEvent()\n  })\n  MESSAGE_VALID_BUTTON.addEventListener('click', validCustomMessage)\n  CARD_BUTTON.addEventListener('click', displayStepSection)\n  CARD_CHANGE_BUTTON.forEach(element => {\n    element.addEventListener('click', resetToCardSelection)\n  })\n  AMOUNT_VALID_BUTTON.addEventListener('click', validateAmountStep)\n  MAIL_CHOICES.forEach(element => {\n    const radioButton = select('[type=radio]', element)\n    radioButton.addEventListener('change', toggleEmailSelection)\n  })\n  MAIL_VALID_BUTTON.addEventListener('click', validEGiftCardBeneficiary)\n\n  selectAll('button', GIFT_CARD_STEPPER).forEach((element, idx) => {\n    element.addEventListener('click', () => {\n      cleanAllFormsErrors()\n      goToStep(idx + 1)\n    })\n  })\n  const phoneNumberLink = select(BALANCE_INFORMATION_PHONE_NUMBER)\n  if (phoneNumberLink) {\n    if (phoneNumberLink.getAttribute('href').indexOf('tel:') !== -1) {\n      const newEl = phoneNumberLink.cloneNode(true)\n      newEl.removeAttribute('hidden')\n      balancePhoneNumber = newEl.outerHTML\n    } else {\n      const phoneNumberText = select('span', phoneNumberLink)\n      balancePhoneNumber = phoneNumberText.innerText\n    }\n  }\n  const openBalancePopinCta = select(OPEN_BALANCE_POPIN_CTA)\n  if (openBalancePopinCta) {\n    openBalancePopinCta.addEventListener('click', () => {\n      openBalancePopin()\n    })\n  }\n\n  bind(document.body, OPEN_OTHER_CARD_BALANCE_CTA, 'click', () => {\n    window.document.DLKit.push('on-giftcard-check-other-card-number', {\n      eventCategory: 'card balance',\n      eventAction: 'check another',\n      eventLabel: '',\n      event: 'uaevent'\n    })\n    popin.hide()\n    Manager.subscribe(MODAL_TRANSITION_END, openBalancePopin)\n  })\n\n  Manager.subscribe(BREAKPOINT_CHANGE, handleDesktopResize)\n}\n\n const bindEvents = () => {\n    let calendarContainer = select(CALENDAR_CONTAINER)\n    inputField = select(INPUT_FIELD)\n    CalendarInstance = flatpickr('.giftcard-visible-submit', {\n      dateFormat: window.config.country === 'JP' ? 'Y/m/d' : 'd/m/Y',\n      minDate: 'today',\n      clickOpens: false,\n      allowInput: true,\n      disableMobile: true,\n      appendTo: calendarContainer,\n      wrap: true,\n      locale: {\n        firstDayOfWeek: 1\n      },\n      disable: [\n        function(date) {\n          return (true)\n        }\n      ],\n      onOpen: () => {\n        if (calendarContainer) {\n          calendarContainer.removeAttribute('hidden')\n          inputField.removeAttribute('style')\n          inputField.focus()\n          if(isMobileScreen() && config.country !== 'JP' && isAtDateLinePosition == 0) {\n            inputField.setSelectionRange(2,2)\n            isAtDateLinePosition++\n          }\n        }\n      },\n      onClose: () => {\n        if (calendarContainer) {\n          calendarContainer.setAttribute('hidden', '')\n          if(isMobileScreen() && document.activeElement != inputField) isAtDateLinePosition = 0\n        }\n      },\n      onReady: () => {\n        let calendarYearInput = select(CALENDAR_YEAR_INPUT)\n        calendarYearInput.maxLength = 4\n        calendarYearInput.addEventListener('click', (calendarYearInput) => {\n          onCalenderYearInput()\n        })\n        xhr.get(window.config.webservices.eGCGiftCardAvailableDates).then((res) => {\n          handleDateTimeResponse(res)\n        })\n      },\n      onMonthChange: () => {\n        addBackground()\n      }\n    })\n\n    //Override the keydown eventlistener of the library that empty the field\n    //on key \"enter\"\n    const elClone = inputField.cloneNode(true)\n    inputField.parentNode.replaceChild(elClone, inputField)\n    inputField = select(INPUT_FIELD)\n    \n\n    // this.events.push(bind(this.el, CONFIRM_SELECTION_BUTTON, 'click', () => this.selectDateSlot()))\n    inputField.addEventListener('input', (event) => {\n      onInput(inputField, event)\n    })\n\n    inputField.addEventListener('click', (event) => {\n      if(isMobileScreen() && config.country !== 'JP' && this.isAtDateLinePosition == 0) {\n        this.inputField.setSelectionRange(2,2)\n        isAtDateLinePosition++\n      }\n      inputField.removeAttribute('style')\n    })\n  }\n\n const onCalenderYearInput = (e) => {\n    const inputYear = e.value.replace(/[^0-9]/g, '');\n    e.value = inputYear\n  }\n\nconst onInput = (dateInputSelector, event) => {\n    const startPos = dateInputSelector.selectionStart\n    let cursorPosition = startPos\n    dateInputSelector.classList.toggle('is-filled', dateInputSelector.value.length > 0)\n    const regex = /^[0-9/]/\n    const values = dateInputSelector.value.split().map((v) => {\n      if (!regex.test(dateInputSelector.value[startPos - 1])) {\n        cursorPosition = startPos - 1\n        toggleClearSubmit(dateInputSelector, calendarDateLabel)\n      } else {\n        //this.selectConfirmationButton.setAttribute('hidden', '')\n        labelInput.classList.add('has-content')\n        toggleClearSubmit(dateInputSelector, calendarDateLabel)\n      }\n      return v.replace(/[^0-9\\/]/g, '')\n    })\n    dateInputSelector.value = values.join('')\n    dateInputSelector.focus()\n    if (cursorPosition === -1) cursorPosition++\n    dateInputSelector.setSelectionRange(cursorPosition, cursorPosition)\n  }\n\n function toggleClearSubmit(inputField, calendarDateLabel) {\n    const isFilled = inputField.value.length > 0 ? 1 : 0\n    if (isFilled > 0) {\n      calendarDateLabel.classList.remove('no-pointer')\n    } else {\n      calendarDateLabel.classList.add('no-pointer')\n    }\n  }\n\nconst openBalancePopin = () => {\n  let popinBalanceHelpText;\n  if(config.country.toLowerCase() == 'gb'){\n    popinBalanceHelpText = popinBalanceTexts.numbersHelpDescriptionUk;\n  }else{\n    popinBalanceHelpText = popinBalanceTexts.numbersHelpDescription;\n  }\n  const popinTemplate = `<div class=\"popin-text text-center balance-popin-content\" data-close-label=\"${popinBalanceTexts.closeBtn}\">\n                              <h1 class=\"js-balance-popin-title balance-popin-title text-center\">${popinBalanceTexts.title}</h1>\n                              <p class=\"js-balance-popin-description balance-popin-description\">${popinBalanceTexts.description}</p>\n                              <form novalidate method=\"post\" class=\"js-verify-balance-form\" id=\"verify-balance-form\">\n                                <div class=\"balance-form\">\n                                    <div class=\"field card-number-field\">\n                                        <div class=\"label-input js-label-input is-ready\">\n                                            <label class=\"label-input__label\" for=\"balance-card-number\">${popinBalanceTexts.formCardNumberLabel}</label>\n                                            <input class=\"label-input__input js-balance-card-number js-verify-balance-input\" type=\"number\" aria-required=\"true\" id=\"balance-card-number\" data-error-message=\"emptyCardNumber\">\n                                        </div>\n                                    </div>\n                                    <div class=\"field pin-field\">\n                                        <div class=\"label-input js-label-input is-ready\">\n                                            <label class=\"label-input__label\" for=\"balance-pin\">${popinBalanceTexts.formCardPinLabel}</label>\n                                            <input class=\"label-input__input js-balance-pin js-verify-balance-input\" type=\"number\"  aria-required=\"true\" id=\"balance-pin\" data-error-message=\"emptyCardPin\">\n                                        </div>\n                                    </div>\n                                    <div class=\"balance-number-container\">\n                                        <button type=\"button\" class=\"js-balance-numbers-help-cta balance-numbers-help-cta link is-underline\"><span>${popinBalanceTexts.formNumbersHelp}</span></button>\n                                        <div class=\"js-balance-numbers-help-container balance-numbers-help-container is-hidden\">\n                                            <button class=\"button is-icon js-balance-help-conainer-close balance-help-conainer-close\" type=\"button\">\n                                                <svg class=\"icon is-small is-next\" focusable=\"false\" viewBox=\"0 0 1 1\" aria-hidden=\"true\">\n                                                    <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${window.config.paths.icons}icons.svg${window.config.targetVersion}#close\"></use>\n                                                </svg>\n                                                <span class=\"is-sr-only\">${popinBalanceTexts.numbersHelpCloseCta}</span>\n                                            </button>\n                                            <p class=\"balance-numbers-help-description\">${popinBalanceHelpText}</p>\n                                            <div class=\"js-balance-numbers-help-image-container balance-numbers-help-image-container\"></div>\n                                        </div>\n                                    </div>\n                                    <div class=\"g_recaptcha\" id=\"g_recaptcha\"></div>\n                                    ${isMobileScreen() ? `<p class=\"balance-information\">${popinBalanceTexts.formInformations.replace('{1}', balancePhoneNumber)}</p>` : ''}\n                                    <div class=\"balance-submit-container\">\n                                      <button type=\"button\" class=\"button is-primary js-balance-submit-cta balance-submit-cta\" aria-label='${popinBalanceTexts.formSubmitCtaAriaLabel}'>\n                                        <span>\n                                            <span>${popinBalanceTexts.formSubmitCta}</span>\n                                        </span>\n                                      </button>\n                                    </div>\n                                </div>\n                              </form>\n                              ${!isMobileScreen() ? `<p class=\"balance-information\">${popinBalanceTexts.formInformations.replace('{1}', balancePhoneNumber)}</p>` : ''}\n                         </div>`\n\n  popin.open({\n    html: popinTemplate,\n    modifiers: 'balance-popin js-balance-popin',\n    modal: true,\n    role: 'dialog',\n    label: popinBalanceTexts.title,\n    forceInert: true,\n    manageFocus: true,\n    outerClose: true\n  }).then((modal) => {\n    createReCaptcha()\n    popinCloseBtn = select('.js-popin-close', modal.modal.el)\n    focusElement(popinCloseBtn, {notChangeTabIndex: true})\n    const balanceNumbersHelpCta = select(BALANCE_POPIN_NUMBERS_HELP_CTA, modal.modal.el)\n    const balanceNumberHelpContainer = select(BALANCE_NUMBER_HELP_CONTAINER, modal.modal.el)\n    const balanceNumbersHelpClose = select(BALANCE_HELP_CONTAINER_CLOSE, modal.modal.el)\n    const balanceNumberHelpImageContainer = select(BALANCE_HELP_IMAGE_CONTAINER, modal.modal.el)\n    const popinCol = select('.js-balance-popin .popin__col')\n    const popinTitle = select('.js-balance-popin-title')\n    if (balanceNumbersHelpCta) {\n      balanceNumbersHelpCta.addEventListener('click', () => {\n        if (balanceNumberHelpImageContainer) balanceNumberHelpImageContainer.innerHTML = `<img src=\"${window.config.paths.icons}/media/giftcard_back.png${window.config.targetVersion}\" class=\"balance-numbers-help-image\" alt=\"\"/>`\n        if (balanceNumberHelpContainer) balanceNumberHelpContainer.classList.toggle('is-hidden')\n        balanceNumbersHelpCta.classList.toggle('is-hidden')\n        if (balanceNumbersHelpClose) focusElement(balanceNumbersHelpClose, {notChangeTabIndex: true})\n        if (isMobileScreen() && popinTitle.getBoundingClientRect().top < 45) {\n          popinCol.classList.add('balance-popin-ios')\n          popinCloseBtn.classList.add('balance-popin-close-ios')\n        }\n        findNumberAnalytics()\n      })\n    }\n\n    if (balanceNumbersHelpClose) {\n      balanceNumbersHelpClose.addEventListener('click', () => {\n        popinCol.classList.remove('balance-popin-ios')\n        popinCloseBtn.classList.remove('balance-popin-close-ios')\n        if (balanceNumberHelpImageContainer) balanceNumberHelpImageContainer.innerHTML = ''\n        if (balanceNumberHelpContainer) balanceNumberHelpContainer.classList.toggle('is-hidden')\n        if (balanceNumbersHelpCta) balanceNumbersHelpCta.classList.toggle('is-hidden')\n        if (balanceNumbersHelpCta) focusElement(balanceNumbersHelpCta)\n      })\n    }\n    modal.modal.el.addEventListener('click', (e) => {\n      if (closest(e.target, '.popin__row')) return\n      popin.hide()\n    })\n  })\n\n  window.document.DLKit.push('on-giftcard-balance', {\n    eventCategory: 'card balance',\n    eventAction: 'open pop in',\n    eventLabel: '',\n    event: 'uaevent'\n  })\n  Manager.unsubscribe(MODAL_TRANSITION_END)\n}\n\nconst findNumberAnalytics = () => {\n  window.document.DLKit.push('on-giftcard-find-number', {\n    eventCategory: 'card balance',\n    eventAction: 'find numbers',\n    eventLabel: ''\n  })\n}\n\nconst isRecaptchaExists = () => {\n  if(select('.g_recaptcha') && select('.g_recaptcha').hasChildNodes()) {\n    return true\n  }\n}\n\nconst moveBalancePopin = () => {\n  TweenLite.set(document.body, {\n    delay: 0.6,\n    onComplete: () => {\n      const balancePopin = select('.js-balance-popin')\n      const captchaEl = select(\"iframe[title='recaptcha challenge']\")\n      if (balancePopin && captchaEl && isMobileScreen()) {\n        const captchaParent = captchaEl.parentNode.parentNode\n        document.body.insertBefore(balancePopin, captchaParent)\n      }\n    }\n  })\n}\n\nconst createReCaptcha = () => {\n  const currentCountry = window.config.currentLanguage.substring(0, 2)\n  const recaptchaCdn = document.createElement('script')\n  recaptchaCdn.setAttribute('src', window.config.recaptchaCdn.replace('{0}', currentCountry))\n  recaptchaCdn.setAttribute('async', true)\n  recaptchaCdn.setAttribute('defer', true)\n  const balancePopin = select('.js-balance-popin')\n  if (balancePopin) document.body.insertBefore(recaptchaCdn, balancePopin)\n  window.onloadCallback = () => {\n    grecaptcha.render('g_recaptcha', {\n     sitekey: window.config.gReCaptchaKey // when testing on local, replace window.config.gReCaptchaKey by this testing sitekey: '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI'\n    })\n    const captcha = select('#g-recaptcha-response')\n    if (captcha) {\n      captcha.setAttribute('required', '')\n    }\n  }\n  moveBalancePopin()\n}\n\nconst verifyBalance = (event) => {\n  event.preventDefault()\n  const balanceForm = select('.js-verify-balance-form')\n  if (balanceForm) {\n    cleanErrors(balanceForm)\n    cleanBalanceAriaDescribedBy(balanceForm)\n  }\n  const balanceSubmit = select(VERIFY_BALANCE_CTA)\n  if (balanceSubmit) {\n    showLoader(balanceSubmit, true)\n    balanceSubmit.classList.add('is-disabled')\n  }\n  const balancePinInput = select(BALANCE_PIN_INPUT)\n  const balanceCardInput = select(BALANCE_CARD_NUMBER_INPUT)\n  const requiredInputs = getCollection('.js-verify-balance-input').filter((e) => {\n    return e.value === ''\n  })\n  if (requiredInputs.length === 0 && grecaptcha.getResponse().length !== 0) {\n    if (balancePinInput && balanceCardInput) {\n      xhr.post(window.config.webservices.giftCardBalance, {\n        data: {\n          gcNumber: balanceCardInput.value,\n          gcCVC: balancePinInput.value\n        }\n      }).then(res => {\n        const showGiftCardBalance = () => {\n          const balanceInformation = select('.balance-information')\n          const elementsToRemove = getCollection('p.js-balance-popin-description, .js-verify-balance-form')\n          elementsToRemove.forEach(element => {\n            element.parentNode.removeChild(element)\n          })\n          const balancePopin = select('.js-balance-popin')\n          if (balancePopin) balancePopin.setAttribute('aria-label', popinBalanceTexts.balanceSecondPopinAriaLabel)\n          const popinTitle = select('.js-balance-popin-title')\n          if (popinTitle) {\n            popinTitle.innerText = popinBalanceTexts.secondPopinTitle\n            popinTitle.classList.add('second-popin-title')\n          }\n          let giftcardBalanceAmount;\n          if(config.country.toLowerCase() == 'gb'){\n            giftcardBalanceAmount=`${window.config.gifcardCurrency}${res.amount}`\n           }\n           else if(config.country.toLowerCase() == 'nl'){\n            giftcardBalanceAmount=`${window.config.gifcardCurrency}&nbsp;${res.amount}`\n           }\n           else{\n            giftcardBalanceAmount=`${res.amount}${window.config.gifcardCurrency}`\n           }\n          const amountSection = document.createElement('p')\n          amountSection.classList.add('amount-section')\n          amountSection.innerHTML = `<span class=\"balance-amount\">${giftcardBalanceAmount} </span><br><span class=\"balance-validity\">${popinBalanceTexts.balanceValidity} ${res.expiryDate}</span>`                           \n          popinTitle.parentNode.insertBefore(amountSection, popinTitle.nextSibling)\n          const otherCardBalanceCta = document.createElement('button')\n          otherCardBalanceCta.setAttribute('class', 'link has-icon is-cta js-open-other-balance-cta open-other-balance-cta')\n          otherCardBalanceCta.setAttribute('type', 'button')\n          otherCardBalanceCta.innerHTML = `<span><span>${popinBalanceTexts.otherCardCta}</span></span>`\n          focusElement(popinCloseBtn, {notChangeTabIndex: true})\n          if (isMobileScreen()) {\n            popinTitle.parentNode.insertBefore(balanceInformation, popinTitle.lastElementChild)\n            popinTitle.parentNode.insertBefore(otherCardBalanceCta, popinTitle.lastElementChild)\n          } else {\n            balanceInformation.parentNode.insertBefore(otherCardBalanceCta, balanceInformation)\n          }\n        }\n        if (res.amount && isRecaptchaExists() && grecaptcha) {\n          if (grecaptcha.getResponse().length === 0) {\n            destroyLoader()\n            if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n            return\n          }\n          showGiftCardBalance()\n        }\n        else if (res.error === null) {\n          showGiftCardBalance()\n        } else {\n          grecaptcha.reset()\n          moveBalancePopin()\n          if (res.error && res.error.errorCode === \"41\") {\n            createErrorMessage(balancePinInput.parentNode, window.config.locales.errors.form.global.giftcard.wrongCardPin, 'wrongCardPin')\n            balancePinInput.setAttribute('aria-describedby', 'wrongCardPin')\n            balancePinInput.setAttribute('aria-invalid', 'true')\n            focusElement(balancePinInput, {notChangeTabIndex: true} )\n          } else if (res.error && res.error.errorCode === \"2\") {\n            createErrorMessage(balanceCardInput.parentNode, window.config.locales.errors.form.global.giftcard.wrongCardNumber, 'wrongCardNumberError')\n            balanceCardInput.setAttribute('aria-describedby', 'wrongCardNumberError')\n            balanceCardInput.setAttribute('aria-invalid', 'true')\n            createErrorMessage(balancePinInput.parentNode, window.config.locales.errors.form.global.giftcard.wrongCardPin, 'wrongCardPin')\n            balancePinInput.setAttribute('aria-describedby', 'wrongCardPin')\n            balancePinInput.setAttribute('aria-invalid', 'true')\n            focusElement(balanceCardInput, {notChangeTabIndex: true})\n          } else {\n            notifier.show({\n              name: window.config.locales.notifier.request.label,\n              message: window.config.locales.notifier.request.message,\n              close: window.config.locales.notifier.request.close\n            })\n          }\n        }\n        destroyLoader()\n        if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n      }).catch(() => {\n        destroyLoader()\n        if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n        notifier.show({\n          name: window.config.locales.notifier.request.label,\n          message: window.config.locales.notifier.request.message,\n          close: window.config.locales.notifier.request.close\n        })\n\n      })\n    }\n  } else {\n    requiredInputs.forEach((element) => {\n      createErrorMessage(element.parentNode, window.config.locales.errors.form.global.giftcard[element.getAttribute('data-error-message')], element.getAttribute('data-error-message'), balanceSubmit)\n      element.setAttribute('aria-describedby', element.getAttribute('data-error-message'))\n      element.setAttribute('aria-invalid', 'true')\n    })\n    focusElement(requiredInputs[0], {notChangeTabIndex: true})\n    destroyLoader()\n    if (balanceSubmit) balanceSubmit.classList.remove('is-disabled')\n  }\n  window.document.DLKit.push('on-giftcard-check-balance', {\n    eventCategory: 'card balance',\n    eventAction: 'check',\n    eventLabel: '',\n    event: 'uaevent'\n  })\n}\n\nfunction handleDesktopResize() {\n  if (currentStep === 1 && !CARD_SECTION.classList.contains('is-hidden-mobile')) {\n    (isWideScreen()) ? STEP_SECTION.removeAttribute('hidden') : STEP_SECTION.setAttribute('hidden', '')\n  }\n}\n\nfunction goToStep(step) {\n  switch (step) {\n    case 1:\n      if (step < currentStep) displayFirstStep()\n      break\n    case 2:\n      if (step < currentStep) validateAmountStep()\n      break\n  }\n}\n\nconst showLoader = (element, isButton = false, delay = 0, callback = null) => {\n  loader = new Loader(element, {\n    referenceEl: element,\n    delay: delay,\n    button: isButton\n  })\n  loader.init()\n  loader.create(callback)\n}\n\nconst destroyLoader = (callback = null) => {\n  if (loader) {\n    loader.destroy(callback)\n  }\n\n}\n\nconst cleanAllFormsErrors = () => {\n  const availableForms = [AMOUNT_SECTION, MAIL_FORM, AMOUNT_SECTION, MESSAGE_FORM]\n  availableForms.forEach(form => {\n    cleanErrors(form)\n  })\n}\n\nfunction cardManagement() {\n  TweenLite.set(document.body, {\n    delay: 1,\n    onComplete: () => {\n      GIFT_CARD_MESSAGE.value = ''\n      window.localStorage.setItem('giftcard-message', '')\n      GIFT_CARD_MESSAGE.parentNode.classList.remove('has-content')\n      GIFT_CARD_MESSAGE.style.height = '29px'\n    }\n  })\n  if (!isWideScreen()) {\n    CARD_TITLES.forEach(element => {\n      element.setAttribute('aria-hidden', 'true')\n    })\n    STEP_SECTION.setAttribute('hidden', '')\n  }\n\n  CARD_SELECTORS.forEach((element, idx) => {\n    if (idx === 0) {\n      toggleRadioButton(element, true)\n    }\n    element.addEventListener('click', selectorCheckedCallback)\n    element.addEventListener('keydown', handleKeyboard)\n\n    if (!isWideScreen()) {\n      select('h2', element).setAttribute('aria-hidden', true)\n    }\n  })\n\n  function selectorCheckedCallback() {\n    cleanAllFormsErrors()\n    CARD_SELECTORS.forEach(element => {\n      if (element === this) {\n        toggleRadioButton(element, true)\n      } else {\n        toggleRadioButton(element, false)\n      }\n    })\n  }\n\n  function handleKeyboard(e) {\n    // Space or Enter\n    if (e.keyCode === 13 || e.keyCode === 32) {\n      const evt = new MouseEvent('click')\n      this.dispatchEvent(evt)\n    }\n  }\n\n  function resetData() {\n    MESSAGE_FORM.reset()\n    GIFT_CARD_MESSAGE.value = ''\n    window.localStorage.setItem('giftcard-message', '')\n    GIFT_CARD_MESSAGE.parentNode.classList.remove('has-content')\n    GIFT_CARD_MESSAGE.style.height ='29px'\n\n    MAIL_FORM.reset()\n\n    MAIL_CHOICES.forEach((mailType, idx) => {\n      const emailDiv = select('.js-show-email', mailType)\n      const emailInput = select('input', emailDiv)\n      mailType.classList.toggle('is-selected', (idx === 0))\n      emailDiv.classList.toggle('is-hidden', idx !== 0)\n      emailInput.required = (idx === 0)\n      emailInput.checked = (idx === 0)\n    })\n\n\n    CARD_AMOUNTS.forEach(element => {\n      element.classList.toggle('is-primary', false)\n      element.classList.toggle('is-quaternary', true)\n      element.setAttribute('aria-pressed', false)\n      CARD_CUSTOM_AMOUNT.value = ''\n    })\n\n    selectAll('.has-content', STEP_SECTION).forEach(element => {\n      element.classList.toggle('has-content', false)\n    })\n  }\n\n  function toggleRadioButton(element, value) {\n    cleanErrors(AMOUNT_SECTION)\n    GIFT_CARD_MESSAGE_CHARS.innerHTML = (window.config.giftcardMessageMaxChars * window.config.giftcardMessageMaxLines)\n    GIFT_CARD_MESSAGE_LINES.innerHTML = window.config.giftcardMessageMaxLines\n    cardAmountSelected = false\n    element.classList.toggle('selected', value)\n    const radio = select('input[type=radio]', element)\n    radio.checked = value\n    if (value && cardSelected !== radio.value) {\n      cardSelected = radio.value\n      resetData()\n      if (currentStep != 1) {\n        resetToCardSelection()\n      }\n\n      if (radio.value === 'physical') {\n        if (CARD_MOBILE_PHYS_DESCRIPTION) CARD_MOBILE_PHYS_DESCRIPTION.classList.toggle('is-hidden', false)\n        if (CARD_PHYS_HEADER) CARD_PHYS_HEADER.classList.toggle('is-hidden', false)\n\n        if (CARD_MOBILE_ELEC_DESCRIPTION) CARD_MOBILE_ELEC_DESCRIPTION.classList.toggle('is-hidden', true)\n        if (CARD_ELEC_HEADER) CARD_ELEC_HEADER.classList.toggle('is-hidden', true)\n\n        GIFT_CARD_MESSAGE_LABEL.setAttribute('data-test', 'lblAddACustomMessage_GiftCard')\n        switchStepperDesign(true)\n      } else {\n        if (CARD_MOBILE_ELEC_DESCRIPTION) CARD_MOBILE_ELEC_DESCRIPTION.classList.toggle('is-hidden', false)\n        if (CARD_ELEC_HEADER) CARD_ELEC_HEADER.classList.toggle('is-hidden', false)\n\n        if (CARD_MOBILE_PHYS_DESCRIPTION) CARD_MOBILE_PHYS_DESCRIPTION.classList.toggle('is-hidden', true)\n        if (CARD_PHYS_HEADER) CARD_PHYS_HEADER.classList.toggle('is-hidden', true)\n\n        GIFT_CARD_MESSAGE_LABEL.setAttribute('data-test', 'lblAddACustomMessage_TheE-GiftCard')\n        switchStepperDesign(false)\n      }\n      bindAnalytics(radio.value === 'physical', 'select')\n    }\n  }\n}\n\nfunction switchStepperDesign(binary) {\n  if (binary) {\n    GIFT_CARD_STEPPER.classList.toggle('is-binary', true)\n    LIST_ELEMENTS[2].remove()\n  } else {\n    GIFT_CARD_STEPPER.classList.toggle('is-binary', false)\n    if (egiftcardStep) GIFT_CARD_STEPPER.appendChild(egiftcardStep)\n  }\n}\n\nfunction setState(state) {\n  currentStep = state\n  --state\n  const liElements = selectAll('li', GIFT_CARD_STEPPER)\n  liElements.forEach((element, idx) => {\n    const stepElement = select('.step', element)\n    const isSrOnly = select('.is-sr-only', element)\n\n    if (idx === state) {\n      stepElement.className = 'step active-step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.activeStep\n      stepElement.parentNode.disabled = true\n    }\n    else if (idx === state - 1) {\n      stepElement.className = 'step previous-active-step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.previousStep\n      stepElement.parentNode.disabled = false\n    }\n    else if (idx > state) {\n      stepElement.className = 'step future-step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.nextStep\n      stepElement.parentNode.disabled = true\n    }\n    else {\n      stepElement.className = 'step'\n      isSrOnly.innerHTML = window.config.locales.giftcard.previousStep\n      stepElement.parentNode.disabled = false\n    }\n  })\n}\n\nfunction highlightAmountCardEvent(elem) {\n  amountSelected = null\n  CARD_AMOUNTS.forEach(element => {\n    if (element === elem) {\n      amountSelected = elem\n      amountSelected.setAttribute('aria-pressed', true)\n      element.classList.toggle('is-primary', true)\n      element.classList.toggle('is-quaternary', false)\n      CARD_CUSTOM_AMOUNT.value = ''\n      CARD_CUSTOM_AMOUNT.closest('.label-input').classList.toggle('has-content', false)\n    } else if (element !== CARD_CUSTOM_AMOUNT) {\n      element.classList.toggle('is-primary', false)\n      element.classList.toggle('is-quaternary', true)\n      element.setAttribute('aria-pressed', false)\n    }\n  })\n  cleanErrors(AMOUNT_SECTION)\n}\n\nfunction setPageTitle(step) {\n  switch (step) {\n    case 1:\n    case 2:\n    case 3:\n      document.title = `${window.config.locales.giftcard.title} ${window.config.locales.giftcard.step} ${step} ${window.config.locales.giftcard.extra}`\n      break\n    default:\n      document.title = `${window.config.locales.giftcard.title} ${window.config.locales.giftcard.extra}`\n      break\n  }\n}\n\nfunction displayStepSection() {\n  STEP_SECTION.classList.toggle('is-hidden-mobile', false)\n  STEP_SECTION.removeAttribute('hidden')\n  CARD_BUTTON.classList.toggle('is-hidden', false)\n  CARD_BUTTON.removeAttribute('hidden')\n  CARD_SECTION.classList.toggle('is-hidden-mobile', true)\n  GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', true)\n  document.body.scrollTop = 0\n  const h3 = select('h3', STEP_SECTION)\n  h3.setAttribute('tabindex', '-1')\n  h3.focus()\n  setState(1)\n  setPageTitle(1)\n}\n\nconst loadCalendar = ()=> {\n  if (window.config.currentLanguage.split('_')[0] === 'vi') {\n    import(`flatpickr/dist/l10n/${config.currentLanguage.toLowerCase().split('_')[1]}.js`)\n      .then(() => {\n        flatpickr.localize(flatpickr.l10ns[config.currentLanguage.toLowerCase().split('_')[1]])\n        bindEvents()\n        console.log(`${config.currentLanguage.split('_')[0]} calendar translations loaded`)\n      })\n      .catch(err => {\n        console.log(err)\n      })\n  }\n  else if (window.config.currentLanguage.split('_')[0] !== 'en') {\n    import(`flatpickr/dist/l10n/${config.currentLanguage.split('_')[0]}.js`)\n\n      .then(() => {\n        flatpickr.localize(flatpickr.l10ns[COUNTRY_SELECTED])\n        bindEvents()\n        console.log(`${config.currentLanguage.split('_')[0]} calendar translations loaded`)\n      })\n      .catch(err => {\n        console.log(err)\n      })\n  }\n  else {\n    bindEvents()\n  }\n}\n\nfunction validCustomMessage(event) {\n  event.preventDefault()\n  cleanErrors(MESSAGE_FORM)\n  const requiredInputs = getCollection('input[data-required=true]', MESSAGE_SECTION).filter((e) => {\n    return e.value === ''\n  })\n\n  if (requiredInputs.length === 0) {\n    if (cardSelected === 'electronic') {\n      if (MESSAGE_FORM.checkValidity() === true) {\n        window.sessionStorage.setItem('selectedSpanAriaLabel', '');\n        MESSAGE_SECTION.classList.toggle('is-hidden', true)\n        MESSAGE_SECTION.setAttribute('hidden', '')\n        GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', true)\n        STEP_SECTION.classList.toggle('is-hidden-mobile', false)\n        CARD_SECTION.classList.toggle('is-hidden-mobile', true)\n        let h2\n        MAIL_SECTION.classList.toggle('is-hidden', false)\n        MAIL_SECTION.removeAttribute('hidden')\n        AMOUNT_SECTION.classList.toggle('is-hidden', true)\n        AMOUNT_SECTION.setAttribute('hidden', '')\n        h2 = select('h3', MAIL_SECTION)\n        h2.setAttribute('tabindex', '-1')\n        bindAnalytics(true, 'add_custom_message', 'next_step')\n        setState(3)\n        h2.focus()\n        const SEND_LATER_RADIO = selectAll(\"input[name=future-selection]\")\n        let sendLaterCalendar = select('.giftcard-visible-submit')\n        SEND_LATER_RADIO.forEach(element => {\n          element.addEventListener('change', onScheduleEGCChanged)\n          element.id === \"send-later\" && element.checked === true ? sendLaterCalendar.removeAttribute(\"hidden\") : sendLaterCalendar.setAttribute(\"hidden\", \"\")\n        })\n        loadCalendar()\n        const egiftcardSenderInput = select('.js-egiftcard-sender')\n        const egiftcardReceiverInput = select('.js-egiftcard-receiver')\n        const egiftCardSenderValue = select('#giftcard-sender')\n        const egiftCardReceiverValue = select('#giftcard-receiver')\n        const egiftcardMessage = select('.js-giftcard-form-message')\n        const giftCardMessage = select('.js-textarea')\n        if (egiftcardSenderInput && egiftCardSenderValue) egiftcardSenderInput.value = egiftCardSenderValue.value\n        if (egiftcardReceiverInput && egiftCardReceiverValue) egiftcardReceiverInput.value = egiftCardReceiverValue.value\n        if (egiftcardMessage && giftCardMessage) egiftcardMessage.value = giftCardMessage.value\n      }\n    } else {\n      if (MESSAGE_FORM.checkValidity() === true) {\n        addToBag(MESSAGE_FORM, 'giftCard')\n      }\n    }\n  }\n  else {\n    const messageFormErrors = {\n      giftCardSender: window.config.locales.errors.form.global.giftcard.emptySenderInput,\n      giftCardReceiver: window.config.locales.errors.form.global.giftcard.emptyReceiverInput\n    }\n    requiredInputs.forEach((e) => {\n      createErrorMessage(e.parentNode, messageFormErrors[e.getAttribute('name')])\n    })\n    focusElement(requiredInputs[0], {notChangeTabIndex: true})\n  }\n}\n\n function handleDateTimeResponse(response) {\n    if (response.errors && response.errors.error && config.region !== 'apac') {\n      notifier.show({\n      name: window.config.locales.notifier.request.label,\n      message: window.config.locales.notifier.request.message,\n      close: window.config.locales.notifier.request.close,\n    })\n      return\n    }\n    else if (response && response.availableDates.length > 0) {\n      CalendarInstance.set('minDate', new Date(response.availableDates[0]))\n      CalendarInstance.set('enable', response.availableDates.map((item)=> new Date(item)))\n      CalendarInstance.set('onValueUpdate', (selectedDates, dateStr, instance) => {\n        if (instance.isOpen) {\n          inputField.value = dateStr\n        }\n      })\n    }\n    labelInput.classList.add('has-content')\n    inputField.value = getInputValueDate(response.availableDates[0])\n    toggleClearSubmit(inputField, calendarDateLabel)\n    addBackground()\n  }\n\nconst createErrorMessage = (domElement, message, id = null, elementDescribedBy = null) => {\n  const elem = document.createElement('p')\n  const errorMsg = document.createTextNode(message)\n  domElement.classList.add('has-error')\n  if (id && elementDescribedBy) elementDescribedBy.setAttribute('aria-describedby', id)\n  elem.classList.add('error')\n  elem.setAttribute('id', id)\n  elem.dataset.errorMessage = 'true'\n  elem.appendChild(errorMsg)\n  const parent = domElement.parentNode\n  parent.appendChild(elem)\n  return elem\n}\n\nconst addToBag = (form, formType) => {\n  let giftCardProduct = (formType ==='giftCard') ? giftCardProductData : eGiftCardProductData\n  let productSku = (formType === 'eGiftCard') ? select('.js-egiftcard-code') : select('.js-giftCard-code')\n  const productPrice = select('.js-giftcard-form-price', form)\n  let addToCartAnalyticsObject = {\n    eventLabel: giftCardProduct.product_name,\n    eventAction: 'regular quickbuy',\n    eventCategory: 'add to cart',\n    event: 'uaevent',\n    ecommerce: {\n      currencyCode: window.config.currentCurrency,\n      add: {\n        products: [{\n          name: giftCardProduct.product_name,\n          id: giftCardProduct.id,\n          brand: giftCardProduct.brand,\n          category: giftCardProduct.category,\n          variant: giftCardProduct.variant,\n          quantity: 1,\n          dimension18: giftCardProduct.collection,\n          dimension19: giftCardProduct.sub_collection,\n          dimension20: giftCardProduct.product_line,\n          dimension21: giftCardProduct.outOfStockStatus,\n          dimension22: giftCardProduct.fsh_modelcode,\n          dimension23: giftCardProduct.fsh_articlecode,\n          dimension25: giftCardProduct.product_axis,\n          dimension26: giftCardProduct.fsh_sku_luxotica,\n          dimension45: ''\n        }]\n      }\n    }\n  }\n  if (productPrice) addToCartAnalyticsObject.ecommerce.add.products[0].price = productPrice.value\n  if (productSku) addToCartAnalyticsObject.ecommerce.add.products[0].dimension8 = productSku.value\n  window.document.DLKit.push('on-giftcard-add-to-bag', addToCartAnalyticsObject, false)\n\n  if (formType === 'giftCard') {\n\n    xhr.post(window.config.webservices.checkAddToBag)\n      .then((res) => {\n        let isWFJCnCPossible = res.isWFJCnCPossible\n        let isWFJHDPossible = res.isWFJHDPossible\n        let isNonWFJPossible = res.isNonWFJPossible\n        let isOABServiceProductPresent = res.isOABServiceProductPresent\n\n        if (isNonWFJPossible && !isOABServiceProductPresent) {\n          submitGiftCardForm(form)\n        } else {\n          let productName = giftCardProduct.product_name\n          let params = isWFJHDPossible ? 'wfj.fnb' : 'cnc.hd'\n\n          function closeMergedModal() {\n            window.removeEventListener('keydown', onEscapeKeyMergedClicked)\n            popin.hide()\n          }\n\n          function onEscapeKeyMergedClicked(e) {\n            if ((e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27)) {\n              closeMergedModal()\n            }\n          }\n\n          openMixedCartconfirmationPopin(params).then((modal) => {\n            window.document.DLKit.push('on-tracking', {\n              'eventCategory': 'click and collect',\n              'eventAction': 'mixed_cart_display',\n              'eventLabel': productName,\n              'event': 'nievent'\n            })\n            const popinCloseBtn = select('.js-popin-close', modal.modal.el)\n            if (popinCloseBtn) focusElement(popinCloseBtn, { notChangeTabIndex: true })\n            popinCloseBtn.addEventListener('click', () => {\n              window.document.DLKit.push('on-tracking', {\n                'eventCategory': 'click and collect',\n                'eventAction': 'mixed_cart_close',\n                'eventLabel': productName,\n                'event': 'uaevent'\n              })\n            })\n            modal.modal.el.addEventListener('click', (e) => {\n              if (closest(e.target, '.popin__row')) return\n              popin.hide()\n            })\n            window.addEventListener('keydown', onEscapeKeyMergedClicked)\n\n            const confirmationPopinCancelCta = select('.js-mixed-cart-confirmation-cancel-cta')\n            if (confirmationPopinCancelCta) confirmationPopinCancelCta.addEventListener('click', () => {\n              window.document.DLKit.push('on-tracking', {\n                'eventCategory': 'click and collect',\n                'eventAction': 'mixed_cart_cancel',\n                'eventLabel': productName,\n                'event': 'uaevent'\n              })\n              popin.hide()\n            })\n\n            const confirmationPopinCta = select('.js-mixed-cart-confirmation-popin-cta')\n            if (confirmationPopinCta) confirmationPopinCta.addEventListener('click', () => {\n              window.document.DLKit.push('on-tracking', {\n                'eventCategory': 'click and collect',\n                'eventAction': 'mixed_cart_continue',\n                'eventLabel': productName,\n                'event': 'uaevent'\n              })\n              submitGiftCardForm(form)\n              popin.hide()\n            })\n          })\n        }\n      })\n  } else {\n    submitGiftCardForm(form)\n  }\n}\n\nfunction submitGiftCardForm(form) {\n  xhr.submit(form).then(() => {\n    sidePanel.open(window.config.popups['mini-cart'], form.querySelector('[type=\"submit\"]'), () => {\n      const giftCardElementCart = select('.js-cartItem-giftCard', sidePanel.currentModal.el)\n      if (giftCardElementCart) {\n        const giftCardLink = select('a[href]', giftCardElementCart)\n        if (giftCardLink) {\n          giftCardLink.setAttribute('href', window.location.pathname)\n          giftCardLink.setAttribute('data-test', 'lnkGiftCard')\n        }\n        const giftCardAmount = select('.js-cart-price-item', giftCardElementCart)\n        if (giftCardAmount) giftCardAmount.setAttribute('data-test', 'lblAmount')\n      }\n\n    })\n    if (HEADER_CART_BTN) {\n      HEADER_CART_BTN.classList.remove('has-product')\n      // trigger a reflow to restart the animation\n      void HEADER_CART_BTN.offsetHeight\n      HEADER_CART_BTN.classList.add('has-product')\n    }\n  }).catch(e => {\n    if (e.gcFormError) {\n      if (MAIL_FORM) cleanErrors(MAIL_FORM)\n      const errorMsg = document.createElement('p')\n      errorMsg.classList.add('error', 'giftcard-unit-error')\n      errorMsg.setAttribute('id', 'giftcard-unit-error')\n      const ctaDescribedBy = select('.js-valid-message')\n      const ctaEGCDescribedBy = select('.js-valid-email')\n      if (ctaDescribedBy) ctaDescribedBy.setAttribute('aria-describedby', 'giftcard-unit-error')\n      if (ctaEGCDescribedBy) ctaEGCDescribedBy.setAttribute('aria-describedby', 'giftcard-unit-error')\n      errorMsg.innerHTML = e.gcFormError\n      MESSAGE_VALID_BUTTON.insertAdjacentHTML(\"afterend\", errorMsg.outerHTML)\n      MAIL_VALID_BUTTON.parentNode.insertBefore(errorMsg, MAIL_VALID_BUTTON.nextSibling)\n      focusElement(errorMsg)\n    } else {\n      notifier.show({\n        name: window.config.locales.notifier.request.label,\n        message: window.config.locales.notifier.request.message,\n        close: window.config.locales.notifier.request.close\n      })\n    }\n  })\n}\n\nfunction onScheduleEGCChanged(event) {\n  let sendLaterCalendar = select('.giftcard-visible-submit')\n  if (sendLaterCalendar)\n    if (event.target.getAttribute(\"id\") == \"send-now\") {\n      sendLaterCalendar.setAttribute(\"hidden\", \"\")\n    } else {\n      sendLaterCalendar.removeAttribute(\"hidden\")\n    }\n}\n\nfunction addBackground() {\n    let isDateSelected = select('span.flatpickr-day.selected')\n    let firstAvailableDate = select('span.flatpickr-day:not(.disabled)')\n    isDateSelected ? window.sessionStorage.setItem('selectedSpanAriaLabel', isDateSelected.ariaLabel) :  ''\n    let allDates = selectAll('span.flatpickr-day')\n    allDates.forEach((date) => {\n      if(date.ariaLabel === window.sessionStorage.getItem('selectedSpanAriaLabel')) {\n        date.classList.add('selected')\n        isDateSelected = date\n      }\n    })\n    if(isDateSelected == null && window.sessionStorage.getItem('selectedSpanAriaLabel') === '' &&  firstAvailableDate !== null) {\n      firstAvailableDate.classList.add('selected')\n      window.sessionStorage.setItem('selectedSpanAriaLabel', firstAvailableDate.ariaLabel)\n    }\n  }\n\n function getInputValueDate(dateString) {\n    const newDate = new Date(dateString)\n    const month = (`0${(newDate.getMonth() + 1)}`).slice(-2)\n    const day = (`0${newDate.getDate()}`).slice(-2)\n    const year = newDate.getFullYear()\n    const date = (window.config.country === 'JP') ? `${year}/${month}/${day}` : `${day}/${month}/${year}`\n    return window.config.country === 'JP' ? `${year}/${month}/${day}` : `${day}/${month}/${year}`\n  }\n\nfunction validEGiftCardBeneficiary(event) {\n  event.preventDefault()\n  cleanErrors(MAIL_FORM)\n  const mailInput = select('#gc-myemail', MAIL_FORM)\n  if (mailInput && mailInput.value === '') {\n    createErrorMessage(mailInput.parentNode, window.config.locales.errors.form.global.giftcard.emptyMailInput)\n    focusElement(mailInput, {notChangeTabIndex: true})\n  } else if (!MAIL_FORM.checkValidity()) {\n    focusElement(mailInput, {notChangeTabIndex: true})\n  } else {\n    xhr.post(window.config.webservices.checkForGiftCard, {\n      data: {\n        isEGiftCard: true\n      }\n    }).then((res) => {\n      if (res.isStandardProductPresent === true || res.isOABServiceProductPresent === true) {\n        const popinParam = res.isOABServiceProductPresent ? 'oab-giftcard-content' : 'content'\n        openAddToBagConfirmationPopin(popinParam).then((modal) => {\n          popinCloseBtn = select('.js-popin-close', modal.modal.el)\n          focusElement(popinCloseBtn, {notChangeTabIndex: true})\n          modal.modal.el.addEventListener('click', (e) => {\n            if (closest(e.target, '.popin__row')) return\n            popin.hide()\n          })\n\n          const confirmationPopinCancelCta = select('.js-confirmation-cancel-cta')\n          if (confirmationPopinCancelCta) confirmationPopinCancelCta.addEventListener('click', () => {\n            popin.hide()\n          })\n\n          const confirmationPopinCta = select('.js-confirmation-popin-cta')\n          if (confirmationPopinCta) confirmationPopinCta.addEventListener('click', () => {\n            addToBag(MAIL_FORM, 'eGiftCard')\n            isStandardProductPresent = 'false'\n            popin.hide()\n          })\n        })\n      } else {\n        addToBag(MAIL_FORM, 'eGiftCard')\n      }\n    })\n  }\n}\n\n\nfunction toggleEmailSelection() {\n  MAIL_CHOICES.forEach(element => {\n    const emailDiv = select('.js-show-email', element)\n    const emailInput = select('input', emailDiv)\n    if (element === this.parentNode) {\n      element.classList.toggle('is-selected', true)\n      emailDiv.classList.toggle('is-hidden', false)\n      emailInput.required = true\n    } else {\n      element.classList.toggle('is-selected', false)\n      emailDiv.classList.toggle('is-hidden', true)\n      emailInput.required = false\n      emailInput.value = ''\n    }\n  })\n  cleanErrors(MAIL_FORM)\n}\n\nfunction displayFirstStep() {\n  GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', true)\n  CARD_SECTION.classList.toggle('is-hidden-mobile', true)\n  STEP_SECTION.classList.toggle('is-hidden-mobile', false)\n  CARD_BUTTON.setAttribute('hidden', '')\n  MESSAGE_SECTION.setAttribute('hidden', '')\n  MAIL_SECTION.setAttribute('hidden', '')\n  AMOUNT_SECTION.classList.toggle('is-hidden', false)\n  AMOUNT_SECTION.removeAttribute('hidden')\n  setState(1)\n  setPageTitle(1)\n}\n\nfunction resetToCardSelection() {\n  GIFTCARD_HEADER.classList.toggle('is-hidden-mobile', false)\n  CARD_SECTION.classList.toggle('is-hidden-mobile', false)\n  STEP_SECTION.classList.toggle('is-hidden-mobile', true)\n  CARD_BUTTON.classList.toggle('is-hidden', false)\n  CARD_BUTTON.removeAttribute('hidden')\n  AMOUNT_SECTION.classList.toggle('is-hidden', false)\n  AMOUNT_SECTION.removeAttribute('hidden')\n  MAIL_SECTION.classList.toggle('is-hidden', true)\n  MAIL_SECTION.setAttribute('hidden', '')\n  MESSAGE_SECTION.classList.toggle('is-hidden', true)\n  MESSAGE_SECTION.setAttribute('hidden', '')\n  setState(1)\n  setPageTitle(1)\n  const input = select('.radio-big:checked', select('.js-main-content'))\n  input.scrollIntoView()\n  input.focus()\n  cleanErrors(AMOUNT_SECTION)\n  cleanErrors(MAIL_FORM)\n}\n\nfunction validateAmountStep(event) {\n  cleanErrors(AMOUNT_SECTION)\n  cleanAriaDescribedBy()\n  if (event) event.preventDefault()\n  GIFT_CARD_MESSAGE.value = window.localStorage.getItem('giftcard-message')\n  if (GIFT_CARD_MESSAGE.value.length > 0) GIFT_CARD_MESSAGE.parentNode.classList.add('has-content')\n  if (cardAmountSelected === true || (CARD_CUSTOM_AMOUNT.value !== '' && parseInt(CARD_CUSTOM_AMOUNT.value) >= giftcardMinAmount && parseInt(CARD_CUSTOM_AMOUNT.value) <= giftcardMaxAmount)) {\n    //    validate step\n    MESSAGE_SECTION.classList.toggle('is-hidden', false)\n    MESSAGE_SECTION.removeAttribute('hidden')\n\n    const buttonText = select('.button__wrapper span', MESSAGE_VALID_BUTTON)\n    buttonText.innerHTML = (cardSelected === 'physical') ? window.config.locales.giftcard.addToBag : window.config.locales.giftcard.nextStep\n\n    AMOUNT_SECTION.setAttribute('hidden', '')\n    AMOUNT_SECTION.classList.toggle('is-hidden', true)\n    MAIL_SECTION.setAttribute('hidden', '')\n    MAIL_SECTION.classList.toggle('is-hidden', true)\n    const cardAmountSlotValue = select('.js-card-amount[aria-pressed=true] .js-card-amount-number')\n    // giftCarddataObject.cardAmount = cardAmountSlotValue ? cardAmountSlotValue.innerText.replace(/\\s/g,'') : CARD_CUSTOM_AMOUNT.value\n    const giftcardFormPrice = select(GIFTCARD_FORM_PRICE, MESSAGE_FORM)\n    if (giftcardFormPrice) giftcardFormPrice.value = cardAmountSlotValue ? cardAmountSlotValue.innerText.replace(/\\s/g,'') : CARD_CUSTOM_AMOUNT.value\n    const eGiftcardFormPrice = select(GIFTCARD_FORM_PRICE, MAIL_FORM)\n    if (eGiftcardFormPrice) eGiftcardFormPrice.value = cardAmountSlotValue ? cardAmountSlotValue.innerText.replace(/\\s/g,'') : CARD_CUSTOM_AMOUNT.value\n    setState(2)\n\n    const h3 = select('h3', MESSAGE_SECTION)\n    if (h3) {\n      h3.setAttribute('tabindex', '-1')\n      h3.focus()\n    }\n    if (amountSelected) {\n      const value = `${amountSelected.children[0].textContent.trim()}_${AMOUNT_SYMBOL.textContent.toUpperCase()}`\n      bindAnalytics(cardSelected === 'physical', value, 'next_step')\n    }\n    else bindAnalytics(cardSelected === 'physical', `${CARD_CUSTOM_AMOUNT.value}_${AMOUNT_SYMBOL.textContent.toUpperCase()}`, 'next_step')\n  } else if (cardAmountSelected === false && CARD_CUSTOM_AMOUNT.value === '') {\n\n    const error = createErrorMessage(CARD_CUSTOM_AMOUNT.parentNode, window.config.locales.errors.form.global.giftcard.base)\n    CARD_AMOUNTS.forEach((element) => {\n      createAriaDescriptionOnError(error, element, 'error-amount-value')\n    })\n    createAriaDescriptionOnError(error, CARD_CUSTOM_AMOUNT, 'error-amount-value')\n    CARD_CUSTOM_AMOUNT.focus()\n  } else if (cardAmountSelected === false && parseInt(CARD_CUSTOM_AMOUNT.value) < giftcardMinAmount) {\n    if (window.config.country.toLocaleLowerCase() === 'gb') {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMinAmountError} ${window.config.gifcardCurrency}${parseInt(giftcardMinAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-min-amount-value')\n    } else {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMinAmountError} ${parseInt(giftcardMinAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-min-amount-value')\n    }\n    CARD_CUSTOM_AMOUNT.focus()\n  } else if (cardAmountSelected === false && parseInt(CARD_CUSTOM_AMOUNT.value) > giftcardMaxAmount) {\n    if (window.config.country.toLocaleLowerCase() === 'gb') {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMaxAmountError} ${window.config.gifcardCurrency}${parseInt(giftcardMaxAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-max-amount-value')\n    } else {\n      createAriaDescriptionOnError(createErrorNode(CARD_CUSTOM_AMOUNT.parentNode, `${giftcardMaxAmountError} ${parseInt(giftcardMaxAmount).toFixed(0)}`), CARD_CUSTOM_AMOUNT, 'error-max-amount-value')\n    }\n    CARD_CUSTOM_AMOUNT.focus()\n  }\n}\n\nfunction createErrorNode(domElement, message) {\n  const elem = document.createElement('p')\n  const errorMsg = document.createTextNode(message)\n  elem.classList.add('error', 'has-error')\n  elem.dataset.errorMessage = 'true'\n  elem.appendChild(errorMsg)\n  elem.setAttribute('data-test', 'lblGlobalErrorMessageOrEnterAnAmount_TheGiftCard')\n  const parent = domElement.parentNode\n  parent.appendChild(elem)\n  domElement.focus()\n  return elem\n}\n\nfunction createAriaDescriptionOnError(errorHTMLelement, inputHTMLelement, ariaID) {\n  errorHTMLelement.id = ariaID\n  const aria = inputHTMLelement.getAttribute('aria-describedby')\n  if (aria) ariaID += ` ${aria}`\n  inputHTMLelement.setAttribute('aria-describedby', ariaID)\n}\n\nfunction cleanAriaDescribedBy() {\n  CARD_AMOUNTS.forEach((element) => {\n    element.removeAttribute('aria-describedby')\n  })\n  CARD_CUSTOM_AMOUNT.setAttribute('aria-describedby', 'currency-symbol')\n}\n\nconst cleanBalanceAriaDescribedBy = (balanceForm) => {\n  const inputs = getCollection('input[type=number]', balanceForm)\n  inputs.forEach((element) => {\n    element.removeAttribute('aria-describedby')\n    element.removeAttribute('aria-invalid')\n  })\n}\n\nfunction cleanErrors(element) {\n  const invalidClasses = element.querySelectorAll('.invalid-field')\n  const hasErrorClasses = element.querySelectorAll('.has-error')\n  const errorMessages = element.querySelectorAll('.error')\n\n  for (let i = 0; i < invalidClasses.length; ++i) {\n    invalidClasses[i].classList.remove('invalid-field')\n    invalidClasses[i].removeAttribute('tabindex')\n  }\n  for (let i = 0; i < hasErrorClasses.length; ++i) {\n    hasErrorClasses[i].classList.remove('has-error')\n  }\n\n  // Remove any existing messages\n  for (let i = 0; i < errorMessages.length; ++i) {\n    errorMessages[i].parentNode.removeChild(errorMessages[i])\n  }\n}\n\nconst getMessageValue = () => {\n  GIFT_CARD_MESSAGE.addEventListener('input', countMessage)\n}\n\nconst countMessage = (e) => {\n  if (GIFT_CARD_MESSAGE_CHARS) {\n    GIFT_CARD_MESSAGE_CHARS.innerHTML = (window.config.giftcardMessageMaxChars * window.config.giftcardMessageMaxLines) - e.target.value.length\n  }\n  if (GIFT_CARD_MESSAGE_LINES) {\n    GIFT_CARD_MESSAGE_LINES.innerHTML = window.config.giftcardMessageMaxLines - GIFT_CARD_MESSAGE.value.split('\\n').length\n  }\n\n  if ((GIFT_CARD_MESSAGE.value.length - GIFT_CARD_MESSAGE.value.split('\\n').length + 1) >= 190) {\n    GIFT_CARD_MESSAGE_COUNTER.setAttribute('aria-live', 'assertive')\n    GIFT_CARD_MESSAGE_COUNTER.setAttribute('aria-atomic', 'false')\n  } else {\n    GIFT_CARD_MESSAGE_COUNTER.removeAttribute('aria-live')\n    GIFT_CARD_MESSAGE_COUNTER.removeAttribute('aria-atomic')\n  }\n  window.localStorage.setItem('giftcard-message', e.target.value)\n  e.target.checkValidity()\n}\n\nfunction bindAnalytics(physicalCard = true, eventAction = '', eventLabel = '') {\n  window.document.DLKit.push('on-giftcard-event', {\n    eventCategory: (physicalCard) ? 'gift_card' : 'e_gift_card',\n    eventAction,\n    eventLabel,\n    event: 'uaevent'\n  })\n}\n\nfunction init() {\n  cardManagement()\n  getMessageValue()\n}\n\nexport default function (el) {\n  return new GiftCard(el)\n}\n"],"sourceRoot":""}