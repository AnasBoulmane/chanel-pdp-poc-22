(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{1073:function(t,e,i){"use strict";i.r(e);i(7);var s=i(454),a=i(472),n=i(5),o=i(544);class c extends s.Component{constructor(t){super(t)}toggleButton(t,e){this.props.toggle(t,e)}render(){const t=this.props.type,e=this.props.active===t?"active":"",i=this.props.active===t?"true":"false";let a="";"light"===t?a=window.config.vto.labels.light:"intense"===t&&(a=window.config.vto.labels.intense);let n=window.config.vto.labels.shadeSwitch;return n=n.replace("{0}",a),n=n.replace("{1}",this.props.selectedVariant),s.default.createElement(s.default.Fragment,null,s.default.createElement("button",{type:"button","aria-pressed":i,"aria-describedby":"switch-".concat(t),className:"switch ".concat(e),"data-sku":this.props.sku,onClick:this.toggleButton.bind(this,this.props.sku,t)},a),s.default.createElement("p",{id:"switch-".concat(t),className:"is-hidden"},n))}}var r=c;class l extends s.Component{constructor(t){super(t),this.state={active:"light"},this.toggle=this.toggle.bind(this)}toggle(t,e){this.state.active!==e&&(this.props.toggleIntensity(t,e),this.setState({active:e}))}componentWillReceiveProps(t){t.product.code!==this.props.product.code&&this.setState({active:"light"})}render(){const t=this.props.product.mainSku,e=this.props.product.altSku;let i=!1;return(this.props.width>960&&"desktop"===this.props.displayType||this.props.width<=960&&"mobile"===this.props.displayType)&&(i=!0),s.default.createElement(s.default.Fragment,null,this.props.product.hasTwoIntensities&&this.props.ready&&i&&s.default.createElement("div",{className:"intensity-switch"},s.default.createElement(r,{type:"light",active:this.state.active,sku:t,toggle:this.toggle,toggleIntensity:this.props.toggleIntensity,selectedVariant:this.props.selectedVariant}),s.default.createElement(r,{type:"intense",active:this.state.active,sku:e,toggle:this.toggle,toggleIntensity:this.props.toggleIntensity,selectedVariant:this.props.selectedVariant})))}}var d=l,h=i(466);class u extends s.Component{componentDidMount(){this.button.focus()}render(){return s.default.createElement("span",{ref:t=>this.button=t,className:"button icon is-large vto-cart nav-item ".concat(this.props.hasProduct)},s.default.createElement(h.a,{name:"vto-cart"}))}}var m=u,p=i(31);let v=null;window.addEventListener("touchmove",(function(){}));class b{constructor(t){let{source:e=document,update:i,multiplier:s=1,friction:a=.92,initialValues:n,boundX:o,boundY:c,bounce:r=!0,onEnd:l}=t;const d=l;var h,u,m,p,b,g,y,C,O,E,x,j=0,S=0,k=.3*s,I=!1,_=!1,T=!1,L=!1,A=[];function M(){i.call(e,j,S)}function P(t){if("touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type){var e=t.targetTouches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY,id:e.identifier}}return{x:t.clientX,y:t.clientY,id:null}}function N(t){var e=P(t);_||T||(_=!0,L=!1,O=e.id,b=y=e.x,g=C=e.y,A=[],D(b,g),document.addEventListener("touchmove",W,!!w()&&{passive:!1}),document.addEventListener("touchend",R),document.addEventListener("touchcancel",B),document.addEventListener("mousemove",W,!!w()&&{passive:!1}),document.addEventListener("mouseup",R))}function W(t){t.preventDefault();var e=P(t);_&&e.id===O&&(y=e.x,C=e.y,D(b,g),function(){I||f(F);I=!0}())}function R(t){var e=P(t);_&&e.id===O&&B()}function B(){_=!1,D(b,g),function(){var t=A[0],e=A[A.length-1],i=e.x-t.x,a=e.y-t.y,n=(e.time-t.time)/15/s;E=i/n||0,x=a/n||0;var o=V();(Math.abs(E)>1||Math.abs(x)>1||!o.inBounds)&&(L=!0,v=f(Y))}(),document.removeEventListener("touchmove",W),document.removeEventListener("touchend",R),document.removeEventListener("touchcancel",B),document.removeEventListener("mouseup",R),document.removeEventListener("mousemove",W)}function D(t,e){for(var i=Date.now();A.length>0&&!(i-A[0].time<=100);)A.shift();A.push({x:t,y:e,time:i})}function F(){var t=y-b,e=C-g;if(j+=t*s,S+=e*s,r){let i=V();0!==i.x&&(j-=t*H(i.x)*s),0!==i.y&&(S-=e*H(i.y)*s)}else V(!0);M(),b=y,g=C,I=!1}function H(t){return 5e-6*Math.pow(t,2)+1e-4*t+.55}function V(t){var e=0,i=0;return void 0!==h&&j<h?e=h-j:void 0!==u&&j>u&&(e=u-j),void 0!==m&&S<m?i=m-S:void 0!==p&&S>p&&(i=p-S),t&&(0!==e&&(j=e>0?h:u),0!==i&&(S=i>0?m:p)),{x:e,y:i,inBounds:0===e&&0===i}}function Y(){if(L){j+=E*=a,S+=x*=a;var t=V();if(.002===Math.max(Math.abs(E),.002)||.002===Math.max(Math.abs(x),.002))return window.cancelAnimationFrame(v),void d.call(e,j,S);if(Math.abs(E)>k||Math.abs(x)>k||!t.inBounds){if(r){let e=2.5;if(0!==t.x)if(t.x*E<=0)E+=.04*t.x;else{let i=t.x>0?e:-e;E=.11*(t.x+i)}if(0!==t.y)if(t.y*x<=0)x+=.04*t.y;else{let i=t.y>0?e:-e;x=.11*(t.y+i)}}else 0!==t.x&&(j=t.x>0?h:u,E=0),0!==t.y&&(S=t.y>0?m:p,x=0);M(),v=f(Y)}else window.cancelAnimationFrame(v),d.call(e,j,S),L=!1}}!function(){if(e="string"==typeof e?document.querySelector(e):e,!e)throw new Error("IMPETUS: source not found.");if(!i)throw new Error("IMPETUS: update function not defined.");n&&(n[0]&&(j=n[0]),n[1]&&(S=n[1]),M()),o&&(h=o[0],u=o[1]),c&&(m=c[0],p=c[1]),e.addEventListener("touchstart",N),e.addEventListener("mousedown",N)}(),this.destroy=function(){return e.removeEventListener("touchstart",N),e.removeEventListener("mousedown",N),null},this.pause=function(){_=!1,T=!0},this.resume=function(){T=!1},this.setValues=function(t,e){"number"==typeof t&&(j=t),"number"==typeof e&&(S=e)},this.setMultiplier=function(t){s=t,k=.3*s},this.setBoundX=function(t){h=t[0],u=t[1]},this.setBoundY=function(t){m=t[0],p=t[1]}}}const f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};function w(){let t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return w=()=>t,t}var g=i(3);class y extends s.Component{render(){return s.default.createElement("button",{ref:t=>this.button=t,className:"button nav-item",type:"button",onClick:()=>this.props.quickAddToBag()},g.a.locales.vto.quickAddToBagLabel,s.default.createElement(h.a,{name:"next",className:"vto-next"}))}}var C=y,O=i(0);class E extends s.Component{componentDidMount(){const t=Object(O.select)(".js-cart");this.button.focus(),t&&t.classList.add("already-has-product")}render(){let{addedToBagLabel:t}=g.a.locales.vto;return s.default.createElement("button",{ref:t=>this.button=t,className:"button nav-item"},t,s.default.createElement(h.a,{name:"next",className:"vto-next"}),s.default.createElement("span",{className:"is-sr-only"},t))}}var x=E,j=i(532),S=i(748),k=i(50),I=i(48);function _(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class T extends s.Component{constructor(t){var e;super(t),e=this,_(this,"onClick",(async function(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{const t=await Object(k.c)(e.state.codeProduct,!e.state.active,!1);e.setState({active:!e.state.active}),e.setState({wishlistData:t}),e.showNotification(t,i),e.pushAnalytics(),Object(I.d)(t,!e.state.active)}catch(t){console.error(t)}})),_(this,"reconfigNotifier",t=>{const e=Object(O.select)(".notifier__wrapper");e.classList.add("notifier__for-vto-wishlist");const i=Object(O.selectAll)("a,button",e);i&&(i.slice(1).forEach(t=>t.removeAttribute("tabindex")),i[0].focus());const s=Object(O.select)(".undo[data-wishlist]",e);if(s){s.classList.add("undo-vto-wishlist");const t=t=>{this.onClick(t,!0)};s.addEventListener("click",t.bind(this))}}),_(this,"showNotification",async(t,e)=>{await p.a.show({name:t.message.label,message:t.message.message,close:t.message.close,opener:this.button,noFocus:!1}),setTimeout(()=>{this.reconfigNotifier(e)},100)}),_(this,"isProductInWishList",()=>{const t=this.state.wishlistData;setTimeout(()=>{this.setState({active:t.productCodeIds.indexOf(this.state.codeProduct)>-1})},100)}),_(this,"pushAnalytics",()=>{let t=this.state.analytics;t.eventAction=this.state.active?this.state.textActive:this.state.textInactive,window.document.DLKit.push("on-wishlist-add",t)}),this.state={codeProduct:t.codeProduct,wishlistData:t.wishlistData,active:!1,analytics:{event:"uaevent",eventCategory:"vto",eventLabel:t.codeProduct,eventAction:""},accessibility:{textActive:t.accessibility.textActive,textInactive:t.accessibility.textInactive},textActive:t.textActive,textInactive:t.textInactive},this.isProductInWishList()}componentWillReceiveProps(t){t.codeProduct!==this.state.codeProduct&&(this.setState({codeProduct:t.codeProduct,analytics:{event:"uaevent",eventCategory:"vto",eventLabel:t.codeProduct,eventAction:""},accessibility:{textActive:t.accessibility.textActive,textInactive:t.accessibility.textInactive},textActive:t.textActive,textInactive:t.textInactive}),this.isProductInWishList())}render(){return s.default.createElement("button",{ref:t=>this.button=t,onClick:this.onClick,type:"button",className:"vto-wishlist"},s.default.createElement(h.a,{name:this.state.active?"wishlist-on":"wishlist-off"}),s.default.createElement("span",{className:"is-sr-only"},this.state.active?this.state.accessibility.textInactive:this.state.accessibility.textActive))}}var L=T,A=i(1),M=i(571),P=i(621),N=i(515),W=i(622),R=i(2);function B(){return(B=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function D(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}e.default=Object(a.b)(t=>t)(class extends s.Component{constructor(t){super(t),D(this,"width",640),D(this,"height",480),D(this,"lastProduct",null),D(this,"previousIntensity",null),D(this,"variantNodes",[]),D(this,"variantList",null),D(this,"observers",[]),D(this,"interceptor",null),D(this,"requestId",null),D(this,"timeout",null),D(this,"windowResized",!1),D(this,"productFirstImage",Object(O.select)(".product-details__media .carousel__slide #pdp-image-0-0>img")),D(this,"_componentIsMounted",!1),D(this,"_firstSlideElId",null),D(this,"disableScroll",null),D(this,"screenHeightDifference",!1),D(this,"windowHeight",0),D(this,"isItChrome",Object(R.C)().includes("Chrome")),D(this,"isPortraitView",Object(R.S)()),D(this,"setVariantListRef",t=>{this.variantList=t}),D(this,"setInterceptorRef",t=>{this.interceptor=t}),D(this,"onResize",()=>{const t=Object(O.select)("#YMK-module-iframe",this.container);t&&t.contentWindow.document&&(Object(R.ab)()&&Object(R.Q)()?this.state.windowWidth!==window.innerWidth&&this.setCanvasDimensionsOnResize():this.isItChrome&&Object(R.Y)()&&this.windowHeight-window.innerHeight<80&&window.innerWidth==this.state.windowWidth||this.setCanvasDimensionsOnResize(),this.windowResized=!0);const e=Math.max(window.innerWidth,this.state.windowWidth)>960&&Math.min(window.innerWidth,this.state.windowWidth)<=960;this.windowHeight=window.innerHeight;const i=this.state.enableLandscapeError&&(window.matchMedia("(orientation:portrait)").matches!=this.isPortraitView||e);if(this.setState({windowWidth:window.innerWidth,showRotationError:i}),i&&window.innerWidth!=this.state.windowWidth){const{dispatch:t}=this.props;this.close(t,!0)}}),D(this,"setWishListState",()=>{const t=Object(O.select)(".product-details__flags button");if(t){const e=t.dataset;JSON.parse(e.trackWishlist);this.state.vtoWishlist={accessibility:{textActive:e.textActive,textInactive:e.textInactive},analytics:{},textActive:e.textWishlistActive,textInactive:e.textWishlistInactive}}}),D(this,"getFrameHeight",()=>{const t=Object(O.select)(".vto__container"),e=Object(O.select)(".vto__wrapper");if(t&&e)return Math.min(t.getBoundingClientRect().height,e.getBoundingClientRect().height)}),D(this,"setCameraPosition",()=>{const t=Object(O.select)(".pdp-camera .camera-icon"),e=Object(O.select)(".vto__wrapper"),i=Object(O.select)(".vto__container");if(t&&e&&i){const s=this.getFrameHeight();let a=0;0!=s&&(t.style.top="auto",a=s-(e.offsetHeight>i.offsetHeight?0:76),t.style.marginTop="".concat(a,"px"));const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),c=i.getBoundingClientRect(),r=e.offsetHeight>i.offsetHeight?c:o;n.bottom>r.bottom&&(t.style.marginTop="".concat(a-20-(n.bottom-r.bottom),"px"))}}),D(this,"toggleTopContainerClass",t=>{const e=Object(O.select)(t),i=Object(O.select)(".vto__wrapper");e&&e.classList.toggle("topContainer",i&&i.offsetTop<0)}),D(this,"setCanvasDimensionsOnResize",()=>{const t=Object(O.select)("#YMK-module-iframe",this.container).contentWindow.document,e=Object(O.select)("#canvas",t),{width:i,height:s}=window.getComputedStyle(Object(O.select)("#YMK-module")),a=Object(O.select)(".frame-content>div",t);a.style.height=s,a.style.width=i;const n=Object(O.select)("#YMK-module"),o=Object(O.select)(".vto__container--inner");if(n&&o){const t=n.getBoundingClientRect(),e=getComputedStyle(n),i=parseFloat(e.marginLeft);this.setState({canvasWidth:t.width+i+"px",canvasHeight:this.getFrameHeight()+"px",imageWidth:t.width+i+"px",...0!=t.height&&{imageHeight:t.height+"px"}})}if(e){const t=Math.max(parseInt(i,10)/parseInt(e.style.width.replace("px",""),10),parseInt(s,10)/parseInt(e.style.height.replace("px",""),10));e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transform="translate3d(-50%, -50%, 0) scale(".concat(t,")")}const c=Object(R.R)(),r=Object(O.select)(".photo_container");r&&(this.toggleTopContainerClass(".vto__picture"),Object(R.S)()?c?(r.classList.contains("mobile_Landscape")&&r.classList.remove("mobile_Landscape"),r.classList.add("mobile_potrait")):r.classList.remove("mobile_Landscape"):r&&(r.classList.add("mobile_Landscape"),r.classList.remove("mobile_potrait"))),this.state.showTimer||this.state.showPicture||this.adjust(),this.setCameraPosition(),A.C.publish(A.db)}),D(this,"a11yOnVideoElem",()=>{const t=Object(O.select)("#YMK-module"),e=Object(O.select)("#YMK-video-input",t);this.state.showPicture||this.state.showTimer?e.setAttribute("tabindex","-1"):e.removeAttribute("tabindex")}),D(this,"adjust",()=>{let{left:t=0,selectedFirstTime:e,shadeChanged:i}=this.state,s=this.interceptor.getBoundingClientRect(),a=this.variantNodes.length>0?this.variantNodes[this.getSelectedIndex()].getBoundingClientRect():0,n=s.left+s.width/2;i&&(t+=n-(a.left+a.width/2),t=Math.floor(t),this.setState({left:t,animate:!0,shadeChanged:!1},()=>{this.impetus&&this.impetus.setValues(t,t)}));const o=Object(O.select)(".vto-shade-list .selected>span>img");o&&e&&(o.setAttribute("tabindex","-1"),o.focus())}),D(this,"cameraClicked",t=>{const e=Object(O.select)("#YMK-module"),i=e.getBoundingClientRect().height,s=Object(R.O)(),a=Object(R.R)();if(e){const t=parseFloat(getComputedStyle(e).marginLeft);if(this.setState({canvasWidth:e.getBoundingClientRect().width+t+"px",canvasHeight:this.getFrameHeight()+"px",imageWidth:e.getBoundingClientRect().width+t+"px",imageHeight:this.getFrameHeight()+"px"}),i>window.innerHeight&&(!s||!a)){const t=Object(O.select)(".vto__container");t&&this.setState({imageHeight:t.getBoundingClientRect().height+"px"})}}dataLayer.push({eventCategory:"vto",eventAction:"take picture on PDP",eventLabel:this.state.code,event:"uaevent"}),this.setState({showTimer:!0},()=>{if(this.toggleTopContainerClass(".count-down"),this.a11yOnVideoElem(),Object(R.e)()){const t=Object(O.select)(".vto__container--inner"),e=Object(O.select)(".count-down");e&&window.scrollTo(0,e.offsetHeight),this.disableScroll=new R.h(t,e),this.disableScroll.attach()}})}),D(this,"timerComplete",()=>{window.YMK.snapshot("base64",t=>{this.setState({imgSrc:t,showTimer:!1,showPicture:!0},()=>{this.disableScroll&&this.disableScroll.detach(),this.toggleTopContainerClass(".vto__picture")})})}),D(this,"updateValue",(t,e)=>{this.setState({[t]:e})}),D(this,"photoCaptureClose",()=>{const t=window.innerWidth>960?Object(O.select)(".camera-icon"):Object(O.select)(".interceptor .camera-icon");setTimeout(()=>{t&&t.focus()},0),this.setState({showPicture:!1},()=>{this.setCanvasDimensionsOnResize(),this.a11yOnVideoElem()})}),this.state={code:this.props.variants.findIndex(t=>t.selected).code||this.props.product.code,sellableOnline:this.props.product.sellableOnline,showCTA:!0,quickAdd:!0,showCart:!0,unavailableMsgFlag:!1,showUnavailableMsg:/(SOLD_OUT|OUT_STOCK)/g.test(this.props.product.stock.stockLevel),errorNotificationClosed:!1,shadeChanged:!0,productTitle:Object(O.select)(".product-details__title",document.body).innerText,is4Ombres:!1,windowWidth:window.innerWidth,wishlistData:this.props.product.wishlistData,showCTOpicture:!1,showTimer:!1,showPicture:!1,canvasWidth:0,canvasHeight:0,imageWidth:0,imageHeight:0,imgSrc:"",cameraAvailable:!0,showRotationError:window.matchMedia("(orientation:portrait)").matches!=Object(R.S)(),enableLandscapeError:!0},this.setWishListState(),this.mobileCameraIcon=s.default.createRef(),this.desktopCameraIcon=s.default.createRef()}componentDidMount(){const{dispatch:t,sdk:e}=this.props;this._componentIsMounted=!0,e.addEventListener("loaded",()=>{this.retrySetup();const t=Object(O.select)(".vto__container");t&&!t.className.includes("vto-window-resized")&&(t.className+=" vto-window-resized"),this.initialCanvas(),this.setState({showCTOpicture:!0},()=>{this.setCameraPosition()}),Object(R.Q)()&&setTimeout(()=>{window.scrollTo(0,1)},0)}),e.addEventListener("liveCam",()=>{Object(j.a)({dispatch:t});const e=this.container.querySelector("#YMK-module-iframe");e.setAttribute("aria-hidden","true"),e.setAttribute("title","".concat(g.a.locales.vto.iframe))}),e.addEventListener("noCamera",()=>{Object(j.e)({dispatch:t}),this.setState({cameraAvailable:!1})}),e.addEventListener("invalidProduct",()=>{!this.state.notify&&this._componentIsMounted&&(this.setState({notify:!0}),p.a.show({message:window.config.vto.labels.invalid||window.config.vto.labels.unavailableShade,name:window.config.vto.labels.invalid||"",close:g.a.vto.makeup.closeButtonLabel||"",onShow:()=>{const t=Object(O.select)(".js-notifier-close",Object(O.select)(".notifier__wrapper"));setTimeout(()=>t.focus(),30)},onHide:()=>{this.setState({notify:!1});const t=this.variantNodes[this.getSelectedIndex()],e=Object(O.selectAll)(".vto-variant-shade",Object(O.select)(".interceptor"));t&&(t.setAttribute("tabindex","-1"),t.focus()),e&&e.forEach(t=>{if(!t.getAttribute("aria-hidden")){Object(O.select)("img",t).setAttribute("tabindex","0")}})}})),e.reset(),this.setState({showCTOpicture:!1})});const{width:i,height:s}=this.container.getBoundingClientRect();this.adjust(),e.init({hideUI:!0,width:i,height:s,autoOpen:!0}),this.windowHeight=window.innerHeight,A.C.subscribe(A.fb,this.onResize),this.productFirstImage&&(this.productFirstImage.style.visibility="hidden"),this.state.productTitle&&this.state.productTitle.toLowerCase().includes("les 4 ombres")&&this.setState({is4Ombres:!0});const a=setInterval(()=>{this.initialFrameDimensions(a)},100)}initialFrameDimensions(t){const e=Object(O.select)("#YMK-module-iframe",this.container);if(e&&e.contentWindow.document){const e=Object(O.select)("#YMK-module-iframe",this.container).contentWindow.document,{width:i,height:s}=window.getComputedStyle(Object(O.select)("#YMK-module"));Object(O.select)(".frame-content>div",e).style.height=s,Object(O.select)(".frame-content>div",e).style.width=i,clearInterval(t)}}initialCanvas(){const t=Object(O.select)("#YMK-module-iframe",this.container).contentWindow.document,e=Object(O.select)("#canvas",t);e&&(e.style.opacity=0,setTimeout(()=>{const t=Object(O.select)("#YMK-module-iframe",this.container).contentWindow.document,e=Object(O.select)("#canvas",t),{width:i,height:s}=window.getComputedStyle(Object(O.select)("#YMK-module"));if(e){const t=Math.max(parseInt(i,10)/parseInt(e.style.width.replace("px",""),10),parseInt(s,10)/parseInt(e.style.height.replace("px",""),10));e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transform="translate3d(-50%, -50%, 0) scale(".concat(t,")"),e.style.opacity=1}},500))}async close(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{sdk:i}=this.props;try{let s=!0;this.requestId&&window.cancelAnimationFrame(this.requestId),!e&&Object(j.j)({dispatch:t}),Object(j.g)({dispatch:t}),Object(O.select)(".vto__container--inner").style.display="none";const a=Object(O.select)("button",Object(O.getCollection)(".js-slide",Object(O.select)(".product-details__container"))[0]);for(a&&this._firstSlideElId&&(a.id=this._firstSlideElId);s;){const t=Object(O.select)("#YMK-module-iframe",this.container),a=t&&(Object(O.select)("#canvas",t.contentWindow.document)||Object(O.select)(".frame-content",t.contentWindow.document))||null;await new Promise(t=>{setTimeout(()=>{(a||Object(O.select)(".permissionDenied",Object(O.select)(".vto__container--inner")))&&(Object(O.select)(".permissionDenied",Object(O.select)(".vto__container--inner"))||!e&&i.close(),window.vtoClose(e),s=!1),t()},200)})}}catch(t){console.error(t)}const s=Object(O.select)(".product-details .product-details-scroll");s&&(s.style.visibility="visible")}retrySetup(){const{dispatch:t,sdk:e,showing:i}=this.props;if(e&&i&&this._componentIsMounted&&(this.show(),Object(j.i)({dispatch:t}),this.container)){const t=this.container.querySelector("#YMK-module-iframe");t.setAttribute("aria-hidden","true"),t.setAttribute("tabindex","-1"),t.setAttribute("title","".concat(g.a.locales.vto.iframe))}}renderAddToBag(){const{product:t}=this.props;return s.default.createElement("span",null,this.state.quickAdd?s.default.createElement(C,{quickAddToBag:()=>this.quickAddToBag(t)}):s.default.createElement(x,null))}renderCartIcon(){return s.default.createElement("div",null,this.state.quickAdd?s.default.createElement(m,{hasProduct:""}):s.default.createElement(m,{hasProduct:"already-has-product"}))}getRightNav(){const{showCTA:t,showCart:e}=this.state;return s.default.createElement("div",{className:"nav-right"},t?this.renderAddToBag():"",e?this.renderCartIcon():"")}renderWishListIcon(){return s.default.createElement("li",null,s.default.createElement(L,{codeProduct:this.state.code,accessibility:this.state.vtoWishlist.accessibility,analytics:this.state.vtoWishlist.analytics,textActive:this.state.vtoWishlist.textActive,textInactive:this.state.vtoWishlist.textInactive,wishlistData:this.state.wishlistData}))}getLeftNav(){return s.default.createElement("ul",{className:"nav-left"},this.renderWishListIcon())}getUnavailableMessage(){return this.state.showUnavailableMsg&&s.default.createElement("ul",{className:"nav-right"},s.default.createElement("li",null,s.default.createElement("button",{className:"button nav-item","aria-disabled":"true"},g.a.locales.vto.unavailable)))}notifyError(t){p.a.show({message:t||window.config.vto.labels.limitationError,name:window.config.vto.labels.quickAddToBagError||"",close:window.config.vto.labels.close+" "+window.config.vto.labels.quickAddToBagError||"",onHide:()=>{let t=this.detailsHeader.querySelector("h1.product-details__head"),e=Object(O.selectAll)(".vto-variant-shade",Object(O.select)(".interceptor"));t&&(t.setAttribute("tabindex","-1"),t.focus()),e&&e.forEach(t=>{if(!t.getAttribute("aria-hidden")){Object(O.select)("img",t).setAttribute("tabindex","0")}if(t.classList.contains("selected")){const e=Object(O.select)("img",t);this.setState({errorNotificationClosed:!0},()=>{e.setAttribute("tabindex","0"),e.focus()})}})}})}show(){const{product:t}=this.props;let e="";t.basic.is4ShadowProduct&&t.is4ShadowFeatureFlipping?(e=t.mainSku,YMK.applyMakeupBySku(e)):(e=t.code,YMK.applyMakeupBySku(e)),this.lastProduct=e}toggleIntensity(t,e){YMK.applyMakeupBySku(t),dataLayer.push({eventCategory:"vto",eventAction:"change intensity",eventLabel:e,event:"uaevent"})}componentDidUpdate(){const{showing:t,product:e,variants:i}=this.props;if(this.lastProduct!==e.code&&t&&this.lastProduct!==this.previousIntensity&&(this.previousIntensity=this.lastProduct,this.show()),!this.impetus||this.windowResized&&!this.state.showTimer&&!this.state.showPicture){this.windowResized&&(this.impetus=this.impetus.destroy(),this.windowResized=!1);const t=this.variantList.getBoundingClientRect(),e=this.interceptor.getBoundingClientRect();this.impetus=new b({source:this.variantList,initialValues:[this.state.left,t.top],boundY:[t.bottom,t.bottom],boundX:[-t.width+t.width/i.length,100],update:t=>{Math.round(t)!==this.state.left&&this.setState({left:Math.round(t),animate:!1})},onEnd:()=>{let t=e.width/2+e.left,s=null,a=this.getSelectedIndex();this.variantNodes.forEach((e,i)=>{let n=e.getBoundingClientRect(),o=Math.min(Math.abs(n.left-t),Math.abs(n.right-t));(o<s||!s)&&(s=o,a=i)}),this.setWishListState(),this.setState({code:i[a].code},()=>{setTimeout(()=>{this.select(this.state.code)},100)})}})}}getSelectedIndex(){return this.props.variants.findIndex(t=>t.code===this.state.code)}componentWillReceiveProps(t){const{vto:e,code:i}=t.product;if(e&&e!==this.props.product.vto){const e=t.product;e.basic.is4ShadowProduct&&e.is4ShadowFeatureFlipping?YMK.applyMakeupBySku(e.mainSku):YMK.applyMakeupBySku(i),this.setState({showCTOpicture:!0})}if(this.setState({code:i},()=>this.adjust()),t.ready&&null===this._firstSlideElId){const t=Object(O.select)("button",Object(O.getCollection)(".js-slide",Object(O.select)(".product-details__container"))[0]);if(t){const e=Object(O.select)(".vto__container--inner.makeup",Object(O.select)(".vto__container"));e&&(this._firstSlideElId=t.id,e.id=t.id,t.id="")}}}componentWillUnmount(){this.observers&&this.observers.length&&this.observers.forEach((t,e)=>t.unobserve(this.variantNodes[e])),this.impetus&&(this.impetus=this.impetus.destroy()),document.body.classList.remove("vto-makeup"),document.body.removeAttribute("style"),this.productFirstImage&&(this.productFirstImage.style.visibility="");const{sdk:t}=this.props;["loaded","liveCam","noCamera","invalidProduct"].forEach(e=>{t.removeEventListener(e)}),this._componentIsMounted=!1,A.C.unsubscribe(A.fb,this.onResize)}select(t){this.props.product.code!==t&&this.setState({quickAdd:!0,showCTA:!0,showCart:!0,unavailableMsgFlag:!1,selectedFirstTime:!0,shadeChanged:!0,sellableOnline:this.props.product.sellableOnline},()=>onVariantChange(t))}quickAddToBag(t){const e='<button type="submit"></button>\n        <input type="hidden" name="qty" value="1" />\n        <input type="hidden" name="productCodePost" value="'.concat(t.code,'" />\n        <input type="hidden" name="ctaStatus" value="').concat(t.stock.stockLevel,'" />\n        <input type="hidden" name="CSRFToken" value="').concat(ACC.config.CSRFToken,'" />'),i=document.createElement("form");i.innerHTML=e,i.classList.add="js-addToBag",i.setAttribute("action",g.a.webservices.cart.add),i.setAttribute("method","post"),n.submit(i).then(t=>{const e={eventLabel:dataLayer[0].ecommerce.detail.products[0].name,ecommerce:{add:{products:[dataLayer[0].ecommerce.detail.products[0]]},currencyCode:dataLayer[0].currencyCode},event:"uaevent",eventCategory:"add to cart",eventAction:"VTO quickAdd",cartid:t.cart_id,cartValue:t.cartValue};dataLayer.push(e),this.setState({quickAdd:!this.state.quickAdd,showCart:!0,unavailableMsgFlag:!1})}).catch(t=>{403===t.statusCode&&("OUT_STOCK"===t.stock.stockLevel?(this.setState({sellableOnline:!1,showCart:!1}),this.setState({unavailableMsgFlag:!0,showUnavailableMsg:!0})):(this.setState(t=>({showCTA:!t.showCTA})),this.notifyError(t.formError),this.setState({unavailableMsgFlag:!1,showUnavailableMsg:!1})))})}renderVariants(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,{variants:e=[]}=this.props,{code:i,left:a,animate:n=!1}=this.state,o={transform:"translateX(".concat(a,"px) translateZ(0px)")},c=this.getSelectedIndex(),r=t=>t<c+3&&t>c-3,l=e.map((t,a)=>{let n=i===t.code,o={},l={src:t.shade.src,srcSet:t.shade.srcSet,onKeyDown:e=>{13!==e.keyCode&&32!==e.keyCode||(this.props.product.code===t.code&&this.mobileCameraIcon.current&&this.mobileCameraIcon.current.props.click(),this.select(t.code))},onClick:e=>{e.preventDefault(),this.select(t.code)},role:"button"},d="vto-variant-shade";var h;return n?(l={...l,alt:"".concat(window.config.vto.makeup.variantSelector.selected,": ").concat(t.text.toLowerCase()),tabIndex:"-1"},d+=" selected",o["aria-current"]=!0):r(h=a)&&h>=0&&h<c?l={...l,alt:"".concat(window.config.vto.makeup.variantSelector.previous,": ").concat(t.text.toLowerCase()),tabIndex:"0"}:(t=>r(t)&&t<=e.length-1&&t>c)(a)?l={...l,alt:"".concat(window.config.vto.makeup.variantSelector.next,": ").concat(t.text.toLowerCase()),tabIndex:"0"}:(l={...l,alt:""},r(a)||(o={"aria-hidden":!0})),s.default.createElement("li",B({ref:t=>this.variantNodes[a]=t,className:d,key:a},o),s.default.createElement("span",B({className:""},o),s.default.createElement("img",l)))});return s.default.createElement("div",{ref:this.setInterceptorRef,className:"interceptor"},g.a.vto.makeup.enableCTOPicturePDP&&this.state.showCTOpicture&&!this.state.showTimer&&this.state.cameraAvailable&&s.default.createElement(P.a,{ref:this.mobileCameraIcon,click:this.cameraClicked,cameraMessage:"".concat(window.config.cto.dedicated.cameraText," ").concat(t?t.text:"")}),s.default.createElement("ul",{ref:this.setVariantListRef,className:"vto-shade-list ".concat(n?"animate":""),"data-left":a,style:o},l))}render(){const{variants:t=[],error:e,product:i,dispatch:a}=this.props;let{sellableOnline:n}=this.props.product.sellableOnline,{unavailableMsgFlag:c,productTitle:r,is4Ombres:l}=this.state,h=t[this.getSelectedIndex()]||{shade:{}},u="true"===sessionStorage.getItem("nobrand");const m=window.jsConfigSecond.isBoutiqueApp,p={...window.innerWidth>960?{style:{width:this.state.canvasWidth,height:this.state.canvasHeight}}:{style:{width:window.innerWidth,height:Object(R.ab)()&&(Object(R.O)()||window.innerWidth>window.innerHeight)?"100%":window.innerHeight+"px"}}},v={...window.innerWidth>960?{style:{width:this.state.imageWidth,height:this.state.imageHeight}}:{style:{width:this.state.imageWidth,height:"100%"}}};return s.default.createElement(N.a.Provider,{value:{state:this.state,updateValue:this.updateValue}},s.default.createElement("div",{className:"vto__wrapper"+(e&&e.name?" error-no-camera-makeup":"")+(this.isItChrome?" chrome":""),ref:t=>this.outer=t},s.default.createElement("div",this.state.showTimer||this.state.showPicture?{hidden:!0,"aria-hidden":!0}:{},s.default.createElement(o.a,{close:()=>this.close(a)})),g.a.vto.makeup.enableCTOPicturePDP&&this.state.showCTOpicture&&!(this.state.showTimer||this.state.showPicture)&&this.state.cameraAvailable&&s.default.createElement("div",{className:"pdp-camera"},s.default.createElement(P.a,{click:this.cameraClicked,ref:this.desktopCameraIcon,cameraMessage:"".concat(window.config.cto.dedicated.cameraText," ").concat(h.text),name:"cto_camera_black"})),this.state.showTimer&&s.default.createElement(W.a,{callback:this.timerComplete,customProps:p}),this.state.showPicture&&s.default.createElement(M.a,{imgSrc:this.state.imgSrc,customProps:v,callback:this.photoCaptureClose,customClass:"vto__picture",backIconName:Object(R.F)()||window.innerWidth>960?"cto_back_white":"cto_back_black"}),s.default.createElement("div",this.state.showTimer||this.state.showPicture?{hidden:!0,"aria-hidden":!0}:{},s.default.createElement(d,{toggleIntensity:this.toggleIntensity,product:i,ready:this.props.ready,width:this.state.windowWidth,displayType:"desktop",selectedVariant:h.text})),s.default.createElement("div",B({ref:t=>this.container=t,id:"YMK-module",className:"".concat(e&&e.type?"has-error":"")},this.state.showTimer||this.state.showPicture?{"aria-hidden":!0}:{})),e&&e.name?s.default.createElement(S.a,{error:e}):null,s.default.createElement("div",B({className:"vto-shade-selector__container"},this.state.showTimer||this.state.showPicture?{hidden:!0,"aria-hidden":!0}:{}),s.default.createElement("div",{className:"vto-product-info"},s.default.createElement("h1",{ref:t=>this.detailsHeader=t,className:"product-details__head"},s.default.createElement("span",{className:"heading vto-product-info--title "},r)),!m&&s.default.createElement("div",B({className:"container"},u?{hidden:"true"}:{}),this.getLeftNav(),this.props.product.sellableOnline&&!c?this.getRightNav():this.getUnavailableMessage()),s.default.createElement("p",{className:"shade-title"},s.default.createElement("img",{alt:"",src:h.shade.src,srcSet:h.shade.srcSet}),h.text),s.default.createElement(d,{toggleIntensity:this.toggleIntensity,product:i,ready:this.props.ready,width:this.state.windowWidth,displayType:"mobile",selectedVariant:h.text}),i.sellableOnline?s.default.createElement("p",B({className:"price"},u?{hidden:"true"}:{}),(i.price||"").toString().split(".")[0]):""),this.renderVariants(h))))}})},515:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const s=i(454).default.createContext({state:"",updateValue:()=>{}})},544:function(t,e,i){"use strict";i(15);var s=i(454),a=i(466),n=i(3),o=i(0);class c extends s.Component{constructor(){var t,e,i;super(...arguments),i=()=>{const t=Object(o.select)(".product-details .js-slide:first-child a");t&&(t.style.top="",t.style.zIndex="")},(e="handleClick")in(t=this)?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}componentDidMount(){this.button.focus()}render(){return s.default.createElement("button",{ref:t=>this.button=t,className:"button is-icon vto-close",onClick:()=>{this.props.close(),this.handleClick()}},s.default.createElement(a.a,{name:"close"}),s.default.createElement("span",{className:"is-sr-only"},n.a.locales.vto.closeButtonLabel))}}e.a=c},571:function(t,e,i){"use strict";i(7);var s=i(2),a=i(454),n=(i(0),i(466)),o=i(515);function c(){return(c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class l extends a.Component{constructor(t){super(t),r(this,"browser",Object(s.o)()),r(this,"getDataSource",t=>{const e=this.getImageName();return{files:[t||this.state.file],...this.isItiOS?{}:{text:e},...this.isItiOS?{}:{title:e}}}),r(this,"convertToFile",t=>{fetch(t).then(t=>t.blob()).then(t=>{const e=new File([t],"".concat(this.getImageName(),".jpg"),{type:"image/jpeg"});this.setState({file:e,shareAvailable:(!this.availablePlatform.includes(this.browser.platform)||Object(s.M)())&&navigator.canShare&&navigator.canShare(this.getDataSource(e))})}).catch()}),r(this,"getImageName",()=>{let t=new Date;t=new Date(t.getTime()-6e4*t.getTimezoneOffset());return t.toISOString().replace(/^(.+)T([^.]+).*/,(t,e,i)=>"CHANEL-TRY-ON_".concat(e,"_").concat(i.replace(/:/g,"")))}),this.state={showPicture:!0,shareAvailable:!1,file:null},this.backButton=a.default.createRef(),this.moveBack=this.moveBack.bind(this),this.isItiOS=Object(s.ab)(),this.availablePlatform=["Mac","Windows"]}componentDidMount(){this.backButton.current.focus(),window.scrollTo({top:0,left:0,options:{behavior:"smooth"}}),this.convertToFile(this.props.imgSrc)}moveBack(){this.context.updateValue("showPicture",!1),this.context.updateValue("backClicked",!0)}componentWillUnmount(){this.props.callback()}downloadImage(){dataLayer.push({eventCategory:"vto",eventAction:"take picture",eventLabel:"download",event:"uaevent"});const t=this.getImageName(),e=this.getDataSource(),i=()=>{const e=document.createElement("a");e.href=this.props.imgSrc,e.download=t+".jpg",document.body.appendChild(e),e.click(),document.body.removeChild(e)};this.state.shareAvailable?navigator.share(e).catch(t=>{"AbortError"!==t.name&&(i(),this.setState({shareAvailable:!1}))}):i()}render(){return a.default.createElement("div",c({className:"cto-captured-photo ".concat(this.props.customClass?this.props.customClass:"")},this.props.customProps),a.default.createElement("div",{className:"photo_container "},a.default.createElement("button",c({type:"button",className:"backButton",onClick:this.moveBack,ref:this.backButton},this.props.backIconName&&-1!=this.props.backIconName.indexOf("white")?{style:{color:"#fff"}}:null),a.default.createElement(n.a,{name:this.props.backIconName?this.props.backIconName:"cto_back_black",className:"cto__back_icon"}),window.config.cto.dedicated.photoCaptureBackText),a.default.createElement("img",c({src:this.props.imgSrc,className:"cto__image",alt:window.config.cto.dedicated.photoCaptureImageAltText},window.innerWidth>960?this.props.customProps:null)),a.default.createElement("ul",null,a.default.createElement("li",null,a.default.createElement("button",{type:"button",className:"cto__download_icon",onClick:this.downloadImage.bind(this)},a.default.createElement("span",{className:"is-sr-only"},this.state.shareAvailable?window.config.cto.dedicated.photoCaptureShareText:window.config.cto.dedicated.photoCaptureDownloadText),a.default.createElement(n.a,{name:"cto_download"}))))))}}r(l,"contextType",o.a),e.a=l},621:function(t,e,i){"use strict";i(7);var s=i(454),a=i(466);class n extends s.Component{constructor(t){var e,i,s;super(t),s=t=>{let e,i,s,a;return t.match(/^rgb/)?(e=(t=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],i=t[2],s=t[3]):(e=(t=+("0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&")))>>16,i=t>>8&255,s=255&t),a=Math.sqrt(e*e*.299+i*i*.587+s*s*.114),50},(i="getLuminescence")in(e=this)?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s}render(){let t;return t=this.props.name?this.props.name:this.props.hexValue?this.getLuminescence(this.props.hexValue)>40?"cto_camera_white":"cto_camera_black":"cto_camera_white",s.default.createElement("button",{className:"camera-icon ".concat(this.props.class),type:"button",onClick:this.props.click},s.default.createElement(a.a,{name:t}),s.default.createElement("span",{className:"is-sr-only"},this.props.cameraMessage))}}e.a=n},622:function(t,e,i){"use strict";var s=i(454),a=i(1),n=i(0);function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class r extends s.Component{constructor(t){super(t),c(this,"countDown",()=>{if(!this.isMountedComponent)return!1;let t=this.state.currentTimer-1;this.setState({currentTimer:t}),t<this.state.timerEnd&&(clearInterval(this.timer),this.props.callback())}),c(this,"startTimer",()=>{this.state.currentTimer>=this.state.timerEnd&&(this.timer=setInterval(this.countDown,1e3))}),this.state={timerEnd:2,currentTimer:3},this.timer=0,this.timerRef=s.default.createRef(),this.isMountedComponent=!1}componentDidMount(){this.isMountedComponent=!0,Object(n.select)(".virtual-makeup-component")&&a.C.subscribe(a.i,()=>{window.innerWidth<961&&(window.innerHeight<window.innerWidth?clearInterval(this.timer):this.startTimer())}),this.timerRef.current.focus(),this.startTimer()}componentDidUpdate(t){void 0!==this.props.pauseTimer&&t.pauseTimer!==this.props.pauseTimer&&(this.props.pauseTimer?clearInterval(this.timer):this.startTimer())}componentWillUnmount(){this.isMountedComponent=!1,clearInterval(this.timer)}render(){return s.default.createElement("div",o({className:"count-down ".concat(this.props.customClass?this.props.customClass:"")},this.props.customProps),s.default.createElement("div",{className:"count-down-text"},s.default.createElement("p",{tabIndex:"-1",ref:this.timerRef},s.default.createElement("span",{className:"is-sr-only"},window.config.cto.dedicated.timerText,": "),s.default.createElement("span",{"aria-live":"assertive"},this.state.currentTimer))))}}e.a=r},748:function(t,e,i){"use strict";var s=i(454);e.a=t=>{let{error:e}=t;return s.default.createElement("div",{className:"error permissionDenied"},s.default.createElement("div",{role:"heading","aria-level":"2",className:"error__title"},e.name),s.default.createElement("p",{className:"error__message"},e.message))}}}]);