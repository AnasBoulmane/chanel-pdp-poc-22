{"version":3,"sources":["webpack:///./patterns/scripts/config/locales-en.js","webpack:///./patterns/scripts/pages/plp/api.js","webpack:///./patterns/scripts/pages/plp/filters.js","webpack:///./patterns/scripts/pages/plp/index.js"],"names":["config","webservices","search","filtersCloseLabel","API","query","facets","get","buildURL","then","sanitizeFacets","data","facetData","map","facet","id","code","isSpecialFacet","specialFacet","isPriceFacet","priceFacet","values","facetValue","toPrice","fromPrice","isDisabled","isSelected","productListHTML","productListPage","nextPage","next","totalResults","filterResults","dataLayer","productList","Manager","publish","PLP_PRODUCT_LIST_UPDATED","Object","keys","error","console","location","window","href","connectSign","includes","newLocation","queryString","reduce","sum","locales","plp","priceFilter","length","facetValues","value","join","push","activeValues","filter","replace","noHash","origin","pathname","updateQueryStringParameter","uri","key","componentsCountKey","componentsCountValue","isViewMore","re","RegExp","isSearch","indexOf","requestParam","requestSep","requestSearch","sep","res","match","isNaN","undefined","trim","queryPage","page","componentsCount","parseInt","Filters","facetsEl","serialize","updateElementsFromObject","facetEl","facetId","dataset","type","priceMin","select","firstElementChild","priceMax","lastElementChild","priceValues","selectAll","selectEl","isClickedClear","localStorage","getItem","isPriceOnUrl","isDirty","valueEl","facetValueId","getAttribute","priceId","forEach","facetValueEl","setAttribute","priceRange","fromValue","lowestAvailablePrice","split","toValue","highestAvailablePrice","setItem","facetGroupEl","toLowerCase","serializedFacetValue","plpFilterHeader","closest","Constants","BODY","FILTER_BAR","GRID_VIEW","GRID_WRAPPER","GRID_ROW","LOADMORE_CONTAINER","LIVE_LOADING_TEXT","HERO","HERO_IMG","stickyCollectionTitle","collectionTitle","exceedingElems","ANIMATION_TIMING","isFilters","desktopFacetsPerRow","visualFilterBreakpoint","facetInfo","plpFilterFacet","windowWidth","innerWidth","loadMoreData","isLoadMoreDataPreLoaded","productDataViewMore","NarrowScreenController","tray","Tray","els","panelEl","toggleEl","closeLabel","locale","labelledBy","additionalClasses","onClose","handleTrayClose","focusableElement","applyEl","clearEl","classList","remove","collapseEls","getCollection","el","savedState","validatedInput","enter","leave","toggle","reset","handleFacetValueChange","isOpen","getSelectedFacets","setFooterButtonViews","addEventListener","handleApplyClick","collapseEl","handleCollapse","contains","add","nextElementSibling","removeAttribute","removeEventListener","close","filters","open","substring","index","lastFacetsRow","collapse","hide","actionType","visualFacetList","visualFacetConatiner","filterFacet","items","listButton","selectedFacetCount","selectFacetsValue","innerHTML","facetCount","hasSeeMore","pop","listitems","numberOfLastRowItems","e","target","currentTarget","disableAllFacets","detail","selectboxEl","selectedIndex","options","update","facetUl","attributes","ariaPressed","loader","Loader","enableSyncCol","referenceEl","delay","bypassTabindexUpdate","bypassLoadingMessageFocus","previousScrollPosition","scrollTop","loaderElem","init","create","updateLoadingTxt","getComputedStyle","top","style","overflowY","resetClearStorage","destroy","focus","sanitizePriceValues","querySelector","priceRangeUpdate","hasActiveFilters","some","isPriceFiltered","innerText","resultText","totalProducts","jsConfigSecond","plpFilter","noFilterTransalation","currentCollapse","isVisible","unsubscribe","refineButton","event","ariaDisabled","ay11Check","dataTrack","eventCategory","eventAction","eventLabel","document","DLKit","gridEl","catch","noop","subscribe","updateFilterSectionFacets","log","targetCheckbox","getTargetCheckbox","WideScreenController","filterWrapper","syncols","handleStickyFilterInit","seeMoreBtns","filtersTrayTitle","productGrid","mutationObserver","MutationObserver","mutations","LOAD_PLP_PROUCTS","observe","childList","characterData","updateAria","updateFilterSyncol","filterMoreBtn","plpWrapper","minHeight","clientHeight","toggleExceedingComponents","gridviewEl","elem","focusElement","stickyHeight","syncol","SyncCols","HEADER_LARGE_EXPANDED_HEIGHT","isPriceFilter","isSelectboxFilter","hasCheckedButton","find","button","inert","set","TweenLite","to","opacity","isChecked","currentUrl","urlPrice","sIndex","Array","from","compareValue","option","parentNode","unset","clickedFacet","scrollToAnimate","filterSelected","children","width","filterFacetIsCarousel","coreFilterPanel","filterSelect","checkingCondition","filterSelectContainer","getBoundingClientRect","isiOS","isLTR","x","left","filterPadding","paddingLeft","disable","selectedButton","panel","allCTAs","querySelectorAll","FILTER_SIDEPANEL_DISABLED","item","tagName","removeVtoCTA","urlHasEyewear","l","vtoSupported","vtoCTAs","checkPLPdesktop","plpContainer","isDesktop","isSafari","requestAnimationFrame","PLP","clearBtnEls","facetsEls","loadmore","api","initialTitle","filterPriceOpt","clearHandleClicked","searchPage","expose","updateComponentsProportions","loaderUpdateComponents","totalPage","narrowScreenController","wideScreenController","controller","currentPageReal","clickedProductId","pagePLPStorage","JSON","parse","removeLocalstorage","pagePLP","lastPLPUrl","plpPageTitle","productItems","fromPLP","backPLP","filterPLP","onPageLoad","bind","handleBreakpoint","updateButtons","updateLinkDirection","title","updateTitleOnLoad","setTimeout","openVtoPlp","url","isPlpEyewear","isVtoActive","isVTOActive","EyewearFirstCategory","EyewearSecondCategory","hasHash","category","btn","shouldOpenVTO","parentElement","className","click","createElement","vtoView","vtoCategory","body","appendChild","removeChild","displayComponent","totalProductsPerPage","totalProductsPage","listOfComponents","position","isWideScreen","Math","ceil","sortPositionsList","listOfElems","isMobile","sort","elemA","elemB","replacePlpList","firstDownloadElement","scrollPos","container","append","firstElem","tl","TimelineLite","fromTo","firstDownloadElementLink","scrollTo","PLP_PAGE_LOAD","updatePositions","handleStickyCollectionTitle","products","productsOffset","headerHeight","offsetHeight","stickyOffset","closestOffset","getClosest","selectIndex","productsList","numberOfColumns","round","offsetWidth","selectedElm","articleElem","collection","visualFacetScroll","enabled","scrollMax","scrollWidth","offsetLeft","scrollLeft","scrollTimeline","startTransition","xPercent","outTranstion","closestSection","plpHeaderFacetClick","stopPropagation","fakeCheckboxEl","handleSeeMoreClick","filterOpt","handleLinkDirection","bindEvent","onStoryClick","onHelpClick","BREAKPOINT_CHANGE","clearBtnEl","handleResetClick","handleToggle","handlePopState","handlePriceSelect","handleLoadMore","handleKeyboard","sendData","eventName","handleBeforeUnload","mutation","subtree","FILTER_SIDEPANEL_OPENED","facetListCollection","isSmallScreen","facetLists","closeSeeMoreItems","preventDefault","WINDOW_WAS_RESIZED","lazyLoadingImage","lazyloadImages","imageObserver","IntersectionObserver","entries","observer","entry","isIntersecting","image","src","unobserve","lazyloadTimeout","lazyload","clearTimeout","pageYOffset","img","offsetTop","innerHeight","stringify","toggleSeeMoreList","buttonEl","reveal","listEl","liEl","focusItem","isLoading","text","priceToEl","priceFromCurrentVal","priceToCurrentVal","availablePriceRange","lowestAvailableVal","hightestAvailableVal","availableFromVal","min","availableToVal","max","filterPriceOnly","priceFromMaxValue","i","display","selectedOption","isFshVtoModalOpen","reload","eAction","filterCatEl","filterCatSpecialEl","filterEl","catName","filterName","hasAttribute","facetSection","handlePriceCTA","fromPriceEl","toPriceEl","fromPriceVal","toPriceVal","updateProducts","buttonClicked","filtersData","currentPage","subitem","filtersDataReset","divEl","totalBlock","initWishlistData","CacheIndex","rePublishPageLoadData","FILTER_SIDEPANEL_ENABLED","updateURL","updateTitle","tryOnLegal","vto","isActive","tryOnConstants","element","bindTryOnButtonEvents","message","cto","err","stack","notifier","prevController","setFilterTrayDimensions","trayContainer","trayBody","trayClose","trayFooter","trayWidth","transform","gridElOffset","getTopOffset","y","resetSelectPrices","optionLength","elementID","asideVisibility","getMq","handleCollapseState","isFilterList","filterFacetId","filteredOnUrl","filteredPriceFrom","filteredPriceTo","filtered","isClear","storageCurrentPage","removeItem","filterData","priceSelected","titleParts","prefixPos","refinedTitle","suffixPosition","splice","filterButton","history","pushState","AFTER_PUSH_STATE","firstFilterFacetSection","visualFilterPanelEl","visualFilterLoader","firstCheckbox","facetButton","apiCallback","hasOwnProperty","dataLayerGA","assign","newEls","realProductGrid","nbOfDisplayedElm","dlUpdateLoadedProductsValue","updateHeadLink","afterCallbackFinished","manageLoader","apiParams","components","lastComponentPosition","positionMobile","positionDesktop","param","productDataToMonetate","myObject","getPropValues","o","prop","productSKUs","Set","productIDs","toUpperCase","pageLoad","page_type","sendDataToMonetate","getMaxWidth","numberOfElementsPerLine","floor","productElem","productWidth","maxWidth","fullGridWidth","spaceTillMaxWidth","spaceToAdd","singleExceededComponents","visibility","links","prev","linksArray","link","otherEl","nextSibling","insertBefore","lastIndexOf","outerHTML","lastIndex","currTitle","UrlLocalStorage","UrlLocation","UrlElParent","UrlEl","childEl","onProductClick","pElm","delegateTarget","productCode","PRODUCT_CLICKED","elm","params","addToBag","ADD_TO_BAG_CLICKED","elmToUpdate","productObjList","attTrackClick","attPlpProductClick","ecommerce","impressions","heroHeight","productGridEl","dlStoryData","dlHelpData","attributeName","ViewMoreProducts","pushMonetateDataOnViewMore","chanelMonetateData","pageType","categories","customVariables"],"mappings":"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","file":"chunks/plp.js?v=3.23.0","sourcesContent":["import config from 'lib/config'\n\nexport default {\n  'Carousel-dots-title': 'Panel',\n  'Carousel-dots-active': 'active',\n  'Filters-close-title': config.webservices.search.filtersCloseLabel\n}\n","import { get } from 'modules/fetch'\nimport config from 'lib/config'\nimport { Manager, PLP_PRODUCT_LIST_UPDATED} from 'lib/events'\n\nfunction API() {\n\n  function query(facets) {\n    return get(buildURL(facets))\n      .then(sanitizeFacets)\n  }\n\n  function sanitizeFacets(data) {\n    // eslint-disable-next-line arrow-body-style\n    const facets = data.facetData.facets.map(facet => {\n      return {\n        id: facet.code,\n        isSpecialFacet: facet.specialFacet,\n        isPriceFacet: facet.priceFacet,\n        // eslint-disable-next-line arrow-body-style\n        values: facet.values.map(facetValue => {\n          if (facetValue.toPrice) {\n            return {\n              id: facetValue.code,\n              fromPrice: facetValue.fromPrice,\n              toPrice: facetValue.toPrice\n            }\n          }\n          return {\n            id: facetValue.code,\n            isDisabled: facetValue.isDisabled,\n            isSelected: facetValue.isSelected\n          }\n        })\n      }\n    })\n    const productListHTML = data.productListPage\n    const nextPage = data.next\n    const totalResults = data.totalResults\n    const filterResults = data.filterResults\n\n    try{\n      if(data && data.dataLayer && data.dataLayer.productList){\n        Manager.publish(PLP_PRODUCT_LIST_UPDATED, Object.keys(data.dataLayer.productList))\n      }\n    }catch (error){\n      console.error(error)\n    }\n    return { facets, productListHTML, totalResults, nextPage, filterResults }\n  }\n\n  function buildURL(facets) {\n    const location = window.location.href\n    const connectSign = !location.includes('?') ? '?' : '&';\n    let newLocation \n    // Regular facets\n    const queryString = facets.reduce((sum, facet) => {\n      if (facet.id === config.locales.plp.priceFilter) {\n        if (facet.values.length) {\n          const facetValues = facet.values[0].map(value => value).join('-')\n          sum.push(`${facet.id}:${facetValues}`)\n        }\n      }\n      const activeValues = facet.values.filter(value => value.isSelected)\n      if (activeValues.length) {\n        if (facet.id === 'special') {\n          const facetValues = activeValues.map(value => `${value.id}:true`).join('|')\n          sum.push(facetValues)\n        } else {\n          const facetValues = activeValues.map(value => value.id).join(',')\n          sum.push(`${facet.id}:${facetValues}`)\n        }\n      }\n      return sum\n    }, []).join('|')\n\n    if (location.includes('q=')){\n      newLocation = location.replace('q=','requestType=ajax&q=' )\n    } else {\n      const noHash = window.location.origin + window.location.pathname + window.location.search\n      newLocation=`${noHash}${connectSign}requestType=ajax`\n    }\n    // Special facets\n    return updateQueryStringParameter(newLocation, 'q', queryString)\n  }\n\n  /**\n   * building url for the ajax call on view more\n   * @param uri\n   * @param key\n   * @param value\n   * @param componentsCountKey\n   * @param componentsCountValue\n   * @returns Url\n   */\n  function updateQueryStringParameter(uri, key, value, componentsCountKey = 'totalElementsCount', componentsCountValue = 0, isViewMore = false) {\n    const re = new RegExp(`([?&])${key}=.*?(&|$)`, 'i')\n    const isSearch = uri.indexOf('?') && uri.includes('?text')\n    const requestParam = 'requestType=ajax'\n    const requestSep = isSearch ? '&' : '?'\n    const requestSearch = isSearch && key === 'page' ? '' : requestParam\n    const sep = uri.indexOf('?') !== -1 ? '&' : '?'\n\n    let res\n\n    if (uri.match(re)) {\n      if (value) {\n\n        if (requestSearch == requestParam){\n          res = uri.replace(re, `$1${key}=${value}$2`)\n        }else {\n          res = uri.replace(re, `$1${requestSearch}&${key}=${value}$2`)\n        }\n        \n      } else {\n        res = uri.replace(re, '')\n      }\n    }\n    else {\n      if (isNaN(componentsCountValue) || componentsCountValue === undefined || !isViewMore) {\n        res = `${uri.replace(`?${requestParam}`, `${requestSep}${requestParam}`)}${sep}${key}=${value}`\n      } else {\n        res = `${uri.replace(`?${requestParam}`, `${requestSep}${requestParam}`)}${sep}${key}=${value}${sep}${componentsCountKey}=${componentsCountValue}`\n      }\n    }\n    \n    if(value !== undefined && value !== null){\n      if(typeof value === 'string' && value.trim() === ''){\n        res = uri.replace(re, '')\n      }   \n    }\n    return res\n  }\n  \n  function queryPage(page, componentsCount, isViewMore = false) {\n    const sep = window.location.href.indexOf('?') !== -1 ? '&' : '?'\n    if (isViewMore) {\n      return get(updateQueryStringParameter(`${window.location.href}${sep}requestType=ajax`, 'page', page, 'totalElementsCount', parseInt(componentsCount) + 1, isViewMore))\n    }\n    return get(updateQueryStringParameter(`${window.location.href}${sep}requestType=ajax`, 'page', page))\n  }\n\n  return { query, buildURL, queryPage }\n\n}\n\nexport default API\n\n","import { select, selectAll, closest } from 'lib/selectors'\nimport config from 'lib/config'\nimport * as Constants from 'ui/widgets/tray/constants'\n\nfunction Filters(facetsEl) {\n  return { serialize, updateElementsFromObject }\n\n  // Extract values from html current state\n  function serialize() {\n    const data = facetsEl.reduce((sum, facetEl) => {\n      const facetId = facetEl.dataset.facetId\n      let facetValues = []\n      if (facetEl.dataset.type === 'price') {\n        const priceMin = select('#price_from').firstElementChild.value\n        const priceMax = select('#price_to').lastElementChild.value\n        const priceValues = selectAll('select', facetEl).map(selectEl => selectEl.value)\n        // eslint-disable-next-line max-len\n        const isClickedClear = localStorage.getItem('clearFilter') ? true : false;\n        const isPriceOnUrl = window.location.href.includes(facetId)\n\n        if (isClickedClear) {\n          if (priceValues.length === 2\n            && (priceValues[0] !== priceMin || priceValues[1] !== priceMax)) {\n            facetValues.push(priceValues)\n          }\n        }\n        // Check if it's a user choice (if it isn't, we don't want to have it in url, cf ONE-12831)\n        else if (facetEl.dataset.isDirty) {\n          if (priceValues.length === 2 &&\n            ((priceValues[0] !== priceMin || priceValues[1] !== priceMax) || isPriceOnUrl)) {\n            facetValues.push(priceValues)\n          }\n        }\n      } else {\n        facetValues = selectAll('[aria-pressed]', facetEl)\n        // eslint-disable-next-line arrow-body-style\n          .map(valueEl => {\n            return {\n              id: valueEl.dataset.facetValueId,\n              isDisabled: valueEl.getAttribute('aria-disabled') === 'true',\n              isSelected: valueEl.getAttribute('aria-pressed') === 'true'\n            }\n          })\n      }\n\n      if (facetValues.length > 0) {\n        sum.push({\n          id: facetId,\n          values: facetValues\n        })\n      }\n      return sum\n    }, [])\n    return data\n  }\n\n  function updateElementsFromObject(data) {\n    const priceId = config.locales.plp.priceFilter\n    data.forEach(facet => {\n      if (facet.isSpecialFacet) {\n        const facetValueEl = select(`.filters__facet-section [data-facet-value-id=\"${facet.id}\"]`)\n        if (facetValueEl && facet.values.length > 0) {\n          if(facet.values[0].isDisabled && facet.values[0].isSelected){\n            facet.values[0].isSelected = false\n          }\n          facetValueEl.setAttribute('aria-disabled', facet.values[0].isDisabled)\n          facetValueEl.setAttribute('aria-pressed', facet.values[0].isSelected)\n        }\n      } else {\n        if(facet.id == priceId) {\n          let priceRange = []\n          if(facet.values.length){\n            const fromValue = facet.values[0].id\n            const lowestAvailablePrice = fromValue.split('&lt;')[0]\n            const toValue = facet.values[facet.values.length -1].id\n            const highestAvailablePrice = toValue.split('&lt;')[2]\n\n            priceRange.push(lowestAvailablePrice, highestAvailablePrice)\n            window.localStorage.setItem('availablePriceRange', priceRange);\n          }\n        }\n        const facetGroupEl = select(`.filters__facet-section [data-facet-id=\"${facet.id}\"]`)\n        if (facetGroupEl) {\n          facet.values.forEach(facetValue => {\n            const facetValueId = facetValue.id ? facetValue.id.toLowerCase() : ''\n            const serializedFacetValue = facetValueId.replace(/;/g, ',')\n            const facetValueEl = select(`[data-facet-value-id=\"${serializedFacetValue}\"]`, facetGroupEl)\n            const plpFilterHeader = closest(facetValueEl, '.plp-filter-section') == null\n            if (facetValueEl && plpFilterHeader) {\n              if(facetValue.isDisabled && facetValue.isSelected){\n                facetValue.isSelected = false\n              }\n              facetValueEl.setAttribute('aria-disabled', facetValue.isDisabled)\n              facetValueEl.setAttribute('aria-pressed', facetValue.isSelected)\n            }\n          })\n        }\n        if(!select(`body${Constants.PLP_FILTER_OPEN}`)) {\n          facet.values.forEach(facetValue => {\n            const facetValueId = facetValue.id ? facetValue.id.toLowerCase() : ''\n            const serializedFacetValue = facetValueId.replace(/;/g, ',')\n            const facetValueEl = select(`.plp-filter-section [data-facet-value-id=\"${serializedFacetValue}\"]`)\n            if (facetValueEl) {\n              if(facetValue.isDisabled && facetValue.isSelected){\n                facetValue.isSelected = false\n              }\n              facetValueEl.setAttribute('aria-disabled', facetValue.isDisabled)\n              facetValueEl.setAttribute('aria-pressed', facetValue.isSelected)\n            }\n          })\n        }\n      }\n    })\n  }\n}\n\nexport default Filters\n","import { Manager, BREAKPOINT_CHANGE, LOAD_PLP_PROUCTS, PLP_PAGE_LOAD, AFTER_PUSH_STATE, PRODUCT_CLICKED, ADD_TO_BAG_CLICKED, FILTER_SIDEPANEL_OPENED, FILTER_SIDEPANEL_DISABLED, FILTER_SIDEPANEL_ENABLED, PLP_PRODUCT_LIST_UPDATED } from 'lib/events'\nimport * as bindEvent from 'delegate'\nimport { debounce, filter } from 'lodash'\nimport { isWideScreen, getTopOffset, isiOS, getMq, focusElement, getClosest, isface, isLTR } from 'lib/helpers'\nimport { select, selectAll, getCollection, closest } from 'lib/selectors'\nimport Filters from './filters'\nimport API from './api'\nimport Tray from 'ui/widgets/tray'\nimport locale from 'config/locales-en'\nimport SyncCols from 'ui/widgets/sync-cols'\nimport config from 'lib/config'\nimport { initWishlistData } from 'lib/wishlist/wishlist-ui'\nimport Loader from 'ui/widgets/loader'\nimport inert from 'lib/inert'\nimport Video from 'ui/video'\nimport { HEADER_LARGE_EXPANDED_HEIGHT } from 'config/constants'\nimport CacheIndex from 'modules/cache/pages/index'\nimport l from 'ui/vto/Utils/helpers'\nimport * as Constants from 'ui/widgets/tray/constants'\nimport {hasHash} from '../index'\nimport { WINDOW_WAS_RESIZED } from 'lib/events'\nimport notifier from 'modules/notifier'\nimport { bindTryOnButtonEvents } from 'ui/try-on-legal'\nimport * as tryOnConstants from 'ui/try-on-legal/constant'\n\nimport {pushMonetateDataWithProductDetails, pushMonetateDataOnViewMore} from '../../ui/monetate'\n\nconst BODY = select('body')\nconst FILTER_BAR = select('.plp-filter-bar')\nconst GRID_VIEW = select('.js-pdp-grid')\nconst GRID_WRAPPER = select('.pdp-grid-wrapper')\nconst GRID_ROW = select('.pdp-grid__row', GRID_VIEW)\nconst LOADMORE_CONTAINER = select('.loadmore-container', GRID_VIEW)\nconst LIVE_LOADING_TEXT = select('.js-live-loading')\nconst HERO = select('.hero')\nconst HERO_IMG = select('.hero img')\nconst stickyCollectionTitle = select('.js-collection-title')\nlet collectionTitle = ''\nlet exceedingElems = []\nconst ANIMATION_TIMING = 0.5\nconst isFilters = select('.is-filters')\nconst desktopFacetsPerRow = 3\nconst visualFilterBreakpoint = 600\nlet facetInfo = null\nconst plpFilterHeader = select('.plp-filter-section')\nlet plpFilterFacet\nlet windowWidth = window.innerWidth\nlet loadMoreData = {}\nlet isLoadMoreDataPreLoaded = false\nlet productDataViewMore = []\n\nfunction NarrowScreenController(plp) {\n  const tray = new Tray(plp.els.panelEl, {\n    toggleEl: plp.els.toggleEl,\n    closeLabel: locale['Filters-close-title'],\n    labelledBy: 'filters-tray-title',\n    additionalClasses: ['is-filters'],\n    onClose: handleTrayClose,\n    focusableElement: select('.plp-filter-bar__label')\n  })\n  let applyEl = null\n  let clearEl = null\n  if (Constants.NEW_VISUAL_FILTER) {\n    applyEl = select('.js-filters-apply', plp.els.panelEl)\n    clearEl = select('.js-filters-clear', plp.els.panelEl)\n    applyEl.classList.remove('is-hidden-l')\n    clearEl.classList.remove('is-hidden-l')\n  } else {\n    applyEl = select('.js-filters-apply', plp.els.panelEl)\n    clearEl = select('.tray__header.js-tray-item', plp.els.panelEl)\n  }\n  const collapseEls = getCollection('[data-module=collapse]', plp.els.el)\n  // eslint-disable-next-line no-unused-vars\n  let savedState\n  // eslint-disable-next-line no-unused-vars\n  let validatedInput = false\n\n  return { enter, leave, toggle, reset, handleFacetValueChange, isOpen, getSelectedFacets, setFooterButtonViews}\n\n  function enter() {\n    plp.els.toggleEl.setAttribute('aria-haspopup', 'dialog')\n    applyEl.addEventListener('click', handleApplyClick)\n    if(!Constants.NEW_VISUAL_FILTER){\n      collapseEls.forEach(collapseEl => collapseEl.addEventListener('COLLAPSE_CHANGE', handleCollapse))\n    }\n\n    if (isFilters && isFilters.classList.contains('is-hidden')) {\n      isFilters.classList.remove('is-hidden')\n      isFilters.classList.add('was-clicked')\n      isFilters.nextElementSibling.classList.add('is-hidden')\n    }\n  }\n\n  function leave() {\n    plp.els.toggleEl.removeAttribute('aria-haspopup')\n    applyEl.removeEventListener('click', handleApplyClick)\n    collapseEls.forEach(collapseEl => collapseEl.removeEventListener('COLLAPSE_CHANGE', handleCollapse))\n    if (tray.isOpen()) {\n      tray.close()\n    }\n  }\n\n  function toggle() {\n    validatedInput = false\n    savedState = plp.filters.serialize()\n    tray.open()\n    Constants.NEW_VISUAL_FILTER ? BODY.classList.add(Constants.PLP_FILTER_OPEN.substring(1)) : null\n    collapseEls.forEach((collapseEl, index) => {\n      if (Constants.NEW_VISUAL_FILTER && collapseEl) {\n        getSelectedFacets(collapseEl)\n        lastFacetsRow(collapseEl)\n      }\n      if (collapseEls[0] !== collapseEl || Constants.NEW_VISUAL_FILTER) {\n        const collapse = collapseEl.data('collapse')\n        collapse.hide()\n      }\n\n    })\n    if (Constants.NEW_VISUAL_FILTER) {\n      setFooterButtonViews(plp, null)\n    }\n  }\n\n  function isOpen() {\n    return select('.tray.is-filters')\n  }\n\n  function getSelectedFacets(collapseEl, actionType) {\n    const visualFacetList = selectAll('.visual-facet li', collapseEl)\n    const visualFacetConatiner = collapseEl.closest('.visual-facet')\n    if (visualFacetList && visualFacetConatiner ) {\n      const filterFacet = visualFacetList.filter((items => {\n        const listButton = select('.js-fake-checkbox', items)\n        return listButton && listButton.getAttribute(\"aria-pressed\") == 'true'\n      }))\n      const selectedFacetCount = select('.selected-facet-count', collapseEl)\n      if (selectedFacetCount) {\n        const selectFacetsValue = selectedFacetCount.innerHTML.replace(/[^\\d.-]/g, '')\n        let facetCount = parseInt(selectedFacetCount.innerHTML.length > 0 ? selectFacetsValue : 0)\n        switch (actionType) {\n          case 'increase':\n            facetCount++\n            selectedFacetCount.innerHTML = facetCount > 0 ? `(${facetCount})` : ''\n            break\n          case 'decrease':\n            facetCount--\n            selectedFacetCount.innerHTML = facetCount > 0 ? `(${facetCount})` : ''\n            break\n          default:\n            selectedFacetCount.innerHTML = filterFacet.length > 0 ? `(${filterFacet.length})` : ''\n        }\n      }\n    }\n  }\n\n  function lastFacetsRow(collapseEl) {\n    const visualFacetList = selectAll('.visual-facet li', collapseEl)\n    const visualFacetConatiner = collapseEl.closest('.visual-facet')\n    if (visualFacetList && visualFacetConatiner ) {\n      const hasSeeMore = select('.visual-facet__seemore', collapseEl)\n      hasSeeMore ? visualFacetList.pop() : null\n        visualFacetList.forEach((listitems, index) => {\n          const numberOfLastRowItems = visualFacetList.length % desktopFacetsPerRow\n          index >= visualFacetList.length - numberOfLastRowItems ? listitems.classList.add('last-row') : null\n      })\n    }\n  }\n\n  function reset() {\n    validatedInput = true\n    tray.close()\n  }\n\n  function handleFacetValueChange(e = null) {\n    const target = e && (e.currentTarget || e.target)\n    const panelEl = select('.tray__body.js-tray-item')\n    plpFilterFacet = null\n    if (Constants.NEW_VISUAL_FILTER) {\n      disableAllFacets(true, e.target, select('.tray.is-filters'))\n    }\n\t  if (e.detail) {\n      getCollection('.selectbox__input ', plp.els.panelEl)\n      .forEach(selectboxEl => {\n        selectboxEl.selectedIndex = selectboxEl.id === 'price_from' ? 0 : selectboxEl.options.length - 1\n      })\n    }\n    if (!Constants.NEW_VISUAL_FILTER) {\n      const target = e && (e.currentTarget || e.target)\n      if (target.closest('[data-facet-id=\"special\"]')) {\n        plp.update(false)\n      }\n    }\n    const collapseEl = target.closest('.collapse-panel')\n    const facetUl = target.closest('[data-facet-id]')\n    if(collapseEl){\n      if(Constants.NEW_VISUAL_FILTER && collapseEl && !(facetUl && facetUl.attributes[\"data-facet-id\"].value.includes(\"price\"))) {\n        getSelectedFacets(collapseEl, ((target.ariaPressed || (target.attributes['aria-pressed'] != undefined && target.attributes['aria-pressed'].value)) == 'false' ? 'decrease' : 'increase'))\n      }\n    }\n    if(Constants.NEW_VISUAL_FILTER) {\n      const loader = new Loader(panelEl, {\n        enableSyncCol: false,\n        referenceEl: panelEl,\n        delay: 1000,\n        bypassTabindexUpdate: true,\n        bypassLoadingMessageFocus: true\n      })\n      const previousScrollPosition = panelEl.scrollTop\n      const loaderElem = loader.init()\n      loader.create(() => {\n        plp.updateLoadingTxt(true)\n        panelEl.scrollTop = getComputedStyle(loaderElem).top\n        panelEl.style.overflowY = 'hidden'\n      })\n      plp.resetClearStorage()\n      plp.update(false,loader, e.currentTarget || e.target).then(() => {\n        loader.destroy(() => {\n          panelEl.style.overflowY = 'auto'\n          plp.updateLoadingTxt(false)\n          e.target.focus()\n          panelEl.scrollTop = previousScrollPosition\n        })\n        getCollection('.selectbox__input ', plp.els.panelEl)\n        .forEach(selectboxEl => {\n          plp.sanitizePriceValues(selectboxEl)\n          if (e.target.querySelector('.selectbox__input')) {\n            plp.priceRangeUpdate(selectboxEl)\n          }\n        })\n      })\n    }\n  }\n\n  function setFooterButtonViews(plp, filterResults = null) {\n    const applyEl = select('.js-filters-apply', plp.els.panelEl)\n    const clearEl = select('.js-filters-clear', plp.els.panelEl)\n    const isClickedClear = localStorage.getItem('clearFilter') ? true : false\n    let hasActiveFilters = plp.filters.serialize().some(facet => {\n      return facet.values.some(value => value.isSelected)\n    })\n    if (!isClickedClear && plp.isPriceFiltered()) {\n      hasActiveFilters = true\n    }\n    if (hasActiveFilters) {\n      clearEl.removeAttribute('aria-disabled')\n      clearEl.removeAttribute('tabindex')\n      if (filterResults) {\n        applyEl.innerText = filterResults.resultText\n        if(filterResults?.totalProducts == 0) {\n          applyEl.innerText = window.jsConfigSecond.plpFilter.noFilterTransalation\n        } \n      }\n    } else {\n      clearEl.setAttribute('tabindex', -1)\n      clearEl.setAttribute('aria-disabled', true)\n      applyEl.innerText = window.jsConfigSecond.plpFilter.noFilterTransalation\n    }\n  }\n\n  function handleCollapse(e) {\n    const panelEl = select('.tray__body.js-tray-item')\n    const loader = new Loader(panelEl, {\n      enableSyncCol: false,\n      referenceEl: panelEl,\n      delay: 0\n    })\n\n    let currentCollapse\n    collapseEls.forEach(collapseEl => {\n      if (collapseEl === e.currentTarget) {\n        currentCollapse = collapseEl\n      }\n    })\n\n    loader.init()\n    loader.create(() => {\n      panelEl.removeAttribute('aria-hidden', 'true')\n      plp.updateLoadingTxt(true)\n    })\n    if (!e.detail.isVisible) {\n      loader.destroy(() => {\n        plp.updateLoadingTxt(false)\n        select('.collapse-panel__button', currentCollapse).focus()\n      })\n      return\n    }\n    collapseEls.forEach((collapseEl, index)=> {\n      if (Constants.NEW_VISUAL_FILTER && collapseEl) {\n        getSelectedFacets(collapseEl)\n        lastFacetsRow(collapseEl)\n      }\n      if (collapseEl !== e.currentTarget) {\n        const collapse = collapseEl.data('collapse')\n        collapse.hide()\n      }\n    })\n    plp.update(false , loader, e.currentTarget || e.target).then(() => {\n      loader.destroy(() => {\n        plp.updateLoadingTxt(false)\n        select('.collapse-panel__button', currentCollapse).focus()\n      })\n      getCollection('.selectbox__input ', plp.els.panelEl)\n      .forEach(selectboxEl => {\n        !Constants.NEW_VISUAL_FILTER ? plp.sanitizePriceValues(selectboxEl) : null\n        if (e.target.querySelector('.selectbox__input')) {\n          plp.priceRangeUpdate(selectboxEl)\n        }\n      })\n    })\n  }\n\n  function handleTrayClose() {\n    if (!validatedInput) {\n      handleApplyClick()\n      Manager.unsubscribe('onComplete')\n    }\n    const refineButton = select('.js-pdp-grid-toggle')\n    refineButton.focus()\n  }\n\n  function handleApplyClick(event) {\n    if (event != undefined && (event.currentTarget.ariaDisabled == 'true' || event.target.ariaDisabled == 'true' || ay11Check(event.target, 'aria-disabled')  == 'true')) {\n        return false\n    }\n    validatedInput = true\n    const panelEl = select('.pdp-grid__main')\n    const loader = new Loader(panelEl, {\n      enableSyncCol: false,\n      referenceEl: panelEl,\n      delay: 0\n    })\n    if (Constants.NEW_VISUAL_FILTER && event != undefined && (event.target.classList.contains('js-filters-apply') || event.currentTarget.classList.contains('js-filters-apply'))) {\n      const dataTrack = {\n        eventCategory: 'filter',\n        eventAction: 'see_results',\n        eventLabel: '',\n        event: 'uaevent'\n      }\n      window.document.DLKit.push('on-tracking', dataTrack)\n    }\n    const gridEl = select('.js-pdp-main')\n    loader.init()\n    loader.create(() => {\n      plp.updateLoadingTxt(true)\n    })\n    Constants.NEW_VISUAL_FILTER ? disableAllFacets(true, null, gridEl) : null\n    Constants.NEW_VISUAL_FILTER && tray.close()\n    plp.update(true ,loader)\n      .catch(config.noop)\n      .then(() => {\n        loader.destroy(() => {\n          plp.updateLoadingTxt(false)\n        })\n        Manager.subscribe('onComplete', (data) => {\n          data.setAttribute('tabindex', '-1')\n          data.focus()\n        })\n        !Constants.NEW_VISUAL_FILTER && tray.close()\n      })\n  }\n\n  function updateFilterSectionFacets(plpFilterHeader) {\n    if (plpFilterHeader) {\n      console.log(selectAll('.js-fake-checkbox', plpFilterHeader))\n      selectAll('.js-fake-checkbox', plpFilterHeader).forEach(el => {\n        const targetCheckbox = plp.getTargetCheckbox(el)\n        if (targetCheckbox) {\n          targetCheckbox.ariaPressed && targetCheckbox.ariaPressed == 'true'|| ay11Check(targetCheckbox, 'aria-pressed') == 'true' ? el.setAttribute('aria-pressed', true) : el.removeAttribute('aria-pressed')\n          targetCheckbox.ariaDisabled && targetCheckbox.ariaDisabled == 'true' || ay11Check(targetCheckbox, 'aria-disabled') == 'true' ? el.setAttribute('aria-disabled', true) : el.removeAttribute('aria-disabled')\n        }\n      })\n    }\n  }\n}\n\nfunction WideScreenController(plp) {\n  const filterWrapper = select('.pdp-grid-wrapper')\n  const syncols = handleStickyFilterInit()\n  const collapseEls = getCollection('[data-module=collapse]', plp.els.el)\n  const seeMoreBtns = getCollection('.filters__more')\n  const filtersTrayTitle = select('#filters-tray-title', plp.els.panelEl)\n  return { enter, leave, toggle, reset, handleFacetValueChange, syncols }\n\n  function enter() {\n    const productGrid = select('.pdp-grid__row .product-grid')\n    if (productGrid) {\n      // eslint-disable-next-line\n      const mutationObserver = new MutationObserver(mutations => mutations.forEach(() => Manager.publish(LOAD_PLP_PROUCTS)))\n      mutationObserver.observe(productGrid, {\n        attributes: true,\n        childList: true,\n        characterData: true\n      })\n    }\n    updateAria()\n    collapseEls.forEach(collapseEl => collapseEl.addEventListener('COLLAPSE_CHANGE', updateFilterSyncol))\n    seeMoreBtns.forEach(filterMoreBtn => filterMoreBtn.addEventListener('click', updateFilterSyncol))\n    Manager.subscribe(LOAD_PLP_PROUCTS, updateFilterSyncol)\n    if (isFilters && isFilters.classList.contains('was-clicked')) {\n      isFilters.classList.add('is-hidden')\n      isFilters.nextElementSibling.classList.remove('is-hidden')\n    }\n  }\n\n  function updateFilterSyncol() {\n    const plpWrapper = select('.pdp-grid__row')\n    plpWrapper.style.minHeight = `${filterWrapper.clientHeight}px`\n    syncols.update()\n  }\n\n  function leave() {\n    plp.els.toggleEl.removeAttribute('aria-expanded')\n    collapseEls.forEach(collapseEl => collapseEl.removeEventListener('COLLAPSE_CHANGE', updateFilterSyncol))\n    syncols.destroy()\n    Manager.unsubscribe(LOAD_PLP_PROUCTS, updateFilterSyncol)\n  }\n\n  function toggle() {\n    plp.toggleExceedingComponents()\n    plp.els.gridviewEl.classList.toggle('has-aside')\n    getCollection('svg', plp.els.toggleEl).forEach(elem => {\n      elem.classList.toggle('is-hidden')\n      elem.classList.remove('was-clicked')\n    })\n    updateAria()\n    if (isVisible()) {\n      syncols.init()\n    }\n    plp.els.gridviewEl.classList.contains('has-aside') && focusElement(filtersTrayTitle)\n  }\n\n  function reset() {\n  }\n\n  function updateAria() {\n    if (plp.els.toggleEl) {\n      plp.els.toggleEl.setAttribute('aria-expanded', isVisible())\n    }\n  }\n\n  function isVisible() {\n    return plp.els.gridviewEl.classList.contains('has-aside')\n  }\n\n  function handleStickyFilterInit() {\n    const stickyHeight = select('.js-sticky-item').clientHeight\n    const syncol = new SyncCols(\n      select('.pdp-grid-wrapper'),\n      select('.pdp-grid__row'),\n      HEADER_LARGE_EXPANDED_HEIGHT + stickyHeight\n    )\n    return syncol\n  }\n\n  function isPriceFilter() {\n    const priceId = config.locales.plp.priceFilter\n    return window.location.href.includes(priceId)\n  }\n  function isSelectboxFilter() {\n    const hasCheckedButton = selectAll('button', plp.els.panelEl).find(button => button.getAttribute('aria-pressed') == 'true')\n    return !!hasCheckedButton\n  }\n  function handleFacetValueChange(e) {\n    const gridEl = plpFilterHeader ? select('.js-pdp-main') : select('.pdp-grid__main')\n    const loader = new Loader(gridEl, {\n      enableSyncCol: true,\n      referenceEl:gridEl,\n      delay: 0,\n      bypassTabindexUpdate: true,\n      bypassLoadingMessageFocus: true\n    })\n    loader.init()\n    loader.create(() => {\n      inert.set(FILTER_BAR)\n      inert.set(GRID_ROW)\n      inert.set(LOADMORE_CONTAINER || undefined)\n      plp.updateLoadingTxt(true)\n      BODY.removeAttribute('aria-hidden')\n      TweenLite.to('.product-grid', .3, { opacity: 0 })\n    })\n    GRID_WRAPPER.classList.add('is-loading-products')\n    plpFilterHeader && !select(Constants.PLP_FILTER_OPEN) ? disableAllFacets(true, e.target, gridEl) : null\n    if (e.detail && isSelectboxFilter() && !isPriceFilter()) {\n      getCollection('.selectbox__input ', plp.els.panelEl)\n      .forEach(selectboxEl => {\n        selectboxEl.selectedIndex = selectboxEl.id === 'price_from' ? 0 : selectboxEl.options.length - 1\n      })\n    }\n    if (e.detail && !e.detail.isChecked && !isPriceFilter() && !isSelectboxFilter()) {\n      getCollection('.selectbox__input ', plp.els.panelEl)\n      .forEach(selectboxEl => {\n        selectboxEl.selectedIndex = selectboxEl.id === 'price_from' ? 0 : selectboxEl.options.length - 1\n      })\n    }\n    if (e.detail && !e.detail.isChecked && isPriceFilter()) {\n      const currentUrl = window.location.href\n      const urlPrice = currentUrl.split('q=')[1].split('|')[1].split(':')[1].split('-')\n\n      getCollection('.selectbox__input ', plp.els.panelEl)\n      .forEach(selectboxEl => {\n        let sIndex\n        const options = Array.from(selectboxEl.options)\n        const compareValue = selectboxEl.id === 'price_from' ? urlPrice[0] : urlPrice[1]\n        if (options) {\n          sIndex = options.find(option => option.value == compareValue)\n          if (sIndex)\n            {\n            selectboxEl.selectedIndex = sIndex.index\n            select('.selectbox__wrapper', selectboxEl.parentNode).innerHTML = sIndex.innerHTML\n          }\n        }\n      })\n    }\n\n    plp.update(true,loader, e.currentTarget || e.target)\n      .catch(config.noop)\n      .then(() => {\n        loader.destroy(() => {\n          inert.unset(FILTER_BAR)\n          inert.unset(GRID_ROW)\n          inert.unset(LOADMORE_CONTAINER || undefined)\n          GRID_WRAPPER.classList.remove('is-loading-products')\n          plp.updateLoadingTxt(false)\n        })\n        const clickedFacet = (e.target || e.currentTarget)\n        if (clickedFacet && clickedFacet.classList.contains('js-filter-facet')) {\n          TweenLite.to('.product-grid', ANIMATION_TIMING, { opacity: 1 })\n        } else {\n          plp.scrollToAnimate()\n        }\n        const filterSelected = select('.filters__option .is-focusable')\n        if (filterSelected) {\n          filterSelected.setAttribute('tabindex', '-1')\n          filterSelected.focus()\n        }\n        getCollection('.selectbox__input ', plp.els.panelEl)\n          .forEach(selectboxEl => {\n            plp.sanitizePriceValues(selectboxEl)\n            if (e.detail && (isSelectboxFilter() || (!isSelectboxFilter() && !isPriceFilter()))) {\n              plp.priceRangeUpdate(selectboxEl)\n            }\n          })\n        exceedingElems = getCollection('.is-exceeding')\n        exceedingElems.forEach((elem) => {\n          if (elem.classList.contains('single-component')) {\n            elem.children[0].style.width = 'initial'\n          }\n          elem.classList.remove('is-exceeding')\n        })\n      })\n  }\n}\n\nfunction filterFacetIsCarousel() {\n  const coreFilterPanel = select('.plp-filter-section')\n  if (coreFilterPanel) {\n    coreFilterPanel.classList.remove('is-carousel')\n    const filterSelect = selectAll('.js-filter-facet')\n    let checkingCondition = false\n    const filterSelectContainer = filterSelect[filterSelect.length - 1].getBoundingClientRect()\n    if (isiOS() && window.innerWidth < 961) {\n      checkingCondition = isLTR() ? window.innerWidth < filterSelectContainer.x + filterSelectContainer.width + 10 : filterSelectContainer.x < 0\n      checkingCondition = checkingCondition || (isLTR() && filterSelect[0].getBoundingClientRect().left < 20)\n    } else {\n      const filterPadding = parseInt(getComputedStyle(coreFilterPanel).paddingLeft)\n      checkingCondition = isLTR() ? window.innerWidth < filterSelectContainer.x + filterSelectContainer.width + (filterPadding == 0 ? 30 : filterPadding) : filterSelectContainer.x < 0\n    }\n    if (checkingCondition) {\n      coreFilterPanel.classList.add('is-carousel')\n    } else {\n      coreFilterPanel.classList.remove('is-carousel')\n    }\n  }\n}\n\nfunction disableAllFacets(disable = true, selectedButton = null, panel = null) {\n  if (panel) {\n    const allCTAs = panel.querySelectorAll(\"button, [role=button], .selectbox__input\")\n    if (allCTAs.length <= 0) { return false }\n    if (disable) {\n      Manager.publish(FILTER_SIDEPANEL_DISABLED)\n      allCTAs.forEach(item => {\n        item.setAttribute('aria-disabled', true)\n        if (item != selectedButton) {\n          item.setAttribute('tabindex', -1)\n        }\n      })\n    } else {\n      allCTAs.forEach(item => {\n        item.removeAttribute('aria-disabled')\n        item.tagName == 'A' ? item.setAttribute('tabindex', 0) : item.removeAttribute('tabindex')\n      })\n    }\n  }\n}\n\nfunction removeVtoCTA() {\n  const urlHasEyewear = select('body').classList.contains('page-productList-Eyewear')\n  if (urlHasEyewear && !l.vtoSupported('eyewear')) {\n    const vtoCTAs = selectAll('.js-vto-open')\n    if(vtoCTAs) {\n      vtoCTAs.forEach((elem) => {\n        elem.remove()\n      })\n    }\n  }\n}\n\nfunction checkPLPdesktop() {\n  const plpContainer = select('.pdp-grid__main')\n  if (plpContainer) {\n    if (l.isDesktop() && !l.isSafari()) {\n      plpContainer.classList.add('pdp-desktop')\n    } else {\n      plpContainer.classList.remove('pdp-desktop')\n    }\n  }\n  window.requestAnimationFrame(() => {\n    if (windowWidth != window.innerWidth) {\n      windowWidth = window.innerWidth\n      filterFacetIsCarousel()\n    }\n  })\n}\n\nfunction PLP(el) {\n  const gridviewEl = select('.js-pdp-grid')\n  const panelEl = select('.js-pdp-grid-aside')\n  const clearBtnEls = getCollection('.js-filters-clear', el)\n  const facetsEls = getCollection('[data-is-exclusive=false]', panelEl)\n  const priceFacet = select('[data-type=price]', panelEl)\n  const loadmore = select('.js-plp-loadmore')\n  const filters = new Filters(facetsEls)\n  const api = new API()\n\n  const toggleEl = select('.js-pdp-grid-toggle')\n  let initialTitle\n  let filterPriceOpt\n  let clearHandleClicked = false\n  const searchPage = gridviewEl.dataset.search\n  const expose = {\n    els: {\n      el,\n      gridviewEl,\n      panelEl,\n      toggleEl\n    },\n    update,\n    handleFacetValueChange,\n    filters,\n    scrollToAnimate,\n    updateLoadingTxt,\n    sanitizePriceValues,\n    updateComponentsProportions,\n    toggleExceedingComponents,\n    priceRangeUpdate,\n    isPriceFiltered,\n    resetClearStorage,\n    getTargetCheckbox\n  }\n  const plpContainer = select('.pdp-grid__main')\n  checkPLPdesktop()\n  window.addEventListener('resize', debounce(checkPLPdesktop, 100))\n  const loaderUpdateComponents = new Loader(plpContainer, {\n    enableSyncCol: true,\n    referenceEl: plpContainer,\n    delay: 0,\n    bypassLoadingMessageFocus: true\n  })\n  const localStorage = window.localStorage\n  let totalPage = 0\n  if (loadmore) {\n    totalPage = parseInt(loadmore.dataset.totalPage, 10)\n  }\n\n  const narrowScreenController = new NarrowScreenController(expose)\n  const wideScreenController = new WideScreenController(expose)\n  let controller\n\n  let nextPage\n  let currentPageReal\n  // eslint-disable-next-line\n  let clickedProductId = localStorage.getItem('clickedProductId')\n  const pagePLPStorage = JSON.parse(localStorage.getItem('pagePLP'))\n  let removeLocalstorage = false\n  const pagePLP = {\n    lastPLPUrl: pagePLPStorage ? pagePLPStorage.lastPLPUrl : '',\n    plpPageTitle: pagePLPStorage ? pagePLPStorage.plpPageTitle : '',\n    productItems: pagePLPStorage ? pagePLPStorage.productItems : '',\n    currentPageReal: pagePLPStorage ? pagePLPStorage.currentPageReal : 1,\n    clickedProductId: pagePLPStorage ? pagePLPStorage.clickedProductId : false,\n    fromPLP: pagePLPStorage ? pagePLPStorage.fromPLP : false,\n    backPLP: pagePLPStorage ? pagePLPStorage.backPLP : false,\n    filterPLP: pagePLPStorage ? pagePLPStorage.filterPLP : false\n  }\n  resetClearStorage()\n\n  init()\n\n  return expose\n\n  function init() {\n    onPageLoad()\n    bind()\n    handleBreakpoint()\n    !Constants.NEW_VISUAL_FILTER && updateButtons()\n    updateLinkDirection()\n    initialTitle = pagePLP.plpPageTitle !== null ? document.title : pagePLP.plpPageTitle\n    if (controller.syncols) {\n      controller.syncols.init()\n    }\n    removeVtoCTA()\n    Constants.NEW_VISUAL_FILTER && update(false)\n    updateTitleOnLoad()\n    window.addEventListener(\"vto.event\", (event) => {\n      // the Timeout is for the script to be parsed/executed by the browser\n      if (event.detail.type === 'vto.script.load') setTimeout(openVtoPlp, 250)\n    })\n    window.requestAnimationFrame(() => {\n      filterFacetIsCarousel()\n    })\n  }\n\n  /**\n   * Open Vto in PLP Eyewear pages if the URL contains hash #vto\n  */\n  function openVtoPlp() {\n    const url = window.location.href\n    const isPlpEyewear = select('.page-productList-Eyewear')\n    const isVtoActive = window.jsConfigSecond.isVTOActive\n    const EyewearFirstCategory = '2x1x1'\n    const EyewearSecondCategory = '2x1x2'\n\n    if(isPlpEyewear && hasHash && isVtoActive) {\n      let category = url.includes(EyewearFirstCategory) ? EyewearFirstCategory : EyewearSecondCategory\n      let btn = select(`.js-header-nav-secondary .js-vto-button[data-vto-category='${category}']`)\n\n      window.jsConfigSecond.shouldOpenVTO = true\n      document.addEventListener('click',(e) => {\n        if(e.target && e.target.parentElement.className === 'fsh-vto__btn-close'){\n          window.jsConfigSecond.shouldOpenVTO = false\n        }\n      })\n\n      if (btn) return btn.click()\n      btn = document.createElement('button')\n      btn.classList.add('js-vto-button')\n      btn.dataset.vtoView = 'compare'\n      btn.dataset.vtoCategory = category\n      btn.setAttribute('hidden', true)\n      document.body.appendChild(btn)\n      btn.click()\n      setTimeout(() => btn.parentNode.removeChild(btn))\n    }\n  }\n\n  /**\n   * Check if the component needs to be displayed in current pages or not\n   */\n  function displayComponent() {\n    const totalProductsPerPage = select('.product-grid') ? parseInt(select('.product-grid').dataset.totalProductsPage) : 0\n    const listOfComponents = getCollection('.plp-component')\n    let position = 0\n    listOfComponents.forEach((elem) => {\n      if (isWideScreen()) {\n        position = elem.getAttribute('data-position-desktop')\n      } else {\n        position = elem.getAttribute('data-position-mobile')\n      }\n      (Math.ceil(position / totalProductsPerPage) <= pagePLP.currentPageReal) ? elem.removeAttribute('hidden') : elem.setAttribute('hidden', 'true')\n    })\n  }\n\n  /**\n   * It's a comparing function to order a list of elements by data position\n   * @param listOfElems: array of elements\n   * @param isMobile: Boolean\n   * @returns {array}\n   */\n  function sortPositionsList(listOfElems, isMobile) {\n    if (isMobile) {\n      return listOfElems.sort((elemA, elemB) => elemA.getAttribute('data-position-mobile') - elemB.getAttribute('data-position-mobile'))\n    }\n    return listOfElems.sort((elemA, elemB) => elemA.getAttribute('data-position-desktop') - elemB.getAttribute('data-position-desktop'))\n  }\n\n  /**\n   * To replace PLP list by ordered list\n   * @param listOfElems: array of ordered elements\n   */\n  function replacePlpList(listOfElems, firstDownloadElement = null , scrollPos = null) {\n    const container = select('.product-grid')\n    if (container) container.innerHTML = ''\n    listOfElems.forEach((elem) => {\n      elem.classList.remove('is-first-line')\n      container.append(elem)\n    })\n    loaderUpdateComponents.destroy(() => {\n      const firstElem = select('.product-grid__item')\n      if (firstElem) {\n        firstElem.classList.contains('full-line-component') && firstElem.classList.add('is-first-line')\n      }\n      const tl = new TimelineLite()\n      tl.fromTo('.product-grid', ANIMATION_TIMING, { opacity: 0 }, { opacity: 1 })\n      if (firstDownloadElement && scrollPos) {\n        const firstDownloadElementLink = selectAll('.txt-product a', firstDownloadElement)\n        if (firstDownloadElementLink) {\n          firstDownloadElementLink[0].focus()\n        }\n        else {\n          firstDownloadElement.setAttribute('tabindex', '-1')\n          firstDownloadElement.focus()\n        }\n        window.scrollTo(0, scrollPos)\n        Manager.publish(PLP_PAGE_LOAD)\n      }\n    })\n  }\n\n  /**\n   * Check the breakpoint and then update the plp list\n   */\n  function updatePositions(firstDownloadElement = null, scrollPos = null) {\n    displayComponent()\n    loaderUpdateComponents.init()\n    loaderUpdateComponents.create()\n    TweenLite.to('.product-grid', .3, { opacity: 0 })\n    const listOfElems = getCollection('.product-grid__item')\n    if (isWideScreen()) replacePlpList(sortPositionsList(listOfElems, false), firstDownloadElement, scrollPos)\n    else replacePlpList(sortPositionsList(listOfElems, true), firstDownloadElement, scrollPos)\n  }\n\n  function handleStickyCollectionTitle() {\n    if (!stickyCollectionTitle) {\n      return\n    }\n    const products = getCollection('.js-product-edito')\n    const productsOffset = []\n    const headerHeight = select('.js-header').offsetHeight\n    const stickyOffset = stickyCollectionTitle.getBoundingClientRect().top + headerHeight\n    if (stickyOffset <= headerHeight * 2) {\n      products.forEach((elem) => {\n        productsOffset.push(elem.getBoundingClientRect().top)\n      })\n      const closestOffset = getClosest(productsOffset, stickyOffset)\n      const selectIndex = productsOffset.indexOf(closestOffset)\n      const productsList = select('.product-grid')\n      const numberOfColumns = Math.round(productsList.offsetWidth / products[0].offsetWidth)\n      const selectedElm = (products.length > 2) ? products[selectIndex + numberOfColumns - 1] : products[products.length - 1]\n      stickyCollectionTitle.removeAttribute('role')\n\n      if (selectedElm) {\n        const articleElem = selectedElm.children[0]\n\n        if (articleElem.dataset.collection !== collectionTitle) {\n          collectionTitle = articleElem.dataset.collection\n\n          stickyCollectionTitle.innerText = collectionTitle\n        }\n      }\n    }\n    else {\n      stickyCollectionTitle.innerText = ''\n      collectionTitle = ''\n      stickyCollectionTitle.setAttribute('role', 'presentation')\n    }\n  }\n\n  function visualFacetScroll(e) { // rubber band scroll\n    if(!l.isSafari()) { // rubber band scroll is already available for Safari\n      const target = e.target\n      var enabled = true\n      const scrollMax = target.scrollWidth - window.innerWidth + (target.offsetLeft * 2)\n      if (!enabled) return\n      if (target.scrollLeft >= (scrollMax - 1)) {\n        const scrollTimeline = new TimelineLite()\n        const startTransition = { xPercent: -20}\n        const outTranstion = { xPercent: 'initial'}\n        scrollTimeline.to(target, 0.3, startTransition).to(target, 0.2, outTranstion)\n      } else if (target.scrollLeft <= 0) {\n        const scrollTimeline = new TimelineLite()\n        const startTransition = { xPercent: 20}\n        const outTranstion = { xPercent: 'initial'}\n        scrollTimeline.to(target, 0.3, startTransition).to(target, 0.2, outTranstion)\n      }\n    }\n  }\n\n  function getTargetCheckbox(el) {\n    const closestSection = closest(el, '.visual-facet__list')\n    if (closestSection) {\n      return  select(`.tray__body .collapse-panel[data-facet-value-id=\"${closestSection.dataset.facetId}\"] .js-fake-checkbox[data-facet-value-id=\"${el.dataset.facetValueId}\"]`)\n    }\n  }\n\n  function plpHeaderFacetClick(e) {\n    e.stopPropagation()\n    getTargetCheckbox(e.target).click()\n  }\n\n  function bind() {\n\n    // getCollection('.js-filter-facet').forEach(fakeCheckboxEl => fakeCheckboxEl.addEventListener('FAKE_CHECKBOX_CHANGE', plpHeaderFacetClick))\n    getCollection('.js-fake-checkbox')\n      .forEach(fakeCheckboxEl => fakeCheckboxEl.addEventListener('FAKE_CHECKBOX_CHANGE', debounce(handleFacetValueChange, 200)))\n    getCollection('.filters__more')\n      .forEach(filterMoreBtn => filterMoreBtn.addEventListener('click', handleSeeMoreClick))\n\n    getCollection('.filters__option')\n      .forEach(filterOpt => filterOpt.addEventListener('click', handleLinkDirection))\n    bindEvent(document.body, '[data-dl-content-story]', 'click', onStoryClick)\n    bindEvent(document.body, '[data-dl-content-help]', 'click', onHelpClick)\n\n\n    Manager.subscribe(BREAKPOINT_CHANGE, handleBreakpoint)\n    Manager.subscribe(BREAKPOINT_CHANGE, updatePositions)\n    clearBtnEls.forEach(clearBtnEl => clearBtnEl.addEventListener('click', handleResetClick))\n    if (toggleEl) {\n      toggleEl.addEventListener('click',handleToggle)\n    }\n    window.addEventListener('popstate', handlePopState)\n    if (select('[data-type=price]')) {\n      select('[data-type=price]').addEventListener('change', handlePriceSelect)\n      getCollection('.selectbox__input ', expose.els.panelEl)\n         .forEach(selectboxEl => selectboxEl.addEventListener('focus', sanitizePriceValues))\n    }\n    if (loadmore) {\n      loadmore.addEventListener('click', handleLoadMore)\n      loadmore.addEventListener('keydown', handleKeyboard)\n      loadmore.addEventListener('click', sendData)\n      window.addEventListener('scroll', debounce(handleLoadMore, 500))\n    }\n\n    const eventName = isiOS() ? 'pagehide' : 'beforeunload'\n    window.addEventListener(eventName, handleBeforeUnload)\n    window.addEventListener('resize', debounce(updateComponentsProportions, 100))\n    if (HERO_IMG) {\n      // eslint-disable-next-line\n      const mutationObserver = new MutationObserver(mutation => mutation.forEach(() => Manager.publish(LOAD_PLP_PROUCTS)))\n      mutationObserver.observe(HERO_IMG, {\n        attributes: true,\n        childList: true,\n        characterData: true,\n        subtree: true\n      })\n    }\n    window.addEventListener('scroll', debounce(handleStickyCollectionTitle, 10))\n    if (Constants.NEW_VISUAL_FILTER) {\n      Manager.subscribe(FILTER_SIDEPANEL_OPENED, () => {\n        const facetListCollection = getCollection('.visual-facet .visual-facet__list')\n        const isSmallScreen = window.innerWidth <= visualFilterBreakpoint\n        if (isSmallScreen) {\n          getCollection('.filters__more')\n            .forEach(filterMoreBtn => {\n              const visualFacetConatiner = filterMoreBtn.closest('.visual-facet')\n              visualFacetConatiner && filterMoreBtn.click()\n            })\n          facetListCollection.forEach(facetLists => {\n            facetLists.addEventListener('scroll', debounce(visualFacetScroll))\n          })\n        } else {\n          closeSeeMoreItems()\n          facetListCollection.forEach(facetLists => {\n            facetLists.removeEventListener('scroll', debounce(visualFacetScroll))\n          })\n        }\n        getCollection('.is-filters .selectbox__input').forEach(facets => {\n          facets.addEventListener('mousedown', function(e) {\n            const target = e && (e.currentTarget || e.target)\n            if (target.ariaDisabled == 'true' || ay11Check(e.target, 'aria-disabled')== 'true') {\n            e.preventDefault()\n            }\n          })\n          facets.addEventListener('touchstart', function(e) {\n            const target = e && (e.currentTarget || e.target)\n            if (target.ariaDisabled == 'true' || ay11Check(e.target, 'aria-disabled') == 'true') {\n            e.preventDefault()\n            }\n          })\n        })\n      })\n      Manager.subscribe(WINDOW_WAS_RESIZED, handleBreakpoint)\n      lazyLoadingImage()\n    }\n  }\n\n  function lazyLoadingImage() { // call lazy loading in init function or in a specific eventlistener like DOMContentLoaded\n    var lazyloadImages\n    if (\"IntersectionObserver\" in window) {\n      lazyloadImages = selectAll(\".lazyLoadedImage\")\n      var imageObserver = new IntersectionObserver(function (entries, observer) {\n        entries.forEach(function (entry) {\n          if (entry.isIntersecting) {\n            var image = entry.target\n            image.src = image.dataset.src\n            image.classList.remove(\"lazyLoadedImage\")\n            imageObserver.unobserve(image)\n          }\n        })\n      })\n      lazyloadImages.forEach(function (image) {\n        imageObserver.observe(image)\n      })\n    } else {\n      var lazyloadTimeout\n      lazyloadImages = document.selectAll(\".lazyLoadedImage\")\n      function lazyload() {\n        if (lazyloadTimeout) {\n          clearTimeout(lazyloadTimeout)\n        }\n        lazyloadTimeout = setTimeout(function () {\n          var scrollTop = window.pageYOffset\n          lazyloadImages.forEach(function (img) {\n            if (img.offsetTop < (window.innerHeight + scrollTop)) {\n              img.src = img.dataset.src\n              img.classList.remove('lazyLoadedImage')\n            }\n          })\n          if (lazyloadImages.length == 0) {\n            document.removeEventListener(\"scroll\", lazyload)\n            window.removeEventListener(\"resize\", lazyload)\n            window.removeEventListener(\"orientationChange\", lazyload)\n          }\n        }, 20)\n      }\n      document.addEventListener(\"scroll\", lazyload)\n      window.addEventListener(\"resize\", lazyload)\n      window.addEventListener(\"orientationChange\", lazyload)\n    }\n  }\n\n  function handleBeforeUnload() {\n    // Before leaving the page, store the current window position\n    // & product items inside localstorage\n    pagePLP.productItems = select('.product-grid', gridviewEl).innerHTML\n    pagePLP.plpPageTitle = document.title\n    localStorage.setItem('productItems', select('.product-grid', gridviewEl).innerHTML)\n    if (!removeLocalstorage) {\n      localStorage.setItem('pagePLP', JSON.stringify(pagePLP))\n    }\n    if (HERO_IMG && HERO_IMG.clientHeight > 0) {\n      localStorage.setItem('heroHeight', HERO_IMG.clientHeight)\n    } else {\n      localStorage.setItem('heroHeight', 0)\n    }\n  }\n\n  function closeSeeMoreItems() {\n    getCollection('.filters__more')\n      .forEach(filterMoreBtn => {\n        toggleSeeMoreList(filterMoreBtn, true)\n      })\n  }\n\n  function handleSeeMoreClick(e) {\n    const target = e && (e.currentTarget || e.target)\n    if (target.ariaDisabled == 'true' || ay11Check(e.target, 'aria-disabled') == 'true') {\n      return false\n    }\n    toggleSeeMoreList(e.currentTarget || e.target)\n  }\n\n  function toggleSeeMoreList(buttonEl, reveal = false) {\n    const listEl = closest(buttonEl, 'ul')\n\n    buttonEl.classList.toggle('is-hidden', reveal)\n    getCollection('.is-filter', listEl)\n      .forEach(liEl => {\n        buttonEl.classList.toggle('is-hidden', !reveal)\n        liEl.classList.toggle('is-hidden', reveal)\n      })\n    const isSmallScreen = window.innerWidth <= visualFilterBreakpoint\n    if (!Constants.NEW_VISUAL_FILTER || !isSmallScreen ) {\n      const focusItem = select('.is-filter .fake-checkbox', listEl)\n      if (focusItem) {\n        focusItem.focus()\n      }\n    }\n  }\n\n  function updateLoadingTxt(isLoading) {\n    if (LIVE_LOADING_TEXT && isLoading) {\n      LIVE_LOADING_TEXT.innerHTML = LIVE_LOADING_TEXT.dataset.text\n      select(Constants.PLP_FILTER_OPEN) ? LIVE_LOADING_TEXT.removeAttribute('aria-hidden') : null\n    } else {\n      LIVE_LOADING_TEXT.innerHTML = ''\n      select(Constants.PLP_FILTER_OPEN) ? LIVE_LOADING_TEXT.setAttribute('aria-hidden', 'true') : null\n    }\n  }\n\n  function sanitizePriceValues(e) {\n    const options = e.children\n    const priceToEl = select('[data-type=price]')\n    const priceValues = getCollection('select', priceToEl).map(selectEl => selectEl.value)\n    const priceFromCurrentVal = parseInt(priceValues[0], 10)\n    const priceToCurrentVal = parseInt(priceValues[1], 10)\n    const value = []\n    const availablePriceRange = (window.localStorage.getItem('availablePriceRange') || '').split(',')\n    const lowestAvailableVal = availablePriceRange && availablePriceRange.length > 1 ? parseInt(availablePriceRange[0], 10) : 0\n    const hightestAvailableVal = availablePriceRange && availablePriceRange.length > 1\n          ? parseInt(availablePriceRange[1], 10)\n          : Array.from(select('#price_to', priceToEl).options).pop().value\n\n    const availableFromVal = Math.min(hightestAvailableVal, priceToCurrentVal)\n    const availableToVal = Math.max(lowestAvailableVal, priceFromCurrentVal)\n    const priceId = config.locales.plp.priceFilter\n    const filterPriceOnly = window.location.href.includes(priceId) && !window.location.href.includes('|')\n    const priceFromMaxValue = Array.from(select('#price_from', priceToEl).options).pop().value\n\n    filterPriceOpt = e.target\n    if (e.id === 'price_from') {\n      for (let i = 0; i < options.length; i++) {\n        value[i] = parseInt(options[i].value, 10)\n        options[i].style.display = 'block'\n        if (!filterPriceOnly && (value[i] < lowestAvailableVal || value[i] >= availableFromVal)) {\n          options[i].style.display = 'none'\n        }\n        if (filterPriceOnly && value[i] >= availableFromVal) {\n          options[i].style.display = 'none'\n        }\n      }\n    }\n    if (e.id === 'price_to') {\n      for (let i = 0; i < options.length; i++) {\n        value[i] = parseInt(options[i].value, 10)\n        options[i].style.display = 'block'\n        if (!filterPriceOnly && (value[i] > hightestAvailableVal || value[i] <= availableToVal)) {\n          options[i].style.display = 'none'\n        }\n        if (filterPriceOnly && value[i] <= availableToVal) {\n          options[i].style.display = 'none'\n        }\n        if (priceFromCurrentVal == priceFromMaxValue && options.length >= 2) {\n          options[options.length - 2].style.display = 'none'\n        }\n      }\n    }\n  }\n\n  function priceRangeUpdate(e) {\n    let selectedOption\n    if (e.id === 'price_from') {\n      selectedOption = Array.from(e.options).find(option => option.style.display == 'block')\n    } else {\n      selectedOption = Array.from(e.options).filter(option => option.style.display == 'block').pop()\n    }\n    e.selectedIndex = selectedOption.index\n    select('.selectbox__wrapper', e.parentNode).innerHTML = selectedOption.innerHTML\n  }\n\n  function handleToggle(e) {\n    const target = e.currentTarget || e.target\n    if(target && ay11Check(target, 'aria-disabled') == 'true') {\n      return false\n    }\n    e.stopPropagation()\n    controller.toggle()\n    closeSeeMoreItems()\n    Manager.publish(LOAD_PLP_PROUCTS)\n  }\n\n  function handlePopState() {\n    if (!window.isFshVtoModalOpen) window.location.reload()\n  }\n\n  function handleFacetValueChange(e) {\n    e.stopPropagation()\n    const target = e && (e.currentTarget || e.target)\n    if (target && (target.ariaDisabled == 'true' || ay11Check(target, 'aria-disabled') == 'true')) {\n      return false\n    }\n    let eAction\n    let filterCatEl = e.target.closest('.collapse-panel') || e.target.closest('.plp-filter-section')\n    let filterCatSpecialEl = e.target.closest('.is-special')\n    let filterEl = e.target\n    let catName = ''\n    let filterName = ''\n    if (filterCatSpecialEl) {\n      filterName = filterEl.getAttribute('data-facet-filtercat-cta') || filterEl.getAttribute('data-facet-value-id')\n    } else if (filterCatEl && filterEl.hasAttribute('data-facet-filter-cta')) {\n      catName = filterCatEl.getAttribute('data-facet-filtercat-cta') || filterCatEl.getAttribute('data-facet-value-id')\n      filterName = filterEl.getAttribute('data-facet-filter-cta') || filterEl.getAttribute('data-facet-value-id')\n    }\n\n    if (target && target.querySelector('a')) {\n      e.preventDefault()\n    }\n    if (Constants.NEW_VISUAL_FILTER && !document.body.classList.contains(Constants.PLP_FILTER_OPEN.substring(1))) {\n      plpFilterFacet = e.target\n      wideScreenController.handleFacetValueChange(e)\n    } else {\n      controller.handleFacetValueChange(e)\n    }\n    const facetSection = target && target.closest('.filters__facet-section')\n    if (facetSection) {\n      eAction = select('.button__wrapper', facetSection)\n    }\n\n    if (!(e.target.id === \"price_from\" || e.target.id === \"price_to\")) {\n      const dataTrack = {\n        eventCategory: e.detail ? (e.detail.isChecked ? \"add filter\" : \"remove filter\") : \"add filter\",\n        eventAction: catName,\n        eventLabel: filterName,\n        event: 'uaevent'\n      }\n      window.document.DLKit.push('on-tracking', dataTrack)\n    }\n    else{\n      handlePriceCTA()\n    }\n  }\n\n  function handlePriceCTA() {\n      const fromPriceEl = select(\"#price_from\")\n      const toPriceEl = select(\"#price_to\")\n      if (fromPriceEl && toPriceEl) {\n        let fromPriceVal = fromPriceEl.options[fromPriceEl.selectedIndex].getAttribute('data-nonLocalizedFromPrice')\n        let toPriceVal = toPriceEl.options[toPriceEl.selectedIndex].getAttribute('data-nonLocalizedToPrice')\n        dataLayer.push({\n          eventCategory: 'add filter',\n          eventAction: 'price',\n          eventLabel: 'from ' + fromPriceVal + ' to ' + toPriceVal,\n          event: 'uaevent'\n        })\n      }\n    }\n\n  function handlePriceSelect(e) {\n    // Remember if the user select a price himself\n    // (unlike it's a consequence of a collection selection, cf ONE-12831)\n    priceFacet.dataset.isDirty = true\n    handleFacetValueChange(e)\n  }\n\n  function update(updateProducts = true, loader = null, buttonClicked = null) {\n    pagePLP.clickedProductId = false\n    pagePLP.filterPLP = false\n    pagePLP.plpPageTitle = ''\n    let filtersData\n    const collapseEls = getCollection('[data-module=collapse]', expose.els.panelEl)\n    if (loadmore) {\n      loadmore.dataset.currentPage = 1\n      pagePLP.currentPageReal = 1\n      localStorage.setItem('pagePLP', JSON.stringify(pagePLP))\n    }\n    if (!clearHandleClicked) {\n      filtersData = filters.serialize()\n      if (Constants.NEW_VISUAL_FILTER && !document.body.classList.contains(Constants.PLP_FILTER_OPEN.substring(1))) {\n        const closestSection = closest(plpFilterFacet, '.visual-facet__list')\n        if (closestSection) {\n          filtersData.forEach(items => {\n            if (items.id == closestSection.dataset.facetId) {\n              items.values.forEach(subitem => {\n                if (subitem.id == plpFilterFacet.dataset.facetValueId) {\n                  subitem.isDisabled = (plpFilterFacet.ariaDisabled || ay11Check(plpFilterFacet, 'aria-disabled')) == 'true'\n                  subitem.isSelected = (plpFilterFacet.ariaPressed || ay11Check(plpFilterFacet, 'aria-pressed')) == 'true'\n                }\n              })\n            }\n          })\n        }\n      }\n    } else {\n      plpFilterFacet = null\n      clearHandleClicked = false\n      const filtersDataReset = filters.serialize()\n      filtersData = filtersDataReset.map(facet => {\n        facet.values = facet.values.map(facetValue => {\n          facetValue.isDisabled = false\n          facetValue.isSelected = false\n          return facetValue\n        })\n        return facet\n      })\n      if (Constants.NEW_VISUAL_FILTER) {\n        filters.updateElementsFromObject(filtersData)\n        collapseEls.forEach((collapseEl, index) => {\n          if (collapseEl) {\n            controller.getSelectedFacets(collapseEl)\n          }\n        })\n      }\n    }\n    return api.query(filtersData)\n      .then(data => {\n        Constants.NEW_VISUAL_FILTER ? disableAllFacets(false, null, select('.tray.is-filters') || select('.js-pdp-grid-aside')) : null\n        Constants.NEW_VISUAL_FILTER && !select(Constants.PLP_FILTER_OPEN) ? disableAllFacets(false, null, select('.js-pdp-main')) : null\n        if(Constants.NEW_VISUAL_FILTER) {\n          facetInfo = !select(`body${Constants.PLP_FILTER_OPEN}`) || facetInfo == null ? data : facetInfo\n        } else {\n          facetInfo = data\n        }\n        filters.updateElementsFromObject(data.facets)\n        if(Constants.NEW_VISUAL_FILTER) {\n          controller.setFooterButtonViews( expose , {\"resultText\": data.filterResults, \"totalProducts\" : data.totalProducts})\n          collapseEls.forEach((collapseEl) => {\n            if (collapseEl) {\n              controller.getSelectedFacets(collapseEl)\n            }\n          })\n        }\n        return data\n      })\n      .then(data => {\n        if (updateProducts) {\n          const divEl = document.createElement('div')\n          divEl.innerHTML = data.productListHTML\n          select('.product-grid').innerHTML = divEl.firstElementChild.innerHTML\n\n          if (filterPriceOpt) {\n            filterPriceOpt.setAttribute('tabindex', '-1')\n            filterPriceOpt.focus()\n          }\n          if (data.totalResults) {\n            if (FILTER_BAR.attributes['aria-hidden']) {\n              FILTER_BAR.removeAttribute('aria-hidden')\n            }\n\n            const totalBlock = select('.js-filters-total-results')\n\n            if (totalBlock) {\n              totalBlock.innerHTML = data.totalResults\n            }\n          }\n        }\n        if (loadmore && !pagePLP.backPLP) {\n          loadmore.classList.toggle('is-hidden', !data.nextPage)\n        }\n        // Update wishlist\n        initWishlistData()\n        CacheIndex.rePublishPageLoadData('PAGELOAD_WISHLIST')\n        Constants.NEW_VISUAL_FILTER && Manager.publish(FILTER_SIDEPANEL_ENABLED)\n      })\n      .then(() => {\n        !Constants.NEW_VISUAL_FILTER && updateButtons()\n        if (updateProducts) {\n          updateURL(filtersData)\n          updateTitle(filtersData)\n        }\n        updateComponentsProportions()\n        jsConfigSecond.tryOnLegal.vto.isActive && getCollection(tryOnConstants.TRY_ON_VTO_BUTTON).forEach(element => {\n          bindTryOnButtonEvents(element, jsConfigSecond.tryOnLegal.vto.message)\n        })\n        jsConfigSecond.tryOnLegal.cto.isActive && getCollection(tryOnConstants.TRY_ON_CTO_BUTTON).forEach(element => {\n          bindTryOnButtonEvents(element, jsConfigSecond.tryOnLegal.cto.message)\n        })\n      })\n      .catch((err) =>{\n        loader && loader.destroy()\n        toggleEl.removeAttribute('aria-disabled')\n          updateLoadingTxt(false)\n          Constants.NEW_VISUAL_FILTER && resetClearStorage()\n          Constants.NEW_VISUAL_FILTER ? disableAllFacets(false, null, select('.tray.is-filters')) : null\n          plpFilterHeader ? disableAllFacets(false, null, select('.js-pdp-main')) : null\n          facetInfo && filters.updateElementsFromObject(facetInfo.facets)\n          facetInfo && controller.setFooterButtonViews(expose, {\"resultText\": facetInfo.filterResults, \"totalProducts\" : facetInfo.totalProducts})\n          buttonClicked && buttonClicked.focus()\n          if ( Constants.NEW_VISUAL_FILTER ) {\n            collapseEls.forEach((collapseEl) => {\n              if (collapseEl) {\n                controller.getSelectedFacets(collapseEl)\n              }\n            })\n            Manager.publish(FILTER_SIDEPANEL_ENABLED)\n          }\n        if(!err.stack){\n          setTimeout(() => {\n            notifier.close()\n          }, 2000);\n        }\n      })\n  }\n\n  function handleBreakpoint() {\n    // Collapse entries if necessary\n    const prevController = controller\n    if(!Constants.NEW_VISUAL_FILTER) { // to switch between new plp filter overlay design and the previous filter design\n      if (!isWideScreen()) {\n        if (prevController !== narrowScreenController) {\n          controller = narrowScreenController\n        }\n      } else if (prevController !== wideScreenController) {\n        controller = wideScreenController\n      }\n    } else {\n      controller = narrowScreenController\n      Manager.publish('FILTER_SIDEPANEL_OPENED')\n    }\n    if (controller !== prevController) {\n      if (prevController) {\n        prevController.leave()\n      }\n      controller.enter()\n    }\n    setFilterTrayDimensions(prevController)\n  }\n\n  function setFilterTrayDimensions(prevController) {\n    if(prevController && prevController !== undefined && prevController.isOpen && prevController.isOpen()) {\n      const trayContainer = select('.tray.is-filters')\n      const trayBody = select('.tray__body.js-tray-item', trayContainer)\n      const trayClose = select('.tray__close', trayContainer)\n      const trayFooter = select('.tray__footer.js-tray-item', trayContainer)\n      if (trayBody) {\n        const trayWidth = trayBody.getBoundingClientRect().width * (isLTR() ? -1 : 0) // LTR for non-arabic markets\n        trayBody.style.transform =  trayClose.style.transform = trayFooter.style.transform = `translate(${isLTR() ? '100%':'-100%'}, 0%) matrix(1, 0, 0, 1,${trayWidth}, 0)`\n      }\n    }\n  }\n\n  function scrollToAnimate() {\n    const gridElOffset = getTopOffset(GRID_VIEW)\n    const tl = new TimelineLite()\n    tl.to(window, .1, {\n      scrollTo: {\n        y: gridElOffset - HEADER_LARGE_EXPANDED_HEIGHT - FILTER_BAR.clientHeight\n      }\n    })\n    tl.fromTo('.product-grid', ANIMATION_TIMING, { opacity: 0 }, { opacity: 1 })\n  }\n\n  function resetSelectPrices() {\n    getCollection('[data-type=price] select')\n      .forEach(element => {\n        const optionLength = element.options.length - 1\n        const elementID = element.id === 'price_from' ? element.selectedIndex = 0 : element.selectedIndex = optionLength\n        select('.selectbox__wrapper', element.parentNode).innerHTML = element.options[elementID].innerHTML\n      })\n  }\n\n  function updateButtons() {\n    const asideVisibility = gridviewEl.classList.contains('has-aside')\n    // eslint-disable-next-line\n    const isClickedClear = localStorage.getItem('clearFilter') ? true : false\n    // eslint-disable-next-line arrow-body-style\n    let hasActiveFilters = filters.serialize().some(facet => {\n      return facet.values.some(value => value.isSelected)\n    })\n\n    if (!isClickedClear && isPriceFiltered()) {\n      hasActiveFilters = true\n    } else if (isClickedClear) {\n      hasActiveFilters = false\n    }\n\n    clearBtnEls.forEach(clearBtnEl => {\n      clearBtnEl.parentElement.classList.toggle('is-hidden', !hasActiveFilters)\n    })\n\n    !hasActiveFilters && updatePositions()\n\n    if (hasActiveFilters && !asideVisibility) {\n      gridviewEl.classList.add('has-aside')\n      if (getMq() === 'desktop') {\n        getCollection('svg', toggleEl).forEach(elem => {\n          elem.classList.toggle('is-hidden')\n        })\n      }\n    }\n\n    handleCollapseState(isClickedClear)\n  }\n\n  function isPriceFiltered() {\n    const isFilterList = []\n    getCollection('[data-type=price] select')\n      .forEach(e => {\n        const filterFacetId = e.closest('[data-facet-id]').dataset.facetId\n        const filteredOnUrl = window.location.href.includes(filterFacetId)\n        // eslint-disable-next-line\n        const filteredPriceFrom = !!(e.selectedIndex) || (!e.selectedIndex && filteredOnUrl) ? true : false\n        // eslint-disable-next-line\n        const filteredPriceTo = (e.selectedIndex < e.options.length - 1) || ((e.selectedIndex === e.options.length - 1) && filteredOnUrl) ? true : false\n        // eslint-disable-next-line\n        const filtered = (e.id === 'price_from' && filteredPriceFrom) || (e.id === 'price_to' && filteredPriceTo) ? true : false\n        isFilterList.push(filtered)\n      })\n\n    return isFilterList.includes(true)\n  }\n\n  function handleCollapseState(isClear) {\n    getCollection('.collapse-panel')\n      .forEach((element, index) => {\n        isClear && resetClearStorage()\n      })\n    if (loadmore) {\n      loadmore.dataset.currentPage = 1\n    } else {\n      const storageCurrentPage = localStorage.getItem('currentPage')\n      if (storageCurrentPage) {\n        localStorage.removeItem('currentPage')\n      }\n    }\n  }\n\n  function resetClearStorage() {\n    localStorage.removeItem('clearFilter')\n  }\n\n  function updateTitle(filtersData) {\n    // eslint-disable-next-line arrow-body-style\n    const isActive = filtersData.some(filterData => {\n      return filterData.values.some(value => value.isSelected)\n    })\n    let priceSelected = false\n    // eslint-disable-next-line\n    filtersData.some(filterData => {\n      if (filterData.id.includes('price')) {\n        priceSelected = filterData.values.some(value => value.length > 0)\n      }\n    })\n    const titleParts = initialTitle.split(' - ')\n    const prefixPos = titleParts.indexOf(config.locales.plp.refinedTitle)\n    const suffixPosition = titleParts.length - 1\n    if (isActive || priceSelected) {\n      if (prefixPos === -1) {\n        titleParts.splice(suffixPosition, 0, config.locales.plp.refinedTitle)\n      }\n    } else if (prefixPos !== -1) {\n      titleParts.splice(suffixPosition, 1)\n    }\n    document.title = titleParts.join(' - ')\n  }\n\n  function updateTitleOnLoad() {\n    const titleParts = initialTitle.split(' - ')\n    const suffixPosition = titleParts.length - 1\n    if (window.location.href.includes('?')) {\n      titleParts.splice(suffixPosition, 0, config.locales.plp.refinedTitle)\n    }\n    document.title = titleParts.join(' - ')\n    const filterButton = select('.js-pdp-grid-toggle')\n    if (filterButton) {\n      filterButton.setAttribute('aria-expanded', true)\n    }\n  }\n\n  function updateURL(data) {\n    const url = api.buildURL(data)\n    const sep = (url.includes('?text') || !url.includes('?requestType')) ? '&' : '?'\n    const re = new RegExp('(([?]|&)*?requestType=ajax)(&|$)')\n    const res = url.match('q=') ? url.replace(re, sep) : url.replace(re, '')\n    window.history.pushState('', '', res)\n    Manager.publish(AFTER_PUSH_STATE)\n  }\n\n  // Clear everything\n  function handleResetClick(e) {\n    const target = e && (e.currentTarget || e.target)\n    if (e.target.ariaDisabled || ay11Check(e.target, 'aria-disabled')) {\n      return false\n    }\n    e.preventDefault()\n    const firstFilterFacetSection = select('.is-filters .filters__facet-section')\n    localStorage.setItem('clearFilter', 'clear')\n    clearHandleClicked = true\n    const gridEl = select('.pdp-grid__main')\n    const loader = new Loader(gridEl, {\n      enableSyncCol: true,\n      referenceEl: gridEl,\n      delay: 0\n    })\n    const visualFilterPanelEl = select('.tray__body.js-tray-item')\n    const visualFilterLoader = new Loader(visualFilterPanelEl, {\n      enableSyncCol: false,\n      referenceEl: visualFilterPanelEl,\n      delay: 0,\n      bypassTabindexUpdate: true,\n      bypassLoadingMessageFocus: true\n    })\n    const previousScrollPosition = visualFilterPanelEl.scrollTop\n    const loaderElem = visualFilterLoader.init()\n    if (!Constants.NEW_VISUAL_FILTER) {\n      if (loadmore) {\n        loadmore.dataset.currentPage = 1\n      }\n      pagePLP.currentPageReal = 1\n      localStorage.setItem('pagePLP', JSON.stringify(pagePLP))\n      loader.init()\n      loader.create(() => {\n        inert.set(FILTER_BAR)\n        inert.set(GRID_ROW)\n        inert.set(LOADMORE_CONTAINER || undefined)\n        updateLoadingTxt(true)\n        TweenLite.to('.product-grid', .3, { opacity: 0 })\n      })\n      GRID_WRAPPER.classList.add('is-loading-products')\n    } else {\n      disableAllFacets(true, null, select('.tray.is-filters'))\n      visualFilterLoader.create(() => {\n          updateLoadingTxt(true)\n          visualFilterPanelEl.scrollTop = getComputedStyle(loaderElem).top\n          visualFilterPanelEl.style.overflowY = 'hidden'\n        })\n      if ( e != undefined && (e.target.classList.contains('js-filters-clear') || target.classList.contains('js-filters-clear'))) {\n        const dataTrack = {\n          eventCategory: 'filter',\n          eventAction: 'erase',\n          eventLabel: '',\n          event: 'uaevent'\n        }\n        window.document.DLKit.push('on-tracking', dataTrack)\n      }\n    }\n    resetSelectPrices()\n    if (priceFacet) {\n      delete priceFacet.dataset.isDirty\n    }\n    update(!Constants.NEW_VISUAL_FILTER, loader, e.currentTarget || e.target)\n      .catch(config.noop)\n      .then(() => {\n        if (!Constants.NEW_VISUAL_FILTER) {\n        loader.destroy(() => scrollToAnimate())\n        inert.unset(FILTER_BAR)\n        inert.unset(GRID_ROW)\n        inert.unset(LOADMORE_CONTAINER || undefined)\n        updateLoadingTxt(false)\n        GRID_WRAPPER.classList.remove('is-loading-products')\n        } else {\n          visualFilterLoader.destroy(() => {\n            visualFilterPanelEl.style.overflowY = 'auto'\n            updateLoadingTxt(false)\n            e.target.focus()\n            visualFilterPanelEl.scrollTop = previousScrollPosition\n          })\n        }\n        getCollection('.selectbox__input ', panelEl)\n        .forEach(selectboxEl => sanitizePriceValues(selectboxEl))\n        if (!Constants.NEW_VISUAL_FILTER) {\n          updatePositions()\n          focusElement(toggleEl)\n          if (!gridviewEl.classList.contains('has-aside')) {\n            exceedingElems.forEach((elem) => {\n              elem.classList.add('is-exceeding')\n            })\n            if (getCollection('.is-exceeding').length !== 0) {\n              updateComponentsProportions()\n            }\n          } else {\n            exceedingElems = getCollection('.is-exceeding')\n            exceedingElems.forEach((elem) => {\n              if (elem.classList.contains('single-component')) {\n                elem.children[0].style.width = 'initial'\n              }\n              elem.classList.remove('is-exceeding')\n            })\n          }\n        }\n      })\n    if (Constants.NEW_VISUAL_FILTER) {\n      const firstCheckbox = select('.js-fake-checkbox', panelEl)\n      const facetButton = select('.js-collapse-button', firstFilterFacetSection)\n      firstFilterFacetSection.classList.contains('is-special') && firstCheckbox ? firstCheckbox.focus() : (facetButton ? facetButton.focus() : null)\n      getCollection('.selectbox__input ', panelEl)\n        .forEach(selectboxEl => {\n          expose.sanitizePriceValues(selectboxEl)\n          if (e.target.querySelector('.selectbox__input')) {\n            expose.priceRangeUpdate(selectboxEl)\n          }\n        })\n    } else {\n      controller.reset()\n    }\n    if (loadmore) {\n      loadmore.classList.remove('is-hidden')\n    }\n  }\n\n  function handleKeyboard(e) {\n    if (e.code === 'Space' || e.code === 'Enter') {\n      e.preventDefault()\n      if (e.target === loadmore) {\n        handleLoadMore(e)\n      }\n    }\n  }\n\n  function handleLoadMore(e) {\n    e.preventDefault()\n    var apiCallback = function (data, loader) {\n      let firstDownloadElement\n      if (data.hasOwnProperty(\"dataLayer\") && data.dataLayer.hasOwnProperty(\"productList\")) {\n        if (dataLayerGA) {\n          if (!dataLayerGA.hasOwnProperty(\"productList\")) {\n            dataLayerGA['productList'] = data.dataLayer.productList\n          } else {\n\n            Object.assign(dataLayerGA.productList, data.dataLayer.productList)\n          }\n        }\n      }\n      if (data.productListPage) {\n        const divEl = document.createElement('div')\n        divEl.innerHTML = data.productListPage\n        firstDownloadElement = select('.product-grid__item:first-child', divEl)\n        const newEls = getCollection('.product-grid > .product-grid__item', divEl)\n        const realProductGrid = select('.product-grid')\n        let nbOfDisplayedElm = getCollection('li.product-grid__item').length + 1\n        for (let i = 0; i < newEls.length; i++, nbOfDisplayedElm++) {\n          realProductGrid.appendChild(newEls[i])\n          dlUpdateLoadedProductsValue(newEls[i], { position: nbOfDisplayedElm })\n        }\n      }\n      if (!searchPage) {\n        updateHeadLink(nextPage)\n      }\n      if (loadmore) {\n        loadmore.dataset.currentPage = nextPage\n        if (!data.next) {\n          loadmore.classList.add('is-hidden')\n        } else {\n          localStorage.setItem('currentPage', nextPage)\n          loadmore.href = loadmore.getAttribute('href').replace(/(page-.)/mg, \"page-\" + (nextPage + 1))\n        }\n      }\n      pagePLP.currentPageReal = nextPage\n      localStorage.setItem('pagePLP', JSON.stringify(pagePLP))\n      initWishlistData()\n      CacheIndex.rePublishPageLoadData('PAGELOAD_WISHLIST')\n\n      jsConfigSecond.tryOnLegal.vto.isActive && getCollection(tryOnConstants.TRY_ON_VTO_BUTTON).forEach(element => {\n        bindTryOnButtonEvents(element, jsConfigSecond.tryOnLegal.vto.message)\n      })\n      jsConfigSecond.tryOnLegal.cto.isActive && getCollection(tryOnConstants.TRY_ON_CTO_BUTTON).forEach(element => {\n        bindTryOnButtonEvents(element, jsConfigSecond.tryOnLegal.cto.message)\n      })\n\n      afterCallbackFinished(firstDownloadElement, loader)\n      loadMoreData = {}\n    }\n\n    var afterCallbackFinished = function (firstDownloadElement, loader) {\n      const scrollPos = window.pageYOffset\n      updatePositions(firstDownloadElement, scrollPos)\n      loader.destroy()\n      inert.unset(FILTER_BAR)\n      inert.unset(GRID_ROW)\n      inert.unset(LOADMORE_CONTAINER)\n      GRID_WRAPPER.classList.remove('is-loading-products')\n      updateLoadingTxt(false)\n      removeVtoCTA()\n    }\n\n    var manageLoader = function () {\n      const gridEl = select('.pdp-grid__main')\n      const scrollPos = window.pageYOffset\n      const loader = new Loader(gridEl, {\n        enableSyncCol: true,\n        referenceEl: gridEl,\n        bypassTabindexUpdate: true,\n        bypassLoadingMessageFocus: true\n      })\n      loader.init()\n      loader.create(() => {\n        window.scrollTo(0, scrollPos)\n        // ACCESSIBILITY REQUIREMENTS\n        inert.set(FILTER_BAR)\n        inert.set(GRID_ROW)\n        inert.set(LOADMORE_CONTAINER)\n        updateLoadingTxt(true)\n        inert.unset(gridviewEl)\n      })\n      return loader\n    }\n\n    var apiParams = function () {\n      currentPageReal = pagePLP.currentPageReal\n\n      if (!loadmore.dataset.currentPage) {\n        loadmore.dataset.currentPage = 1\n      }\n      if (currentPageReal > 1) {\n        // eslint-disable-next-line\n        if (parseInt(currentPageReal) + 1 == totalPage) {\n          nextPage = parseInt(totalPage, 10)\n        } else {\n          nextPage = parseInt(currentPageReal, 10) + 1\n        }\n      } else {\n        nextPage = parseInt(loadmore.dataset.currentPage, 10) + 1\n      }\n\n      // VAR FOR ACCESSIBILITY REQUIREMENTS\n\n      const components = getCollection('.js-product-edito')\n      let lastComponentPosition = 0\n\n      if (components) {\n        // pick the last component on the list and getting the data position depending on device\n        lastComponentPosition = (!isWideScreen()) ?\n          components[components.length - 1].dataset.positionMobile :\n          components[components.length - 1].dataset.positionDesktop\n      }\n\n      return { nextPage, lastComponentPosition }\n    }\n\n   // Pre loading data after 1 second of user start scrolling the plp page\n\n    if (e.type == \"scroll\") {\n      if (!(isLoadMoreDataPreLoaded) && (loadmore.dataset.currentPage !== loadmore.dataset.totalPage)) {\n        isLoadMoreDataPreLoaded = true\n        let param = apiParams()\n        api.queryPage(param.nextPage, param.lastComponentPosition, true)\n          .then(data => {\n\n            loadMoreData = data\n            const productDataToMonetate = Object.values(data.dataLayer.productList)\n            const myObject = productDataToMonetate\n            const getPropValues = (o, prop) =>\n              (res => (JSON.stringify(o, (key, value) =>\n                (key === prop && res.push(value), value)), res))([])\n\n            let productSKUs = [...new Set(getPropValues(myObject, \"sku_id\"))]\n            let productIDs = [...new Set(getPropValues(myObject, \"id\"))]\n\n            productIDs.forEach((elem,index) => {\n              productDataViewMore.push({'productId': elem.toUpperCase(), 'sku': productSKUs[index].toUpperCase()})\n            })\n          })\n          .catch(config.noop)\n      }\n    }\n    else {\n\n      GRID_WRAPPER.classList.add('is-loading-products')\n      if (Object.keys(loadMoreData).length === 0) {\n        let param = apiParams()\n        let loader = manageLoader()\n        api.queryPage(param.nextPage, param.lastComponentPosition, true)\n          .then(data => {\n            apiCallback(data, loader)\n            isLoadMoreDataPreLoaded = false\n          })\n          .catch(config.noop)\n      }\n      else {\n        let loader = manageLoader()\n        apiCallback(loadMoreData, loader)\n        isLoadMoreDataPreLoaded = false\n      }\n\n      const dataTrack = {\n        eventCategory: dataLayerGA.pageLoad.page_type,\n        eventAction: 'view more',\n        eventLabel: '',\n        event: 'uaevent'\n      }\n      window.document.DLKit.push('on-tracking', dataTrack)\n    }\n  }\n\n  function sendData(){\n    setTimeout(() => {\n      sendDataToMonetate(productDataViewMore)\n      productDataViewMore = []\n    }, 1000)\n  }\n\n  function getMaxWidth() {\n    return (window.innerWidth < 1600) ? window.innerWidth : 1600\n  }\n\n  function numberOfElementsPerLine() {\n    return Math.floor(getMaxWidth() / select('.js-product-edito').offsetWidth)\n  }\n\n  // function createLoader() {\n  //   const plpWrapper = select('.plp')\n  //   const componentsLoader = new Loader(plpWrapper, {\n  //     referenceEl: plpWrapper\n  //   })\n  //   componentsLoader.init()\n  //   componentsLoader.create(() => {\n  //     panelEl.removeAttribute('aria-hidden', 'true')\n  //   })\n  // }\n\n  /**\n   * Make all the exceeding components inside the grid when we open the filter bar\n   */\n  function toggleExceedingComponents() {\n    if (gridviewEl.classList.contains('has-aside')) {\n      exceedingElems.forEach((elem) => {\n        elem.classList.add('is-exceeding')\n      })\n      if (getCollection('.is-exceeding').length !== 0) {\n        updateComponentsProportions()\n      }\n    } else {\n      exceedingElems = getCollection('.is-exceeding')\n      exceedingElems.forEach((elem) => {\n        if (elem.classList.contains('single-component') && elem.children.length > 0) {\n          elem.children[0].style.width = 'initial'\n        }\n        elem.classList.remove('is-exceeding')\n      })\n    }\n  }\n\n  function updateComponentsProportions() {\n    if (select('.plp-component')) {\n      const productElem = select('.js-product-edito')\n      const productWidth = productElem.offsetWidth\n      const maxWidth = getMaxWidth()\n      const fullGridWidth = productWidth * numberOfElementsPerLine()\n      // eslint-disable-next-line max-len\n      const spaceTillMaxWidth = (maxWidth - fullGridWidth) / 2 // space to add to the product width to achieve the max grid width\n      // eslint-disable-next-line max-len\n      const spaceToAdd = (spaceTillMaxWidth * 100) / maxWidth // space in 'vw' to add to the product width to achieve the max grid width\n      const singleExceededComponents = getCollection('.is-exceeding.single-component > *')\n      singleExceededComponents.forEach((elem) => {\n        elem.style.width = `calc(100% + ${spaceToAdd}vw)`\n        elem.style.visibility = 'visible'\n        elem.parentElement.style.minHeight = `${elem.clientHeight}px`\n      })\n    }\n  }\n\n  function updateHeadLink(page) {\n    const links = {\n      prev: {\n        url: '',\n        element: select('link[rel=\"prev\"]'),\n        page: parseInt(page, 10) - 1\n      },\n      next: {\n        url: '',\n        element: select('link[rel=\"next\"]'),\n        page: parseInt(page, 10) + 1\n      }\n    }\n\n    const linksArray = Object.keys(links)\n\n    for (let i = 0; i < linksArray.length; i++) {\n      const link = links[linksArray[i]]\n      if (!link.element) {\n        const divEl = document.createElement('div')\n        link.url = window.location.href.split('?')[0]\n        if (link.page > 1) {\n          link.url += `page-${link.page}`\n        }\n        divEl.innerHTML = `<link rel=\"${linksArray[i]}\" href=\" ${link.url}\">`\n        link.element = divEl.firstElementChild\n        // if it's 'prev', then just insert it before the next link tag\n        // otherwise insert 'next' after the prev link tag\n        const otherEl = linksArray[i] === 'prev' ? links.next.element : links.prev.element.nextSibling\n        select('head').insertBefore(link.element, otherEl)\n      } else {\n        link.url = `${link.element.href.substring(0, link.element.href.lastIndexOf('/page-'))}/page-${link.page}`\n        link.element.href = link.url\n      }\n    }\n    // if next page is superior than the total page, remove the next link tag\n    if (links.next.page > totalPage) {\n      if (links.next.element) {\n        links.next.element.outerHTML = ''\n      }\n    }\n    // if prev page is inferior than 1, remove the prev link tag\n    if (links.prev.page < 1) {\n      if (links.prev.element) {\n        links.prev.element.outerHTML = ''\n      }\n    }\n\n    // Update the Title\n    const title = select('head > title')\n    const lastIndex = title.innerHTML.lastIndexOf('page')\n    const currTitle = lastIndex !== -1 ? title.innerHTML.substring(0, lastIndex) : title.innerHTML\n    title.innerHTML = `${currTitle} page ${page}/${totalPage}`\n  }\n\n  function updateLinkDirection() {\n    const UrlLocalStorage = localStorage.getItem('UrlDirection')\n    const UrlLocation = window.location.pathname\n    const UrlElParent = select('.collapse-panel__content')\n    if (UrlLocalStorage) {\n      if (UrlLocation === UrlLocalStorage) {\n        const UrlEl = select(`a[href=\"${UrlLocalStorage}\"]`, UrlElParent)\n        if (UrlEl) {\n          UrlEl.parentNode.classList.add('is-bold')\n        }\n      }\n    } else {\n      const UrlEl = select(`a[href=\"${UrlLocation}\"]`, UrlElParent)\n      if (UrlEl) {\n        UrlEl.parentNode.classList.add('is-bold')\n      }\n    }\n  }\n\n  function handleLinkDirection() {\n    const childEl = select('a', this)\n    if (childEl) {\n      localStorage.setItem('UrlDirection', childEl.pathname)\n    }\n  }\n\n  /**\n   * eventlistener for product click event\n   * @param e: event object\n   */\n  function onProductClick(e) {\n    const pElm = select('[data-plp-product-click]', e.delegateTarget)\n    if (pElm) {\n      const productCode = pElm.getAttribute('data-id')\n      const target = e && (e.currentTarget || e.target)\n      if(productCode){\n        localStorage.setItem('productItemElm', target.classList)\n        localStorage.setItem('clickedProductId', productCode)\n        pagePLP.plpPageTitle = document.title\n        pagePLP.lastPLPUrl = window.location.href.replace(/\\s/g, '')\n        pagePLP.clickedProductId = true\n        pagePLP.fromPLP = true\n        localStorage.setItem('pagePLP', JSON.stringify(pagePLP))\n\n        //above is PLP specific functionality on product click\n        // publishing event below to trigger analytics.\n        Manager.publish(PRODUCT_CLICKED, e)\n      }\n    }\n  }\n\n\n  /**\n   * This method must be only used on tracking (DataLayer) cases\n   * @param elm {Element}: Element where the update must be applied\n   * @param params {Object}: contains values must be applied\n   */\n  function dlUpdateLoadedProductsValue(elm, params) {\n    elm.setAttribute('data-track-visible', '')\n    elm.addEventListener('click', onProductClick)\n\n    const addToBag = select('[data-popup-target][aria-haspopup]', elm)\n    if (addToBag) {\n      addToBag.addEventListener('click', (e) => {\n        // publishing event below to trigger analytics.\n        Manager.publish(ADD_TO_BAG_CLICKED, e)\n      })\n    }\n\n    const elmToUpdate = select('[data-track-click]', elm)\n    if (elmToUpdate && elmToUpdate.dataset) {\n      // get attributes\n      const productCode = elmToUpdate.dataset.id;\n      if (productCode && dataLayerGA.productList.hasOwnProperty(productCode)) {\n\n        const productObjList = dataLayerGA['productList'][productCode]\n        const attTrackClick = productObjList['productData']\n        const attPlpProductClick = productObjList['productClick']\n        if(attTrackClick){\n          // update values\n          attTrackClick.ecommerce.impressions[0].position = params.position\n          // save the values\n          elmToUpdate.setAttribute('data-track-click', JSON.stringify(attTrackClick))\n        }\n        if(attPlpProductClick){\n          attPlpProductClick.ecommerce.click.products[0].position = params.position\n          elmToUpdate.setAttribute('data-plp-product-click', JSON.stringify(attPlpProductClick))\n        }\n      }\n    }\n  }\n\n  function onPageLoad() {\n    if (pagePLP.clickedProductId &&\n      pagePLP.backPLP &&\n      pagePLP.lastPLPUrl === window.location.href) {\n      const productItems = localStorage.getItem('productItems')\n      const heroHeight = localStorage.getItem('heroHeight')\n      const productGridEl = select('.product-grid')\n      // eslint-disable-next-line\n      if (loadmore && parseInt(pagePLP.currentPageReal) === totalPage) {\n        loadmore.classList.add('is-hidden')\n      }\n      if (pagePLP.plpPageTitle) {\n        document.title = pagePLP.plpPageTitle\n      }\n      if (productGridEl && productItems) {\n        productGridEl.innerHTML = productItems\n        if (heroHeight && HERO) {\n          HERO.style.minHeight = `${heroHeight}px`\n        }\n      }\n    } else {\n      pagePLP.currentPageReal = 1\n      localStorage.removeItem('productItems')\n      localStorage.removeItem('currentPage')\n    }\n    if(pagePLP.backPLP){\n      if (loadmore && parseInt(pagePLP.currentPageReal) === totalPage) {\n        loadmore.classList.add('is-hidden')\n      }\n    }\n\n    localStorage.removeItem('pagePLP')\n    localStorage.removeItem('clickedProductId')\n    removeLocalstorage = true\n    updateComponentsProportions()\n    updatePositions()\n  }\n\n  function onStoryClick(e) {\n    const dlStoryData = JSON.parse(e.delegateTarget.getAttribute('data-dl-content-story'))\n    window.document.DLKit.push('on-tracking', dlStoryData)\n  }\n\n  function onHelpClick(e) {\n    const dlHelpData = JSON.parse(e.delegateTarget.getAttribute('data-dl-content-help'))\n    window.document.DLKit.push('on-tracking', dlHelpData)\n  }\n}\n\nfunction ay11Check(target, attributeName) { // compatibility for firefox\n  return target.attributes[attributeName] != undefined && target.attributes[attributeName].value\n}\n\nfunction sendDataToMonetate(ViewMoreProducts){\n  pushMonetateDataOnViewMore(window.chanelMonetateData.pageType, window.chanelMonetateData.categories, window.chanelMonetateData.customVariables,ViewMoreProducts)\n}\n\nexport default function (el) {\n  return new PLP(el)\n}\n"],"sourceRoot":""}