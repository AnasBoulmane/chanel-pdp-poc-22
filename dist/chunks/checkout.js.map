{"version":3,"sources":["webpack:///./node_modules/flatpickr/dist/l10n lazy ^\\.\\/.*\\.js$ namespace object","webpack:///./patterns/scripts/lib/helpers/fit-text.js","webpack:///./patterns/scripts/modules/toshi-module.js","webpack:///./patterns/scripts/pages/account/popinResetPassword.js","webpack:///./patterns/scripts/pages/account/preference-setting.js","webpack:///./patterns/scripts/pages/opc/address-validation.js","webpack:///./patterns/scripts/pages/opc/applePayOPCManager.js","webpack:///./patterns/scripts/pages/opc/change-country.js","webpack:///./patterns/scripts/pages/opc/delivery-method-calender.js","webpack:///./patterns/scripts/pages/opc/hilight-credit-card.js","webpack:///./patterns/scripts/pages/opc/index.js","webpack:///./patterns/scripts/pages/opc/list.js","webpack:///./patterns/scripts/pages/opc/promocode.js","webpack:///./patterns/scripts/pages/opc/threeDS2-popin.js","webpack:///./patterns/scripts/pages/opc/toggle-formaction.js","webpack:///./patterns/scripts/pages/opc/wechatpayQR-adyen.js"],"names":["addEvent","el","type","fn","addEventListener","attachEvent","extend","obj","ext","key","hasOwnProperty","window","fitText","kompressor","options","settings","fit","compressor","resizer","style","fontSize","Math","max","min","clientWidth","parseFloat","maxFontSize","minFontSize","length","i","initToshiDetails","toshiCartDataUrl","toshiLibraryUrl","config","webservices","getData","data","deliveryModeCode","getAttribute","xhr","then","showDetails","toshi","global","_babelPolyfill","apiToshi","document","createElement","id","src","onload","body","appendChild","modal","createBookingIntegration","api","url","toshiApiUrl","toshiApiKey","showErrorMessage","setInlineErrorMessage","hideErrorMessage","undefined","setFirstName","cartUserFirstName","setLastName","cartUserLastName","setEmail","cartUserEmail","setPhone","cartUserPhone","setAddress","cartUserAddress","setBrandCheckoutReference","checkoutReference","setProducts","cartEntries","mountModalSeparately","COOKIE_KEY","POPIN_SELECTOR","FORM_SELECTOR","resetPassword","isVisible","followRedirect","userData","handleFromLogin","removeCookie","showPopin","select","handleFromOPC","hiddenEmailEl","getElementById","value","sourceEl","formContainerEl","page","popin","open","label","locales","passwordForcedUpdate","html","fixRevealPassword","innerHTML","role","modifiers","opener","manageFocus","forceInert","closeButton","closeButtonDataTest","checkAPI","json","errorCode","inEmailEl","outEmailEl","handleSubmit","e","handleSuccess","hide","location","redirectURL","forceUpdate","Manager","publish","form","delegateTarget","selectors","invalid","preventDefault","encodePasswords","catch","err","console","error","decodePasswords","promptPasswordMode","readCookie","subscribe","CHECK_API","bind","nodeElement","copyEl","cloneNode","selectAll","forEach","setAttribute","dataset","togglePassword","preferenceSetting","heightOfNewsletterRule","handlePreferenceSetting","newsletterElm","newsletterRulesElm","isChecked","checked","country","pageName","hasAttribute","classList","remove","removeAttribute","add","clientHeight","height","TweenLite","fromTo","autoAlpha","eventCallback","getCollection","elm","gigyaEmailStatusElm","binded","addressIsValid","currentPopin","target","closest","validCallback","display","params","MODULE_SELECTOR","OPC_APPLE_PAY_INPUT_SELECTOR","APPLE_PAY_CTA_SELECTOR","ApplePayOPCManager","Base","constructor","renderExpressCheckoutCtas","event","shippingInfo","JSON","parse","cartdata","checkTermCondEl","termCondErrorMsgEl","labeltermCondition","pElem","errorMsg","createTextNode","opc","customError","termsAndCondition","removeChild","disablePaymentModes","applePayData","cancelCallback","enablePaymentModes","placeOrderCallback","formElm","action","applepay","placeOrder","submit","paymentAuthorizedFailureCallback","response","success","stockStatusFail","href","cart","cartUrl","posStockStatusFail","deliveryOptionAvailableFail","checkout","checkoutUrl","paymentError","startApplePaySession","bindEvents","onApplePayCheckoutButtonClicked","onPageLoad","OPC_STEP_PROCESS","onOPCStepProcess","applePayIsSupported","applePayEl","getApplePayData","billingForm","billingRadioButtonsElm","radioButtonsElm","radioElm","disabled","updateBillingStep","applePayBlockElm","placeOrderBlockElm","initApplePayOPCManager","context","OPCElm","DIALOG_CLOSE_BUTTON_SELECTOR","ChangeCountry","closeModal","focusElement","clickedElm","isWideScreen","links","tabIndexToZero","keyCode","onModalCancelButtonClicked","buttonClose","init","responseData","markets","sortedMarketKeys","Object","keys","sort","key1","key2","val1","toUpperCase","val2","buildTemplate","template","countryChange","closeChangeDeliveryCountry","deliveryCountry","currentlyOnlineBoutique","replace","current","name","changeLocationDescription","changeYourLocation","marketSelectTemplate","cartMessage","createSelectBox","populateMarkets","setNiceSelectTemplate","marketSelection","firstLoad","firstChild","option","innerText","defaultOption","append","marketKey","outerHTML","paths","icons","targetVersion","onOpenPopin","setDomElements","popinEl","buttonValidate","onChangeMarket","productMessage","onValidate","isFallback","selectedMarket","formUrl","outerClose","onEscapeKeyClicked","removeEventListener","initChangeCountry","changeCountry","flatpickrLocale","currentLanguage","split","log","COUNTRY_SELECTED","DATE_CONTAINER","INPUT_FIELD","SUBMIT_BTN","dateSelection","events","dateContainer","flatpickr","localize","l10ns","initializeCalendar","dateControl","startDate","endDate","calendarContainer","inputControl","defaultDate","disable","isMobileScreen","self","push","onInput","onKeydown","date","getDay","CalendarInstance","minDate","maxDate","clickOpens","appendTo","allowInput","wrap","disableMobile","onChange","selectedDates","dateStr","instance","cleanErrors","input","setHours","getTime","onOpen","removeElement","closeBtn","svg","stopPropagation","close","onClose","calendar","checkDateRange","createErrorMessage","dl","deliveryMethod","errors","emptyDate","Date","selectedDate","checkValidDate","unavailableDate","inputValue","map","v","parseInt","match","inValidDate","domElement","message","elem","parent","parentNode","errorMessage","notChangeTabIndex","caretAtTheEnd","element","hasErrorClasses","errorMessages","isOpen","dateInputSelector","isInputCharacter","inputType","startPos","selectionStart","cursorPosition","toggle","regex","values","test","join","setSelectionRange","hilightCreditCard","isValidCardSupport","creditCardInput","submitBtn","inputField","cardIconList","cardSupportErr","cardCVNTootip","amexTooltip","otherTooltip","creditCardInputFourDigit","dataRegex","regexList","filter","reg","cardTypeEl","card","fourDigitRegex","RegExp","highlightIcon","handleErr","undoHighlight","cardName","cardNameId","supportedCard","tooltipBtn","contains","roleMsg","paymentMethod","selected","some","icon","addErr","removeErr","paymentMethodes","notAccepted","handleSubmitOrder","focus","GIGYA_WRAPPER_ID","HIDDEN_CLASSNAME","DISABLED_FIELDS","DISABLED_FIELDS_GMO","GUEST_EMAIL","LOGIN_EMAIL","EMPLOYEE_SAVINGS","SHIPPING_ADDRESS_FORM_SELECTOR","DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR","gigyaRegisterForm","ADDRESS_TOWN_MOBILE_SELECTOR","ADDRESS_MOBILE_SELECTOR","EXPERIAN_AUTOCOMPLETE_SELECTOR","PRECISELY_AUTOCOMPLETE_SELECTOR","toLowerCase","countryCodes","gb","ca","au","dataLayerProductData","deliveryCalendar","isMobile","isSendDataToLoggedInUser","paymentSubmitted","newForm","countryCode","OPC","module","default","steps","step1","querySelector","step2","step3","cart_data","cart_total","cart_wrapping","gift_message","payment_modes_opc","formErrorMapping","guestEmail","loginEmail","enableSubmitBtns","btn","toggleFormAction","popinResetPasswordHandler","popinResetPassword","popinMergeDecisionHandler","popinMergeDecision","currentTrackingStep","isCncDeliveryMode","isCncDeliveryModeSelected","animateStep","step","newStep","newHeight","done","revealNewStep","children","opacity","onComplete","set","clearProps","css","to","zipCodeVariation","updateInputs","bindSelectionItems","List","initGoogleMap","displayError","includes","dataLayer","addressValidation","submitStepForm","fields","formError","MobilePhoneValidation","resultCode","payload","billing","base","CHECK_RESPONSE","enableAllElements","Array","prototype","call","elements","focusInteractiveStep","container","stepForm","heading","POSElementHeading","focusFirstErrorElement","boutiqueName","handleBillingAddressForm","checkbox","show","formFieldset","formToggleDisplay","setUseDeliveryAddressEl","setBillToBusinessAddressEl","setAddressLine2","COUNTRY_SELECT","selectorCountry","dispatchCapAddress","CustomEvent","detail","isOpc","querySelectorAll","field","tagName","addValue","emptyAddressContainer","getOS","removeRequiredAttribute","phoneCCodeEle","countryCodeOpcEle","countryCodesOption","parentElement","code","index","att","createAttribute","setAttributeNode","selectedIndex","handleFinalStep","signature","pspProvider","hasSignature","cardno","expiryMonth","ExpiryYear","securitycode","holdername","tokennumber","apiKey","gmo","Multipayment","disableFieldsBeforeSend","ceil","tokens","callGmoWithLoop","iterator","tokensNumber","count","getToken","expire","tokenObject","token","substr","buttonClick","trim","fieldNameAttribute","enableValidations","cseEncryptedForm","adyen","createEncryptedForm","encryptedToken","encrypt","paymentUrl","cybersource","disabledFields","Boolean","expiryField","card_expiry_date","billingAddress","from","keepDisabled","handleGigyaLogin","args","loginData","loginFrom","origin","account","loginUrl","forcePassword","method","className","insertAdjacentHTML","handleStepResponse","stockSuccess","updateMobileBurgerMenu","disableSamplesBlock","trackPageview","pathname","parts","subTotal","noop","handleGigyaNotifyLogin","notifyLoginUrl","getUpdatedCartProductData","gtmData","currentStep","dynamicDlCheckoutYapi","pushUpdatedCartData","ecommerce","actionField","products","TRACKING_HIT","ecom","pageLoad","val","addToJson","isFormValid","checkValidity","gEmailElm","lEmailElm","cardNumberErr","selectedPosEle","selectedPosId","giftCardEl","giftCardNumberEl","giftCardCvnEl","selectedInput","billingCheckboxEU","updateGiftCardList","selectedRadio","selectedAddress","addressError","isLocalStorage","localStorage","setItem","toshiFlag","toshiDeliveryMode","weChatSelected","handleSMSNotification","handleUnsubscribe","registrationForm","consentList","defaultMsg","deliveryContainer","deliveryCalendarDate","deliveryDateStatus","invalidFields","invalidItem","phoneNumber","isKR","mobileValidation","isValid","addcncDeliveryAnalytics","addDeliveryAnalytics","manageDataObj","countryCodeName","sendToDatalayer","processStep","stepNumber","currentLocale","promocode","Promocode","nextPage","appliedFocusOnActiveForm","pathPage","isGuestUser","getItem","funnel_type","category","cartValue","cartValueWithoutTax","checkoutStepName","sub_category_level1","cartValueWithTax","checkoutStepNumber","userEmail","email_sha256","sha256","paramsData","inputs","isoCode","namesToExclude","required","indexOf","selectedOptions","isNotMobile","countryIso","stepBack","button","formFocus","checkPrivacy","privacyErrorMsg","labelPrivacy","valueMissing","privacy","updateAnalyticsShippingOptions","updateSteps","hidden","phonePattern","dispatchPhoneNumber","dispatchEvent","editboutiqueLayerUpdate","manageStep1ScreenSwitch","selectPOSNow","preSelectedPOS","lat","long","initializeMap","updatePageTitle","loadMaponEditBoutique","shippingOptionHighlight","deliveryMethodCalendar","stepDivElm","firstElementChild","stepName","pageTitle","headingTextEle","headingText","pushCheckoutMonetateData","reviewCart","sendShippingDataToDatalayer","replaceSteps","httpForm","Promise","resolve","all","promises","activationPopup","gigya","accounts","hideScreenSet","screenSet","checkMergeCookie","WRAPPING_KEY","promptMergeDecision","promptMergeWrappingDecision","btnContinuetoShippingOptions","updateWrappingChoice","callSeeMoreOption","loadGmoDeviceFingerUrl","getCustomerTimeZone","showUnionPay","showWeChat","isWeChatPayQRAdyenEnabled","initWechatPayQrAdyenPopin","loadMapOnPageLoad","updateSamples","updateEmployeeSavings","updateOrderSummary","selectDeliveryMethod","resetPaymentModes","timeZoneElm","unionPayDiv","weChatDiv","aliPay","isWeChatBrowser","wechatCheckbox","alipayCheckbox","weChatForm","aliPayForm","wechatPayTerms","aliPayTerms","seeMoreBtns","toggleSeeMore","seeMoreBtn","seeMoreContent","nextElementSibling","conciergeDelivery","seeLessBtn","paymentUl","paymentLi","applePayDiv","isEmployeeSale","sampleList","wrapper","notification","samples","employee","wrapping","employeeSavingsSection","orderSummaryElm","cart_items","setFocus","hasFocus","inputEl","managePlaceholders","loginInput","passwordContainer","onfocusin","onblur","onchange","step1DivElm","gigyaWrapperElm","guestDivElm","gigyaLoginScreen","gigyaRegisterScreen","hideBlock","showBlock","forceSwitch","switchScreen","containerID","screen","toggleDisplay","stepDisplay","updateAnalyticsUserOpc","inert","REMOVE_ERROR","unset","updateDefaultCardCheckbox","updateDatalayerStep","divElm","subtotal","privateWait","setTimeout","stepsElms","activeStepElm","find","stepElm","titleElm","res","PAGELOAD_WISHLIST","signInElm","welcomeElm","session","welcomeLiString","signinWelcome","welcomeLiElm","svgElm","firstNameElm","menu","welcome","accountUrl","childNodes","menuNameList","samplesBlockElm","nbSamples","samplesBlock","PromocodeToggle","onUserConfirmedWrongAddress","isSafari","handlePopState","radioButton","shippingNodes","shippingNode","detailsSection","inputElement","setCustomValidity","deliverySlotDateInput","selectBox","shippingOptions","nameAndPrice","substring","DLKit","eventAction","eventLabel","selectOpt","PSOptionWrapper","shippingAddressSection","cartPriceEle","customerEle","customerAsideEle","stickyMap","inputs_length","cncOption","homeDeliveryOption","addhomeDeliveryCnCAnalytics","posDataLayerUpdate","top","offsetHeight","overflow","inputPOS","totalPOS","posMap","weekendDeliverySelect","handleChange","isChallengeShopper","initThreeDS2Popin","giftCardList","paymentCreditCard","nonSelectedPOSList","pymtError","pushDataEvent","selectPOSAddress","selectPOS","posValue","skipStoreMapTop","skipStoremapBottom","j","lng","posTitle","elementType","stylers","visibility","center","google","maps","LatLng","mapOptions","mapTypeId","MapTypeId","ROADMAP","disableDefaultUI","zoomControl","gestureHandling","mobileMapElement","posMapBlock","Map","isTabletScreen","mapType","StyledMapType","mapTypes","setMapTypeId","latlngbounds","LatLngBounds","latLng","Number","pt","marker_image","theme","pinIcon","MarkerImage","Size","marker","Marker","position","addListener","setCenter","setZoom","bounds","getCenter","fitBounds","posId","posElement","hideNewCardForm","paymentMethodBlock","paymentIdEdit","selectedCard","formAction","script","gmoDeviceFingerUrl","evt","selectPaymentFocusIn","activeElement","border","selectPaymentFocusOut","selectPaymentType","paymentTypeEl","giftcardEl","codPaymentEl","setTrustlyEl","setOptionalEl","updateCodPayment","giftMethodEl","op","codOperation","selectSavedCard","selectedCvvId","setDefaultEl","setSavePaymentMethodEl","cvvLabelElement","cvnInputField","eventCategory","updateAnalyticsEditAddress","updateAnalyticsAddAddress","updateAnalyticsContinueAsGuest","updateAnalyticsOpcEdit","title","posListArray","cnc","click_and_collect_number_of_store","eventActionMap","eventActionList","defaultPaymentMethod","paymentDetailsForm","creditCardOption","click","numberSubmitted","mobileNumber","inptPhone","phoneCountryCode","inpt","modifiedTime","updateSMSNumber","cancelUpdateSMSNumber","handleSubscribeAgain","signUpCta","pElement","selectPhoneInput","shippingRulesDataLayerUpdate","giftCardDataLayerUpdate","changePaymentType","paymentModeSelector","giftCardPaymentHeader","giftCardBtn","creditCardBtn","giftCardListDisplay","removeGiftCard","renderGiftCardSection","selectedCardDefault","evtParams","bubbles","cancelable","giftForm","addGiftCard","gift_card_number","gift_card_cvn","giftCardTitleEl","giftCardNo","giftCardCvn","defaultUrl","jsonData","successKey","dataErrorMessage","giftCardForm","addMoreGiftCard","giftCardPlaceOrder","removeAllGiftCards","removeLink","giftCardNoEl","showGiftCardForm","giftCardLabel","hideGiftCardForm","giftCardAddEl","showPaymentForm","giftCardlistDiv","giftCardMoreSection","giftCardMethod","selectCardType","handleDeliverySlotDateSelection","deliverySlotDateSelectBox","timeSlotSelectBox","selectedOption","timeSlots","timeSlot","text","editOrderSummary","paymentModeSelected","paymentInfoNodes","cardNumber","paymentInfoNode","updateRegisterUserDetails","perferencesDetail","updateAnalyticsPerferenceRegister","updateIncompleteAddress","sidepanelDiv","addressForm","orderRegisterUserDetails","updateAnalyticsOrderPerferenceRegister","toshiDeliveryMehod","deliverySlotSelected","dataTime","updateAnalyticErrorToshi","updateDataOnWeekendDeliverySelect","srcElement","containerDiv","price","dropdown","arr","onSaveAddressCheckbox","savecheckbox","invoiceDisplay","invoice","invoiceform","invoicePrivacy","invoiceAccount","invoiceList","invoiceRadio","profesional","invoiceTypeDisplay","personal","invoiceCompany","invoicePersonal","editExistingBoutique","productCode","sidePanel","popups","geoPointDetails","elmId","updateOnlineGiftCardBtn","navigator","onLine","confirmGiftCardBtn","copyQRCode","qrCode","clipboard","writeText","copyNotification","notifier","notifierNotify","notifierTitle","notifierDesc","handlePOSMap","LIST_ITEMS_SELECTOR","SIDEPANEL_ADD_ADDRESS_FORM_SELECTOR","DIALOG_WRONG_ADDRESS_CLOSE_BUTTON_SELECTOR","handleEditResponse","displayMoreItems","selectionList","lastItem","childElementCount","updatedItem","tempWrapper","item","replaceChild","on","requestAnimationFrame","itemInput","handleSidepanelEditForm","addSelector","checkboxCompanyName","inputCompanyName","submitFormData","updateAnalyticsEditAddressSideTray","phone","trimNumber","loadMoreItems","replacedApi","loader","Loader","enableSyncCol","referenceEl","create","more","loadmore","manageLoadMoreButton","destroy","next","offsetParent","onUserCloseWrongAddress","PROMOCODE_ID","PROMOCODE_FORM_ID","PROMOCODE_INTRO_ID","TOGGLE_SELECTOR","focusable","intro","dataLyerType","promoCodeDataLayerEntry","highlightShippingNodeWithPromo","formTypeRemove","formTypeAdd","setFocusAdd","setFocusRemove","pop","confirmation","request","noFocus","addNewEle","addNewValue","newPromoBtn","handlePromoAdd","voucherCode","submitted","ThreeDS2Popin","challengeTokenIdElem","challengeToken","legacy","checkGiftCard","isGiftCard","perform3DS2Operations","tokenID","initiate3DS2ChallengeShopper","threeDS2ChallengeShopperNode","localeValue","envValue","configuration","locale","environment","AdyenCheckout","challengeShopperComponent","challengeData","challengeResult","details","challengeResultField","threeDS2popinCol","onError","stringify","size","mount","threeDS2Auth","closethreeDS2Auth","threeDS2ResponseLegacy","threeDS2GiftCard","threeDS2Response","popin3DS2","authLabelTitle","threeDS2","Toggle","scope","handleFormAction","defaultAction","formaction","WECHANT_ADYAN_PAYMENT_BUTTON_SELECTOR","WechatPayQrAdyenPopin","resp","webComponentConfiguration","clientKey","amount","onAdditionalDetails","submitPaymentData","onSubmit","state","component","createWebConfiguration","webAction","weChatPayStart","handleWechatPayinitResponse","paymentDataField","paymentData","payloadField","weChatPaySubmit","createFromAction","wechat","qrCodePopin","selectecWechatPayment","weChatPopin"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,qC;;;;;;;;;;;ACxOA,C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","file":"chunks/checkout.js?v=3.23.0","sourcesContent":["var map = {\n\t\"./ar.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ar.js\",\n\t\t9\n\t],\n\t\"./at.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/at.js\",\n\t\t10\n\t],\n\t\"./be.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/be.js\",\n\t\t11\n\t],\n\t\"./bg.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/bg.js\",\n\t\t12\n\t],\n\t\"./bn.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/bn.js\",\n\t\t13\n\t],\n\t\"./cat.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/cat.js\",\n\t\t14\n\t],\n\t\"./cs.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/cs.js\",\n\t\t15\n\t],\n\t\"./cy.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/cy.js\",\n\t\t16\n\t],\n\t\"./da.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/da.js\",\n\t\t17\n\t],\n\t\"./de.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/de.js\",\n\t\t18\n\t],\n\t\"./default.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/default.js\",\n\t\t19\n\t],\n\t\"./eo.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/eo.js\",\n\t\t20\n\t],\n\t\"./es.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/es.js\",\n\t\t21\n\t],\n\t\"./et.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/et.js\",\n\t\t22\n\t],\n\t\"./fa.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/fa.js\",\n\t\t23\n\t],\n\t\"./fi.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/fi.js\",\n\t\t24\n\t],\n\t\"./fr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/fr.js\",\n\t\t25\n\t],\n\t\"./gr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/gr.js\",\n\t\t26\n\t],\n\t\"./he.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/he.js\",\n\t\t27\n\t],\n\t\"./hi.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/hi.js\",\n\t\t28\n\t],\n\t\"./hr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/hr.js\",\n\t\t29\n\t],\n\t\"./hu.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/hu.js\",\n\t\t30\n\t],\n\t\"./id.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/id.js\",\n\t\t31\n\t],\n\t\"./index.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/index.js\",\n\t\t32\n\t],\n\t\"./it.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/it.js\",\n\t\t33\n\t],\n\t\"./ja.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ja.js\",\n\t\t34\n\t],\n\t\"./km.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/km.js\",\n\t\t35\n\t],\n\t\"./ko.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ko.js\",\n\t\t36\n\t],\n\t\"./kz.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/kz.js\",\n\t\t37\n\t],\n\t\"./lt.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/lt.js\",\n\t\t38\n\t],\n\t\"./lv.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/lv.js\",\n\t\t39\n\t],\n\t\"./mk.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/mk.js\",\n\t\t40\n\t],\n\t\"./mn.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/mn.js\",\n\t\t41\n\t],\n\t\"./ms.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ms.js\",\n\t\t42\n\t],\n\t\"./my.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/my.js\",\n\t\t43\n\t],\n\t\"./nl.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/nl.js\",\n\t\t44\n\t],\n\t\"./no.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/no.js\",\n\t\t45\n\t],\n\t\"./pa.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/pa.js\",\n\t\t46\n\t],\n\t\"./pl.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/pl.js\",\n\t\t47\n\t],\n\t\"./pt.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/pt.js\",\n\t\t48\n\t],\n\t\"./ro.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ro.js\",\n\t\t49\n\t],\n\t\"./ru.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/ru.js\",\n\t\t50\n\t],\n\t\"./si.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/si.js\",\n\t\t51\n\t],\n\t\"./sk.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sk.js\",\n\t\t52\n\t],\n\t\"./sl.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sl.js\",\n\t\t53\n\t],\n\t\"./sq.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sq.js\",\n\t\t54\n\t],\n\t\"./sr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sr.js\",\n\t\t55\n\t],\n\t\"./sv.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/sv.js\",\n\t\t56\n\t],\n\t\"./th.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/th.js\",\n\t\t57\n\t],\n\t\"./tr.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/tr.js\",\n\t\t58\n\t],\n\t\"./uk.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/uk.js\",\n\t\t59\n\t],\n\t\"./vn.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/vn.js\",\n\t\t60\n\t],\n\t\"./zh.js\": [\n\t\t\"./node_modules/flatpickr/dist/l10n/zh.js\",\n\t\t61\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__.t(id, 7);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = \"./node_modules/flatpickr/dist/l10n lazy recursive ^\\\\.\\\\/.*\\\\.js$\";\nmodule.exports = webpackAsyncContext;","(() => {\n  const addEvent = (el, type, fn) => {\n    if (el.addEventListener)\n      el.addEventListener(type, fn, false)\n        else\n            el.attachEvent('on'+type, fn)\n  }\n  const extend = (obj, ext) => {\n    for(let key in ext)\n      if(ext.hasOwnProperty(key))\n        obj[key] = ext[key]\n    return obj\n  }\n  window.fitText = (el, kompressor, options) => {\n    const settings = extend({\n      'minFontSize' : -1/0,\n      'maxFontSize' : 1/0\n    }, options)\n    const fit = (el) => {\n      const compressor = kompressor || 1\n      const resizer = function () {\n        el.style.fontSize = Math.max(Math.min(el.clientWidth / (compressor*10), parseFloat(settings.maxFontSize)), parseFloat(settings.minFontSize)) + 'px'\n      }\n      resizer()\n      addEvent(window, 'resize', resizer)\n      addEvent(window, 'orientationchange', resizer)\n    }\n    if (el.length)\n      for(let i=0; i < el.length; i++)\n        fit(el[i])\n    else\n      fit(el)\n    return el\n  }\n})()","import Loader from 'ui/widgets/loader'\nimport * as xhr from 'modules/fetch'\n\nfunction initToshiDetails(el) {\n\n  const {toshiCartDataUrl, toshiLibraryUrl} = window.config.webservices\n\n  /**\n  * Triggered once form is created to get data to populate the form\n  */\n  function getData() {\n    let data = {\n      data : {\n          deliveryModeCode: el.getAttribute(\"data-method-toshi\")\n        }\n    }\n\n    xhr.post(toshiCartDataUrl, data).then(data => {\n      showDetails(el, data.toshi)\n    })\n  }\n\n  if (!window.toshi) {\n    global._babelPolyfill = false\n    const apiToshi = document.createElement('script')\n    apiToshi.type = 'text/javascript'\n    apiToshi.id = 'apiToshi'\n    apiToshi.src = toshiLibraryUrl\n    apiToshi.onload = () => {\n        getData()\n    }\n    document.body.appendChild(apiToshi)\n  }\n  else {\n    // already loaded just fill user data and mount modal\n    getData()\n  }\n\n  function showDetails(el, data) {\n    \n    if(window.toshi) {\n      const modal = window.toshi.createBookingIntegration({\n          api: {\n              url: data.toshiApiUrl,\n              key: data.toshiApiKey\n          }\n      });\n      \n      // This is fired by the ecommerce integration when the customer attempts to\n      // proceed without selecting a timeslot.\n      window.showErrorMessage = () => {\n        modal.setInlineErrorMessage(\n          \"Please add your details before proceeding!\"\n        );\n      };\n      window.hideErrorMessage = () => {\n        modal.setInlineErrorMessage(undefined)\n      };\n      \n      modal.setFirstName(data.cartUserFirstName)\n      modal.setLastName(data.cartUserLastName)\n      modal.setEmail(data.cartUserEmail)\n      modal.setPhone(data.cartUserPhone)\n      modal.setAddress(data.cartUserAddress)\n\n      modal.setBrandCheckoutReference(data.checkoutReference)\n\n      modal.setProducts(data.cartEntries)\n\n      modal.mountModalSeparately(el, document.body)   \n    }\n  }\n}\n\nexport default initToshiDetails","import bind from 'delegate'\nimport * as xhr from 'modules/fetch'\nimport popin from 'modules/popin'\nimport { select, selectAll, getCollection } from 'lib/selectors'\nimport { read as readCookie, remove as removeCookie } from 'modules/cookie'\nimport config from 'lib/config'\nimport { Manager, CHECK_API } from 'lib/events'\nimport { encodePasswords, decodePasswords } from 'lib/helpers'\n\n// This cookie can be created manually in your browser\n// to display the popin after a page refresh\n// ie. forceResetPassword=true\nconst COOKIE_KEY = 'forceResetPassword'\nconst POPIN_SELECTOR = '#js-modal-prompt-password-update'\nconst FORM_SELECTOR = '#js-modal-prompt-password-update-form'\n\nexport default function resetPassword() {\n  let isVisible = false\n  let followRedirect = true\n  let userData\n\n  // Redirect is not followed from opc\n  function handleFromLogin() {\n    removeCookie(COOKIE_KEY)\n    showPopin(select(POPIN_SELECTOR), 'login')\n  }\n\n  function handleFromOPC(data) {\n    // Let Gigya handle the login\n    followRedirect = false\n    // Save userData from later use\n    userData = data\n    // Set reset password hidden email to sign in value if necessary\n    const hiddenEmailEl = document.getElementById('emailID')\n    if (hiddenEmailEl.value.length === 0) {\n      const sourceEl = document.getElementById('login-email')\n      if (sourceEl) {\n        hiddenEmailEl.value = sourceEl.value\n      }\n    }\n    showPopin(select(POPIN_SELECTOR), 'checkout')\n  }\n\n  function showPopin(formContainerEl, page) {\n    isVisible = true\n\n    popin.open({\n      label: config.locales.modal.passwordForcedUpdate.label,\n      html: fixRevealPassword(formContainerEl).innerHTML,\n      role: 'dialog',\n      modifiers: 'is-big is-my-account',\n      opener: null,\n      manageFocus: false,\n      forceInert: true,\n      modal: true,\n      closeButton: 'is-popin-close',\n      closeButtonDataTest: 'btnClosePasswordUpdateRequired',\n      page\n    })\n  }\n\n  function checkAPI(json) {\n    // 403100 Gigya status: Pending password change\n    // The password is flagged and has to be updated\n    if (json.errorCode === 403100) {\n      // Set hidden field to previously entered email value\n      const inEmailEl = document.getElementById('login-email')\n      const outEmailEl = document.getElementById('emailID')\n      outEmailEl.value = inEmailEl.value\n      isVisible = false\n      if (!isVisible) {\n        handleFromLogin()\n      }\n    }\n  }\n\n  function handleSubmit(e) {\n    function handleSuccess(data) {\n      popin.hide()\n      isVisible = false\n      // From login: redirect to the given URL\n      if (followRedirect) {\n        window.location = data.redirectURL\n      }\n      // From OPC: validate login and move to next step\n      else if (userData) {\n        delete userData.forceUpdate\n        Manager.publish('gigyaLogin', userData)\n      }\n    }\n\n    const form = e.delegateTarget\n    const selectors = ['input#password-currentPassword-popin', 'input#password-newPassword-popin']\n    if (form.invalid.length) {\n      return\n    }\n\n    e.preventDefault()\n\n    // Encodes password (current and new) before sent\n    encodePasswords(selectors, form)\n\n    xhr.submit(form)\n      .then(handleSuccess)\n      .catch(err => {\n        console.error(err)\n      })\n\n    // Restore passwords once they are sent\n    decodePasswords(selectors, form)\n\n  }\n\n\n  const promptPasswordMode = readCookie(COOKIE_KEY)\n\n  Manager.subscribe(CHECK_API, checkAPI)\n  bind(document.body, FORM_SELECTOR, 'submit', handleSubmit)\n  if (promptPasswordMode) {\n    handleFromLogin()\n  }\n\n  return { handleFromOPC }\n}\n\n// Helpers that updates the ids so the JS bindings remains active after cloning\n// ie. use of the show password relies on ids, duplicate ids messes it up\nfunction fixRevealPassword(nodeElement) {\n  const copyEl = nodeElement.cloneNode(true)\n  selectAll('input[type=password]', copyEl).forEach(el => el.setAttribute('id', `${el.id}-popin`))\n  selectAll('[data-toggle-password]', copyEl).forEach(el => el.setAttribute('data-toggle-password', `${el.dataset.togglePassword}-popin`))\n  selectAll('label[for]', copyEl).forEach(el => el.setAttribute('for', `${el.getAttribute('for')}-popin`))\n  return copyEl\n}\n","import {select, selectAll, getCollection} from 'lib/selectors'\nimport config from 'lib/config'\nimport bind from 'delegate'\n\n/**\n * Triggered once user change newsletter checkbox value\n * @param evt {object}: click event\n */\nexport default function preferenceSetting(el) {\n  \n  let heightOfNewsletterRule = 0 \n  \n  function handlePreferenceSetting(e) {\n    const newsletterElm = e.delegateTarget\n\n    if (newsletterElm) {\n      const newsletterRulesElm = select('div#newsletter-rules')\n      const isChecked = newsletterElm.checked\n      \n      if(newsletterRulesElm) {\n        if (config.country === 'GB' && config.pageName === 'checkout') {\n          if (isChecked) {\n            if (newsletterRulesElm.hasAttribute('hidden')) {\n              newsletterRulesElm.classList.remove('is-hidden')\n              newsletterRulesElm.removeAttribute('hidden')\n            }\n            newsletterRulesElm.classList.add('has-margin-bottom-sm')\n          } else {\n            newsletterRulesElm.setAttribute('hidden', '')\n            newsletterRulesElm.classList.remove('has-margin-bottom-sm')\n            newsletterRulesElm.classList.add('is-hidden')\n          }\n          \n        } else {\n        // Add/Remove class to avoid margin mistake\n          newsletterRulesElm.classList.remove('is-hidden')\n          newsletterRulesElm.removeAttribute('hidden')\n        } \n\n        // Used only for first times to get height\n        if (!heightOfNewsletterRule) {\n          newsletterRulesElm.classList.remove('is-hidden')\n          heightOfNewsletterRule = newsletterRulesElm.clientHeight\n          newsletterRulesElm.style.height = 0\n        }\n\n        // Start animation for both check and unchecked\n        TweenLite.fromTo(newsletterRulesElm, (isChecked ? 1 : .4),\n          { autoAlpha: isChecked ? 0 : .5, height: isChecked ? 0 : heightOfNewsletterRule },\n          { autoAlpha: isChecked ? 1 : .0, height: isChecked ? heightOfNewsletterRule : 0 }\n        ).eventCallback('onComplete',() => {\n          if (isChecked) {\n            newsletterRulesElm.removeAttribute('hidden')\n          } else {\n            newsletterRulesElm.setAttribute('hidden', '')\n          }\n        })\n      }\n\n      // Stuff for the Newsletter interest\n      getCollection('.gigya-status', el).forEach((elm) => {\n        elm.value = isChecked ? 'INTERESTED' : 'UNSET'\n      })\n\n      const gigyaEmailStatusElm = selectAll('.gigya-status-value', el)\n      gigyaEmailStatusElm.forEach(el => {\n        el.value = isChecked ? 'OPTIN' : 'UNSET'\n      })\n        \n    }\n  }\n  \n  bind(el, 'input#newsletter-subscribe', 'change', handlePreferenceSetting)\n  \n}\n","import bind from 'delegate'\nimport popin from 'modules/popin'\n\nlet binded = false\n\nfunction addressIsValid(e) {\n  const currentPopin = e.target.closest('.popin-wrapper')\n\n  if (!currentPopin) {\n    return\n  }\n\n  const validCallback = currentPopin.data('validCallback')\n\n  if (!validCallback) {\n    return\n  }\n\n  validCallback()\n}\n\nfunction display(params) {\n  // register an event handler  if not already registered\n  if (!binded) {\n    bind(document.body, '.popin [data-is-valid=\"true\"]', 'click', addressIsValid)\n    binded = true\n  }\n\n  // display the popin\n  popin.open(params)\n    .then(data => {\n      const modal = data.modal\n      modal.el.data('validCallback', params.validCallback)\n      modal.el.setAttribute('role', 'dialog')\n      modal.el.removeAttribute('aria-describedby')\n    })\n}\n\nexport default { display }\n","/* eslint-disable no-new */\nimport Base from 'modules/base'\nimport bind from 'delegate'\nimport {select, selectAll} from 'lib/selectors'\nimport {applePayIsSupported} from 'lib/helpers'\nimport {Manager, OPC_STEP_PROCESS} from 'lib/events'\nimport {getApplePayData, startApplePaySession} from \"../../lib/applepay/applepay-common\";\n\n// Selectors\nconst MODULE_SELECTOR = '[data-page-type=checkout]'\nconst OPC_APPLE_PAY_INPUT_SELECTOR = '.js-applepay-enable'\nconst APPLE_PAY_CTA_SELECTOR = '.js-apple-pay-checkout-btn'\n\nclass ApplePayOPCManager extends Base {\n\n  constructor(el) {\n    super(el)\n    this.el = el\n    this.params = {\n      applePayData: null\n    }\n    this.bindEvents()\n  }\n\n  bindEvents() {\n    bind(this.el, `${APPLE_PAY_CTA_SELECTOR}`, 'click', this.onApplePayCheckoutButtonClicked)\n    window.addEventListener('load', this.onPageLoad)\n    Manager.subscribe(OPC_STEP_PROCESS, this.onOPCStepProcess)\n  }\n\n  /**\n   * This enable ApplePay radio button if ApplePay is supported\n   */\n  renderExpressCheckoutCtas() {\n    if (applePayIsSupported()) {\n      const applePayEl = select(`${OPC_APPLE_PAY_INPUT_SELECTOR}`, this.el)\n      if (applePayEl) {\n        getApplePayData('checkout').then((data) => {\n          this.params.applePayData = data\n          applePayEl.removeAttribute('hidden')\n        })\n      }\n    }\n  }\n\n\n  disablePaymentModes() {\n    const billingForm = select('form[id=\"sopPaymentDetailsForm\"]', this.el)\n    const billingRadioButtonsElm = select('.js-billing-radio-buttons', billingForm)\n    const radioButtonsElm = selectAll('li input', billingRadioButtonsElm)\n\n    radioButtonsElm.forEach(radioElm => {\n      if (!radioElm.checked) {\n        radioElm.disabled = true\n      }\n    })\n  }\n\n  enablePaymentModes() {\n    const billingForm = select('form[id=\"sopPaymentDetailsForm\"]', this.el)\n    const billingRadioButtonsElm = select('.js-billing-radio-buttons', billingForm)\n    const radioButtonsElm = selectAll('li input', billingRadioButtonsElm)\n\n    radioButtonsElm.forEach(radioElm => {\n      radioElm.disabled = false\n    })\n  }\n\n  updateBillingStep() {\n    const billingForm = select('form[id=\"sopPaymentDetailsForm\"]', this.el)\n    const applePayBlockElm = select('div[id=\"applePay-method\"]', billingForm)\n    const placeOrderBlockElm = select('[id=\"apple-pay-payment\"]', billingForm)\n\n    // Hide ApplePayBlock, display order block and disable the unchecked input\n    applePayBlockElm.classList.add('is-hidden')\n    placeOrderBlockElm.classList.remove('is-hidden')\n    this.disablePaymentModes()\n    // Set order button action for apple pay\n    billingForm.action = window.config.webservices.applepay.placeOrder\n  }\n\n  onPageLoad = () => {\n    this.renderExpressCheckoutCtas()\n  }\n\n  /**\n   * Triggered once Each OPC step is activated\n   */\n  onOPCStepProcess = () => {\n    this.renderExpressCheckoutCtas()\n  }\n\n  onApplePayCheckoutButtonClicked = (event) => {\n    const shippingInfo = JSON.parse(event.delegateTarget.dataset.cartdata)\n\n    const checkTermCondEl = select('#setTermCondition_applePay')\n    const termCondErrorMsgEl = select('#error-setTermCondition_applePay')\n    const labeltermCondition = select('label[for=\"setTermCondition_applePay\"]')\n\n    if (checkTermCondEl && !checkTermCondEl.checked) {\n      if (!termCondErrorMsgEl && labeltermCondition) {\n        const pElem = document.createElement('p')\n        const errorMsg = document.createTextNode(window.config.locales.opc.customError.termsAndCondition)\n        pElem.classList.add('error')\n        pElem.setAttribute('id', 'error-setTermCondition_applePay')\n        pElem.appendChild(errorMsg)\n        labeltermCondition.appendChild(pElem)\n      }\n      return\n    } else {\n      if (termCondErrorMsgEl && labeltermCondition) {\n        labeltermCondition.removeChild(termCondErrorMsgEl)\n      }\n    }\n\n    this.disablePaymentModes()\n\n    if (this.params.applePayData) {\n      shippingInfo.cancelCallback = () => {\n        this.enablePaymentModes()\n      }\n      shippingInfo.placeOrderCallback = () => {\n        let formElm = select('form#sopPaymentDetailsForm')\n        if (formElm) {\n          formElm.action = window.config.webservices.applepay.placeOrder\n          formElm.submit()\n        }\n      }\n      shippingInfo.paymentAuthorizedFailureCallback = (response) => {\n        this.enablePaymentModes()\n        if (response && response.success == false) {\n          if (response.stockStatusFail) {\n            window.location.href = window.config.webservices.cart.cartUrl\n          } else if (response.posStockStatusFail || response.deliveryOptionAvailableFail) {\n            window.location.href = window.config.webservices.checkout.checkoutUrl\n          } else {\n            window.location.href = window.config.webservices.checkout.paymentError\n          }\n        }\n      }\n\n      startApplePaySession(shippingInfo, this.params.applePayData)\n\n    }\n  }\n\n}\n\nfunction initApplePayOPCManager(context = document) {\n  const OPCElm = select(MODULE_SELECTOR, context)\n  if (OPCElm) {\n    new ApplePayOPCManager(OPCElm, 'checkout')\n  }\n}\n\nexport default initApplePayOPCManager\n","import {select, selectAll} from 'lib/selectors'\nimport {focusElement, isWideScreen, tabIndexToZero} from 'lib/helpers'\nimport popin from 'modules/popin'\nimport config from 'lib/config'\nimport * as xhr from 'modules/fetch'\n\n// Selectors\nconst DIALOG_CLOSE_BUTTON_SELECTOR = 'div.yes-no-modal button.popin__close.js-popin-close'\n\n\n\nclass ChangeCountry {\n  constructor(el) {\n    this.el = el\n    this.buttonClose = null\n    this.params = {\n    }\n\n  }\n\n  async init() {\n    let responseData = await xhr.get(config.markets.checkoutUrl)\n\n    if (responseData && responseData.markets) {\n      const markets = responseData.markets\n      responseData.sortedMarketKeys = Object.keys(markets).sort((key1, key2) => {\n        let val1 = markets[key1].label.toUpperCase()\n        let val2 = markets[key2].label.toUpperCase()\n\n        if (val1 == val2) {\n          return 0\n        } else if (val1 > val2) {\n          return 1\n        } else {\n          return -1\n        }\n      })\n    }\n\n    this.data = responseData\n    this.buildTemplate()\n  }\n\n  // templates\n  buildTemplate() {\n    this.template =\n      `<div class=\"popin-text text-center\" data-close-label=\"${window.config.locales.opc.countryChange.closeChangeDeliveryCountry}\" data-test=\"secChangeDeliveryCountryPopin\">\n        <div class=\"modal-body\">\n          <form id=\"changeDeliveryCountryForm\" novalidate=\"true\" method=\"\" action=\"\">\n            <p id=\"title-change-delivery-country\" class=\"heading is-5\" role=\"heading\" aria-level=\"1\">\n              ${window.config.locales.opc.countryChange.deliveryCountry}\n            </p>\n            <p class=\"sub-heading\">${window.config.locales.opc.countryChange.currentlyOnlineBoutique.replace('{0}', '<strong>' + this.data.current.name + '</strong>')} </p>\n            <p>${window.config.locales.opc.countryChange.changeLocationDescription}</p>\n            <div class=\"field\" data-id=\"\">  \n              <div class=\"js-label-input has-select is-ready\">\n              <label class='heading is-7 text-center title-language' for=\"market-selection\" data-test=\"lblChangeYourLocation\">${window.config.locales.opc.countryChange.changeYourLocation}</label>\n              `+ this.marketSelectTemplate() + `\n              </div>\n            </div>\n            <p class=\"product-message\">${window.config.locales.opc.countryChange.cartMessage}</p>\n            <div class=\"button__wrapper\">\n                  <button type=\"submit\" class=\"button is-primary validate\" data-test=\"btnLanguageSubmit\">\n                    <span class=\"button__wrapper\">\n                      <span class=\"label\">${window.config.locales.opc.countryChange.submit}</span>\n                    </span>\n                  </button>\n            </div>\n          </form>\n        </div>\n      </div>`\n  }\n\n  createSelectBox() {\n    const el = document.createElement('select')\n    el.classList.add('selectbox__input')\n    el.classList.add('is-simple')\n    el.classList.add('select-country-focus')\n    el.setAttribute('data-test', 'drdwnChangeCountry')\n    el.setAttribute('required', 'true')\n    return el\n  }\n\n  marketSelectTemplate() {\n    const el = this.createSelectBox()\n    el.id = \"market-selection\"\n    this.populateMarkets(el, true)\n    const html = this.setNiceSelectTemplate(el)\n    return html\n  }\n\n  populateMarkets(marketSelection, firstLoad = false) {\n    // remove initial content\n    while (marketSelection.firstChild) {\n      marketSelection.removeChild(marketSelection.firstChild)\n    }\n\n    let markets = this.data.markets\n\n    //Default select country option\n    var option = document.createElement('option')\n    option.innerText = `${window.config.locales.opc.countryChange.defaultOption}`\n    option.value = \"\"\n    option.setAttribute('selected', 'selected')\n    marketSelection.append(option)\n    if(this.data.sortedMarketKeys) {\n      this.data.sortedMarketKeys.forEach((marketKey) => {\n        var option = document.createElement('option')\n        option.innerText = markets[marketKey].label\n        option.value = marketKey\n        marketSelection.append(option)\n      })\n    }\n  }\n  setNiceSelectTemplate(el) {\n    const html = `<span class=\"selectbox is-simple is-ready has-content i18n is-using-keyboard\">\n                  `+ el.outerHTML + `\n                  <span class=\"selectbox__wrapper\" aria-hidden=\"true\">\n                    <span></span>\n                  </span>\n                  <svg data-test=\"\" class=\"icon is-small  is-dropdown\" focusable=\"false\" viewBox=\"0 0 1 1\" aria-hidden=\"true\">\n                    <use xlink:href=\"${config.paths.icons}icons.svg${config.targetVersion}#dropdown\"></use>\n                  </svg>\n                </span>`\n    return html\n  }\n  onOpenPopin() {\n    this.setDomElements()\n  }\n\n  setDomElements() {\n    this.popinEl = select('.changeCountry')\n    this.buttonClose = select('.js-popin-close', this.popinEl)\n    this.marketSelection = select('#market-selection', this.popinEl)\n    this.buttonValidate = select('button.validate', this.popinEl)\n    this.form = select('form', this.popinEl)\n    this.marketSelection.addEventListener('change', this.onChangeMarket.bind(this))\n    this.productMessage = select('.product-message', this.popinEl)\n    this.productMessage.setAttribute('hidden','')\n    this.buttonValidate.addEventListener('click', this.onValidate.bind(this))\n  }\n\n  onValidate(event) {\n    if (this.data.markets[this.marketSelection.value].isFallback) {\n      event.preventDefault();\n      window.location.href = this.data.markets[this.marketSelection.value].url\n    }\n  }\n\n  onChangeMarket(e) {\n    let selectedMarket = e.target.value\n    selectedMarket && this.data.markets[selectedMarket].isFallback ? this.productMessage.removeAttribute('hidden') : this.productMessage.setAttribute('hidden', '')\n    if(selectedMarket && this.data.markets[selectedMarket].url){\n      this.formUrl = this.data.markets[selectedMarket].url\n      this.form.setAttribute(\"method\", \"POST\")\n      this.form.setAttribute(\"action\", this.formUrl)\n    }   \n  }\n\n  /**\n   * display a yes(remove) or no(cancel) dialog\n   * @param data {Object}: contains additional params\n   */\n  open() {\n    popin.open({\n      html: this.template,\n      role: 'dialog',\n      modifiers: 'is-relative changeCountry',\n      opener: null,\n      manageFocus: true,\n      forceInert: true,\n      modal: true,\n      action: 'removeCancelModal',\n      outerClose: false\n    }).then(() => {\n      this.onOpenPopin()\n    })\n    // To catch the esc key\n    window.addEventListener('keydown', this.onEscapeKeyClicked)\n  }\n\n  /**\n   * Close the active modal\n   */\n  closeModal() {\n    window.removeEventListener('keydown', this.onEscapeKeyClicked)\n    popin.hide()\n  }\n\n  /**\n   * Triggered once user clicked on the modal cancel button\n   * @param params {MouseEvent}: contains MouseEvent parameters\n   */\n  onModalCancelButtonClicked = (e) => {\n    this.closeModal()\n    focusElement(this.params.clickedElm)\n    if (!isWideScreen()) {\n      const links = selectAll('.collapse-panel__header .js-collapse-button')\n      if (links) {\n        tabIndexToZero(links)\n      }\n    }\n  }\n\n\n  /**\n   * Triggered once user clicked on keyboard inputs\n   * @param e {MouseEvent}: MouseEvent parameters \n   */\n  onEscapeKeyClicked = (e) => {\n    if ((e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27)) {\n      this.onModalCancelButtonClicked(e)\n    }\n  }\n\n}\n\n\nconst initChangeCountry = () => {\n  const changeCountry = new ChangeCountry()\n  changeCountry.init().then(() => {\n    changeCountry.open()\n  })\n}\n\nexport default initChangeCountry","import { getCollection, select, closest } from \"lib/selectors\"\nimport { isMobileScreen, removeElement, focusElement} from 'lib/helpers'\nimport bind from 'delegate'\nimport config from \"lib/config\"\nimport flatpickr from \"flatpickr\"\n\n(async () => {\n  try {\n    const { flatpickrLocale } = await import(`flatpickr/dist/l10n/${config.currentLanguage.split('_')[0]}.js`)\n    console.log(`${config.currentLanguage.split('_')[0]} calendar translations loaded`)\n  }\n  catch(err) {\n    console.log('file does not exist')\n  }\n})();\n\nconst COUNTRY_SELECTED = config.currentLanguage.split('_')[0]\nconst DATE_CONTAINER = '.js-date-container'\nconst INPUT_FIELD = '.js-select-date-input'\nconst SUBMIT_BTN = '.js-date-select-submit'\n\nclass dateSelection {\n  constructor() {\n\tthis.el = document.body\t\t\n\tthis.events = []\n\tthis.dateContainer = select(DATE_CONTAINER, this.el)\n\tif (this.dateContainer) {\n\t\tthis.dateContainer.innerHTML = ''\n    }\n\tflatpickr.localize(flatpickr.l10ns[COUNTRY_SELECTED])\n\tthis.bindEvents()\n  }\n  initializeCalendar(dateControl) {\n    let startDate, endDate, calendarContainer, inputControl, defaultDate, disable\n    if (isMobileScreen()) {\n    \tcalendarContainer = select(\".js-calendar-overlay-mobile\", document.body)\n    } else {\n    \tcalendarContainer = select(\".js-calendar-container\", dateControl)\n    }\n  \n    inputControl = select(\".js-select-date-input\", dateControl)\n    defaultDate = inputControl.getAttribute(\"data-defaultDate\")\n    startDate = inputControl.getAttribute(\"data-startDate\")\n    endDate = inputControl.getAttribute(\"data-endDate\")\n    self = this\n    this.events.push(bind(this.el, INPUT_FIELD, 'input', (event) => this.onInput(inputControl, event)))\n    this.events.push(bind(this.el, INPUT_FIELD, 'keydown', (event) => this.onKeydown(event)))\n    if (COUNTRY_SELECTED == 'ko') {\n      disable= [\n        function(date) {\n            return (date.getDay() === 0);\n        }\n      ]\n    }\n    this.CalendarInstance = flatpickr(dateControl, {\n      minDate: startDate,\n      maxDate: endDate,\n      defaultDate: defaultDate,\n      clickOpens: false,\n      appendTo: calendarContainer,\n      allowInput:true,\n      wrap: true,\n      disableMobile: \"true\",\n      ...(disable != null && disable != undefined) && {disable: disable},\n      onChange: function (selectedDates, dateStr, instance) {\n    \tself.cleanErrors(instance.input)\n\t\tlet date = selectedDates[0];\n\t\tdate.setHours(12);\n\t\tselect(\".delivery_slot_date\", dateControl).value = date.getTime();\n\t\tif (isMobileScreen()) {\n\t\t\tcalendarContainer.setAttribute(\"hidden\",\"\")\n\t\t}\n\t\tdocument.body.classList.remove(\"has-modal\")\n      },\n      onOpen: function (selectedDates, dateStr, instance) {\n\t\t  if (isMobileScreen()){\n\t\t\t  calendarContainer.removeAttribute(\"hidden\")\n\t\t\t  removeElement(\".flatpickr-close-btn\",instance.calendarContainer)\n\t    \t  let closeBtn = document.createElement(\"span\")\n\t    \t  closeBtn.innerHTML = `<svg class=\"icon is-medium is-close \" viewBox=\"0 0 1 1\" aria-hidden=\"true\">\n\t              <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${config.paths.icons}icons.svg${config.targetVersion}#close\"></use>\n\t              </svg>`\n\t    \t\t  \n\t    \t  closeBtn.classList.add(\"flatpickr-close-btn\")\n\t    \t  let svg = select(\"svg\", closeBtn)\n\t    \t  svg.addEventListener('click', function(e){\n\t    \t\t  e.preventDefault()\n\t    \t\t  e.stopPropagation()\n\t    \t\t  instance.close()\n\t    \t  })\n\t    \t  instance.calendarContainer.appendChild(closeBtn)\n\t    \t  instance.calendarContainer.setAttribute(\"role\",\"dialog\")\n\t    \t  instance.calendarContainer.setAttribute(\"aria-label\",\"Calendar\")\n\t    \t  document.body.classList.add(\"has-modal\")\n\t\t  }\n      },\n      onClose: function () {\n    \t  if (isMobileScreen()){\n    \t\t  calendarContainer.setAttribute(\"hidden\",\"\")\n    \t\t  document.body.classList.remove(\"has-modal\")\n    \t  }\n      }\n    });\n  } \n  bindEvents() {\n    let self = this;\n    this.dateControl = getCollection(\".delivery-method-calendar\")\n    this.dateControl.forEach(function (calendar, i) {\n    \tself.initializeCalendar(calendar)\n    });\n  }\n  \n  checkDateRange(inputControl) {\n\tif(inputControl.value == \"\") {\n\t\tthis.createErrorMessage(inputControl,window.config.dl.opc.deliveryMethod.errors.emptyDate)\n\t\treturn false\n\t}\n\tlet startDate = new Date(inputControl.getAttribute('data-startDate'))\n\tlet endDate = new Date(inputControl.getAttribute('data-endDate'))\n\tlet selectedDate = new Date(inputControl.value)\n\tstartDate.setHours(12)\n\tendDate.setHours(12)\n\tselectedDate.setHours(12)\n\t\n\tif(this.checkValidDate(inputControl)){\n\t\tif(selectedDate.getTime() >= startDate.getTime() && selectedDate.getTime() <= endDate.getTime()){\n\t\t\tthis.cleanErrors(inputControl)\n\t\t\treturn selectedDate.getTime()\n\t\t} else{\n\t\t\tthis.createErrorMessage(inputControl,window.config.dl.opc.deliveryMethod.errors.unavailableDate)\n\t\t\treturn false\n\t\t}\n\t}else{\n\t\treturn false\n\t}\n  }\n  \n  checkValidDate(dateControl) {\n    const inputValue = dateControl.value.split('-').map((v) => parseInt(v.replace(/\\D/g, '')))\n    if (dateControl.value.match(/^\\d{4}\\-\\d{1,2}\\-\\d{1,2}$/)) {\n      this.cleanErrors(dateControl)\n      return true\n    } else {\n      this.createErrorMessage(dateControl, window.config.dl.opc.deliveryMethod.errors.inValidDate)\n      return false\n    }\n  }\n  \n  createErrorMessage(domElement, message) {\n    this.cleanErrors(domElement)\n    const elem = document.createElement('p')\n    const errorMsg = document.createTextNode(message)\n    const parent = domElement.parentNode\n    parent.classList.add('has-errors')\n    elem.classList.add('error')\n    elem.setAttribute('id', 'error-date')\n    elem.dataset.errorMessage = 'true'\n    elem.appendChild(errorMsg)\n    elem.setAttribute('data-test', 'data-test=\"lblDateErrormsg\"')\n    parent.parentNode.appendChild(elem)\n    domElement.setAttribute('aria-describedby', 'error-date')\n    focusElement(domElement, { notChangeTabIndex: true, caretAtTheEnd: false })\n    domElement.removeAttribute('tabindex')\n    return elem\n  }\n  \n  cleanErrors(element) {\n\telement = element.parentNode.parentNode\n    const hasErrorClasses = getCollection('.has-errors', element)\n    const errorMessages = getCollection('.error', element)\n    for (let i = 0; i < hasErrorClasses.length; i++) {\n      hasErrorClasses[i].classList.remove('has-errors')\n    }\n    for (let i = 0; i < errorMessages.length; i++) {\n      errorMessages[i].parentNode.removeChild(errorMessages[i])\n    }\n    element.removeAttribute('aria-describedby')\n  }\n\n  onKeydown(event) {\n    if (this.CalendarInstance.isOpen && (event.keyCode == 37 || event.keyCode == 38 || event.keyCode == 39 || event.keyCode == 40 || event.keyCode == 13)) {\n      event.stopPropagation()\n    }\n  }\n  onInput(dateInputSelector, event) {\n\tconst isInputCharacter = event.inputType === 'deleteContentForward' || event.inputType === 'deleteContentBackward'\n    if (!isInputCharacter && (dateInputSelector.value.match(/^\\d{4}$/) || dateInputSelector.value.match(/^\\d{4}\\-\\d{2}$/))) {\n      dateInputSelector.value += '-'\n    }\n    const startPos = dateInputSelector.selectionStart\n    let cursorPosition = startPos\n    dateInputSelector.classList.toggle('is-filled', dateInputSelector.value.length > 0)\n    const regex = /^[0-9-]/\n    const values = dateInputSelector.value.split().map((v) => {\n      if (!regex.test(dateInputSelector.value[startPos - 1])) {\n        cursorPosition = startPos - 1\n      }\n      return v.replace(/[^0-9\\-]/g, '')\n    })\n    dateInputSelector.value = values.join('')\n    if (cursorPosition === -1) cursorPosition++\n    dateInputSelector.setSelectionRange(cursorPosition, cursorPosition)\n  }\n}\n\nexport default dateSelection\n","import config from 'lib/config'\nimport { select, selectAll, getCollection } from 'lib/selectors'\n\nfunction hilightCreditCard(e) {\n  let isValidCardSupport\n  const creditCardInput = e.delegateTarget\n  const form = creditCardInput.closest('form')\n  const submitBtn = select('button[type=\"submit\"]', form)\n  const inputField = creditCardInput.closest('.field')\n  const cardIconList = select('.js-bank-icons')\n  const role = select('[aria-live=\"assertive\"]', form)\n  const cardSupportErr = select('.js-cardNumber-error')\n  const cardCVNTootip = select('#tooltip-card_cvn')\n  const amexTooltip = select('.amex-tooltip')\n  const otherTooltip = select('.other-tooltip')\n  \n  \n  let creditCardInputFourDigit\n\n  if (creditCardInput) {\n    creditCardInputFourDigit = creditCardInput.value.split('', 4).join('')\n  }\n\n  if (creditCardInputFourDigit.length === 4) {\n    const dataRegex = selectAll('.js-bank-icons [data-regex]')\n    const regexList = dataRegex.filter(reg => reg.dataset.regex.length > 0)\n\n    const cardTypeEl = select('#selectCreditCardType')\n    if (cardTypeEl) {\n      cardTypeEl.removeAttribute('data-cardIcon-value')\n    }\n    getCollection('.supported-card').forEach(card => {\n      card.classList.remove('supported-card')\n    })\n    regexList.forEach(regex => {\n      const fourDigitRegex = regex.dataset.regex.replace(RegExp(/{[0-9]}|{[0-9][0-9]}{1,}/g), '{0,}')\n\n      if (RegExp(fourDigitRegex).test(creditCardInputFourDigit)) {\n        highlightIcon(regex.id)\n      }\n    })\n    handleErr()\n  } else {\n    undoHighlight()\n  }\n\n  function highlightIcon(regex) {\n    let cardName\n    let cardNameId\n    const supportedCard = select(`li#${regex} .bank-icon`)\n    const cardTypeEl = select('#selectCreditCardType')\n\n    if (select(`li#${regex}`)) {\n      cardName = select(`li#${regex}`).dataset.cardName\n      cardNameId = select(`li#${regex}`).getAttribute('id')\n    }\n    if (cardIconList && supportedCard) {\n      if (cardCVNTootip) {\n    \tconst tooltipBtn = select('button', cardCVNTootip) \n    \tif (tooltipBtn) {\n          if (supportedCard.classList.contains('is-American')) {\n    \t    tooltipBtn.setAttribute('data-tooltip', amexTooltip.innerHTML)          \n    \t  }\n          else {\n            tooltipBtn.setAttribute('data-tooltip', otherTooltip.innerHTML)\n          }\n        }\n      }\n      cardIconList.classList.add('bank-icons--active')\n      supportedCard.classList.add('supported-card')\n      if (cardTypeEl && cardNameId)\n        if (cardTypeEl.getAttribute('data-cardIcon-value')) {\n          cardTypeEl.setAttribute('data-cardIcon-value', cardTypeEl.getAttribute('data-cardIcon-value') + \"|\" + cardNameId)\n        } else {\n          cardTypeEl.setAttribute('data-cardIcon-value', cardNameId)\n        }\n    }\n    if (role && cardName && !role.innerText) {\n      const roleMsg = document.createTextNode(`${config.dl.opc.paymentMethod.selected} ${cardName}`)\n      role.appendChild(roleMsg)\n    }\n  }\n\n  function undoHighlight() {\n    if (cardIconList) {\n      cardIconList.classList.remove('bank-icons--active')\n    }\n    selectAll('.supported-card').forEach(card => {\n      card.classList.remove('supported-card')\n    })\n    if (role) {\n      role.innerText = ''\n    }\n  }\n\n  function handleErr() {\n    isValidCardSupport = selectAll('.js-bank-icons .bank-icon').some(icon => icon.classList.contains('supported-card'))\n    // eslint-disable-next-line\n    !isValidCardSupport ? addErr() : removeErr()\n  }\n\n  function addErr() {\n    if (cardSupportErr) {\n      cardSupportErr.innerText = config.locales.errors.form.global.paymentMethodes.notAccepted\n      cardSupportErr.removeAttribute('role')\n    }\n    if (inputField) {\n      inputField.classList.add('has-error')\n    }\n    if (submitBtn) {\n      submitBtn.setAttribute('aria-disabled', true)\n      submitBtn.addEventListener('click', handleSubmitOrder)\n    }\n  }\n\n  function removeErr() {\n    if (cardSupportErr) {\n      cardSupportErr.innerText = ''\n      cardSupportErr.setAttribute('role', 'presentation')\n    }\n    if (inputField) {\n      inputField.classList.remove('has-error')\n    }\n    if (creditCardInput && cardSupportErr) {\n      creditCardInput.setAttribute('aria-describedby', cardSupportErr.id)\n    }\n    if (submitBtn) {\n      submitBtn.setAttribute('aria-disabled', false)\n      submitBtn.removeEventListener('click', handleSubmitOrder)\n    }\n  }\n}\n\nfunction handleSubmitOrder(e) {\n  e.preventDefault()\n  const creditCardInput = select('[name=\"card_number\"]')\n\n  if (creditCardInput) {\n    creditCardInput.focus()\n  }\n}\n\nexport default hilightCreditCard\n","import { cloneDeep } from \"lodash\";\nimport * as xhr from \"modules/fetch\";\nimport pageTitle from \"modules/pageTitle\";\nimport popin from \"modules/popin\";\nimport { CHECK_RESPONSE, Manager, OPC_STEP_PROCESS, PAGELOAD_WISHLIST, REMOVE_ERROR, TRACKING_HIT } from \"lib/events\";\nimport bind from \"delegate\";\nimport config from \"lib/config\";\nimport inert from \"lib/inert\";\nimport List from \"./list\";\nimport { Promocode, PromocodeToggle } from \"./promocode\";\nimport addressValidation from \"./address-validation\";\nimport ChangeCountry from \"./change-country\";\nimport hilightCreditCard from \"./hilight-credit-card\";\nimport toggleFormAction from \"./toggle-formaction\";\nimport popinResetPassword from \"../account/popinResetPassword\";\nimport popinMergeDecision from \"../account/popinMergeDecision\";\nimport preferenceSetting from \"../account/preference-setting\";\nimport { getCollection, select, selectAll } from \"lib/selectors\";\nimport deliveryMethodCalendar from \"./delivery-method-calender\";\nimport \"lib/helpers/fit-text\";\nimport { addToJson, applePayIsSupported, focusElement, handlePopState, isLocalStorage, isMobileScreen, isWideScreen, isSafari, initGoogleMap, trimNumber, getOS, isTabletScreen, isWeChatBrowser } from \"lib/helpers\";\nimport initApplePayOPCManager from \"./applePayOPCManager\";\nimport zipCodeVariation from \"../account/zip-code-variation\";\nimport { sha256 } from \"js-sha256\";\nimport * as MobilePhoneValidation from \"../../config/mobile-phone-validation\";\nimport initToshiDetails from \"../../modules/toshi-module\";\nimport initThreeDS2Popin from \"./threeDS2-popin\";\nimport initWechatPayQrAdyenPopin from \"./wechatpayQR-adyen\";\nimport { read as readCookie } from \"modules/cookie\";\nimport { pushCheckoutMonetateData } from \"../../ui/monetate\";\nimport sidePanel from 'modules/sidepanel';\nimport notifier from 'modules/notifier';\n/* eslint-disable consistent-return */\n\nconst GIGYA_WRAPPER_ID = \"gigya-wrapper\";\nconst HIDDEN_CLASSNAME = \"is-hidden\";\nconst DISABLED_FIELDS = [\"card_cvn\", \"card_number\"];\nconst DISABLED_FIELDS_GMO = [\"card_cvn\", \"tokennumber\", \"card_number\"];\nconst GUEST_EMAIL = \"guest-email\";\nconst LOGIN_EMAIL = \"login-email\";\nconst EMPLOYEE_SAVINGS = \".js-employee-savings\";\nconst SHIPPING_ADDRESS_FORM_SELECTOR = \"form[id=addressForm]\";\nconst DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR = \"button.is-tertiary.js-popin-close\";\nconst gigyaRegisterForm = select(\"#gigya-register-form\");\nconst ADDRESS_TOWN_MOBILE_SELECTOR = \".js-address-line1\";\nconst ADDRESS_MOBILE_SELECTOR = \".js-autocomplete-mobile\";\nconst EXPERIAN_AUTOCOMPLETE_SELECTOR = \".experian-autocomplete\";\nconst PRECISELY_AUTOCOMPLETE_SELECTOR = \".precisely-autocomplete\";\nconst COUNTRY_SELECTED = config.country.toLowerCase()\nconst countryCodes = {gb:\"+44 (GB)\", ca:\"+1 (CA)\", au:\"+61 (AU)\"} \nlet dataLayerProductData;\nlet deliveryCalendar =\"\";\nlet isMobile = isMobileScreen();\nlet isSendDataToLoggedInUser = false;\nlet paymentSubmitted = false;\nlet newForm = null\n\nconst countryCode = countryCodes[COUNTRY_SELECTED]\n\nfunction OPC(el) {\n  if (config.country.toUpperCase() === 'CN') {\n    import('../account/cn-address').then((module) => {\n      module.default.init()\n    })\n    import(/* webpackChunkName: \"chinaPaymentFlow\" */'./china-payment').then((module) => {\n      module.default.init()\n    })\n  }\n  const steps = {\n    step1: {\n      el: el.querySelector(\".step1\"),\n    },\n    step2: {\n      el: el.querySelector(\".step2\"),\n    },\n    step3: {\n      el: el.querySelector(\".step3\"),\n    },\n    cart_data: {\n      el: el.querySelector(\".cart-product-list\"),\n    },\n    cart_total: {\n      el: el.querySelector(\".cart-prices\"),\n    },\n    cart_wrapping: {\n      el: el.querySelector(\".cart-wrapping\"),\n    },\n    gift_message: {\n      el: el.querySelector(\".cart-gift-message\"),\n    },\n    payment_modes_opc: {\n      el: el.querySelector(\".payment-modes-opc\"),\n    },\n  };\n\n  const formErrorMapping = {\n    'gigya-register-form':'REGISTER',\n    'gigya-login-form' : 'LOGIN',\n    'chanelGuestForm':'Guest LOGIN',\n    'addressForm' : 'SHIPPING',\n    'applyVoucherForm' : 'SHIPPING',\n    'selectDeliveryMethodForm':'Delivery methods (SHIPPING)',\n    'sopPaymentDetailsForm':'BILLING'\n  }\n\n  let guestEmail = \"\";\n  let loginEmail = \"\";\n\n  function enableSubmitBtns() {\n    selectAll(\".js-disabled-btn\").forEach((btn) => {\n      btn.removeAttribute(\"disabled\");\n      btn.classList.remove(\"disabled-btn\");\n    });\n  }\n\n  toggleFormAction(el);\n\n  /* let expiringCheckoutTimestamp = readCookie('expiringCheckoutTimestamp')\n  const checkoutStockReserveTimerEl = el.querySelector('.js-timer')\n  if (checkoutStockReserveTimerEl) {\n    const checkoutStockReserveTimer = checkoutStockReserveTimerEl.getAttribute('data-timer')\n    if (!expiringCheckoutTimestamp || readCookie('lastVisitedPage') !== window.location.href) {\n      expiringCheckoutTimestamp = Date.now() + parseInt(checkoutStockReserveTimer, 10)\n      document.cookie = `expiringCheckoutTimestamp=${expiringCheckoutTimestamp}`\n      document.cookie = `lastVisitedPage=${window.location.href}`\n    }\n  } */\n\n  // startTimer()\n  const popinResetPasswordHandler = popinResetPassword();\n  const popinMergeDecisionHandler = popinMergeDecision();\n\n  /* function startTimer() {\n    if (!checkoutStockReserveTimerEl) {\n      return\n    }\n    setTimeout(() => {\n      displayTimeoutAlert()\n    }, expiringCheckoutTimestamp - Date.now())\n  }\n  function displayTimeoutAlert() {\n    removeCookie('expiringCheckoutTimestamp')\n    stockReleaseRequest()\n  }\n  function stockReleaseRequest() {\n    xhr.get(config.webservices.checkout.stockRelease)\n      .then(data => displayError(data))\n      .catch(data => {\n        if (data.statusCode === 422) {\n          displayError(data)\n        } else {\n          console.error(data)\n        }\n      })\n  }\n  function stockReleaseBeforeUnload() {\n    stockReleaseRequest()\n  } */\n  let currentTrackingStep;\n\n  var isCncDeliveryMode = typeof isCncDeliveryModeSelected === 'undefined' ? false : isCncDeliveryModeSelected;\n\n  function animateStep({ step, newStep, newHeight, done }) {\n    const revealNewStep = () => {\n      step.el.innerHTML = newStep.innerHTML;\n      Manager.publish(\"bindDom\", step.el);\n\n      if (!step.el.children[1]) {\n        return;\n      }\n      TweenLite.fromTo(\n        step.el.children[1],\n        0.2,\n        {\n          opacity: 0,\n        },\n        {\n          opacity: 1,\n          onComplete: () => {\n            TweenLite.set(step.el.children[1], { clearProps: \"all\" });\n          },\n        }\n      );\n    };\n\n    TweenLite.fromTo(\n      step.el,\n      0.5,\n      {\n        css: {\n          height: step.height,\n        },\n      },\n      {\n        css: {\n          height: newHeight,\n        },\n        onComplete: () => {\n          TweenLite.set(step.el, { clearProps: \"all\" });\n          step.el.removeAttribute(\"style\");\n          done();\n        },\n      }\n    );\n\n    if (step.el.children[1]) {\n      TweenLite.to(step.el.children[1], 0.2, {\n        css: {\n          opacity: 0,\n        },\n        onComplete: revealNewStep,\n      });\n    } else {\n      revealNewStep();\n    }\n    zipCodeVariation();\n    updateInputs();\n  }\n\n  function bindSelectionItems() {\n    List(el);\n    window.addEventListener(\"DOMContentLoaded\", initGoogleMap())\n  }\n\n\n  function displayError(data, form) {\n    if (form) {\n      if (Object.keys(formErrorMapping).includes(form.id)) {\n        dataLayer.push({\n          'eventCategory': formErrorMapping[form.id],\n          'eventAction': 'error',\n          'eventLabel': 'responseError_' + form.id,\n          'event': 'nievent'\n        })\n      }\n    }\n\n    if (data.modal && form) {\n      addressValidation.display({\n        html: data.modal,\n        modifiers: 'adress-validation',\n        outerClose: false,\n        form,\n        opener: form.querySelector('[type=\"submit\"]'),\n        validCallback: () => {\n          submitStepForm(form);\n        },\n      });\n    } else if (data.modal && !form) {\n      popin\n        .open({\n          label: data.label,\n          html: data.modal,\n          role: \"dialog\",\n          opener: null,\n          manageFocus: false,\n          forceInert: true,\n          outerClose: false,\n          modal: true,\n        })\n        .then((modal) => {\n          const message = modal.el.querySelector(\"p\");\n          if (message) {\n            focusElement(message);\n          }\n        });\n    } else if (!data.fields && !data.formError) {\n      const input = select(\"[data-phone-pattern]\");\n      if (!isCncDeliveryMode && input.value == \"\") {\n          MobilePhoneValidation.sampleErrorMsg(input);\n      } else if (data.resultCode !== \"000\") {\n        const payload = {\n          data: { formError: window.config.locales.errors.form.global.billing.base },\n          form: form,\n        };\n        Manager.publish(CHECK_RESPONSE, payload);\n      } else {\n        console.error(\"Something went wrong with the request\", data);\n      }\n    } else if (data.fields) {\n      const payload = {\n        data: data,\n        form: form,\n      };\n      Manager.publish(CHECK_RESPONSE, payload);\n    }\n\n    return data;\n  }\n\n  function enableAllElements(form) {\n    Array.prototype.forEach.call(form.elements, (element) => {\n      element.removeAttribute(\"disabled\");\n    });\n  }\n\n  if (gigyaRegisterForm) {\n    preferenceSetting(el);\n  }\n\n  function focusInteractiveStep(container) {\n    if (!container) {\n      const stepForm = el.querySelector(\"form\");\n      let step;\n\n      if (stepForm) {\n        step = stepForm.closest(\"[class^=step]\");\n        step ? (container = step.querySelector(`.js-step-display:not(.${HIDDEN_CLASSNAME})`)) : (container = null);\n\n        if (!container) {\n          container = step;\n        }\n      }\n    }\n\n    if (container) {\n      const heading = container.querySelector(\".heading\");\n      const POSElementHeading = container.querySelector(\".POSElementHeading\");\n      const focusFirstErrorElement = select('input[aria-describedby=\"addressError\"]');\n      const boutiqueName = container.querySelector(\".selectedBoutiqueName\");\n\n      if (heading) {\n        focusElement(heading);\n        if (POSElementHeading) {\n          focusElement(POSElementHeading);\n        }\n        if (focusFirstErrorElement) {\n          focusElement(focusFirstErrorElement);\n        }\n        if (boutiqueName) {\n          focusElement(boutiqueName);\n        }\n        return heading;\n      }\n    }\n\n    return null;\n  }\n\n  function handleBillingAddressForm(e) {\n    const checkbox = e.delegateTarget;\n    const show = !checkbox.checked;\n    const formFieldset = document.getElementById(checkbox.dataset.formToggleDisplay);\n\n    if (!formFieldset) {\n      return;\n    }\n    checkbox.setAttribute(\"checked\", !show);\n    const setUseDeliveryAddressEl = select(\"#useDeliveryAddress\");\n    if (setUseDeliveryAddressEl) {\n      setUseDeliveryAddressEl.removeAttribute(\"required\");\n      setUseDeliveryAddressEl.setAttribute(\"aria-required\", false);\n    }\n    const setBillToBusinessAddressEl = select(\"#billToBusinessAddress\");\n    if (setBillToBusinessAddressEl) {\n      setBillToBusinessAddressEl.removeAttribute(\"required\");\n      setBillToBusinessAddressEl.setAttribute(\"aria-required\", false);\n    }\n    const setAddressLine2 = select('input[name=\"billTo_street2\"]');\n    if (setAddressLine2) {\n      setAddressLine2.removeAttribute(\"required\");\n      setAddressLine2.setAttribute(\"aria-required\", false);\n    }\n\n    enableSubmitBtns();\n    // we add custom event triggering the country change and emptying the address fields\n    const COUNTRY_SELECT = '.is-myaccount-select > select[name=\"countryIso\"]';\n    const selectorCountry = select(COUNTRY_SELECT, document.body);\n    const dispatchCapAddress = new window.CustomEvent(\"change\", {\n      detail: { isOpc: true },\n    });\n\n    Array.prototype.forEach.call(formFieldset.querySelectorAll(\"input, select, textarea\"), (field) => {\n      let type = field.tagName === \"SELECT\" ? \"select\" : \"input\";\n      let name = field.name;\n      if (field.tagName === \"INPUT\") {\n        type = field.type;\n      }\n\n      // store and remove the current value of the fields so the user can add its own\n      if (show) {\n        if ((config.country.toLowerCase() === \"gb\" || config.country.toLowerCase() === \"ru\") && (field.id === \"address.line1-mobile\")) {\n          let addValue = select(`${ADDRESS_MOBILE_SELECTOR} button${ADDRESS_TOWN_MOBILE_SELECTOR} span.js-button-value`);\n          let emptyAddressContainer = select(`${EXPERIAN_AUTOCOMPLETE_SELECTOR, PRECISELY_AUTOCOMPLETE_SELECTOR}`);\n          if (addValue) {\n            addValue.innerHTML = \"\";\n          }\n          field.setAttribute(\"aria-required\", \"true\");\n          field.setAttribute(\"ariaRequired\", \"true\");\n          if (emptyAddressContainer) {\n            if (emptyAddressContainer.classList.contains(\"has-content\") && field.value === \"\") {\n              emptyAddressContainer.classList.remove(\"has-content\");\n            }\n          }\n          if (getOS() == \"iOS\") {\n            const checkbox = select('input[id=\"useDeliveryAddressEU\"]');\n            checkbox ? focusElement(checkbox, { notChangeTabIndex: true }) : \"\";\n          }\n        }\n\n        if ((type === \"checkbox\" || type === \"radio\") && name !== \"addressId\") {\n          field.data(\"checked\", field.checked);\n          field.checked = false;\n        } else {\n          if (field.id !== \"address.line2\") {\n            field.setAttribute(\"required\", true);\n            field.setAttribute(\"aria-required\", true);\n          }\n          if(config.country.toLowerCase() === \"ru\") {\n              if(field.id === \"address.complemenatry\") {\n                field.removeAttribute('required');\n                field.removeAttribute('aria-required');\n              }\n              if(field.id === \"address.postcode\") {\n                field.removeAttribute('required');\n\t\t            field.removeAttribute('aria-required');\n\t\t           }\n          }\n          if (\n            field.id !== \"bill_to_address_country\" &&\n            field.id !== \"address.countryIso\" &&\n            field.id !== \"add-address-countryCode-screens\" &&\n            field.id !== \"phoneCountryCodeHidden\" &&\n            name !== \"addressId\" &&\n            field.id !== \"countryIso\"\n          ) {\n            field.value = field.data(\"value\", field.value) || \"\";\n          }\n          if(config.country.toLowerCase() === \"ca\" && field.id === \"address.phone\") {\n            removeRequiredAttribute(field)\n          }\n        }\n      } else if ((type === \"checkbox\" || type === \"radio\") && name !== \"addressId\") {\n        field.checked = field.data(\"checked\") || false;\n        field.data(\"checked\", \"\");\n        type === \"radio\" ? (field.checked = false) : null;\n      } else {\n        field.removeAttribute(\"required\");\n        field.setAttribute(\"aria-required\", false);\n        if (\n          field.id !== \"bill_to_address_country\" &&\n          field.id !== \"address.countryIso\" &&\n          field.id !== \"add-address-countryCode-screens\" &&\n          field.id !== \"phoneCountryCodeHidden\" &&\n          name !== \"addressId\" &&\n          field.id !== \"countryIso\"\n        ) {\n          field.value = field.data(\"value\", field.value) || \"\";\n        }\n      }\n\n      //Setting default country code for GB\n      if ((config.country.toLowerCase() === \"gb\" || config.country.toLowerCase() === \"ca\") && field.id === \"pos_countryCode\") {\n        let phoneCCodeEle = select(\"span\", select(\".selectbox__wrapper.phone_selectbox\"));\n        let countryCodeOpcEle = select(\"#pos_countryCode\");\n        let countryCodesOption = getCollection(\"#pos_countryCode option\");\n        if (phoneCCodeEle) {\n          phoneCCodeEle.innerHTML = countryCode;\n          countryCodeOpcEle.parentElement.classList.add(\"has-content\");\n          countryCodeOpcEle.parentElement.parentElement.classList.add(\"has-content\");\n          phoneCCodeEle.classList.add(\"is-focusable\");\n          countryCodeOpcEle.classList.add(\"has-content\");\n        }\n        countryCodesOption.forEach((code, index) => {\n          var att = document.createAttribute(\"selected\");\n          att.value = \"selected\";\n          if (code.innerHTML == countryCode) {\n            code.setAttributeNode(att);\n            countryCodeOpcEle.selectedIndex = index;\n          } else {\n            code.removeAttribute(\"selected\");\n          }\n        });\n      }\n    });\n  }\n\n  function removeRequiredAttribute(field){\n    field.removeAttribute('required')\n    field.removeAttribute('aria-required')\n  }\n\n  function handleFinalStep(form) {\n    const signature = form.elements.signature;\n    const pspProvider = form.elements.pspProvider;\n    const hasSignature = signature && !signature.disabled;\n    if (pspProvider && pspProvider.value === \"GMO\" && hasSignature) {\n      const cardno = document.getElementById(\"cardNumber\").value;\n      let expiryMonth = document.getElementById(\"expiration-month\").value;\n      const ExpiryYear = document.getElementById(\"expiration-year\").value;\n      if (expiryMonth.length === 1) {\n        expiryMonth = `0${expiryMonth}`;\n      }\n      const securitycode = document.getElementById(\"card_cvn\").value;\n      const holdername = document.getElementById(\"card_nameOnCard\").value;\n      const tokennumber = document.getElementById(\"tokennumber\").value;\n      const apiKey = config.webservices.gmo.apiKey;\n      window.Multipayment.init(apiKey);\n\n      const disableFieldsBeforeSend = () => {\n        DISABLED_FIELDS_GMO.forEach((name) => {\n          const field = form.elements[name];\n          if (field) {\n            field.removeAttribute(\"name\");\n          }\n        });\n      };\n      let max = Math.ceil(tokennumber / 10);\n      let tokens = [];\n      let i = 1;\n      let callGmoWithLoop = (iterator) => {\n        let tokensNumber = 10;\n        const count = i * 10;\n        if (count > tokennumber) {\n          tokensNumber = tokennumber % 10;\n        }\n        window.Multipayment.getToken({ cardno, expire: `${ExpiryYear}${expiryMonth}`, securitycode, holdername, tokennumber: tokensNumber }, (response) => {\n          if (response.resultCode !== \"000\") {\n            displayError(response, form);\n          } else {\n            tokens.push(response.tokenObject.token);\n            if (i == iterator) {\n              document.getElementById(\"gmoTokens\").value = tokens.join();\n              document.getElementById(\"maskedCardNo\").value = cardno.substr(cardno.length - 4);\n\n              disableFieldsBeforeSend();\n              form.submit();\n              // disabled submit button after order placed\n              buttonClick(form);\n            } else {\n              i++;\n              callGmoWithLoop(iterator);\n            }\n          }\n        });\n      };\n\n      callGmoWithLoop(max);\n    } else {\n      if (paymentSubmitted) {\n        return;\n      }\n      paymentSubmitted = true;\n      if (pspProvider !== undefined && (pspProvider.value === \"Adyen\" || hasSignature)) {\n        // Prevent sending All elements when PayPal selected\n        // enable hidden billing address if the address is set to use the same address\n        enableAllElements(form);\n\n        if (signature.value) {\n          return;\n        }\n\n        selectAll(\".label-input__input\", form).forEach((inputField) => {\n          inputField.value = inputField.value.trim();\n        });\n        //      For ADYEN\n        if (document.getElementById(\"pspProvider\").value === \"Adyen\") {\n          var options = {};\n          options.fieldNameAttribute = \"data-encrypted-name\";\n          options.enableValidations = false;\n          var cseEncryptedForm = window.adyen.createEncryptedForm(form, options);\n          var encryptedToken = cseEncryptedForm.encrypt();\n          if (encryptedToken !== null) {\n            document.getElementById(\"encryptedCardToken\").value = encryptedToken;\n          }\n        }\n        //      For CyberSource\n        else if (document.getElementById(\"pspProvider\").value === \"CyberSource\") {\n          const paymentUrl = form.action;\n          form.action = config.webservices.cybersource;\n\n          const disabledFields = DISABLED_FIELDS.map((name) => {\n            const field = form.elements[name];\n            if (!field) {\n              return;\n            }\n            field.data(\"name\", field.name);\n            field.removeAttribute(\"name\");\n            return field;\n          }).filter(Boolean);\n\n          xhr\n            .submit(form, { type: \"text\" })\n            .then((data) => {\n              disabledFields.forEach((input) => {\n                input.setAttribute(\"name\", input.data(\"name\"));\n              });\n\n              form.setAttribute(\"action\", paymentUrl);\n              signature.setAttribute(\"value\", data);\n\n              let expiryMonth = document.getElementById(\"expiration-month\").value;\n              const ExpiryYear = document.getElementById(\"expiration-year\").value;\n              if (expiryMonth.length === 1) {\n                expiryMonth = `0${expiryMonth}`;\n              }\n\n              const expiryField = form.elements.card_expiry_date;\n              if (expiryField) {\n                expiryField.value = `${expiryMonth}-${ExpiryYear}`;\n              }\n\n              // remove disabled attribute on billing address\n              const billingAddress = document.getElementById(\"billing-address\");\n              if (form.contains(billingAddress)) {\n                Array.from(billingAddress.querySelectorAll(\"[disabled]\")).forEach((input) => {\n                  if (input.dataset.keepDisabled) {\n                    return;\n                  }\n                  input.removeAttribute(\"disabled\");\n                });\n              }\n              form.submit();\n            })\n            .catch((data) => displayError(data, form));\n          return;\n        }\n      }\n\n      form.submit();\n      // disabled submit button after order placed\n      buttonClick(form);\n    }\n  }\n\n  function handleGigyaLogin(args) {\n    if (args.context !== 'checkout') return\n\n    let data = args.loginData;\n    \n    // tell the server where we're calling from\n    data.loginFrom = \"checkout\";\n    const url = `${window.location.origin}${config.webservices.account.loginUrl}?forcePassword=${data.forcePassword}`;\n    /**\n     * If password must be updated a forcePassword=true has been sent to Gigya\n     *    => that mean user has been flaged to update their credentials\n     *    => the user has been logout and redirected to checkout to update password\n     * else\n     *    => user follow the standard OPC steps (login, shipping, billing, confirmation)\n     */\n    if (data.forcePassword) {\n      const form = document.createElement(\"form\");\n      form.action = `${url}`;\n      form.method = \"POST\";\n      form.className = \"is-hidden\";\n      Object.keys(data).forEach((key) => {\n        form.insertAdjacentHTML(\"beforeend\", `<input type=\"hidden\" name=\"${key}\" value=\"${data[key]}\"/>`);\n      });\n      document.body.appendChild(form);\n      form.submit();\n    } else {\n      xhr\n        .post(url, { data })\n        .then(handleStepResponse)\n        .then((data) => {\n        \tif (data && data.stockSuccess === false) {\n\t          window.location.replace(window.config.webservices.cart.cartUrl);\n\t          return;\n\t        }\n        })\n        .then(updateMobileBurgerMenu)\n        .then(disableSamplesBlock)\n        .then((response) => {\n          trackPageview(response, `${window.location.pathname}/shipping`);\n          select(\".is-total .js-cart-price-subtotal\", el).innerText = response.parts.subTotal;\n          return response;\n        })\n        .catch(config.noop);\n    }\n  }\n\n  function handleGigyaNotifyLogin(data) {\n    data.loginFrom = \"checkout\"\n\n    const url = `${window.location.origin}${config.webservices.account.notifyLoginUrl}`\n    xhr\n      .post(url, { data })\n      .then(handleStepResponse)\n      .then(updateMobileBurgerMenu)\n      .then(disableSamplesBlock)\n      .then((response) => {\n        trackPageview(response, `${window.location.pathname}/shipping`);\n        select(\".is-total .js-cart-price-subtotal\", el).innerText = response.parts.subTotal;\n        return response;\n      })\n      .catch(config.noop);\n  }\n\n  async function getUpdatedCartProductData(gtmData, currentStep) {\n    dataLayerProductData = await xhr.get(window.config.webservices.dynamicDlCheckoutYapi).then(pushUpdatedCartData);\n     if(!(isSendDataToLoggedInUser && currentStep == 1)) {\n      gtmData.ecommerce.checkout = {\n        actionField: { step: currentStep },\n        products: dataLayerProductData.ecommerce.products,\n      };\n      Manager.publish(TRACKING_HIT, gtmData);\n    }\n  }\n\n  function pushUpdatedCartData(data) {\n    const gtmData = cloneDeep(data);\n    let ecom = {};\n    Object.keys(gtmData.pageLoad).forEach(function (val) {\n      addToJson(val, gtmData.pageLoad[val], ecom);\n    });\n\n    return cloneDeep(ecom);\n  }\n\n  function handleSubmit(e) {\n    const form = e.delegateTarget;\n    newForm = form\n    let isFormValid = form.checkValidity()\n    if(!isFormValid) {\n      if(Object.keys(formErrorMapping).includes(form.id)) {\n        dataLayer.push({\n          'eventCategory': formErrorMapping[form.id],\n          'eventAction': 'error',\n          'eventLabel': 'invalidInputs_'+ form.id,\n          'event': 'nievent'\n        })\n      }\n    }\n    if(form.id === 'billingAddressForm') {\n      dataLayer.push({\n        'eventCategory': 'checkout',\n        'eventAction': 'click',\n        'eventLabel': 'proceed to payment',\n        'event': 'uaevent'\n      })\n    }\n    const gEmailElm = select(`#${GUEST_EMAIL}`);\n    const lEmailElm = select(`#${LOGIN_EMAIL}`);\n    const cardNumberErr = select(\".js-cardNumber-error\");\n    const selectedPosEle = select('input[name=\"posName\"]') ? select('input[name=\"posName\"]') : select('input[name=\"posNameCheckout\"]');\n    const selectedPosId = select('input[name=\"posName\"]:checked') ? select('input[name=\"posName\"]:checked') : select('input[name=\"posNameCheckout\"]:checked');\n    const giftCardEl = select(\"#payment-giftcard:checked\");\n    const giftCardNumberEl = select(\"#giftCardNumber\");\n    const giftCardCvnEl = select(\"#giftCardCvn\");\n    const selectedInput = select('input[name=\"addressId\"]:checked');\n    const billingCheckboxEU = select('input[id=\"useDeliveryAddressEU\"]:checked');\n    if ((window.config.country == \"GB\" || window.config.country == \"CA\")  && form.elements[\"data.userPhones[0].number\"]) {\n      if (form.elements[\"data.userPhones[0].number\"].value != null && form.elements[\"data.userPhones[0].number\"].value != '') {\n        form.elements[\"data.userPhones[0].number\"].value = form.elements[\"data.userPhones[0].number\"].value.trim();\n      }\n    }\n\n    if (giftCardEl && giftCardNumberEl && giftCardCvnEl) {\n      updateGiftCardList(e);\n      return;\n    }\n\n    if (!billingCheckboxEU) {\n      const selectedRadio = select('input[name=\"addressId\"]:checked');\n       if (selectedRadio) {\n        const selectedAddress = selectedInput.closest(\"div\");\n        const addressError = select('p[id=\"addressError\"]', selectedAddress);\n        if (addressError) {\n          e.preventDefault();\n          return;\n        }\n      }\n    }\n\n    if (isLocalStorage() === true) {\n      // Guest case\n      if (gEmailElm && !gEmailElm.disabled) {\n        guestEmail = gEmailElm.value;\n        window.localStorage.setItem(\"lastUsedEmail\", gEmailElm.value);\n        if (guestEmail) {\n          window.localStorage.setItem(\"isGuestUser\", true);\n        }\n      }\n\n      // Login case\n      if (lEmailElm && !lEmailElm.disabled) {\n        loginEmail = lEmailElm.value;\n        window.localStorage.setItem(\"loginEmail\", lEmailElm.value);\n        if (loginEmail) {\n          window.localStorage.setItem(\"isGuestUser\", false);\n        }\n      }\n    }\n    // if no pos is selected and user clicks enter\n    if (selectedPosEle && !selectedPosId && form.id === \"posForm\") {\n      e.preventDefault();\n      return;\n    }\n\n    if (form.id === \"selectDeliveryMethodForm\") {\n      let toshiFlag = toshiDeliveryMode(form);\n      if (toshiFlag) {\n        e.preventDefault();\n        return;\n      }\n    }\n\n    if (form.id === \"otpValidate\") {\n      return\n    }\n    if (form.id === \"registerPhone\") {\n      return\n    }\n    if (form.id === \"cnPlaceOrderForm\") {\n      return\n    }\n\tif(config.country.toLowerCase() === \"ca\" && form.id === \"sopPaymentDetailsForm\" ){\n      const weChatSelected = select('input[id=\"payment-wechatPay\"]')\n      if (weChatSelected.checked) {\n        return\n      }\n    }\n    if (form.id === \"notificationSubscriptionForm\") {\n      e.preventDefault();\n      handleSMSNotification(form);\n      return;\n    }\n    if (form.id === \"notificationUnSubscriptionForm\") {\n      e.preventDefault();\n      handleUnsubscribe(form);\n      return;\n    }\n    if (form.id === \"\")\n      if (cardNumberErr && cardNumberErr.innerText) {\n        cardNumberErr.removeAttribute(\"role\");\n      }\n\tif (form.id === \"gigya-register-form\") {\n      const registrationForm = select('form.gigya-register-form')\n      const consentList = select('ul.consent-checkbox', registrationForm)\n      const defaultMsg = selectAll('p[class=\"error\"]', consentList)\n      if (defaultMsg) {\n        defaultMsg.forEach((element) => {\n      \t element.remove()\n        })\n      }\n    }\n    let deliveryContainer = select('.highlightShippingNode',form)\n\tlet deliveryCalendarDate = select(\".delivery-method-calendar\",deliveryContainer)\n\tif(deliveryCalendarDate){\n\t\tlet dateControl = select('.js-select-date-input',deliveryCalendarDate)\n\t\tlet deliveryDateStatus = deliveryCalendar.checkDateRange(dateControl)\n\t\tif(deliveryDateStatus){\n\t\t\tselect(\".delivery_slot_date\",form).value = deliveryDateStatus\n\t\t}else{\n\t\t\te.preventDefault()\n\t\t\treturn false\n\t\t}\n\t}\n    // dont post in ajax if the form has errors\n    // or if the form needs to be posted without ajax\n\n    if (form.hasAttribute(\"data-http-form\") || form.classList.contains(\"gigya-form\")) {\n      isSendDataToLoggedInUser = true\n      return\n    }\n\n    const invalidFields = form.invalid.filter((invalidItem) => !invalidItem.el.hasAttribute(\"disabled\"))\n    if (invalidFields.length) {\n      return\n    }\n\n\n    e.preventDefault();\n\n    // on step 3\n    if (steps.step3.el.contains(form) && !form.classList.contains(\"address-form\")) {\n      handleFinalStep(form);\n      return;\n    }\n    const phoneNumber = select(\"[data-phone-pattern]\");\n    const checkbox = select('input[id=\"useDeliveryAddressEU\"]');\n    const isKR = config.country === \"KR\" ? true : false\n    if (!isKR && ((checkbox && !checkbox.checked) || !checkbox) && !selectedPosId && phoneNumber && !phoneNumber.dataset.mobileValidation && !phoneNumber.disabled && (phoneNumber.value!='')) {\n      MobilePhoneValidation.getUserNumber().then((isValid) => {\n        if (typeof isCncDeliveryMode !== 'undefined' && isCncDeliveryMode) {\n          addcncDeliveryAnalytics();\n        } else {\n          addDeliveryAnalytics();\n        }\n        submitStepForm(form);\n      });\n    } else {\n      if (typeof isCncDeliveryMode !== 'undefined' && isCncDeliveryMode) {\n        addcncDeliveryAnalytics();\n      } else {\n        addDeliveryAnalytics();\n      }\n      submitStepForm(form);\n    }\n  }\n\n  function submitStepForm(form) {\n    if (form.id === \"billingAddressForm\" || form.id === \"addressForm\") {\n      manageDataObj(form);\n    } else {\n      if (form.id === \"posForm\") {\n        countryCodeName();\n      }\n      xhr\n        .submit(form)\n        .then((data) => {\n          if (form.id === \"chanelGuestForm\") {\n            sendToDatalayer(data, form.action);\n          }\n          if (data.stockSuccess === false) {\n            window.location.replace(window.config.webservices.cart.cartUrl);\n            return;\n          }\n          processStep(data, form);\n        })\n        .catch((data) => {\n          //blocking guest cpf to go inside the function\n          if (form.id === \"chanelGuestForm\" && (data.fields[0] && data.fields[0].name !== 'guestCpf')){\n            sendToDatalayer(data, form.action);\n          }\n          displayError(data, form);\n        });\n    }\n  }\n\n  function processStep(responseData, form) {\n    return handleStepResponse(responseData)\n      .then((data) => {\n        Manager.publish(OPC_STEP_PROCESS, { step: data.stepNumber });\n\n        if (data.stepNumber === 3 && (form.id === 'selectDeliveryMethodForm' || form.id === 'posForm') && window.config.currentLocale !== '/us/') {\n          dataLayer.push({\n            'eventCategory': 'checkout',\n            'eventAction': 'display',\n            'eventLabel': 'proceed to payment',\n            'event': 'nievent'\n          })\n        }\n        return data;\n      })\n      .then((data) => {\n        if (data.parts.promocode) {\n          Promocode(data);\n          enableSubmitBtns();\n        }\n        return data;\n      })\n      .then((data) => {\n        trackPageview(data, form.action);\n        return data;\n      });\n  }\n\n  function trackPageview(data, nextPage) {\n    // dont send the page view when the step number is the same\n    if (data.success && data.dl.stepNumber === currentTrackingStep) {\n      return;\n    }\n\n    currentTrackingStep = data.dl.stepNumber;\n    sendToDatalayer(data, nextPage);\n    appliedFocusOnActiveForm();\n  }\n\n  /**\n   * call this to send a right data according step\n   * @param data\n   * @param nextPage\n   */\n  function sendToDatalayer(data, nextPage) {\n    const gtmData = cloneDeep(window.dataLayer[0]);\n    const pathPage = nextPage.split(\"/\");\n\n    if (isLocalStorage() === true) {\n      const isGuestUser = window.localStorage.getItem(\"isGuestUser\");\n      if (isGuestUser === \"true\") {\n        gtmData.funnel_type = \"guest\";\n      } else {\n        gtmData.funnel_type = \"customer login\";\n      }\n    }\n\n    gtmData.category = \"funnel\";\n    currentTrackingStep = data.dl.stepNumber;\n    switch (currentTrackingStep) {\n      case 0:\n        gtmData.cartValue = data.cartValueWithoutTax;\n        gtmData.checkoutStepName = \"Signing\";\n        gtmData.page = `${window.location.pathname}/login`;\n        gtmData.sub_category_level1 = \"Signing\";\n        break;\n      case 1:\n        gtmData.cartValue = data.cartValueWithoutTax;\n        gtmData.checkoutStepName = \"shipping\";\n        gtmData.page = `${window.location.pathname}/shipping`;\n        gtmData.sub_category_level1 = \"shipping\";\n        break;\n      case 2:\n        gtmData.checkoutStepName = \"billing\";\n        gtmData.cartValue = data.cartValueWithTax;\n        gtmData.page = `${window.location.pathname}/billing`;\n        gtmData.sub_category_level1 = \"billing\";\n        break;\n      default:\n        gtmData.checkoutStepName = \"billing\";\n        gtmData.cartValue = data.cartValueWithoutTax;\n        gtmData.page = pathPage.length ? `/${pathPage[pathPage.length - 1]}/${pathPage[pathPage.length - 2]}` : gtmData.page;\n        gtmData.sub_category_level1 = \"billing\";\n        break;\n    }\n    gtmData.event = \"virtualPageview\";\n    gtmData.checkoutStepNumber = currentTrackingStep;\n    gtmData.ecommerce.checkout = {\n      actionField: { step: currentTrackingStep },\n      products: gtmData.ecommerce.products,\n    };\n    delete gtmData.ecommerce.products;\n    if (isLocalStorage() === true) {\n      if (window.localStorage.getItem(\"loginEmail\")) {\n        if (config.country.toLowerCase() != \"us\") {\n          gtmData.userEmail = \"\";\n        } else {\n          gtmData.userEmail = window.localStorage.getItem(\"loginEmail\");\n        }\n        gtmData.email_sha256 = sha256(window.localStorage.getItem(\"loginEmail\"));\n      }\n      if (window.localStorage.getItem(\"lastUsedEmail\")) {\n        if (config.country.toLowerCase() != \"us\") {\n          gtmData.userEmail = \"\";\n        } else {\n          gtmData.userEmail = window.localStorage.getItem(\"lastUsedEmail\");\n        }\n        gtmData.email_sha256 = sha256(window.localStorage.getItem(\"lastUsedEmail\"));\n      }\n    }\n\n    getUpdatedCartProductData(gtmData, currentTrackingStep);\n  }\n  /**\n   * Return new object from Form data\n   */\n  function manageDataObj(form) {\n    const paramsData = {};\n    const inputs = getCollection(\"input, select\", form);\n    let isoCode;\n\n    // We add an exceptions for some fields that are required but don't have the required attribute\n    // as it would broke the accessibility to have required hidden fields\n    const namesToExclude = [\n      \"phoneCountryCode\",\n      \"addressId\",\n      \"countryIso\",\n      \"useDeliveryAddressEU\",\n      \"_useDeliveryAddressEU\",\n      \"qualityCode\",\n      \"skipValidation\",\n      \"_shippingToBusinessAddress\",\n      \"billingAddress\",\n      \"shippingAddress\",\n      \"line2\",\n      \"district\",\n      \"provincia\",\n      \"shippingToBusinessAddress\",\n      \"defaultAddress\",\n      \"municipality\",\n      \"village\",\n      \"addAddressToGigya\",\n      \"building\"\n    ];\n\n    if((config.country.toLowerCase() === \"ru\") || (config.country.toLowerCase() === \"cn\")){\n      namesToExclude.push(\"postcode\")\n    }\n\n    if(config.country.toLowerCase() === \"ca\") {\n      namesToExclude.push(\"phone\")\n    }\n\n    Array.from(inputs)\n      .filter((input) => input.required || namesToExclude.indexOf(input.name) !== -1)\n      .forEach((input) => {\n        // Then fill paramsData with inputs values that passed the filter\n        if (input.type === \"radio\" || input.type === \"checkbox\") {\n          if (input.name === \"addAddressToGigya\") {\n            input.value !== \"\" ? (paramsData[input.name] = input.value) : null;\n          } else {\n            input.checked === true ? (paramsData[input.name] = input.value) : null;\n          }\n        } else if (input.name === \"countryIso\") {\n          isoCode = input.value === \"LT\" ? input.value : null;\n          paramsData[input.name] = input.value;\n        } else if((config.country.toLowerCase() === \"cn\") && ((input.name === \"provincia\") || (input.name === \"district\") || (input.name === \"townCity\"))) {\n          paramsData[input.name] = input.selectedOptions[0].innerText;\n        } else if (input.name === \"postcode\") {\n          let isNotMobile = !isMobileScreen();\n          paramsData.countryIso === \"LT\" ? (input.value = input.value.replace(/[^0-9]/g, \"\")) : null;\n          paramsData[input.name] = isoCode ? `${isoCode}-${input.value}` : input.value;\n        } else {\n          input.value !== \"\" ? (paramsData[input.name] = input.value) : null;\n        }\n      });\n    xhr\n      .submit(form, { data: paramsData })\n      .then((data) => {\n        if (data.stockSuccess === false) {\n          window.location.replace(window.config.webservices.cart.cartUrl);\n          return;\n        }\n        processStep(data, form);\n      })\n      .catch((data) => {\n        displayError(data, form);\n      });\n  }\n\n\n  /**\n   * Create a get call to a different checkout step\n   * @param {object} e - user event\n   * @param {HTMLElement} button - the button that triggered the step back\n   */\n  function stepBack(e) {\n    const button = e.delegateTarget;\n    const step = button.dataset.step;\n    const formFocus = button.hasAttribute(\"data-step-focus\");\n    const checkPrivacy = select('input[name=\"termsSelection\"]');\n    const privacyErrorMsg = select(\".privacy-error-msg\");\n    const labelPrivacy = select('label[for=\"guest.termsSelection\"]');\n\n    if (checkPrivacy && !checkPrivacy.checked) {\n      if (!privacyErrorMsg && labelPrivacy) {\n        const pElem = document.createElement(\"p\");\n        const errorMsg = document.createTextNode(config.locales.errors.form.fields.valueMissing.privacy);\n\n        pElem.classList.add(\"error\", \"privacy-error-msg\");\n        pElem.appendChild(errorMsg);\n        labelPrivacy.appendChild(pElem);\n      }\n\n      return;\n    }\n\n    if (step.indexOf(\"editStep2Addresses\") !== -1) {\n      updateAnalyticsShippingOptions();\n    }\n    xhr\n      .get(step)\n      .then(updateSteps)\n      .then((data) => {\n        if (step.indexOf(\"editBillingAddressStep\") !== -1) {\n          const checkbox = select('input[id=\"useDeliveryAddressEU\"]', document.body);\n          if (checkbox) {\n            const formFieldset = document.getElementById(checkbox.dataset.formToggleDisplay);\n            const inputs = Array.from(formFieldset.querySelectorAll(\"input, select, textarea\"));\n            // set timeout to get the populated fields from back end\n            TweenLite.to(inputs, 0.1, {\n              onComplete: () => {\n                inputs\n                  .filter((input) => !input.hidden)\n                  .forEach((field) => {\n                    if (field.id !== \"address.line2\" && field.type !== \"checkbox\") {\n                      field.setAttribute(\"required\", true);\n                      field.setAttribute(\"aria-required\", true);\n                    }\n                    if(config.country.toLowerCase() === \"ru\") {\n                        if(field.id === \"address.complemenatry\") {\n                          field.removeAttribute('required');\n                          field.removeAttribute('aria-required');\n                        }\n                        if(field.id === \"address.postcode\") {\n\t\t                        field.removeAttribute('required');\n\t\t                        field.removeAttribute('aria-required');\n\t\t                     }\n                    }\n                     if(config.country.toLowerCase() === \"ru\" && field.id === \"address.complemenatry\"){\n                        field.removeAttribute('required');\n                        field.removeAttribute('aria-required');\n                      }\n                    if (field.dataset.phonePattern) {\n                      // adding custom event to trigger the update of the phone country code in order to get the right pattern\n                      const dispatchPhoneNumber = new window.CustomEvent(\"input\", {\n                        detail: { isOpc: true },\n                      });\n                      field.dispatchEvent(dispatchPhoneNumber);\n                    }\n                  });\n              },\n            });\n          }\n        }\n        editboutiqueLayerUpdate();\n        Manager.publish(OPC_STEP_PROCESS, { step: data.dl });\n        if (step.indexOf(\"guest\") !== -1) {\n          sendToDatalayer(data.data, step);\n        }\n        return data;\n      })\n      .then(() => manageStep1ScreenSwitch(\"checkout-guest-sign-in\"))\n      .then(() => {\n        enableSubmitBtns();\n        const form = el.querySelector(\"form input:not([disabled]):not([type=hidden]), form button:not([disabled]), form select:not([disabled]), form textarea:not([disabled])\");\n\n        var selectedPosId = select('input[name=\"posName\"]:checked');\n        if (selectedPosId) {\n          selectPOSNow(selectedPosId.getAttribute(\"id\"));\n        }\n\n        var preSelectedPOS = select('input[name=\"posGeoLocation\"]');\n        if (preSelectedPOS) {\n          const lat = preSelectedPOS.getAttribute(\"data-lat\");\n          const long = preSelectedPOS.getAttribute(\"data-lng\");\n          const id = preSelectedPOS.getAttribute(\"id\");\n          initializeMap(lat, long, id);\n        }\n\n        if (formFocus && form) {\n          zipCodeVariation();\n          updateInputs();\n          form.focus();\n          return;\n        }\n\n        updatePageTitle(focusInteractiveStep());\n        loadMaponEditBoutique();\n        return;\n      })\n      .then(() => {\n        if (select(\"#selectDeliveryMethodForm\")) {\n          shippingOptionHighlight();\n        }\n        deliveryCalendar = new deliveryMethodCalendar();\n      })\n      .catch((data) => displayError(data));\n  }\n\n  function updatePageTitle(heading) {\n    const stepDivElm = select(\"[data-opc-step]\");\n\n    if (!heading || !heading.firstElementChild) {\n      if (stepDivElm) {\n        const stepName = stepDivElm.getAttribute(\"data-opc-step-title\");\n        if (stepName) {\n          pageTitle(stepName);\n        }\n      } else {\n        return;\n      }\n    } else {\n      const headingTextEle = select(\"span\", heading);\n      if (headingTextEle) {\n        const headingText = headingTextEle.innerText;\n        pageTitle(headingText);\n      }\n    }\n  }\n\n  function updateSteps(data) {\n    //Monetate\n    try {\n      if (data && data.dl && data.dl.stepName) {\n        pushCheckoutMonetateData(data.dl.stepName.toLowerCase());\n      }\n      if (newForm && select( `button[id=continueToShippingOptions]`,newForm.parentNode)) {\n        pushCheckoutMonetateData('delivery')\n        newForm = null\n      }\n      if (newForm && select( `button.js-add-edit-address-save`,newForm.parentNode)){\n        pushCheckoutMonetateData('payment')\n        newForm = null\n      }\n    } catch (error) {\n      console.error(error);\n    }\n\n    if (data && data.dl && data.dl.stepName && data.dl.stepName === 'SHIPPING'\n            && data.reviewCart && data.reviewCart === true) {\n      window.location.replace(window.config.webservices.cart.cartUrl);\n      return;\n    }\n\n    sendShippingDataToDatalayer();\n    if (data.parts) {\n      const replaceSteps = Object.keys(data.parts).map((step) => {\n        const currentStep = steps[step];\n        if (!currentStep || !currentStep.el) {\n          return;\n        }\n        const newStep = document.createElement(\"div\");\n\n        if (!currentStep.height) {\n          currentStep.height = currentStep.el.clientHeight;\n        }\n\n        newStep.innerHTML = data.parts[step];\n        // look for a potential form to be posted with http\n        const httpForm = newStep.querySelector('form[data-http-form=\"immediate\"]');\n\n        // append the new step to get its height\n        currentStep.el.appendChild(newStep);\n\n        // if the newStep has a form to post using http not ajax\n        // submit it while its in the dom\n        if (httpForm) {\n          httpForm.submit();\n          return Promise.resolve();\n        }\n\n        const newHeight = newStep.clientHeight;\n\n        currentStep.el.removeChild(newStep);\n\n        // replace without transition if the step has the same height\n        if (currentStep.height === newHeight) {\n          currentStep.el.innerHTML = newStep.innerHTML;\n\n          return Promise.resolve();\n        }\n\n        return new Promise((done) => {\n          animateStep({\n            step: currentStep,\n            newStep,\n            newHeight,\n            done,\n          });\n\n          currentStep.height = newHeight;\n\n          if (currentStep.el.classList.contains(\"step3\")) {\n            const label = select(\".billing-radio-buttons .creditCard label\");\n            label && window.fitText(label);\n          }\n        });\n      });\n\n      return Promise.all(replaceSteps).then((values) => {\n        return { data, promises: values };\n      });\n    }\n  }\n\n  function handleStepResponse(data) {\n    enableSubmitBtns();\n    const activationPopup = select('[id=\"account-deactivated-screen\"]')\n    if (activationPopup) {\n      if (document.body.classList.contains('has-modal')) {\n  \t    document.body.classList.remove('has-modal')\n  \t  }\n      window.gigya.accounts.hideScreenSet({\n          screenSet: 'account-deactivated'\n      })\n    }\n    popinMergeDecisionHandler.checkMergeCookie();\n    const COOKIE_KEY = \"cartMergeDecision\";\n    const WRAPPING_KEY = 'cartWrappingMergeDecision';\n    const promptMergeDecision = readCookie(COOKIE_KEY);\n    const promptMergeWrappingDecision = readCookie(WRAPPING_KEY);\n    data.parts.cart_wrapping = select(\"[class='cart-wrapping']\", el).innerHTML;\n    return updateSteps(data).then(() => {\n      if (promptMergeDecision == \"false\" || promptMergeWrappingDecision == 'false') {\n        const btnContinuetoShippingOptions = select(\"#continueToShippingOptions\");\n        updateWrappingChoice(promptMergeWrappingDecision);\n        if (btnContinuetoShippingOptions && document.body.classList.hasAttribute(\"has-modal\")) {\n          btnContinuetoShippingOptions.setAttribute(\"tabindex\", \"-1\");\n        }\n      }\n      const heading = focusInteractiveStep();\n\n      if (heading) {\n        const currentStep = heading.closest(\"[class^=step]\");\n        data.stepNumber = Array.prototype.indexOf.call(currentStep.parentElement.children, currentStep) + 1;\n      }\n      if(data.stepNumber === 3) {\n        if (window.config.country === \"KR\") {\n          callSeeMoreOption()\n        }\n        if (window.config.country === \"JP\") {\n          loadGmoDeviceFingerUrl()\n        }\n        if (window.config.country === \"RU\") {\n          getCustomerTimeZone()\n        }\n        if (window.config.country === \"CN\") {\n          showUnionPay()\n          showWeChat()\n        }\n\t\tif (window.config.country === \"CA\") {\n          const isWeChatPayQRAdyenEnabled = select(\"#wechatPayAdyen\");\n          if (isWeChatPayQRAdyenEnabled) {\n            initWechatPayQrAdyenPopin()\n          }\n        }\n      }\n\n      if (data.stepNumber === 2 || data.stepNumber === 3) {\n        if (select('input[name=\"posGeoLocation\"]') || selectAll('.POSElement').length === 1) {\n          loadMapOnPageLoad()\n        }\n      }\n\n      updateSamples(data);\n      updateEmployeeSavings(data);\n      updatePageTitle(heading);\n      updateOrderSummary(data);\n      enableSubmitBtns();\n      selectDeliveryMethod();\n      resetPaymentModes();\n\n      return data;\n    });\n  }\n\n  function getCustomerTimeZone() {\n\tconst timeZoneElm = select('.js-time-zone')\n\ttimeZoneElm.value = new Date()\n  }\n\n  function showUnionPay() {\n    let unionPayDiv = select('.js-union-pay')\n\tif (isWideScreen() && unionPayDiv) {\n\t  unionPayDiv.removeAttribute('hidden')\n\t}\n  }\n\n  function showWeChat(){\n    const weChatDiv = select('.js-wechat-pay')\n    const aliPay = select('.js-alipay-pay')\n    if(!isWideScreen()){\n\t\tif (weChatDiv && isWeChatBrowser()) {\n\t\t\tconst wechatCheckbox = select('#payment-wechatPay')\n\t\t\tconst alipayCheckbox = select('#payment-aliPay')\n\t\t\tconst weChatForm = select('#wechatPay-method')\n\t\t\tconst aliPayForm = select('#aliPay-method')\n\t\t\tconst wechatPayTerms = select('#setTermCondition_wechatPay')\n\t\t\tconst aliPayTerms = select('#setTermCondition_aliPay')\n\t\t\tweChatDiv.removeAttribute('hidden')\n\t\t\tweChatDiv.classList.add('selected')\n\t\t\twechatCheckbox.setAttribute(\"checked\", \"checked\")\n\t\t\tweChatForm.classList.remove('is-hidden')\n\t\t\tweChatForm.removeAttribute('aria-hidden')\n\t\t\twechatPayTerms.setAttribute('required', true)\n\t\t\taliPayTerms.removeAttribute('required')\n\t\t\taliPay.classList.remove('selected')\n\t\t\talipayCheckbox.removeAttribute(\"checked\")\n\t\t\taliPayForm.classList.add('is-hidden')\n\t\t\taliPayForm.setAttribute('aria-hidden', true)\n\t\t} else {\n\t\t\taliPay.removeAttribute('hidden')\n\t\t}\n    } else {\n      weChatDiv.removeAttribute('hidden')\n      aliPay.removeAttribute('hidden')\n    }\n  }\n\n  function callSeeMoreOption() {\n\t  const seeMoreBtns = selectAll('.js-see-more-terms-kr')\n\t  seeMoreBtns.forEach((element) => {\n\t    element.addEventListener('click', toggleSeeMore)\n\t  })\n\t}\n\n\tfunction toggleSeeMore(e) {\n\t  const seeMoreBtn = e.target\n\t  const seeMoreContent = seeMoreBtn.closest('div').nextElementSibling\n\t  if (seeMoreContent.style.display === \"none\" || seeMoreContent.style.display === \"\") {\n\t    seeMoreContent.style.display = \"block\";\n\t    e.target.innerText = config.conciergeDelivery.seeLessBtn\n\t    seeMoreContent.setAttribute('tabindex', 0)\n\t   } else {\n\t    seeMoreContent.style.display = \"none\";\n\t    e.target.innerText = config.conciergeDelivery.seeMoreBtn\n\t  }\n\t}\n\n\n  function resetPaymentModes() {\n    if (!applePayIsSupported()) {\n      const paymentUl = select(\".js-billing-radio-buttons\");\n      const paymentLi = select(\".js-applepay-enable\");\n      const applePayDiv = select(\"#applepay-method\");\n      if (paymentUl) {\n        if (paymentLi) {\n          paymentUl.removeChild(paymentLi);\n        }\n        if (applePayDiv) {\n          applePayDiv.remove();\n        }\n      }\n    }\n  }\n\n  function updateSamples(data) {\n    if (data.isEmployeeSale) {\n      const sampleList = select(\".js-samples-list\");\n      if (sampleList) {\n        const wrapper = sampleList.parentNode;\n        sampleList.remove();\n        wrapper.innerHTML = `<p class='error'>${config.dl.opc.notification.samples.employee}</p>`;\n      }\n    }\n  }\n\n   function updateWrappingChoice(promptMergeWrappingDecision){\n    if (promptMergeWrappingDecision == 'false'){\n      const wrapping = select(\"[class='cart-wrapping']\", el);\n      wrapping.innerHTML = \"\";\n      data.parts.cart_wrapping = wrapping.innerHTML;\n    }\n\n   }\n\n  function updateEmployeeSavings(data) {\n    if (data.isEmployeeSale) {\n      const employeeSavingsSection = select(EMPLOYEE_SAVINGS);\n\n      if (employeeSavingsSection) {\n        employeeSavingsSection.removeAttribute(\"hidden\");\n      }\n    }\n  }\n\n  /**\n   * Update order summary items\n   * @param data {object}: request response data\n   */\n  function updateOrderSummary(data) {\n    const parts = data.parts;\n    if (parts && \"cart_items\" in parts) {\n      const orderSummaryElm = select(\"[class=cart-product-list]\", el);\n      orderSummaryElm.innerHTML = parts.cart_items;\n    }\n  }\n\n  function setFocus(container, hasFocus, inputEl) {\n    if (hasFocus) {\n      if (!container.classList.contains(\"has-focus\")) {\n        container.classList.add(\"has-focus\");\n      }\n    } else if (container.classList.contains(\"has-focus\") && inputEl.value === \"\") {\n      container.classList.remove(\"has-focus\");\n    }\n  }\n\n  function managePlaceholders(elem) {\n    const loginInput = elem || false;\n    const passwordContainer = elem ? elem.parentElement : false;\n\n    if (!loginInput || !passwordContainer) {\n      return;\n    }\n\n    loginInput.onfocusin = function () {\n      setFocus(passwordContainer, true);\n    };\n    loginInput.onblur = function () {\n      setFocus(passwordContainer, false, loginInput);\n    };\n    loginInput.onchange = function () {\n      const focus = loginInput.val() !== \"\" ? setFocus(passwordContainer, true) : setFocus(passwordContainer, false, loginInput);\n    };\n\n    const focus = loginInput.value !== \"\" ? setFocus(passwordContainer, true) : setFocus(passwordContainer, false, loginInput);\n  }\n\n  function manageStep1ScreenSwitch(id) {\n    const step1DivElm = select(\".step1\", document.body);\n    const gigyaWrapperElm = select(`#${GIGYA_WRAPPER_ID}`, step1DivElm);\n    const guestDivElm = select(\"#checkout-guest-sign-in\", step1DivElm);\n    const gigyaLoginScreen = select(\"#gigya-login-screen\", document.body);\n    const gigyaRegisterScreen = select(\"#gigya-register-screen\", document.body);\n\n    // According on id, if Guest we show Guest section and hide gigya wrapper section else reverse\n    if (id === \"checkout-guest-sign-in\") {\n      hideBlock(gigyaWrapperElm);\n      showBlock(guestDivElm);\n      updatePageTitle(focusInteractiveStep(guestDivElm));\n    } else {\n      // If gestDivElm is not hidden then we need to manually switch Gigya\n      const forceSwitch = !guestDivElm.hasAttribute(\"aria-hidden\");\n      hideBlock(guestDivElm);\n      showBlock(gigyaWrapperElm);\n\n      if (id === \"checkout-sign-in\") {\n        updatePageTitle(focusInteractiveStep(gigyaLoginScreen));\n      }\n\n      if (id === \"checkout-register\") {\n        updatePageTitle(focusInteractiveStep(gigyaRegisterScreen));\n      }\n\n      // We want to force the switch only when coming from guest page, eitherway we get an error as the switch is done twice\n      if (forceSwitch) {\n        window.gigya.accounts.switchScreen({\n          screenSet: \"chanel-one\",\n          containerID: GIGYA_WRAPPER_ID,\n          screen: id === \"checkout-sign-in\" ? \"gigya-login-screen\" : \"gigya-register-screen\",\n        });\n      }\n    }\n    return;\n  }\n\n  function toggleDisplay(e) {\n    enableSubmitBtns();\n    const button = e.delegateTarget;\n    const id = button.dataset.stepDisplay;\n    const lEmailElm = select(`#${LOGIN_EMAIL}`, document.body);\n\n    // hide or show [guest, sign-in, register] blocks\n    manageStep1ScreenSwitch(id);\n    updateAnalyticsUserOpc(id);\n\n    if (lEmailElm && isLocalStorage() === true) {\n      lEmailElm.value = window.localStorage.getItem(\"lastUsedEmail\");\n    }\n\n    managePlaceholders(lEmailElm);\n  }\n\n  function hideBlock(context) {\n    if (context) {\n      context.classList.add(HIDDEN_CLASSNAME);\n      context.setAttribute(\"aria-hidden\", \"true\");\n\n      inert.set(context);\n      const fields = Array.from(context.querySelectorAll(\"input, textarea, select\"));\n      fields.forEach((field) => {\n        field.setAttribute(\"disabled\", true);\n      });\n\n      Manager.publish(REMOVE_ERROR, context);\n    }\n  }\n\n  function showBlock(context) {\n    if (context) {\n      context.classList.remove(HIDDEN_CLASSNAME);\n      context.removeAttribute(\"aria-hidden\");\n\n      const fields = Array.from(context.querySelectorAll(\"[disabled]\"));\n      fields.forEach((field) => {\n        if (!field.closest('[aria-hidden=\"true\"]')) {\n          field.removeAttribute(\"disabled\");\n        }\n      });\n      inert.unset(context);\n    }\n  }\n\n  function updateDefaultCardCheckbox(e) {\n    const checkbox = document.getElementById(\"setDefaultPaymentMethod\");\n\n    if (e.delegateTarget.checked) {\n      checkbox.removeAttribute(\"disabled\");\n      return;\n    }\n\n    checkbox.checked = false;\n    checkbox.setAttribute(\"disabled\", true);\n  }\n\n  /**\n   * this function are used only where user are logged\n   * to send missing info to datalayer\n   */\n  function updateDatalayerStep() {\n    const divElm = select(\"[data-opc-step]\");\n    const subtotal = select(\"[data-subtotal]\");\n    let cartValueWithoutTax;\n    if (subtotal && subtotal.dataset && subtotal.dataset.subtotal) {\n      cartValueWithoutTax = subtotal.dataset.subtotal;\n    }\n    const privateWait = function (data, nextPage) {\n      window.addEventListener(\"load\", () => {\n        window.setTimeout(() => {\n          trackPageview(data, nextPage);\n        }, 50);\n      });\n    };\n\n    if (divElm) {\n      const stepName = divElm.getAttribute(\"data-opc-step\");\n      const data = {\n        dl: {\n          stepName,\n          stepNumber: 0,\n        },\n        cartValueWithoutTax,\n      };\n      switch (stepName) {\n        case \"SHIPPING\":\n          data.dl.stepNumber = 1;\n          privateWait(data, `${window.location.pathname}/shipping`);\n          break;\n        case \"BILLING\":\n          data.dl.stepNumber = 2;\n          privateWait(data, `${window.location.pathname}/billing`);\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  function appliedFocusOnActiveForm() {\n    const stepsElms = selectAll(\"[class^=step]\");\n    const activeStepElm = (stepsElms || []).find((stepElm) => select(\"form\", stepElm));\n    if (activeStepElm) {\n      zipCodeVariation();\n      updateInputs();\n      const titleElm = select(\"h2.heading\", activeStepElm);\n      if (titleElm) {\n        focusElement(titleElm);\n      }\n    }\n  }\n\n  /**\n   * Private fn: This method are used to update the mobiles burger menu\n   * It should be used for this purposes only\n   * @param res {JSON}: contains xhr.request response\n   * @return {*} initial request response\n   */\n  function updateMobileBurgerMenu(res) {\n    Manager.subscribe(PAGELOAD_WISHLIST, (response) => {\n      const signInElm = selectAll(\".signIn-register\");\n      const welcomeElm = select(\"[data-signin-welcome]\");\n\n      if (signInElm && welcomeElm && response.session.name) {\n        // Get HTML li element (to display welcome user.firstName)\n        const welcomeLiString = welcomeElm.dataset.signinWelcome;\n\n        // Create a tmp div and extract the HTML li element\n        const welcomeLiElm = document.createElement(\"li\");\n        welcomeLiElm.innerHTML = welcomeLiString;\n\n        // Get the SVG element\n        const svgElm = select(\"svg\", welcomeLiElm);\n\n        // update the firstName element according received values from xhr.request\n        const firstNameElm = select(\"#signIn-welcome-firstName\", welcomeLiElm);\n        firstNameElm.innerHTML = `${window.config.locales.menu.welcome} ${response.session.name}`;\n        firstNameElm.setAttribute(\"href\", response.session.accountUrl);\n        firstNameElm.appendChild(svgElm);\n\n        // set current li.signIn-register by the li.signIn-Welcome elm\n        if (signInElm) {\n          signInElm.forEach((elm) => {\n            elm.innerHTML = welcomeLiElm.childNodes[0].innerHTML;\n            if (elm.id !== \"signIn-register\") {\n              const menuNameList = elm.id.split(\"-\");\n              const firstNameElm = select(\"#signIn-welcome-firstName\", elm);\n              firstNameElm.id = `signIn-welcome-firstName-${menuNameList[menuNameList.length - 1]}`;\n              firstNameElm.removeAttribute(\"class\");\n            }\n          });\n        }\n      }\n      return response;\n    })\n    return res;\n  }\n\n  /**\n   * Check if user is an employee sales\n   * true => hide sample block\n   * false => do nothing\n   * @param data {object}: Gigya provided data\n   * @returns {*}: Gigya provided data\n   */\n  function disableSamplesBlock(data) {\n    const samplesBlockElm = select(\"[data-samples-block]\");\n    const nbSamples = samplesBlockElm ? parseInt(samplesBlockElm.dataset.samplesBlock, 10) : null;\n    if (samplesBlockElm && data.isEmployeeSale && !nbSamples) {\n      samplesBlockElm.hidden = data.isEmployeeSale;\n    }\n    return data;\n  }\n\n  bindSelectionItems();\n  PromocodeToggle();\n  updateDatalayerStep();\n\n  // update a11y document title on page loaded\n  updatePageTitle();\n  function buttonClick(form) {\n    Array.prototype.forEach.call(form.elements, (element) => {\n      if (element.type === \"submit\") {\n        element.setAttribute(\"disabled\", true);\n      }\n    });\n  }\n\n  function onUserConfirmedWrongAddress(e) {\n    const formElm = select(SHIPPING_ADDRESS_FORM_SELECTOR, el);\n    if (formElm) {\n      if (formElm[\"skipValidation\"]) {\n        formElm[\"skipValidation\"].value = \"true\";\n      }\n    }\n  }\n\n  // listen for login from gigya\n  Manager.subscribe(\"gigyaLogin\", handleGigyaLogin);\n  Manager.subscribe(\"gigyaNotifyLogin\", handleGigyaNotifyLogin);\n  window.addEventListener(\"load\", enableSubmitBtns);\n  if (!isSafari()) {\n    window.addEventListener(\"popstate\", handlePopState);\n  }\n  // window.addEventListener('load', renderExpressCheckoutCtas)\n\n  if (applePayIsSupported()) {\n    initApplePayOPCManager();\n  }\n  function shippingOptionHighlight(e) {\n    if (e && e.delegateTarget) {\n      let radioButton = select(\"input[name=delivery_method]\", e.delegateTarget);\n      if (radioButton) {\n        radioButton.checked = true;\n      }\n    }\n    let shippingNodes = getCollection(\".shippingItem\");\n    shippingNodes.forEach((shippingNode) => {\n      if (shippingNode.children[0].checked !== true) {\n        shippingNode.classList.remove(\"highlightShippingNode\");\n        getCollection(\".shippingmethod__details\", shippingNode).forEach((detailsSection) => {\n          detailsSection.classList.add(\"is-hidden\");\n          const inputElement = select(\".toshi-method > input\");\n          if (inputElement) {\n            inputElement.setCustomValidity(\"\");\n            inputElement.checkValidity();\n            shippingNode.classList.remove(\"toshi-method\");\n          }\n          const deliverySlotDateInput = select(\".delivery_slot_date\", detailsSection);\n\n          if (deliverySlotDateInput) {\n            deliverySlotDateInput.removeAttribute(\"name\");\n          }\n          getCollection(\"select\", detailsSection).forEach((selectBox) => {\n            selectBox.removeAttribute(\"name\");\n          });\n        });\n      } else {\n        if (!shippingNode.classList.contains(\"highlightShippingNode\")) {\n          shippingNode.classList.add(\"highlightShippingNode\");\n          getCollection(\".shippingmethod__details\", shippingNode).forEach((detailsSection) => {\n            detailsSection.classList.remove(\"is-hidden\");\n            if (detailsSection.hasAttribute(\"data-method-toshi\")) {\n              shippingNode.classList.add(\"toshi-method\");\n              initToshiDetails(detailsSection);\n            }\n            const deliverySlotDateInput = select(\".delivery_slot_date\", detailsSection);\n            if (deliverySlotDateInput) {\n              deliverySlotDateInput.setAttribute(\"name\", \"delivery_slot_date\");\n            }\n            getCollection(\"select\", detailsSection).forEach((selectBox) => {\n              selectBox.setAttribute(\"name\", selectBox.dataset[\"name\"]);\n            });\n          });\n        }\n      }\n    });\n  }\n  function sendShippingDataToDatalayer() {\n    let shippingOptions = selectAll(\"input[data-shippingmethod-analytics]\");\n    if (shippingOptions) {\n      let name = \"\";\n      shippingOptions.forEach((shippingNode) => {\n        if (shippingNode.dataset[\"shippingmethodAnalytics\"]) {\n          name += `${shippingNode.dataset[\"shippingmethodAnalytics\"]}|`;\n        }\n      });\n      let nameAndPrice = name.substring(0, name.length - 1);\n      if (nameAndPrice) {\n        document.DLKit.push(\"when-shipping-methods-display\", {\n          eventAction: \"display\",\n          eventLabel: nameAndPrice,\n        });\n      }\n    }\n  }\n  function selectDeliveryMethod(e) {\n    deliveryCalendar = new deliveryMethodCalendar();\n    var selectOpt;\n    if (!(e && e.delegateTarget)) {\n      selectOpt = select('input[name=\"deliveryOptions\"]:checked');\n    } else {\n      selectOpt = select('input[type=\"radio\"]', e.delegateTarget);\n    }\n    const PSOptionWrapper = select(\".POSOptionWrapper\");\n    const shippingAddressSection = select(\".shippingAddressSection\");\n    const cartPriceEle = select(\".cart-product-list\");\n    const customerEle = select(\".customer\");\n    const customerAsideEle = select(\".customer__aside\");\n    const stickyMap = select(\".POSMap\");\n\n    if (selectOpt) {\n      selectOpt.checked = true;\n      var inputs = selectAll('input[name=\"deliveryOptions\"]')\n      if (inputs) {\n        var inputs_length = inputs.length;\n        const cncOption = select('input[id=\"clickAndCollect\"]')\n        const homeDeliveryOption = select('input[id=\"homeDelivery\"]')\n        if (cncOption && homeDeliveryOption && inputs_length > 1) {\n          addhomeDeliveryCnCAnalytics()\n        }\n        var i = 0;\n        for (; i < inputs_length; i++) {\n          if (inputs[i].checked === true) {\n            inputs[i].closest(\"div\").classList.add(\"selectedOpt\");\n            inputs[i].closest(\"div\").classList.remove(\"unSelectedOpt\");\n            if (inputs[i].id === \"clickAndCollect\") {\n              isCncDeliveryMode = true;\n              posDataLayerUpdate(\"CnC\", inputs[i].id);\n              if (selectAll('input[name=\"posName\"]').length > 5 && !isMobileScreen()) {\n                if (customerAsideEle) {\n                  customerAsideEle.classList.add(\"customerAsideSticky\");\n                  customerAsideEle.style.top = \"-\" + (cartPriceEle.offsetHeight + 80);\n                }\n                if (customerEle) {\n                  customerEle.style.overflow = \"initial\";\n                }\n                if (stickyMap) {\n                  stickyMap.classList.add(\"POSMapSticky\");\n                }\n              }\n              var selectedPosId = select('input[name=\"posName\"]:checked');\n              var lat;\n              var long;\n              var id;\n              if (selectedPosId) {\n                lat = selectedPosId.getAttribute(\"data-lat\");\n                long = selectedPosId.getAttribute(\"data-lng\");\n                id = selectedPosId.getAttribute(\"id\");\n                initializeMap(lat, long, id);\n              }\n              if (PSOptionWrapper) {\n                PSOptionWrapper.closest(\"fieldset\").removeAttribute(\"hidden\");\n                shippingAddressSection.setAttribute(\"hidden\", \"\");\n                var inputPOS = selectAll('input[name=\"posName\"]');\n                if (inputPOS) {\n                  var totalPOS = inputPOS.length;\n                  if (totalPOS === 1) {\n                    inputPOS[0].checked = true;\n                    select(\".moreDetailsPOS\", inputPOS[0].closest(\"li\")).removeAttribute(\"hidden\");\n                    select(\".leadTimeExpended\", inputPOS[0].closest(\"li\")).removeAttribute(\"hidden\");\n                    select(\".leadTimeCollapsed\", inputPOS[0].closest(\"li\")).setAttribute(\"hidden\", \"\");\n                  }\n                }\n              }\n            } else {\n              isCncDeliveryMode = false;\n              if (stickyMap) {\n                stickyMap.classList.remove(\"POSMapSticky\");\n              }\n              if (customerAsideEle) {\n                customerAsideEle.removeAttribute(\"style\");\n                customerAsideEle.classList.remove(\"customerAsideSticky\");\n              }\n              if (customerEle) {\n                customerEle.removeAttribute(\"style\");\n              }\n            }\n            focusElement(inputs[i], { notChangeTabIndex: true });\n          } else {\n            inputs[i].closest(\"div:not(.notAvailableOpt)\").classList.add(\"unSelectedOpt\");\n            inputs[i].closest(\"div\").classList.remove(\"selectedOpt\");\n            if (PSOptionWrapper) {\n              PSOptionWrapper.closest(\"fieldset\").setAttribute(\"hidden\", \"\");\n            }\n            shippingAddressSection.removeAttribute(\"hidden\");\n          }\n        }\n      }\n    } else {\n      if (config.country.toLowerCase() == \"us\" && !isWideScreen()) {\n        let posMap = select(\".POSMap\");\n        if (posMap) {\n          posMap.setAttribute(\"hidden\", \"\");\n        }\n      }\n    }\n    shippingOptionHighlight();\n    sendShippingDataToDatalayer();\n    const weekendDeliverySelect = select('select', document.getElementById(\"weekendDeliveryOptions\"))\n    if (weekendDeliverySelect) {\n      handleChange(weekendDeliverySelect);\n    }\n  }\n  window.onload = function () {\n    const isChallengeShopper = select(\"#challengeShopperId\");\n    if (isChallengeShopper) {\n      initThreeDS2Popin();\n    }\n    selectDeliveryMethod();\n    const giftCardList = select(\".giftCard__List\");\n    if (giftCardList) {\n      const paymentCreditCard = select(\"#payment-creditcard\");\n      paymentCreditCard.removeAttribute(\"disabled\");\n    }\n    const nonSelectedPOSList = selectAll('.POSElement');\n    if (nonSelectedPOSList.length === 1) {\n      loadMapOnPageLoad();\n    }\n    const preSelectedPOS = select('input[name=\"posGeoLocation\"]')\n    if (preSelectedPOS) loadMapOnPageLoad();\n    const pymtError = select(\".pending-payment-error\")\n    if (pymtError) {\n      pushDataEvent()\n      pymtError.focus();\n     }\n  };\n\n  function pushDataEvent () {\n    dataLayer.push({\n        'eventCategory': 'payment in progress',\n        'eventAction': 'display',\n        'eventLabel': '',\n        'event':  'uaevent'\n     });\n  }\n\n  function selectPOSAddress(e) {\n    var selectPOS = e.delegateTarget;\n    if (!selectPOS) {\n      selectPOS = e;\n    }\n    const lat = selectPOS.getAttribute(\"data-lat\");\n    const long = selectPOS.getAttribute(\"data-lng\");\n    const id = selectPOS.getAttribute(\"id\");\n    const posValue = selectPOS.getAttribute(\"value\");\n    const skipStoreMapTop = select(\"#skip_storemap_top\")\n    const skipStoremapBottom = select(\"#skip_storemap_bottom\")\n    if (skipStoreMapTop) {\n      skipStoreMapTop.removeAttribute(\"aria-hidden\")\n      skipStoreMapTop.removeAttribute(\"tabindex\")\n      skipStoreMapTop.parentElement.removeAttribute(\"aria-hidden\")\n    }\n    if (skipStoremapBottom) {\n      skipStoremapBottom.removeAttribute(\"aria-hidden\")\n      skipStoremapBottom.removeAttribute(\"tabindex\")\n      skipStoremapBottom.parentElement.removeAttribute(\"aria-hidden\")\n    }\n    posDataLayerUpdate(\"posMap\", posValue);\n    initializeMap(lat, long, id);\n\n    if (selectPOS) {\n      selectPOS.checked = true;\n      var inputs = selectAll('input[name=\"posName\"]');\n      if (inputs) {\n        var inputs_length = inputs.length;\n        var j = 0;\n        for (; j < inputs_length; j++) {\n          if (inputs[j].checked === true) {\n            select(\".moreDetailsPOS\", inputs[j].closest(\"li\")).removeAttribute(\"hidden\");\n            select(\".leadTimeExpended\", inputs[j].closest(\"li\")).removeAttribute(\"hidden\");\n            select(\".leadTimeCollapsed\", inputs[j].closest(\"li\")).setAttribute(\"hidden\", \"\");\n            focusElement(inputs[j], { notChangeTabIndex: true });\n          } else {\n            select(\".moreDetailsPOS\", inputs[j].closest(\"li\")).setAttribute(\"hidden\", \"\");\n            select(\".leadTimeCollapsed\", inputs[j].closest(\"li\")).removeAttribute(\"hidden\");\n            select(\".leadTimeExpended\", inputs[j].closest(\"li\")).setAttribute(\"hidden\", \"\");\n          }\n        }\n      }\n    }\n  }\n\n  function initializeMap(lat, lng, posTitle) {\n    var map;\n    var style = [\n      {\n        elementType: \"labels.icon\",\n        stylers: [\n          {\n            visibility: \"off\",\n          },\n        ],\n      },\n    ];\n    var center = new google.maps.LatLng(lat, lng);\n    var mapOptions = {\n      center: center,\n      mapTypeId: google.maps.MapTypeId.ROADMAP,\n      disableDefaultUI: true,\n      zoomControl: true,\n      gestureHandling: \"greedy\",\n    };\n    var mobileMapElement = select(\"#googleMapMobile-\" + posTitle);\n    let posMapBlock = select(\".POSMap\");\n    if (isMobile) {\n      if (posMapBlock) posMapBlock.setAttribute(\"hidden\", \"\")\n      if (mobileMapElement) {\n        mobileMapElement.closest(\".POSMapMobile\").removeAttribute(\"hidden\");\n        map = new google.maps.Map(mobileMapElement, mapOptions);\n      }\n    }\n    else if (isTabletScreen()) {\n      if (posMapBlock) posMapBlock.setAttribute(\"hidden\", \"\")\n      if (mobileMapElement) {\n        mobileMapElement.closest(\".POSMapMobile\").removeAttribute(\"hidden\");\n        map = new google.maps.Map(mobileMapElement, mapOptions);\n      }\n    }\n    else if (isWideScreen()) {\n      if (mobileMapElement) {\n        mobileMapElement.closest(\".POSMapMobile\").setAttribute(\"hidden\", \"\");\n      }\n      if (posMapBlock) posMapBlock.removeAttribute(\"hidden\")\n      map = new google.maps.Map(document.getElementById(\"googleMap\"), mapOptions);\n    }\n    var mapType = new google.maps.StyledMapType(style, { name: \"Grayscale\" });\n    map.mapTypes.set(\"grey\", mapType);\n    map.setMapTypeId(\"grey\");\n    var latlngbounds = new google.maps.LatLngBounds();\n    var latLng = { lat: Number(lat), lng: Number(lng) };\n    var pt = new google.maps.LatLng(lat, lng);\n    var marker_image = `${config.theme}/assets/media/pin-black.png`;\n    var pinIcon = new google.maps.MarkerImage(marker_image, null, null, null, new google.maps.Size(22, 22));\n    var marker = new google.maps.Marker({\n      position: latLng,\n      map: map,\n      icon: pinIcon,\n    });\n    latlngbounds.extend(marker.position);\n    marker.addListener(\"click\", function () {\n      selectPOSNow(posTitle);\n    });\n    if (posTitle) {\n      map.setCenter(pt);\n      map.setZoom(17);\n    } else {\n      if (!isMobileScreen()) {\n        var bounds = new google.maps.LatLngBounds();\n        map.setCenter(latlngbounds.getCenter());\n        map.fitBounds(latlngbounds);\n      }\n    }\n  }\n\n  function selectPOSNow(posId) {\n    if (posId) {\n      var posElement = select(`#${posId}`);\n      if (posElement) {\n        posElement.checked = true;\n        selectPOSAddress(posElement);\n      }\n    }\n  }\n  /**\n   * hide the new card form if user clicks\n   * edit card link of saved cards without\n   * selecting its radio button\n   */\n  function hideNewCardForm(e) {\n    const paymentMethodBlock = select(\"#payment-method-block\");\n    const paymentIdEdit = select('input[name=\"paymentId\"]');\n    if (paymentMethodBlock && paymentIdEdit) {\n      hideBlock(paymentMethodBlock);\n      const form = select(\"#sopPaymentDetailsForm\");\n      const selectedCard = select('input[name=\"subscriptionId\"]:not([id=payment-method-add])');\n      if (selectedCard) {\n        const formAction = selectedCard.getAttribute(\"data-formaction\");\n        if (formAction) {\n          form.action = formAction;\n        }\n      }\n    }\n  }\n\n  function loadMaponEditBoutique() {\n    var selectedPosId = select('input[name=\"posName\"]:checked');\n    if (selectedPosId) {\n      const lat = selectedPosId.getAttribute(\"data-lat\");\n      const long = selectedPosId.getAttribute(\"data-lng\");\n      initializeMap(lat, long, selectedPosId);\n      focusElement(selectedPosId, { notChangeTabIndex: true });\n    }\n  }\n\n  function loadGmoDeviceFingerUrl() {\n    // load Gmo Device Finger url on body\n    let script = document.createElement('script')\n    script.src = `${window.config.webservices.gmo.gmoDeviceFingerUrl}`\n    script.type = 'text/javascript'\n    script.onload = function( evt ) {\n      document.body.removeChild ( this )\n    }\n    document.body.appendChild(script)\n  }\n\n  function selectPaymentFocusIn() {\n    selectAll('[name=\"payment\"]').forEach((inputs) => {\n      if (document.activeElement === inputs) {\n        inputs.closest(\"li\").style.border = \"1px solid\";\n      } else {\n        inputs.closest(\"li\").removeAttribute(\"style\");\n      }\n    });\n  }\n\n  function selectPaymentFocusOut() {\n    selectAll('[name=\"payment\"]').forEach((inputs) => {\n      inputs.closest(\"li\").removeAttribute(\"style\");\n    });\n  }\n\n  function selectPaymentType(e) {\n    const paymentTypeEl = e.delegateTarget;\n    const giftcardEl = select(\".js-giftCard\");\n    const codPaymentEl = select(\"#payment-cod\");\n    var setTrustlyEl = select(\".js-trustly\");\n    paymentTypeEl.checked = true;\n    if (paymentTypeEl) {\n      selectAll('[name=\"payment\"]').forEach((inputs) => {\n        if (paymentTypeEl.id === inputs.id) {\n          inputs.closest(\"li\").removeAttribute(\"style\");\n          inputs.closest(\"li\").classList.add(\"selected\");\n          focusElement(inputs, { notChangeTabIndex: true });\n          inputs.setAttribute(\"checked\", \"checked\");\n          inputs.removeAttribute(\"tabindex\");\n          inputs.closest(\"li\").style.border = \"1px solid\";\n        } else {\n          inputs.closest(\"li\").classList.remove(\"selected\");\n          inputs.removeAttribute(\"checked\");\n          inputs.removeAttribute(\"tabindex\");\n          inputs.closest(\"li\").removeAttribute(\"style\");\n        }\n      });\n    }\n    if (paymentTypeEl) {\n      if (select(\"#payment-giftcard\")) {\n        select(\"#payment-giftcard\").closest(\"li\").classList.remove(\"giftcard-black\");\n        select(\"#payment-giftcard\").closest(\"li\").classList.add(\"giftcard-white\");\n      }\n      const id = paymentTypeEl.getAttribute(\"id\");\n\n      if (setTrustlyEl) {\n        setTrustlyEl.innerHTML = `<svg class=\"icon trustly\" focusable=\"false\" aria-hidden=\"true\">\n              <use xlink:href=\"${config.paths.icons}icons.svg${config.targetVersion}#${id === \"payment-trustly\" ? 'trustly' : 'trustly-grey-bg'}\" />\n              </svg><span class=\"is-sr-only\">Trustly</span>`;\n      }\n      if (id === \"payment-creditcard\") {\n        var setOptionalEl = select('input[name=\"card_cvn_optional\"]');\n        if (setOptionalEl) {\n          setOptionalEl.removeAttribute(\"required\");\n          setOptionalEl.setAttribute(\"aria-required\", false);\n        }\n      }\n      if(codPaymentEl){\n        if (id !== \"payment-cod\") {\n          updateCodPayment(\"remove\");\n        } else {\n          updateCodPayment(\"apply\");\n        }\n      }\n      if (id === \"payment-applePay\") {\n        const termCondErrorMsgEl = select(\"#error-setTermCondition_applePay\");\n        const labeltermCondition = select('label[for=\"setTermCondition_applePay\"]');\n        if (termCondErrorMsgEl && labeltermCondition) {\n          labeltermCondition.removeChild(termCondErrorMsgEl);\n        }\n      }\n      if (id === \"payment-giftcard\") {\n        const formElm = select(\"form#sopPaymentDetailsForm\");\n        const giftMethodEl = select(\"#giftcard-method\");\n        localStorage.setItem(\"defaultAction\", formElm.getAttribute(\"action\"));\n        if (giftcardEl) {\n          if (giftMethodEl && giftMethodEl.classList.contains(HIDDEN_CLASSNAME)) {\n            giftMethodEl.classList.remove(HIDDEN_CLASSNAME);\n            giftMethodEl.removeAttribute(\"aria-hidden\");\n            const fields = selectAll(\"input\", giftMethodEl);\n            fields.forEach((field) => {\n              field.removeAttribute(\"disabled\");\n              field.setAttribute(\"required\", true);\n              field.setAttribute(\"aria-required\", true);\n            });\n          }\n          paymentTypeEl.closest(\"li\").classList.remove(\"giftcard-white\");\n          paymentTypeEl.closest(\"li\").classList.add(\"giftcard-black\");\n          giftcardEl.innerHTML = \"\";\n          giftcardEl.innerHTML = `<svg class=\"icon is-boxes-giftcard-white\" focusable=\"false\" aria-hidden=\"true\">\n              <use xlink:href=\"${config.paths.icons}icons.svg${config.targetVersion}#boxes_giftcard\" />\n              </svg><span class=\"is-sr-only\">Chanel Gift card</span>`;\n        }\n      } else {\n        if (giftcardEl) {\n          giftcardEl.innerHTML = `<svg class=\"icon\" focusable=\"false\" aria-hidden=\"true\">\n                <use xlink:href=\"${config.paths.icons}icons.svg${config.targetVersion}#boxes_giftcard\" />\n                </svg><span class=\"is-sr-only\">Chanel Gift card</span>`;\n        }\n      }\n    }\n  }\n\n  function updateCodPayment(op) {\n    xhr.post(config.webservices.checkout.codOperation + op, {}).then((data) => {\n      if (data.success) {\n        updateSteps(data);\n      }\n    });\n  }\n\n  function selectSavedCard(e) {\n    var selectedCard = e.delegateTarget;\n    if (!selectedCard) {\n      selectedCard = e;\n    }\n    const id = selectedCard.getAttribute(\"id\");\n    if (selectedCard) {\n      selectedCard.checked = true;\n      var inputs = selectAll('input[name=\"subscriptionId\"]');\n      var selectedCvvId = \"\";\n      if (inputs) {\n        var inputs_length = inputs.length;\n        var j = 0;\n        for (; j < inputs_length; j++) {\n          if (inputs[j].checked === true) {\n            if (inputs[j].id == \"payment-method-add\") {\n              var setDefaultEl = select(\"#setDefaultPaymentMethod\");\n              if (setDefaultEl) {\n                setDefaultEl.removeAttribute(\"required\");\n                setDefaultEl.setAttribute(\"aria-required\", false);\n                setDefaultEl.setAttribute(\"disabled\", true);\n              }\n              var setSavePaymentMethodEl = select(\"#savePaymentMethod\");\n              if (setSavePaymentMethodEl) {\n                setSavePaymentMethodEl.removeAttribute(\"required\");\n                setSavePaymentMethodEl.setAttribute(\"aria-required\", false);\n              }\n              if (setSavePaymentMethodEl.checked) {\n                setDefaultEl.removeAttribute(\"disabled\");\n              }\n              selectedCvvId = \"card_cvn\";\n            } else {\n              selectedCvvId = \"card_cvn\" + inputs[j].value;\n            }\n          }\n          if (inputs[j].id !== \"payment-method-add\") {\n            var cvvLabelElement = select(\"#card-cvv-block-\" + inputs[j].value);\n            if (inputs[j].checked === true && cvvLabelElement) {\n              cvvLabelElement.removeAttribute(\"class\");\n              cvvLabelElement.removeAttribute(\"hidden\");\n              focusElement(inputs[j], { notChangeTabIndex: true });\n            } else {\n              if (cvvLabelElement) {\n                cvvLabelElement.setAttribute(\"hidden\", \"\");\n                cvvLabelElement.removeAttribute(\"class\");\n              }\n            }\n          }\n        }\n      }\n      selectAll(\".js-card-cvn\").forEach((cvnInputField) => {\n        if (cvnInputField.id == selectedCvvId) {\n          cvnInputField.setAttribute(\"name\", \"card_cvn\");\n          cvnInputField.setAttribute(\"data-encrypted-name\", \"cvc\");\n        } else {\n          cvnInputField.setAttribute(\"name\", \"card_cvn_optional\");\n          cvnInputField.setAttribute(\"data-encrypted-name\", \"cvc_optional\");\n          cvnInputField.setAttribute(\"disabled\", \"disabled\");\n        }\n      });\n    }\n  }\n\n  /**\n   * Update Analytics data for Continue to shipping Options\n   */\n  function addDeliveryAnalytics() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: window.config.dl.event,\n      eventCategory: \"delivery\",\n      eventAction: \"home delivery\",\n      eventLabel: \"continue\",\n    });\n  }\n\n  function addcncDeliveryAnalytics() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: window.config.dl.event,\n      eventCategory: \"delivery\",\n      eventAction: \"click and collect\",\n      eventLabel: \"continue\",\n    });\n  }\n\n  /**\n   * Update Analytics data for Continue to shipping Options\n   */\n  function updateAnalyticsShippingOptions() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: window.config.dl.event,\n      eventCategory: \"delivery\",\n      eventAction: \"click\",\n      eventLabel: \"edit address\",\n    });\n  }\n\n  /**\n   * Update Analytics data for Edit an address for registered users\n   */\n  function updateAnalyticsEditAddress() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: window.config.dl.event,\n      eventCategory: \"delivery\",\n      eventAction: \"click\",\n      eventLabel: \"edit details\",\n    });\n  }\n\n  function editboutiqueLayerUpdate() {\n    window.document.DLKit.push(\"on-tracking\", {\n      eventCategory: \"delivery\",\n      eventAction: \"click\",\n      eventLabel: \"edit boutique\",\n      event: \"uaevent\",\n    });\n  }\n\n  /**\n   * Update Analytics data for Add an address for registered users\n   */\n  function updateAnalyticsAddAddress() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: window.config.dl.event,\n      eventCategory: \"delivery\",\n      eventAction: \"click\",\n      eventLabel: \"add a new address\",\n    });\n  }\n\n  /**\n   * Update Analytics data for Continue as a guest / Create an account\n   */\n  function updateAnalyticsUserOpc(id) {\n    switch (id) {\n      case \"checkout-guest-sign-in\":\n        window.document.DLKit.push(\"on-tracking\", {\n          event: window.config.dl.event,\n          eventCategory: \"account\",\n          eventAction: \"redirection\",\n          eventLabel: \"continue as a guest\",\n        });\n        break;\n      case \"checkout-register\":\n        window.document.DLKit.push(\"on-tracking\", {\n          event: window.config.dl.event,\n          eventCategory: \"account\",\n          eventAction: \"redirection\",\n          eventLabel: \"create an account\",\n        });\n        break;\n    }\n  }\n\n  function updateAnalyticsContinueAsGuest() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: window.config.dl.event,\n      eventCategory: \"guest\",\n      eventAction: \"click\",\n      eventLabel: \"continue to delivery\",\n    });\n  }\n\n  function updateAnalyticsOpcEdit() {\n    window.document.DLKit.push(\"on-tracking\", {\n      eventCategory: \"checkout\",\n      eventAction: \"click and collect\",\n      eventLabel: \"edit\",\n      event: \"uaevent\",\n    });\n  }\n\n  /**\n   * Update Analytics data for click and collect\n   * and select POS functionality\n   */\n  function posDataLayerUpdate(type, title) {\n    const posListArray = selectAll('input[name=\"posName\"]');\n    var totalPOS;\n    if (posListArray) {\n      totalPOS = posListArray.length;\n    }\n    var dataset;\n    switch (type) {\n      case \"CnC\":\n        dataset = {\n          eventCategory: window.config.dl.opc.deliveryMethod.method,\n          eventAction: window.config.dl.opc.deliveryMethod.cnc,\n          event: window.config.dl.event,\n          eventLabel: title,\n          click_and_collect_number_of_store: totalPOS,\n        };\n        break;\n      case \"posMap\":\n        dataset = {\n          eventCategory: window.config.dl.opc.deliveryMethod.method,\n          eventAction: window.config.dl.opc.deliveryMethod.eventActionMap,\n          event: window.config.dl.event,\n          eventLabel: title,\n          click_and_collect_number_of_store: totalPOS,\n        };\n        break;\n      default:\n        var selectedPosId = select('input[name=\"posName\"]:checked');\n        if (selectedPosId) title = selectedPosId.getAttribute(\"value\");\n        dataset = {\n          eventCategory: window.config.dl.opc.deliveryMethod.method,\n          eventAction: window.config.dl.opc.deliveryMethod.eventActionList,\n          event: window.config.dl.event,\n          eventLabel: title,\n          click_and_collect_number_of_store: totalPOS,\n        };\n        break;\n    }\n    window.document.DLKit.push(\"on-tracking\", dataset);\n  }\n\n  function addhomeDeliveryCnCAnalytics() {\n    window.dataLayer.push({\n      'eventCategory': 'delivery',\n      'eventAction': 'display',\n      'eventLabel': 'home delivery|click and collect',\n      'event':  'nievent'\n    });\n  }\n\n  defaultPaymentMethod();\n\n  function defaultPaymentMethod() {\n    const paymentDetailsForm = select(\"#sopPaymentDetailsForm\");\n    const creditCardOption = select(\"#payment-creditcard\");\n    if (paymentDetailsForm) {\n      if (creditCardOption) {\n        creditCardOption.click();\n      }\n    }\n  }\n\n  function handleSMSNotification(form) {\n    if (form.invalid.length) {\n      return;\n    }\n    xhr\n      .submit(form)\n      .then((data) => {\n        if (data.success) {\n          select('button[type=\"submit\"]', form).innerHTML = `\n            <svg class=\"icon is-medium is-checked\" focusable=\"false\" viewBox=\"0 0 1 1\" aria-hidden=\"true\" data-test=\"\">\n              <use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"${config.paths.icons}icons.svg${config.targetVersion}#checked\"></use>\n            </svg>\n            <span class=\"is-sr-only\">${window.config.dl.opc.numberSubmitted}</span>`;\n          if (select(\".js-btn-submit\")) select(\".js-btn-submit\").setAttribute(\"disabled\", true);\n          const countryCode = select(\"#countryCodeID\", form).value;\n          const mobileNumber = select(\"#smsContactNo\", form).value;\n          if (countryCode !== \"\" && mobileNumber !== \"\") {\n            let code = countryCode.replace(/\\D/g, \"\");\n            if (select(\"#numberWithCode\")) select(\"#numberWithCode\").innerHTML = `+${code} ${mobileNumber}`;\n            if (select(\"#notificationUnSubscriptionForm\")) select(\"#notificationUnSubscriptionForm\").action = select(\"#smsUnSubscriptionUrl\").value;\n            selectAll('[name=\"contactNumber\"]').forEach((inptPhone) => {\n              inptPhone.value = data.phoneCountryCode + \"\" + data.phoneNumber;\n            });\n            selectAll('[name=\"modifiedTime\"]').forEach((inpt) => {\n              inpt.value = data.modifiedTime;\n            });\n          }\n\n          setTimeout(function () {\n            if (select(\"#notification-form\")) select(\"#notification-form\").setAttribute(\"hidden\", \"\");\n            if (select(\"#notification-subscribed\")) select(\"#notification-subscribed\").removeAttribute(\"hidden\");\n            if (select(\".js-change-number\")) focusElement(select(\".js-change-number\"));\n          }, 3000);\n        }\n      })\n      .catch((data) => {\n        if (select(\".js-btn-save\")) select(\".js-btn-save\").classList.remove(\"is-disabled\");\n        displayError(data, form);\n      });\n  }\n\n  function updateSMSNumber(e) {\n    if (select(\"#notification-subscribed\")) select(\"#notification-subscribed\").setAttribute(\"hidden\", \"\");\n    if (select(\"#notification-form\")) select(\"#notification-form\").removeAttribute(\"hidden\");\n    if (select(\"#js-btn-submit\")) select(\"#js-btn-submit\").setAttribute(\"hidden\", \"\");\n    if (select(\"#js-btn-save\")) select(\"#js-btn-save\").removeAttribute(\"hidden\");\n    if (select(\".js-btn-save\")) select(\".js-btn-save\").classList.remove(\"is-disabled\");\n    if (select(\"#smsContactNo\") && select(\"#numberWithCode\")) {\n      select(\"#smsContactNo\").value = select(\"#numberWithCode\").innerHTML.substring(2).trim();\n      focusElement(select(\"#smsContactNo\"), { notChangeTabIndex: true });\n    }\n    if (select(\"#notificationSubscriptionForm\") && select(\"#smsUpdateSubscriptionUrl\")) select(\"#notificationSubscriptionForm\").action = select(\"#smsUpdateSubscriptionUrl\").value;\n    e.preventDefault();\n  }\n\n  function cancelUpdateSMSNumber(e) {\n    if (select(\"#notification-form\")) select(\"#notification-form\").setAttribute(\"hidden\", \"\");\n    if (select(\"#notification-subscribed\")) select(\"#notification-subscribed\").removeAttribute(\"hidden\");\n    if (select(\"#notificationSubscriptionForm\") && select(\"#smsUnSubscriptionUrl\")) select(\"#notificationSubscriptionForm\").action = select(\"#smsUnSubscriptionUrl\").value;\n    if (select(\".js-change-number\")) focusElement(select(\".js-change-number\"));\n    e.preventDefault();\n  }\n\n  function handleSubscribeAgain() {\n    const form = select(\"#notificationSubscriptionForm\");\n    if (select(\"#smsSubscriptionUrl\")) form.action = select(\"#smsSubscriptionUrl\").value;\n    if (select(\"#notification-unsubscribed\")) select(\"#notification-unsubscribed\").setAttribute(\"hidden\", \"\");\n    if (select(\"#notification-form\")) select(\"#notification-form\").removeAttribute(\"hidden\");\n    if (select(\"#js-btn-submit\")) select(\"#js-btn-submit\").removeAttribute(\"hidden\");\n    select(\".js-btn-submit\", form).innerHTML = `\n         <span class=\"button__wrapper\"><span>${window.config.dl.opc.signUpCta}</span></span>`;\n    if (select(\"#js-btn-save\")) select(\"#js-btn-save\").setAttribute(\"hidden\", \"\");\n    if (select(\"#smsContactNo\")) {\n      select(\"#smsContactNo\").value = \"\";\n      focusElement(select(\"#smsContactNo\"), { notChangeTabIndex: true });\n    }\n  }\n\n  function handleUnsubscribe(form) {\n    if (form.invalid.length) {\n      return;\n    }\n    if (select(\".js-change-number\")) select(\".js-change-number\").classList.add(\"disabled-btn\");\n    xhr\n      .submit(form)\n      .then((data) => {\n        if (data.success) {\n          if (select(\"#notification-subscribed\")) select(\"#notification-subscribed\").setAttribute(\"hidden\", \"\");\n          if (select(\"#notification-unsubscribed\")) select(\"#notification-unsubscribed\").removeAttribute(\"hidden\");\n          selectAll('[name=\"modifiedTime\"]').forEach((inpt) => {\n            inpt.value = data.modifiedTime;\n          });\n          const pElement = select(\"p.unsubscribed\");\n          if (pElement) {\n            focusElement(pElement);\n            if (select(\".js-change-number\")) select(\".js-change-number\").classList.remove(\"disabled-btn\");\n          }\n        }\n      })\n      .catch((data) => {\n        displayError(data, form);\n      });\n  }\n\n  /**\n   * Update class of input's parent if input has value\n   */\n\n  function updateInputs() {\n    const selectPhoneInput = select(\"input[data-phone-pattern-code]\", document.body);\n\n    if (selectPhoneInput && selectPhoneInput.value !== \"\") {\n      const wrapper = selectPhoneInput.closest(\".js-label-input\");\n      !wrapper.classList.contains(\"has-content\") ? wrapper.classList.add(\"has-content\") : null;\n    }\n  }\n\n  /**\n   * Update Analytics data for\n   * view shipping rules link\n   */\n  function shippingRulesDataLayerUpdate() {\n    var dataset = {\n      eventCategory: \"delivery\",\n      eventAction: \"click\",\n      eventLabel: \"shipping rules\",\n      event: \"uaevent\",\n    };\n    window.document.DLKit.push(\"on-tracking\", dataset);\n  }\n\n  function giftCardDataLayerUpdate(message) {\n    var dataset = {\n      eventCategory: \"card balance\",\n      eventAction: \"error\",\n      eventLabel: message,\n      event: \"nievent\",\n    };\n    window.document.DLKit.push(\"on-tracking\", dataset);\n  }\n\n  function changePaymentType(e) {\n    e.preventDefault();\n    const paymentModeSelector = select(\"#paymentModeSelector\");\n    const giftCardPaymentHeader = select(\"#giftCardPaymentHeader\");\n    const giftCardBtn = select(\"#payment-giftcard\");\n    const creditCardBtn = select(\"#payment-creditcard\");\n    const MODULE_SELECTOR = \"[data-form-toggle-display]\";\n    const giftCardListDisplay = select(\"#giftcard-display-list\");\n    giftCardListDisplay ? (giftCardListDisplay.innerHTML = \"\") : \"\";\n    paymentModeSelector ? paymentModeSelector.classList.remove(HIDDEN_CLASSNAME) : \"\";\n    giftCardPaymentHeader ? giftCardPaymentHeader.setAttribute(\"hidden\", true) : \"\";\n\n    xhr.post(config.webservices.checkout.removeGiftCard, {}).then((data) => {\n      renderGiftCardSection(data, true);\n      const formElm = select(\"form#sopPaymentDetailsForm\");\n      const selectedCard = select(\"#payment-method-add\");\n      if (selectedCard.checked) {\n        formElm.action = selectedCard.getAttribute(\"data-formaction\");\n      } else {\n        const selectedCardDefault = select('input[name=\"subscriptionId\"]:not([id=payment-method-add])');\n        formElm.action = selectedCardDefault.getAttribute(\"data-formaction\");\n      }\n    });\n\n    if (creditCardBtn && giftCardBtn) {\n      creditCardBtn.checked = true;\n      creditCardBtn.setAttribute(\"checked\", \"checked\");\n      giftCardBtn.checked = false;\n      giftCardBtn.removeAttribute(\"checked\", \"checked\");\n    }\n\n    const evtParams = {\n      bubbles: true,\n      cancelable: false,\n    };\n    const evt = new window.CustomEvent(\"change\", evtParams);\n    Array.prototype.forEach.call(document.querySelectorAll(MODULE_SELECTOR), (el) => {\n      if (el.checked) {\n        el.dispatchEvent(evt);\n        focusElement(creditCardBtn, { notChangeTabIndex: true });\n      }\n    });\n  }\n\n  function updateGiftCardList(e) {\n    e.preventDefault();\n    const checkTermCondEl = select(\"#setTermCondition_applePay\");\n    if (checkTermCondEl) {\n      checkTermCondEl.removeAttribute(\"required\", true);\n    }\n    const giftForm = e.delegateTarget.form || e.delegateTarget;\n    if (giftForm.checkValidity() && select(\"input[id=giftCardNumber]\", giftForm).value.length > 0 && select(\"input[id=giftCardCvn]\", giftForm).value.length > 0) {\n      giftForm.action = config.webservices.checkout.addGiftCard;\n      let paramsData = {\n        gift_card_number: select(\"input[id=giftCardNumber]\", giftForm).value,\n        gift_card_cvn: select(\"input[id=giftCardCvn]\", giftForm).value,\n      };\n      xhr.submit(giftForm).then((paramsData) => {\n        renderGiftCardSection(paramsData, false);\n        const giftCardTitleEl = select(\".gift-card-main\");\n        giftCardTitleEl ? focusElement(giftCardTitleEl) : \"\";\n        let paymentModeSelector = select(\"#paymentModeSelector\");\n        paymentModeSelector ? paymentModeSelector.classList.add(HIDDEN_CLASSNAME) : \"\";\n        let giftCardPaymentHeader = select(\"#giftCardPaymentHeader\");\n        giftCardPaymentHeader ? giftCardPaymentHeader.removeAttribute(\"hidden\") : \"\";\n      });\n    } else {\n      let giftCardNo = select(\"#giftCardNumber\").getAttribute(\"aria-invalid\");\n      let giftCardCvn = select(\"#giftCardCvn\").getAttribute(\"aria-invalid\");\n      if (giftCardNo) {\n        focusElement(select(\"#giftCardNumber\"), { notChangeTabIndex: true });\n        return;\n      }\n      if (giftCardCvn) {\n        focusElement(select(\"#giftCardCvn\"), { notChangeTabIndex: true });\n        return;\n      }\n    }\n  }\n\n  function renderGiftCardSection(data, defaultUrl) {\n    if (data.jsonData.success) {\n      let paymentModeSelector = select(\"#paymentModeSelector\");\n      let giftCardPaymentHeader = select(\"#giftCardPaymentHeader\");\n      if (data.jsonData.giftCardList.length > 0) {\n        paymentModeSelector.classList.add(HIDDEN_CLASSNAME);\n        giftCardPaymentHeader.removeAttribute(\"hidden\");\n      } else {\n        giftCardPaymentHeader.setAttribute(\"hidden\", true);\n        paymentModeSelector.classList.remove(HIDDEN_CLASSNAME);\n      }\n      let wrapper = select(\"#giftcard-method-wrapper\");\n      wrapper.innerHTML = data.html;\n      if (!data.jsonData.successKey) {\n        let errorMessage = select(\"#giftcard-error-message\");\n        const dataErrorMessage = data.jsonData.errorMessage;\n        errorMessage.innerHTML = dataErrorMessage;\n        giftCardDataLayerUpdate(dataErrorMessage);\n        focusElement(errorMessage);\n        let giftCardForm = select(\"#giftcard_add_form\");\n        if (giftCardForm) {\n          giftCardForm.classList.remove(HIDDEN_CLASSNAME);\n          const fields = selectAll(\"input\", giftCardForm);\n          if (!defaultUrl) {\n            fields.forEach((field) => {\n              field.removeAttribute(\"disabled\");\n              field.setAttribute(\"required\", true);\n              field.setAttribute(\"aria-required\", true);\n            });\n          } else {\n            fields.forEach((field) => {\n              field.setAttribute(\"disabled\", true);\n            });\n          }\n        }\n        let addMoreGiftCard = select(\".js-giftCard-addMoreSection\");\n        addMoreGiftCard ? addMoreGiftCard.classList.add(HIDDEN_CLASSNAME) : \"\";\n      }\n      steps[\"cart_total\"].el.innerHTML = data.cart_total;\n      Manager.publish(\"bindDom\", wrapper);\n      const formElm = select(\"form#sopPaymentDetailsForm\");\n      if (formElm) {\n        if (defaultUrl) formElm.action = localStorage.getItem(\"defaultAction\");\n        else formElm.action = window.config.webservices.checkout.giftCardPlaceOrder;\n      }\n    } else {\n      // TODO - Handle Error Scenario\n    }\n  }\n\n  function removeAllGiftCards(e) {\n    e.preventDefault();\n    const removeLink = e.delegateTarget;\n    if (removeLink.classList.contains(\"display-remove-link\")) {\n      const paymentModeSelector = select(\"#paymentModeSelector\");\n      const giftCardPaymentHeader = select(\"#giftCardPaymentHeader\");\n      paymentModeSelector ? paymentModeSelector.classList.remove(HIDDEN_CLASSNAME) : \"\";\n      giftCardPaymentHeader ? giftCardPaymentHeader.setAttribute(\"hidden\", true) : \"\";\n    }\n    const giftCardListDisplay = select(\"#giftcard-display-list\");\n    giftCardListDisplay ? (giftCardListDisplay.innerHTML = \"\") : \"\";\n    xhr.post(config.webservices.checkout.removeGiftCard, {}).then((data) => {\n      renderGiftCardSection(data, false);\n      const giftCardNoEl = select(\"#giftCardNumber\");\n      const giftCardCvnEl = select(\"#giftCardCvn\");\n      if (giftCardNoEl && giftCardCvnEl) {\n        giftCardNoEl.setAttribute(\"required\", \"true\");\n        giftCardCvnEl.setAttribute(\"required\", \"true\");\n        giftCardNoEl ? focusElement(giftCardNoEl, { notChangeTabIndex: true }) : \"\";\n      }\n    });\n  }\n\n  function showGiftCardForm(e) {\n    e.preventDefault();\n    const giftCardNoEl = select(\"#giftCardNumber\");\n    const giftCardForm = select(\"#giftcard_add_form\");\n    if (giftCardForm) {\n      giftCardForm.classList.remove(HIDDEN_CLASSNAME);\n      select(\".js-giftCard-addMoreSection\").classList.add(HIDDEN_CLASSNAME);\n      select(\"#giftCardCvn\").setAttribute(\"required\", \"true\");\n      if (giftCardNoEl) {\n        const giftCardLabel = select(\"h3\", giftCardForm);\n        giftCardNoEl.setAttribute(\"required\", \"true\");\n        giftCardLabel ? focusElement(giftCardLabel) : \"\";\n      }\n      getCollection(\"#giftcard_add_form input\").forEach((input) => {\n        input.removeAttribute(\"disabled\");\n      });\n    }\n  }\n\n  function hideGiftCardForm(e) {\n    e.preventDefault();\n    select(\"#giftcard_add_form\").classList.add(HIDDEN_CLASSNAME);\n    selectAll(\"#giftcard_add_form input\").forEach((input) => {\n      input.setAttribute(\"disabled\", true);\n    });\n    select(\".js-giftCard-addMoreSection\").classList.remove(HIDDEN_CLASSNAME);\n    select(\"#giftCardNumber\").removeAttribute(\"required\");\n    select(\"#giftCardCvn\").removeAttribute(\"required\");\n    const giftCardAddEl = select(\".js-show-giftCard-form-button\");\n    giftCardAddEl ? focusElement(giftCardAddEl, { notChangeTabIndex: true }) : \"\";\n    let errorMessage = select(\"#giftcard-error-message\");\n    errorMessage ? errorMessage.classList.add(HIDDEN_CLASSNAME) : \"\";\n  }\n\n  function showPaymentForm(e) {\n    e.preventDefault();\n    const paymentModeSelector = select(\"#paymentModeSelector\");\n    const giftCardPaymentHeader = select(\"#giftCardPaymentHeader\");\n    const giftCardBtn = select(\"#payment-giftcard\");\n    const creditCardBtn = select(\"#payment-creditcard\");\n    const MODULE_SELECTOR = \"[data-form-toggle-display]\";\n    const giftCardListDisplay = select(\"#giftcard-display-list\");\n    const giftCardlistDiv = select(\".giftCard__List\").innerHTML;\n    const giftCardMoreSection = select(\".js-giftCard-addMoreSection\");\n    giftCardListDisplay ? giftCardListDisplay.classList.remove(HIDDEN_CLASSNAME) : \"\";\n\n    var giftCardMethod = document.createElement(\"div\");\n    var giftCardList = document.createElement(\"div\");\n    giftCardMethod.setAttribute(\"class\", \"giftcard-method\");\n    giftCardList.setAttribute(\"class\", \"giftCard__List\");\n    giftCardMethod.appendChild(giftCardList);\n    giftCardList.innerHTML = giftCardlistDiv;\n    giftCardListDisplay ? (giftCardListDisplay.innerHTML = giftCardMethod.innerHTML) : \"\";\n    giftCardMoreSection ? giftCardMoreSection.classList.add(HIDDEN_CLASSNAME) : \"\";\n    if (creditCardBtn && giftCardBtn) {\n      creditCardBtn.checked = true;\n      creditCardBtn.setAttribute(\"checked\", \"checked\");\n      giftCardBtn.checked = false;\n      giftCardBtn.removeAttribute(\"checked\", \"checked\");\n    }\n    const evtParams = {\n      bubbles: true,\n      cancelable: false,\n    };\n    const evt = new window.CustomEvent(\"change\", evtParams);\n    Array.prototype.forEach.call(document.querySelectorAll(MODULE_SELECTOR), (el) => {\n      if (el.checked) {\n        el.dispatchEvent(evt);\n        focusElement(creditCardBtn, { notChangeTabIndex: true });\n      }\n    });\n\n    if (giftCardListDisplay) {\n      const button = select(\".js-remove-giftCard\", giftCardListDisplay);\n      const selectCardType = select(\"#selectCreditCardType\");\n      button ? button.classList.add(\"display-remove-link\") : \"\";\n      selectCardType ? focusElement(selectCardType, { notChangeTabIndex: true }) : \"\";\n      const formElm = select(\"form#sopPaymentDetailsForm\");\n      if (formElm) {\n        formElm.action = window.config.webservices.checkout.giftCardPlaceOrder;\n      }\n    }\n  }\n\n  function handleDeliverySlotDateSelection(e) {\n    let deliverySlotDateSelectBox = e.delegateTarget;\n    getCollection(\"option\", deliverySlotDateSelectBox).forEach((option) => {\n      if (option.value == deliverySlotDateSelectBox.value && option.dataset[\"timeSlotSelectboxId\"] && option.dataset[\"timeSlots\"]) {\n        getCollection(\"#\" + option.dataset[\"timeSlotSelectboxId\"]).forEach((timeSlotSelectBox) => {\n          timeSlotSelectBox.innerHTML = \"\";\n          let selectedOption;\n          JSON.parse(option.dataset[\"timeSlots\"]).timeSlots.forEach((timeSlot) => {\n            let option = document.createElement(\"option\");\n            option.value = timeSlot.value;\n            option.innerText = timeSlot.display;\n            timeSlotSelectBox.appendChild(option);\n            selectedOption = selectedOption || option;\n          });\n          if (selectedOption) {\n            let wrapper = select(\".selectbox__wrapper\", timeSlotSelectBox.parentElement);\n            if (wrapper) {\n              wrapper.innerHTML = `<span>${selectedOption.innerText}</span>`;\n            }\n            selectedOption.setAttribute(\"selected\", \"selected\");\n          }\n        });\n      }\n    });\n  }\n\n  function countryCodeName() {\n    const selectBox = select(\"#pos_countryCode\");\n    let countryCodeName = select('input[name=\"countryCodeName\"]');\n    if (countryCodeName) {\n      countryCodeName.value = selectBox.options[selectBox.selectedIndex].text;\n    }\n  }\n\n  function editOrderSummary() {\n    updateAnalyticsOpcEdit();\n  }\n\n  /**\n   * when payment mode selected BCMC then hide input security code and save for later checkbox.\n   * paymentModeSelected function checks for code 'ban_contact'\n   */\n  function paymentModeSelected(event) {\n    let paymentInfoNodes = getCollection(\".ban-contact-info-eu\");\n    let cardNumber = select(\"#cardNumber\");\n    paymentInfoNodes.forEach((paymentInfoNode) => {\n      let type = paymentInfoNode.type;\n      if (event.target.value === \"ban_contact\") {\n        paymentInfoNode.classList.add(HIDDEN_CLASSNAME);\n        paymentInfoNode.setAttribute(\"aria-hidden\", \"true\");\n        cardNumber.setAttribute(\"maxlength\", \"19\");\n        if (type === \"text\" || type === \"number\") {\n          paymentInfoNode.setAttribute(\"disabled\", true);\n        }\n      } else {\n        paymentInfoNode.classList.remove(HIDDEN_CLASSNAME);\n        paymentInfoNode.removeAttribute(\"aria-hidden\");\n        cardNumber.setAttribute(\"maxlength\", \"16\");\n        if (type === \"text\" || type === \"number\") {\n          paymentInfoNode.removeAttribute(\"disabled\");\n        }\n      }\n    });\n  }\n\n  function updateRegisterUserDetails() {\n    let perferencesDetail = select(\"#newsletter-subscribe\");\n    let subscribe = perferencesDetail && perferencesDetail.checked;\n    if (subscribe) {\n      updateAnalyticsPerferenceRegister();\n    }\n  }\n\n  /**\n   * Update Analytics data for register user on opc in case of newletter subscribed\n   */\n  function updateAnalyticsPerferenceRegister() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: \"uaevent\",\n      eventCategory: \"checkout\",\n      eventAction: \"newsletter\",\n      eventLabel: \"subscription\",\n    });\n  }\n\n  function updateIncompleteAddress() {\n    const sidepanelDiv = select(\"div.sidepanel-edit-form.js-add-edit-address-from-opc\");\n    const addressForm = select('form[id=\"addressForm\"]', sidepanelDiv);\n\n    const submitBtn = select('button[type=\"submit\"]', addressForm);\n    if (submitBtn) {\n      submitBtn.click();\n    }\n  }\n\n  function orderRegisterUserDetails() {\n    let perferencesDetail = select(\"#newsletter-subscribe\");\n    let subscribe = perferencesDetail.checked;\n    if (subscribe) {\n      updateAnalyticsOrderPerferenceRegister();\n    }\n  }\n\n  /**\n   * Update Analytics data for register user on order in case of newletter subscribed\n   */\n  function updateAnalyticsOrderPerferenceRegister() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: \"uaevent\",\n      eventCategory: \"order confirmation\",\n      eventAction: \"newsletter\",\n      eventLabel: \"subscription\",\n    });\n  }\n\n  function toshiDeliveryMode(form) {\n    let toshiDeliveryMehod = select(\".toshi-method\");\n    let toshiFlag = false;\n    if (toshiDeliveryMehod && toshiDeliveryMehod.children[0].checked == true) {\n      const deliverySlotSelected = getCollection(\".css-1odr93t\");\n      const inputElement = select(\".toshi-method > input\");\n      const dataTime = getCollection(\".css-1odr93t\");\n      if (dataTime.length > 1) {\n        toshiFlag = true;\n        inputElement.setCustomValidity(\"toshi.invalid\");\n        inputElement.checkValidity();\n        focusElement(inputElement);\n        updateAnalyticErrorToshi();\n        return true;\n      }\n    }\n    return toshiFlag;\n  }\n\n  function updateDataOnWeekendDeliverySelect(e) {\n    handleDeliverySlotDateSelection(e);\n    const data = JSON.parse(e.srcElement.options[e.srcElement.selectedIndex].getAttribute(\"data-deliverymode-info\"));\n    const containerDiv = select(\".highlightShippingNode\");\n    containerDiv.setAttribute(\"data-test\", \"rdbtnShippingMethod_\" + data.code);\n    const selectedRadio = select('input[name=\"delivery_method\"]', containerDiv);\n    selectedRadio.value = data.code;\n    selectedRadio.setAttribute(\"data-shippingmethod-analytics\", data.code + \" - \" + data.price);\n    selectedRadio.setAttribute(\"data-test\", \"rdbtnShippingMethod_Input_\" + data.code);\n  }\n  \n  function handleChange(e) {\n    const dropdown = e.target || e\n    const selectedIndex = dropdown.selectedIndex\n    if (dropdown.options[selectedIndex]) {\n      const el = select('#weekendDeliveryOptions')\n      if (dropdown.options[selectedIndex].text.includes(' ')) {\n        const arr = dropdown.options[selectedIndex].text.split(' ')\n        select('span', el).innerHTML = ['<span>', arr[0], ' ', '<b>', arr[1], '</b>', '</span>'].join('')\n      } else {\n        select('span', el).innerHTML = ['<span>', dropdown.options[selectedIndex].text, '</span>'].join('')\n      }\n    }\n  }\n\n  function updateAnalyticErrorToshi() {\n    window.document.DLKit.push(\"on-tracking\", {\n      event: \"nievent\",\n      eventCategory: \"delivery\",\n      eventAction: \"error\",\n      eventLabel: \"Please select a date and a time slot\",\n    });\n  }\n\n  function updateIncompleteAddress() {\n    const sidepanelDiv = select(\"div.sidepanel-edit-form.js-add-edit-address-from-opc\");\n    const addressForm = select('form[id=\"addressForm\"]', sidepanelDiv);\n\n    const submitBtn = select('button[type=\"submit\"]', addressForm);\n    if (submitBtn) {\n      submitBtn.click();\n    }\n  }\n\n  function onSaveAddressCheckbox() {\n    const savecheckbox = select('[id=\"address.addAddressToGigya\"]')\n    if (savecheckbox) {\n\t    if (savecheckbox.checked) {\n\t\t    savecheckbox.value = true\n\t\t    savecheckbox.setAttribute('checked', true)\n      }\n      else {\n    \t  savecheckbox.value = false\n    \t  savecheckbox.removeAttribute('checked')\n      }\n    }\n  }\n\n  function invoiceDisplay() {\n    const invoice = select('[id=\"set-invoice\"]')\n    const invoiceform = select('[id=\"invoice-form\"]')\n    const invoicePrivacy = selectAll('.js-privacy')\n    const invoiceAccount = selectAll('.js-company')\n    if (invoice) {\n\t    if (invoice.checked) {\n\t\t    invoice.value = true\n\t\t    invoice.setAttribute('checked', true)\n        invoiceform.removeAttribute('hidden')\n        const invoiceList = select('ul.inline-invoice-radio')\n        const invoiceRadio = selectAll('.js-invoice', invoiceList)\n        const profesional = select('[id=\"invoiceForm-professional\"]')\n        if (invoiceRadio) {\n          invoiceRadio.forEach((element) => {\n            element.addEventListener('change', invoiceTypeDisplay)\n          })\n        }\n        if (profesional.checked == true) {\n          invoiceAccount.forEach((input) => {\n            input.setAttribute('required', true)\n            input.setAttribute('aria-required', true)\n          })\n        }\n        invoicePrivacy.forEach((input) => {\n          input.setAttribute('required', true)\n          input.setAttribute('aria-required', true)\n        })\n      } else {\n          invoice.value = false\n          invoice.removeAttribute('checked')\n          invoiceform.setAttribute('hidden', '')\n          invoicePrivacy.forEach((input) => {\n            input.removeAttribute('required')\n            input.removeAttribute('aria-required')\n          })\n           invoiceAccount.forEach((input) => {\n            input.removeAttribute('required')\n            input.removeAttribute('aria-required')\n          })\n      }\n    }\n  }\n  function invoiceTypeDisplay() {\n    const personal = select('[id=\"invoiceForm-personal\"]')\n    const profesional = select('[id=\"invoiceForm-professional\"]')\n    const invoiceCompany = select('.js-professional')\n    const invoicePersonal = select('.js-personal')\n    const invoicePrivacy = selectAll('.js-privacy')\n    const invoiceAccount = selectAll('.js-company')\n    invoicePrivacy.forEach((input) => {\n      input.setAttribute('required', true)\n      input.setAttribute('aria-required', true)\n    })\n\n    if (profesional.checked == true) {\n        invoiceCompany.removeAttribute('hidden')\n        personal.setAttribute('checked', false)\n        invoiceAccount.forEach((input) => {\n          input.setAttribute('required', true)\n          input.setAttribute('aria-required', true)\n        })\n    } else {\n        invoiceCompany.setAttribute('hidden', '')\n        invoicePersonal.removeAttribute('hidden')\n        profesional.setAttribute('checked', false)\n        invoiceAccount.forEach((input) => {\n          input.removeAttribute('required')\n          input.removeAttribute('aria-required')\n        })\n      }\n  }\n\n  function editExistingBoutique(e) {\n    const button = e.delegateTarget;\n    const productCode = button.dataset.productCode\n    sidePanel.open(config.popups['listOfPOSDataForCnC'] + '?productCode=' + productCode, document.querySelector('.js-edit-boutique-link'))\n  }\n\n  function loadMapOnPageLoad() {\n    var geoPointDetails = select('input[name=\"posGeoLocation\"]') ? select('input[name=\"posGeoLocation\"]') : select('input[name=\"posName\"]');\n    if (geoPointDetails) {\n      const lat = geoPointDetails.getAttribute(\"data-lat\");\n      const long = geoPointDetails.getAttribute(\"data-lng\");\n      const elmId = geoPointDetails.getAttribute(\"id\");\n      initializeMap(lat, long, elmId);\n      focusElement(geoPointDetails, { notChangeTabIndex: true });\n    }\n  }\n\n  window.addEventListener(\"online\", updateOnlineGiftCardBtn);\n  function updateOnlineGiftCardBtn(event) {\n    if (navigator.onLine) {\n      const confirmGiftCardBtn = select(\".js-add-giftCard-button\");\n      if (confirmGiftCardBtn) confirmGiftCardBtn.classList.remove(\"is-disabled\");\n    }\n  }\n  function copyQRCode(e) {\n    const button = e.delegateTarget;\n    const qrCode = button.getAttribute(\"data-qrcode\");\n    navigator.clipboard.writeText(qrCode);\n    if(qrCode)  {\n      dataLayer.push({\n        'eventCategory': 'order summary',\n        'eventAction': 'copy_pix_qr_code',\n        'eventLabel': '',\n        'event': 'uaevent' // associated event\n      });\n    }\n    copyNotification();\n  }\n\n  function copyNotification() {\n    notifier.show({\n      name: config.notifierNotify.notifierTitle,\n      message: `<div class=\"notify-head\"><div class=\"notify-me-heading\" role=\"heading\" aria-level=\"1\">` + config.notifierNotify.notifierTitle + `</div>\n      <p class=\"notify-desc\">` + config.notifierNotify.notifierDesc + `</p></div>`,\n      close: config.notifierNotify.close,\n    })\n  }\n\n  window.addEventListener('resize', handlePOSMap);\n\n  function handlePOSMap() {\n    var lat;\n    var long;\n    var id;\n    var geoPointDetails = select('input[name=\"posGeoLocation\"]');\n    var selectedPosId = select('input[name=\"posName\"]:checked');\n    if (geoPointDetails || selectedPosId) {\n      if (geoPointDetails) {\n        lat = geoPointDetails.getAttribute(\"data-lat\");\n        long = geoPointDetails.getAttribute(\"data-lng\");\n        id = geoPointDetails.getAttribute(\"id\");\n      }\n      else if (selectedPosId) {\n        lat = selectedPosId.getAttribute(\"data-lat\");\n        long = selectedPosId.getAttribute(\"data-lng\");\n        id = selectedPosId.getAttribute(\"id\");\n      }\n\n      var mobileMapElement = select(\"#googleMapMobile-\" + id);\n      if (isMobile) {\n        if (select(\".POSMap\")) {\n          select(\".POSMap\").setAttribute(\"hidden\", \"\");\n        }\n        if (mobileMapElement) {\n          mobileMapElement.closest(\".POSMapMobile\").removeAttribute(\"hidden\");\n        }\n      }\n      else if (isTabletScreen()) {\n        if (select(\".POSMap\")) {\n          select(\".POSMap\").setAttribute(\"hidden\", \"\");\n        }\n        if (mobileMapElement) {\n          mobileMapElement.closest(\".POSMapMobile\").removeAttribute(\"hidden\");\n        }\n      }\n      else if (isWideScreen()) {\n        if (select(\".POSMap\")) {\n          select('.POSMap').removeAttribute(\"hidden\")\n        }\n        if (mobileMapElement) {\n          mobileMapElement.closest(\".POSMapMobile\").setAttribute(\"hidden\", \"\");\n        }\n      }\n      initializeMap(lat, long, id);\n    }\n  }\n\n  bind(document.body, \".js-opc-change-country\", \"click\", ChangeCountry);\n  bind(document.body, \".js-update-cancel\", \"click\", cancelUpdateSMSNumber);\n  bind(document.body, \".js-change-number\", \"click\", updateSMSNumber);\n  bind(document.body, \".subscribe-again\", \"click\", handleSubscribeAgain);\n  bind(document.body, \".js-shipping-rules\", \"click\", shippingRulesDataLayerUpdate);\n  bind(document.body, \".continueWithPOS\", \"click\", posDataLayerUpdate);\n  bind(document.body, '[data-popup-target=\"address-edit\"]', \"click\", updateAnalyticsEditAddress);\n  bind(document.body, '[data-popup-target=\"address-add\"]', \"click\", updateAnalyticsAddAddress);\n  bind(document.body, \".deliveryOptionType\", \"click\", selectDeliveryMethod);\n  bind(document.body, '[name=\"posName\"]', \"change\", selectPOSAddress);\n  bind(document.body, \"[data-step]\", \"click\", stepBack);\n  bind(document.body, \"[data-step-display]\", \"click\", toggleDisplay);\n  bind(document.body, '.step3 [name=\"useDeliveryAddress\"]', \"change\", handleBillingAddressForm);\n  bind(document.body, '.step3 [name=\"useDeliveryAddressEU\"]', \"change\", handleBillingAddressForm);\n  bind(document.body, '[id=\"savePaymentMethod\"]', \"change\", updateDefaultCardCheckbox);\n  bind(document.body, DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR, \"click\", onUserConfirmedWrongAddress);\n  bind(el, \"form\", \"submit\", handleSubmit);\n  bind(el, \".js-check-credit-card-support\", \"input\", hilightCreditCard);\n  bind(document.body, '[id=\"address.addAddressToGigya\"]', 'change', onSaveAddressCheckbox)\n  bind(document.body, '[id=\"set-invoice\"]', 'change', invoiceDisplay)\n  bind(document.body, \"button\", \"click\", enableSubmitBtns);\n  bind(document.body, '[name=\"subscriptionId\"]', \"change\", selectSavedCard);\n  bind(document.body, '[name=\"payment\"]', \"change\", selectPaymentType);\n  bind(document.body, '[name=\"payment\"]', \"focusin\", selectPaymentFocusIn);\n  bind(document.body, '[name=\"payment\"]', \"focusout\", selectPaymentFocusOut);\n  bind(document.body, '[id=\"sopPaymentDetailsForm\"]', \"submit\", hideNewCardForm);\n  bind(document.body, '[id=\"btnContinuAsGuest\"]', \"click\", updateAnalyticsContinueAsGuest);\n  bind(document.body, \".js-remove-giftCard\", \"click\", removeAllGiftCards);\n  bind(document.body, \".js-add-giftCard-button\", \"click\", updateGiftCardList);\n  bind(document.body, '[id=\"selectCreditCardType\"]', \"change\", paymentModeSelected);\n  bind(document.body, \".js-remaining-pay\", \"click\", showPaymentForm);\n  bind(document.body, \".change-giftCard-link\", \"click\", changePaymentType);\n  bind(document.body, \".js-show-giftCard-form-button\", \"click\", showGiftCardForm);\n  bind(document.body, \".js-hide-giftCard-form-button\", \"click\", hideGiftCardForm);\n  bind(document.body, \".js-deliveryslot-date\", \"change\", handleDeliverySlotDateSelection);\n  bind(document.body, \".js-weekend-select\", \"change\", updateDataOnWeekendDeliverySelect);\n  bind(document.body, \".js-shipping-mode-option\", \"click\", shippingOptionHighlight);\n  bind(document.body, '[id=\"edit_checkout\"]', \"click\", editOrderSummary);\n  bind(document.body, \".js-gigya-register-form\", \"click\", updateRegisterUserDetails);\n  bind(document.body, 'button[id=\"updateAddress\"]', \"focusout\", updateIncompleteAddress);\n  bind(document.body, \".js-order-resgister-screen\", \"click\", orderRegisterUserDetails);\n  bind(document.body, \".js-edit-boutique-link\", \"click\", editExistingBoutique);\n  bind(document.body, \".js-selectBoutique\", \"click\", handleSubmit);\n  bind(document.body, \".js-cta-copy-qrcode\", \"click\", copyQRCode);\n  bind(document.body, '[id=\"weekendDeliveryOptions\"]', 'change', handleChange);\n}\n\nexport default function (el) {\n  return new OPC(el);\n}\n","import * as xhr from 'modules/fetch'\nimport config from 'lib/config'\nimport bind from 'delegate'\nimport Loader from 'ui/widgets/loader'\nimport { select, getCollection } from 'lib/selectors'\nimport addressValidation from './address-validation'\nimport { Manager, CHECK_RESPONSE } from 'lib/events'\nimport  * as MobilePhoneValidation  from '../../config/mobile-phone-validation'\nimport {trimNumber} from 'lib/helpers'\n\nconst LIST_ITEMS_SELECTOR = '.js-selection-list'\nconst SIDEPANEL_ADD_ADDRESS_FORM_SELECTOR = '.sidepanel-edit-form form[id=addressForm]'\nconst DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR = 'button.is-tertiary.js-popin-close'\nconst DIALOG_WRONG_ADDRESS_CLOSE_BUTTON_SELECTOR = 'button.is-icon.js-popin-close'\n\nexport default function List(el) {\n  function displayError(data, form, sidePanel) {\n    if (data.modal) {\n      addressValidation.display({\n        html: data.modal,\n        outerClose: false,\n        form,\n        opener: form.querySelector('[type=\"submit\"]'),\n        // when the user decide that the filled address is valid\n        validCallback: () => {\n          handleEditResponse(data, sidePanel, form)\n        }\n      })\n    } else if (data.fields){\n      const payload = {\n        'data': data,\n        'form': form\n      }\n      Manager.publish(CHECK_RESPONSE, payload)\n    }      \n  }\n\n  function displayMoreItems(data, selectionList) {\n    if (data.html) {\n      const lastItem = selectionList.children[selectionList.childElementCount - 1]\n\n      selectionList.insertAdjacentHTML('beforeend', data.html)\n\n      lastItem.nextElementSibling.querySelector('input').focus()\n    }\n\n    return data\n  }\n\n  function handleEditResponse(data, sidePanel) {\n    // check if the item is already in the list\n    let updatedItem = document.getElementById(`selection-item-${data.id}`)\n\n    // update the item if it's in the list\n    if (updatedItem) {\n      const tempWrapper = document.createElement('ul')\n      tempWrapper.innerHTML = data.html\n      const item = tempWrapper.firstElementChild\n      updatedItem.parentElement.replaceChild(item, updatedItem)\n      updatedItem = item\n    }\n    // add the new item at the top of the list\n    else {\n      const selectionList = el.querySelector(LIST_ITEMS_SELECTOR)\n      selectionList.insertAdjacentHTML('afterbegin', data.html)\n      updatedItem = selectionList.firstElementChild\n    }\n\n    sidePanel.on('hide', () => {\n      window.requestAnimationFrame(() => {\n        const itemInput = updatedItem.querySelector('input')\n        // preselect the item if its new or updated\n        if(itemInput) {\n          itemInput.click()\n          itemInput.focus()\n        }\n      })\n    })\n\n    // close the sidepanel\n    sidePanel.hide()\n  }\n\n   \n  function handleSidepanelEditForm(e) {\n    const form = e.target\n    const sidePanel = e.delegateTarget.parentElement.modal\n    const addSelector = select('.js-sidepanel-address-save') \n    if (addSelector) {\n      addSelector.classList.add('is-disabled')\n      addSelector.disabled = true\n    }\n    if (form.invalid.length) {\n      addSelector.classList.remove('is-disabled')\n      addSelector.disabled = false\n      return\n    }\n    if(!form.invalid.length && config.country.toLowerCase() === \"ru\"){\n      addSelector.classList.remove('is-disabled')\n      addSelector.disabled = false\n    }\n    const checkboxCompanyName = select('[name=billToBusinessAddress]', form)\n    const inputCompanyName = select('[name=companyName]', form)\n\n    if (checkboxCompanyName) {\n      checkboxCompanyName.value = !!checkboxCompanyName.checked\n      !checkboxCompanyName.checked ? inputCompanyName.value = '' : null\n    }\n    e.preventDefault()\n    const phoneNumber = select('.sidepanel-edit-form input[data-phone-pattern]')\n\n    if (phoneNumber && !phoneNumber.dataset.mobileValidation) {\n      MobilePhoneValidation.getUserNumber()\n      .then((isValid) => {\n        submitFormData(form, sidePanel)\n      })\n    }\n    else {\n      submitFormData(form, sidePanel)\n    }\n    \n  }\n\n  function submitFormData(form, sidePanel) {\n    updateAnalyticsEditAddressSideTray()\n    if (form.id === 'addressForm') {\n      manageDataObj(form, sidePanel)\n    }\n    else {\n      xhr.submit(form)\n        .then(data => {\n          handleEditResponse(data, sidePanel)\n        })\n        .catch(data => {\n          displayError(data, form, sidePanel)\n        })\n    }\n  }\n\n  /**\n * Return new object from Form data\n */\n  function manageDataObj(form, sidePanel) {\n    const paramsData = {}\n    const inputs = getCollection('input, select', form)\n    let isoCode\n    const namesToExclude = ['phoneCountryCode', 'addressId', 'countryIso', 'useDeliveryAddressEU', '_useDeliveryAddressEU', 'qualityCode', 'skipValidation', '_shippingToBusinessAddress', 'billingAddress', 'shippingAddress', 'line2', 'district', 'provincia', 'shippingToBusinessAddress', 'defaultAddress', 'municipality','village','addAddressToGigya','building']\n    if((config.country.toLowerCase() === \"ru\") || (config.country.toLowerCase() === \"cn\")){\n      namesToExclude.push(\"postcode\")      \n    }\n    Array.from(inputs).filter(input =>\n      // We add an exception for phoneCountryCode as this field is used to normalized the\n      // required phoneCountryCodeField input\n       (input.required || namesToExclude.indexOf(input.name) !== -1)).forEach(input => {\n        if (input.type === 'radio'|| input.type === 'checkbox') {\n          if (input.name === \"addAddressToGigya\") {\n            paramsData[input.name] = input.value\n          } else {\n            input.checked === true ? (paramsData[input.name] = input.value) : null;\n          }\n        } else if (input.name === 'countryIso') {\n        isoCode = input.value === 'LT' ? input.value : null\n        paramsData[input.name] = input.value\n      } else if((config.country.toLowerCase() === \"cn\") && ((input.name === \"provincia\") || (input.name === \"district\") || (input.name === \"townCity\"))) {\n        paramsData[input.name] = input.selectedOptions[0].innerText\n      } else if (input.name === 'postcode') {\n        input.value.indexOf('LT') !== -1 ? input.value = input.value.replace(/[^0-9]/g, '') : null\n        paramsData[input.name] = isoCode ? `${isoCode}-${input.value}` : input.value\n      }\n      else {\n        input.value !== '' ? paramsData[input.name] = input.value : null\n      }\n    })\n    \n    if (window.config.country=='GB')\n      paramsData.phone =  trimNumber(paramsData.phone)\n    \n    xhr.submit(form, { data: paramsData })\n    .then(data => {\n      handleEditResponse(data, sidePanel)\n    })\n    .catch(data => {\n      displayError(data, form, sidePanel)\n    })\n  }\n\n  function loadMoreItems(e) {\n    const button = e.delegateTarget\n    const selectionList = el.querySelector(LIST_ITEMS_SELECTOR)\n    let replacedApi\n\n    const loader = new Loader(button, {\n      enableSyncCol: true,\n      referenceEl: button\n    })\n\n    loader.init()\n    loader.create()\n\n    if (config.webservices.more[button.dataset.loadmore]) {\n      replacedApi = config.webservices.more[button.dataset.loadmore]\n      replacedApi = replacedApi.replace('{0}', selectionList.childElementCount)\n    }\n\n    // get the api call from the confif or directly from the button if theres no match in the config\n    const api = replacedApi || button.dataset.loadmore\n\n    xhr.get(api)\n      .then(data => displayMoreItems(data, selectionList))\n      .then(data => manageLoadMoreButton(data, button))\n      .catch(config.noop)\n      .then(loader.destroy)\n  }\n\n  function manageLoadMoreButton(data, button) {\n    // update the load more button url\n    if (data.next) {\n      button.dataset.loadmore = data.next\n    }\n    // remove it if theres no more itemes to display\n    else {\n      button.parentElement.removeChild(button)\n    }\n  }\n  function onUserConfirmedWrongAddress(e) {\n    const formElm = select(SIDEPANEL_ADD_ADDRESS_FORM_SELECTOR, this.el)\n    if(!!formElm){\n      const sidePanel = formElm.offsetParent.modal\n\n      if(formElm['skipValidation']) {\n        formElm['skipValidation'].value = 'true'\n      }\n      submitFormData(formElm, sidePanel)\n    }\n  }\n\n  function onUserCloseWrongAddress(e) {\n    const addSelector = select('.js-sidepanel-address-save')\n    if(!addSelector) return\n    addSelector.classList.remove('is-disabled')\n    addSelector.disabled = false\n  }\n\n  /**\n   * Update Analytics data for Add/Edit an address for registered users in side tray\n   */\n  function updateAnalyticsEditAddressSideTray() {\n    window.document.DLKit.push('on-tracking', {\n      event: window.config.dl.event,\n      eventCategory: 'edit address',\n      eventAction: 'click',\n      eventLabel: 'save address'\n    })\n  }\n\n  bind(document.body, '.sidepanel-edit-form', 'submit', handleSidepanelEditForm)\n  bind(el, '[data-loadmore]', 'click', loadMoreItems)\n  bind(document.body, DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR, 'click', onUserConfirmedWrongAddress)\n  bind(document.body, DIALOG_WRONG_ADDRESS_CLOSE_BUTTON_SELECTOR, 'click', onUserCloseWrongAddress)\n}\n","import bind from 'delegate'\nimport config from 'lib/config'\nimport inert from 'lib/inert'\nimport { Manager } from 'lib/events'\nimport notifier from 'modules/notifier'\nimport { select, getCollection } from 'lib/selectors'\nimport { focusElement } from 'lib/helpers'\n\nconst PROMOCODE_ID = 'promocode'\nconst PROMOCODE_FORM_ID = 'promocode-form'\nconst PROMOCODE_INTRO_ID = 'promocode-intro'\nconst TOGGLE_SELECTOR = '.js-promocode'\nconst HIDDEN_CLASSNAME = 'is-hidden'\n\t\n\t\nfunction PromocodeToggle() {\n\t\n  function toggle(e) {\n    e.preventDefault()\n\n    const form = document.getElementById(PROMOCODE_FORM_ID)\n    if (form) {\n      form.classList.remove(HIDDEN_CLASSNAME)\n      inert.unset(form)\n\n      const focusable = form.querySelector('input:not([type=\"hidden\"])')\n      if (focusable) {\n        focusable.focus()\n      }\n    }\n\n    const intro = document.getElementById(PROMOCODE_INTRO_ID)\n    if (intro) {\n      intro.parentNode.removeChild(intro)\n    }\n    const dataLyerType = 'promo code'\n    promoCodeDataLayerEntry(dataLyerType)\n  }\n\n  bind(document.body, `#${PROMOCODE_ID} ${TOGGLE_SELECTOR}`, 'click', toggle)\n}\nfunction highlightShippingNodeWithPromo(e) {\n  if (e && e.delegateTarget) {\n    let radioButton = select('input[name=delivery_method]', e.delegateTarget)\n    if (radioButton) {\n      radioButton.checked = true\n    }\n  }\n  let shippingNodes = getCollection('.shippingItem')\n  shippingNodes.forEach((shippingNode) => {\n    if (shippingNode.children[0].checked !== true) {\n      shippingNode.classList.remove('highlightShippingNode')\n      getCollection('.shippingmethod__details', shippingNode).forEach((detailsSection) => {\n        detailsSection.classList.add('is-hidden')\n        getCollection('select', detailsSection).forEach((selectBox) => {\n          selectBox.removeAttribute('name')\n        })\n      })\n    }\n    else {\n      if (!shippingNode.classList.contains('highlightShippingNode')) {\n        shippingNode.classList.add('highlightShippingNode')\n        getCollection('.shippingmethod__details', shippingNode).forEach((detailsSection) => {\n          detailsSection.classList.remove('is-hidden')\n          getCollection('select', detailsSection).forEach((selectBox) => {\n            selectBox.setAttribute('name', selectBox.dataset['name'])\n          })\n        })\n      }\n    }\n  })\n}\nfunction Promocode(data) {\n  const el = document.getElementById(PROMOCODE_ID)\n\n  function set() {\n    if (!el) {\n      return\n    }\n    el.innerHTML = data.parts.promocode\n    Manager.publish('bindDom', el)\n   \n   const formTypeRemove = el.querySelector('form[data-form-type=\"promocode-remove\"]')\n   const formTypeAdd = el.querySelector('form[data-form-type=\"promocode-add\"]')\n   \n    if(formTypeRemove){\n      setFocusAdd()\n    }\n    if(formTypeAdd){\n      setFocusRemove()\n   }\n   highlightShippingNodeWithPromo()\n  }\n\n  function setFocusAdd() {\n    let focusable = Array.from(el.querySelectorAll('.confirmation')).pop()\n    if (focusable) {\n      focusable = focusable.querySelector('p') || focusable\n      focusable.setAttribute('tabindex', -1)\n    }\n    else {\n      focusable = el.querySelector('input:not([type=\"hidden\"])')\n    }\n\n    if (focusable) {\n      focusable.focus()\n    }\n  }\n\n  function setFocusRemove() {\n    let confirmation = Array.from(el.querySelectorAll('.confirmation'))\n    let focusable\n\n    if (confirmation.length) {\n      confirmation = confirmation.pop()\n      focusable = confirmation.querySelector('button[type=\"submit\"]')\n    }\n    else {\n      focusable = el.querySelector('input:not([type=\"hidden\"])')\n    }\n    if (data.message) {\n      const message = data.message\n      const params = {\n        name: message.label || config.locales.notifier.request.label,\n        message: message.text || message,\n        close: message.close || config.locales.notifier.request.close,\n        noFocus: !document.body.classList.contains('is-using-keyboard')\n      }\n      if (focusable) {\n        params.opener = focusable\n      }\n      notifier.show(params)\n    }\n    else if (focusable) {\n      focusable.focus()\n    }\n\n   const addNewEle =  select('#addNewValue')\n   if (addNewEle) {\n\t   const addNewValue = addNewEle.value\n\t   if (addNewValue) {\n        const newPromoBtn = document.getElementById(addNewValue)\n         if (newPromoBtn) {\n           focusElement(newPromoBtn)\n        }\n      }\n    }\n  }\n\n  set()\n}\n\nfunction promoCodeDataLayerEntry(type) {\n  var dataset = {\n    'eventCategory': 'delivery',\n    'eventAction': 'click',\n    'eventLabel': type,\n    'event': 'uaevent'\n   }\n  window.document.DLKit.push('on-tracking', dataset)\n}\n\nfunction handlePromoAdd() {\n  const voucherCode = select('#voucher-code')\n  const addNewValue = select('#addNewValue')\n\n   if (voucherCode && addNewValue) {\n     addNewValue.value = voucherCode.value\n   }\n  const dataLyerType = 'apply promo code'\n  promoCodeDataLayerEntry(dataLyerType)\n}\n\nbind(document.body, '[data-form-type=\"promocode-add\"]', 'click', handlePromoAdd)\n\nexport {\n  Promocode,\n  PromocodeToggle\n}\n","import {select, selectAll} from 'lib/selectors'\nimport {focusElement, isWideScreen, tabIndexToZero} from 'lib/helpers'\nimport popin from 'modules/popin'\nimport config from 'lib/config'\n\n// Selectors\nconst DIALOG_CLOSE_BUTTON_SELECTOR = 'div.yes-no-modal button.popin__close.js-popin-close'\n\nlet submitted = false;\n\nclass ThreeDS2Popin {\n  constructor(el) {\n    this.el = el\n    this.buttonClose = null\n    this.params = {\n    }\n  }\n\n  async init() {\n    let challengeTokenIdElem = select(\"#challengeTokenId\")\n    let challengeToken = challengeTokenIdElem.value\n    let legacy = challengeTokenIdElem.dataset['legacy']\n    let checkGiftCard = select('#isGiftCard')\n    let isGiftCard = checkGiftCard.value == 'true' ? true : false\n    this.buildTemplate(challengeToken, legacy, isGiftCard)\n}\n\n  perform3DS2Operations (tokenID) {\n    const isChallengeShopper = select(\"#challengeShopperId\").value\n    if (isChallengeShopper) {\n      this.initiate3DS2ChallengeShopper(tokenID);\n    }\n  }\n\n  initiate3DS2ChallengeShopper(challengeToken) {\n    submitted = false;\n    var threeDS2ChallengeShopperNode = select('#threeDS2');\n    const localeValue = select(\"#localId\").value\n    const envValue = select(\"#envId\").value\n    var configuration = {\n      locale: localeValue,\n      environment: envValue\n    }\n    const checkout = new AdyenCheckout(configuration);\n    var challengeShopperComponent = checkout\n      .create( 'threeDS2Challenge', {\n        challengeToken: challengeToken,\n        onComplete: function ( challengeData ) {\n          if (submitted) {\n            // Already submitted. Ignore this call\n            return;\n          }\n          submitted = true;\n          this.challengeResult = challengeData.data.details[\"threeds2.challengeResult\"];\n          var challengeResultField = select(\"#challengeResult\");\n          challengeResultField.value = this.challengeResult;\n          var threeDS2popinCol = select('.popin__col')\n          threeDS2popinCol.setAttribute('style', 'visibility:hidden');\n          document.getElementById(\"3ds2-form\").submit();\n        },\n        onError: function (error) {\n          console.error(JSON.stringify(error));\n        },\n        size: '05'\n      } );\n    challengeShopperComponent.mount(threeDS2ChallengeShopperNode);\n  }\n\n  buildTemplate(tokenID, legacy, isGiftCard) {\n    this.template =\n      `<div class=\"popin-text text-center\" id=\"threeDS2-popin-wrapper\" data-close-label=\"${window.config.locales.opc.threeDS2Auth.closethreeDS2Auth}\" data-test=\"secThreeDS2Popin\">\n        <div class=\"modal-body\">\n          <div id=\"threeDS2\" class=\"heading is-5\" role=\"heading\"></div>\n           <form method=\"post\" id=\"3ds2-form\" action=\"${legacy ? window.config.webservices.checkout.threeDS2ResponseLegacy :(isGiftCard ? window.config.webservices.checkout.threeDS2GiftCard : window.config.webservices.checkout.threeDS2Response)}\">\n                <input type=\"hidden\" name=\"challengeToken\" value=\"${tokenID}\" />\n                <input type=\"hidden\" id=\"challengeResult\" name=\"challengeResult\" />\n          </form>      \n        </div>\n      </div>`\n  }\n\n  onOpenPopin() {\n    let challengeToken = select(\"#challengeTokenId\").value\n    this.perform3DS2Operations(challengeToken)\n    this.setDomElements()\n  }\n\n  setDomElements() {\n    this.popinEl = select('.threeDS2popin')\n    if (this.popinEl) {\n      this.popinEl.removeAttribute('aria-labelledby')\n      this.popinEl.setAttribute('aria-label', config.popin3DS2.authLabelTitle)\n      this.popinEl.setAttribute('tabindex', '-1');\n    }\n\n    this.buttonClose = select('.js-popin-close', this.popinEl)\n    this.form = select('form', this.popinEl)\n  }\n\n  /**\n   * display a yes(remove) or no(cancel) dialog\n   * @param data {Object}: contains additional params\n   */\n   open() {\n    popin.open({\n      html: this.template,\n      role: 'dialog',\n      modifiers: 'is-relative threeDS2popin',\n      opener: null,\n      manageFocus: true,\n      forceInert: true,\n      modal: true,\n      action: 'removeCancelModal',\n      outerClose: false\n    }).then(() => {\n      this.onOpenPopin()\n    })\n    // To catch the esc key\n    window.addEventListener('keydown', this.onEscapeKeyClicked)\n  }\n\n  /**\n   * Close the active modal\n   */\n  closeModal() {\n    window.removeEventListener('keydown', this.onEscapeKeyClicked)\n    popin.hide()\n  }\n\n  /**\n   * Triggered once user clicked on the modal cancel button\n   * @param params {MouseEvent}: contains MouseEvent parameters\n   */\n  onModalCancelButtonClicked = (e) => {\n    this.closeModal()\n    focusElement(this.params.clickedElm)\n    if (!isWideScreen()) {\n      const links = selectAll('.collapse-panel__header .js-collapse-button')\n      if (links.length > 0) {\n        tabIndexToZero(links)\n      }\n    }\n  }\n\n  /**\n   * Triggered once user clicked on keyboard inputs\n   * @param e {MouseEvent}: MouseEvent parameters \n   */\n  onEscapeKeyClicked = (e) => {\n    if ((e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27)) {\n      this.onModalCancelButtonClicked(e)\n    }\n  }\n\n}\n\nconst initThreeDS2Popin = () => {\n  const threeDS2 = new ThreeDS2Popin()\n  threeDS2.init().then(() => {\n    threeDS2.open()\n  })\n}\n\nexport default initThreeDS2Popin","import bind from 'delegate'\nimport { select } from 'lib/selectors'\n\n/**\n *\n * @param {*HTMLElement} scope - the element containing the data-formaction attributes\n * formaction attribute used because it is triggerd on submiting (enter key)\n   and we want to change the form's action value only when input is selected\n */\nexport default function Toggle(scope) {\n  function handleFormAction(e) {\n    const el = e.delegateTarget\n\n    if (!el.checked) {\n      return\n    }\n\n    const form = el.closest('form')\n\n    if (!form) {\n      return\n    }\n\n    if (!form.defaultAction) {\n      form.defaultAction = form.getAttribute('action')\n    }\n\n    form.action = el.dataset.formaction\n\n    if (!form.action) {\n      form.action = form.defaultAction\n    }\n\n    if (form.id === 'sopPaymentDetailsForm' && select('.js-remove-giftCard')) {\n       form.action = window.config.webservices.checkout.giftCardPlaceOrder\n     }\n  }\n\n  bind(scope, 'input[data-formaction]', 'change', handleFormAction)\n}\n","import {select, selectAll} from 'lib/selectors'\nimport {focusElement, isWideScreen, tabIndexToZero} from 'lib/helpers'\nimport popin from 'modules/popin'\nimport * as xhr from 'modules/fetch'\nimport config from 'lib/config'\nimport bind from \"delegate\";\n\n// Selectors\nconst DIALOG_CLOSE_BUTTON_SELECTOR = 'div.yes-no-modal button.popin__close.js-popin-close'\nconst WECHANT_ADYAN_PAYMENT_BUTTON_SELECTOR = \".js-wechat-adyan-payment\";\n\nlet submitted = false;\n\nclass WechatPayQrAdyenPopin {\n  constructor() {\n    this.buttonClose = null\n    this.params = {\n    }\n  }\n\n   init() {\n    this.buildTemplate()\n    bind(document.body, WECHANT_ADYAN_PAYMENT_BUTTON_SELECTOR, \"click\", this.selectecWechatPayment);    \n}\n\n createWebConfiguration = (resp) =>{\n    this.webComponentConfiguration = {\n        locale: resp.configuration.locale,\n        environment: resp.configuration.environment,\n        clientKey: resp.configuration.clientKey,\n        amount: resp.configuration.amount,\n        countryCode: resp.configuration.countryCode,\n        onAdditionalDetails: this.submitPaymentData, \n        onSubmit: function (state, component) {\n          console.log(\"onSubmit\", state, component);\n          // document.getElementById(\"paymentData\").innerText = JSON.stringify(state.data, null, 2);\n        }\n      }\n}\n\nhandleWechatPayinitResponse = (resp) => {\n    this.createWebConfiguration(resp)\n    this.webAction = resp.action\n    this.open()\n}\n\n selectecWechatPayment=(e)=>{\n    e.preventDefault()\n    xhr.post(config.webservices.checkout.weChatPayStart).then((resp) => this.handleWechatPayinitResponse(resp))\n  }\n\n  submitPaymentData = (state, component) => {\n      var paymentDataField = select(\"#weChatPayAdyen-form #paymentData\");\n      paymentDataField.value = state.data.paymentData;\n      var payloadField = select(\"#weChatPayAdyen-form #payload\");\n      payloadField.value = state.data.details.payload;\n      document.getElementById(\"weChatPayAdyen-form\").submit();\n  }\n\n  buildTemplate = () => {\n    this.template =\n      `<div class=\"popin-text text-center\" id=\"threeDS2-popin-wrapper\" data-close-label=\"${window.config.locales.opc.threeDS2Auth.closethreeDS2Auth}\" data-test=\"secThreeDS2Popin\">\n        <div class=\"modal-body\">\n            <div id=\"wechatpayQR-container\"></div>  \n           <form method=\"post\" id=\"weChatPayAdyen-form\" action=\"${window.config.webservices.checkout.weChatPaySubmit}\">\n                <input type=\"hidden\" name=\"PaymentData\" id=\"paymentData\"/>\n                <input type=\"hidden\" name=\"payload\" id=\"payload\"/>\n          </form>      \n        </div>\n      </div>`\n  }\n\n  onOpenPopin = () => {\n    const checkout = new AdyenCheckout( this.webComponentConfiguration)\n    checkout.createFromAction(this.webAction).mount('#wechatpayQR-container')\n    this.setDomElements()\n  }\n\n  setDomElements = () => {\n    this.popinEl = select('.weChatPayQRPopin')\n    if (this.popinEl) {\n      this.popinEl.setAttribute('tabindex', '-1');\n    }\n\n    this.buttonClose = select('.js-popin-close', this.popinEl)\n    this.form = select('form', this.popinEl)\n  }\n\n  /**\n   * display a yes(remove) or no(cancel) dialog\n   * @param data {Object}: contains additional params\n   */\n   open = () => {\n    popin.open({\n      html: this.template,\n      role: 'dialog',\n      label:  config.wechat.qrCodePopin.title,\n      modifiers: 'is-relative weChatPayQRPopin',\n      opener: null,\n      manageFocus: true,\n      forceInert: true,\n      modal: true,\n      action: 'removeCancelModal',\n      outerClose: false\n    }).then(() => {\n      this.onOpenPopin()\n    })\n    // To catch the esc key\n    window.addEventListener('keydown', this.onEscapeKeyClicked)\n  }\n\n  /**\n   * Close the active modal\n   */\n  closeModal = () => {\n    window.removeEventListener('keydown', this.onEscapeKeyClicked)\n    popin.hide()\n  }\n\n  /**\n   * Triggered once user clicked on the modal cancel button\n   * @param params {MouseEvent}: contains MouseEvent parameters\n   */\n  onModalCancelButtonClicked = (e) => {\n    this.closeModal()\n    focusElement(this.params.clickedElm)\n    if (!isWideScreen()) {\n      const links = selectAll('.collapse-panel__header .js-collapse-button')\n      if (links.length > 0) {\n        tabIndexToZero(links)\n      }\n    }\n  }\n\n  /**\n   * Triggered once user clicked on keyboard inputs\n   * @param e {MouseEvent}: MouseEvent parameters \n   */\n  onEscapeKeyClicked = (e) => {\n    if ((e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27)) {\n      this.onModalCancelButtonClicked(e)\n    }\n  }\n\n}\n\nconst initWechatPayQrAdyenPopin = () => {\n    const weChatPopin = new WechatPayQrAdyenPopin()\n    weChatPopin.init()\n}\n\nexport default initWechatPayQrAdyenPopin"],"sourceRoot":""}