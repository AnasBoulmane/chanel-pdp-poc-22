{"version":3,"sources":["webpack:///./patterns/scripts/pages/opc/china-payment.js"],"names":["isWechatQRCodePopinVisited","isFetchPaymentStatusEnabled","placeChinesePayOrder","e","form","target","preventDefault","paymentError","select","remove","weChatOption","classList","contains","showErrorCodePopin","isFormValid","checkValidity","xhr","then","res","isSuccess","pspname","handleAlipayPayment","handleWechatPayment","handleUnionPayment","window","location","replace","config","currentLocale","url","catch","err","console","error","htmlTemplate","wechat","qrCodePopin","close","errPopin","title","summary","description","popin","open","html","modifiers","modal","role","label","opener","forceInert","manageFocus","outerClose","addEventListener","onDocumentPopinClose","resWechat","handleWechatPayInBrowserPayment","handleWechatNativeQRCodePayment","data","fetchPaymentStatus","orderCode","WeixinJSBridge","invoke","appId","timeStamp","nonceStr","packageName","signType","paySign","resp","status","err_msg","split","handleWechatBrowserPaymentFailure","paymentStatus","placeOrderBtn","wechatAgreement","errorPara","document","createElement","add","setAttribute","innerHTML","failed","cancelled","parentNode","insertBefore","nextSibling","template","altImgText","orderTitle","msg","showQRCodePopin","popinContainer","hide","removeEventListener","webservices","checkout","cnCheckPaymentStatus","retry","href","redirectUrl","setTimeout","frontTransUrl","key","value","Object","entries","submitFromDataMap","formItem","appendChild","union_pay","after","submit","proceedPayment","event","number","paymentMethod","buttonSpec","isWeChatBrowser","delegateTarget","dataLayer","push","eventCategory","eventAction","eventLabel","getMq","placeOrder","allowedPaymentMethod","createPopup","loader","btn","buttons","selectAll","forEach","button","Loader","init","create","placeOrderFromHistory","paymentProvider","destroy","availablePayOption","payOption","selectedPaymentMethod","popUpMessages","aliPay","unionPay","description1","description2","description3","continueButtonText","proceedWithOption","bind","body"],"mappings":"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","file":"chunks/chinaPayment.js?v=3.23","sourcesContent":["import bind from 'delegate'\nimport * as xhr from 'modules/fetch'\nimport {select, selectAll} from '../../lib/selectors'\nimport popin from 'modules/popin'\nimport config from \"lib/config\"\nimport { getMq, isWeChatBrowser } from 'lib/helpers'\nimport Loader from 'ui/widgets/loader'\n\nlet isWechatQRCodePopinVisited = false\nlet isFetchPaymentStatusEnabled = true\n\nfunction placeChinesePayOrder(e) {\n  const form = e.target\n  e.preventDefault()\n  const paymentError = select('#paymentError')\n  if(paymentError){\n    isFetchPaymentStatusEnabled = true\n    paymentError.remove()\n  }\n  const weChatOption = select(\".js-wechat-pay-option\")\n  if (isWechatQRCodePopinVisited && weChatOption.classList.contains(\"selected\")) {\n    showErrorCodePopin()\n    return false\n  }\n  let isFormValid = form.checkValidity() \n  if (!isFormValid) return\n  xhr.submit(form, {\n  }).then((res) => {\n    if (res.isSuccess) {\n      if (res.pspname === \"alipay\") {\n        handleAlipayPayment(res)\n      } else if (res.pspname === \"wechatpay\") {\n        handleWechatPayment(res)\n      }else if (res.pspname === \"unionpay\"){\n         handleUnionPayment(res)\n      }\n    } else {\n      window.location.replace(config.currentLocale + res.url)\n    }\n  }).catch((err) => {\n    console.error(err)\n  })\n}\n\nfunction showErrorCodePopin() {\n  const htmlTemplate = `<div id=\"errPopin\" class=\"wechat-error-popin\" data-close-label=\"${config.wechat.qrCodePopin.close} - ${config.wechat.errPopin.title}\">\n                          <div class=\"wechat-error-popin__header has-text-centered\">\n                            <div class=\"heading is-7 text-center\" role=\"heading\" aria-level=\"1\">\n                              ${config.wechat.errPopin.title}\n                            </div>\n                          </div>\n                          <p class=\"has-text-centered summary\">\n                            ${config.wechat.errPopin.summary}\n                          </p>\n                          <p class=\"has-text-centered description\">\n                            ${config.wechat.errPopin.description}\n                          </p>\n                        </div>`\n  popin.open({\n    html: htmlTemplate,\n    modifiers: 'is-big is-relative errPopin',\n    modal: true,\n    role: 'dialog',\n    label:  config.wechat.errPopin.title,\n    opener: select(\".js-wechat-btn\"),\n    forceInert: true,\n    manageFocus: true,\n    outerClose: true\n  }).then(()=>{\n    window.addEventListener('click', onDocumentPopinClose)\n  })\n}\n\nfunction handleWechatPayment(res) {\n\txhr.get(config.currentLocale + res.url, {\n\t}).then((resWechat) => {\n\t\tif (resWechat.isSuccess) {\n\t\t\tif (resWechat.pspname === \"wechatpay\") {\n\t\t\t\thandleWechatPayInBrowserPayment(resWechat)\n\t\t\t} else if (resWechat.pspname === \"wechatpay_native\") {\n\t\t\t\thandleWechatNativeQRCodePayment(resWechat)\n\t\t\t}\n\t\t}\n\t}).catch((err) => {\n\t\tconsole.error(err)\n\t})\n}\n\nfunction handleWechatPayInBrowserPayment(data) {\n  fetchPaymentStatus(data.orderCode)\t\n  WeixinJSBridge.invoke('getBrandWCPayRequest', {\n      'appId' : data.appId,\n      'timeStamp' : data.timeStamp,\n      'nonceStr' : data.nonceStr,\n      'package' : data.packageName,\n      'signType' : data.signType,\n      'paySign' : data.paySign,\n  }, function(resp) {\n      var status = resp.err_msg.split(':')[1]\n      if (status === 'ok' ){\n\t\t  fetchPaymentStatus(data.orderCode)\n\t  } else if(status === 'fail' || status === 'cancel'){\n          handleWechatBrowserPaymentFailure(status)\n      }\n  })\n}\n\nfunction handleWechatBrowserPaymentFailure(paymentStatus){\n\tisFetchPaymentStatusEnabled = false\n\tconst placeOrderBtn = select(\".js-wechat-btn\")\n\tplaceOrderBtn.classList.remove(\"is-disabled\")\n\tconst wechatAgreement = select('#wechat-agreement')\n\tconst errorPara = document.createElement('p')\n\terrorPara.classList.add('error')\n\terrorPara.setAttribute('id', 'paymentError')\n\terrorPara.setAttribute('tabindex', -1)\n\terrorPara.innerHTML = paymentStatus === 'fail' ? config.wechat.error.failed : config.wechat.error.cancelled \n\twechatAgreement.parentNode.insertBefore(errorPara, wechatAgreement.nextSibling)\t\n}\n\nfunction handleWechatNativeQRCodePayment(res) {\n  const url = `data:image/png;base64,${res.url}`\n  const template = `<div id=\"qrCodePopin\" class=\"qr-code-popin\" data-close-label=\"${config.wechat.qrCodePopin.close} - ${config.wechat.qrCodePopin.title}\">\n                      <div class=\"qr-code-popin__header has-text-centered\">\n                        <div class=\"heading is-7 text-center\" role=\"heading\" aria-level=\"1\">\n                          ${config.wechat.qrCodePopin.title}\n                        </div>\n                      </div>\n                      <div id=\"qrCode\"><img id=\"qr-code\" alt=\"${config.wechat.qrCodePopin.altImgText}\" src =\"${url}\" /></div>\n                      <p class=\"has-text-centered\">\n                      ${config.wechat.qrCodePopin.orderTitle}</br>\n                        ${res.orderCode}\n                      </p>\n                      <p class=\"msg\">\n                        ${config.wechat.qrCodePopin.msg}</br>\n                      </p>\n                    </div>`\n  showQRCodePopin(template,res)         \n}\n\nfunction showQRCodePopin(template,res) {\n  popin.open({\n    html: template,\n    modifiers: 'is-big is-relative qrCodePopin',\n    modal: true,\n    label:  config.wechat.qrCodePopin.title,\n    opener: select(\".js-wechat-btn\"),\n    forceInert: true,\n    manageFocus: true,\n    outerClose: true\n  }).then(() => {\n    fetchPaymentStatus(res.orderCode)\n    isWechatQRCodePopinVisited = true\n    const placeOrderBtn = select(\".js-wechat-btn\")\n    placeOrderBtn.classList.remove(\"is-disabled\")\n    window.addEventListener('click', onDocumentPopinClose)\n  })\n}\n\nfunction onDocumentPopinClose(e) {\n  const popinContainer = select('.popin__col')\n  if (popinContainer && !popinContainer.contains(e.target)) {\n    popin.hide()\n    window.removeEventListener('click', onDocumentPopinClose)\n  }\n}\n\nfunction fetchPaymentStatus(orderCode) {\n  if (isFetchPaymentStatusEnabled) {\n\txhr.get(config.webservices.checkout.cnCheckPaymentStatus + orderCode)\n\t\t.then((res) => {\n\t\t\tif (!res.retry) {\n\t\t\t\twindow.location.href = config.currentLocale + res.redirectUrl\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tfetchPaymentStatus(orderCode)\n\t\t\t\t}, 10000)\n\t\t\t}\n\t\t})\n   }\n}\n\nfunction handleAlipayPayment(res) {\n  window.location.href = res.url\n}\n\nfunction handleUnionPayment(res) {\n  const form = document.createElement(\"form\")\n  form.setAttribute('method',\"post\")\n  form.setAttribute('action',res.frontTransUrl)\n  form.setAttribute('id',\"payForm\")\n  for (const [key, value] of Object.entries(res.submitFromDataMap)) {\n    const formItem = document.createElement(\"input\")\n    formItem.setAttribute('type',\"hidden\")\n    formItem.setAttribute('name', key)\n    formItem.setAttribute('id', key)\n    formItem.setAttribute('value', value)\n    form.appendChild(formItem)\n  }\n  let union_pay = select('#unionPay-method')\n  union_pay = union_pay === null ? select('.proceed-payment') : union_pay\n  union_pay.after(form)\n  form.submit()\n}\n\nfunction proceedPayment(event) {\n  let number = select('#order-code').innerHTML\n  let paymentMethod = select('#payment-method').innerHTML\n  let buttonSpec = ''\n  if (!isWeChatBrowser()) {\n    if (event.delegateTarget.classList.contains('order-history')) {\n      dataLayer.push({\n        eventCategory: 'order history',\n        eventAction: 'proceed_to_payment',\n        eventLabel: number,\n        event: 'uaevent'\n      })\n      buttonSpec = 'order-history'\n    }\n    if (event.delegateTarget.classList.contains('order-summary')) {\n      dataLayer.push({\n        eventCategory: 'order summary',\n        eventAction: 'proceed_to_payment',\n        eventLabel: number,\n        event: 'uaevent'\n      })\n      buttonSpec = 'order-summary'\n    }\n    if(paymentMethod === 'alipay' || (paymentMethod === 'unionpay' && (getMq() !== 'mobile'))) {\n        placeOrder(number,paymentMethod,buttonSpec)\n    }\n    if(paymentMethod === 'unionpay' && (getMq() === 'mobile') ) {\n      const allowedPaymentMethod = 'alipay'\n      createPopup(paymentMethod,allowedPaymentMethod,number)\n    }\n  }\n}\n\nfunction placeOrder(orderCode,paymentMethod,buttonSpec) {\n  let loader\n  let btn\n  const buttons = selectAll('button.place-order')\n  buttons.forEach(button => {\n    if (button.classList.contains(buttonSpec)) {\n      btn = button\n    }\n  })\n  if (btn && btn.classList.contains('button')) {\n    loader = new Loader(btn, {\n      button: true\n    })\n    loader.init()\n    loader.create()\n  }\n  xhr.post(config.webservices.checkout.placeOrderFromHistory,{\n    data: {\n      paymentProvider: paymentMethod,\n      orderCode: orderCode\n    }\n  }).then((res) => {\n    if (loader) {\n      loader.destroy(function () {\n        btn.classList.remove('is-disabled')\n      })\n    }\n    if (res.pspname === \"alipay\") {\n      handleAlipayPayment(res)\n    } else if (res.pspname === \"wechatpay\") {\n      handleWechatPayment(res)\n    } else if (res.pspname === \"unionpay\"){\n      handleUnionPayment(res)\n    }\n  }).catch(err => {\n    console.error(err)\n  })\n}\n\nfunction createPopup(paymentMethod, availablePayOption,number) {\n  let payOption\n  let selectedPaymentMethod\n  if (availablePayOption === 'alipay') {\n    payOption = config.popUpMessages.aliPay\n  }\n  if (paymentMethod === 'unionpay') {\n    selectedPaymentMethod = config.popUpMessages.unionPay\n  }\n  const template = `\n                  <div role=\"dialog\" aria-label=\"${config.popUpMessages.title}\" id=\"nonPaymentPopin\" class=\"non-payment-popin has-text-centered\" data-close-label=\"${config.popUpMessages.close} - ${config.popUpMessages.title}\">\n                    <div class=\"non-payment-popin__header\">\n                       <div class=\"heading is-7 text-center\" role=\"heading\" aria-level=\"1\">\n                       ${config.popUpMessages.title}\n                       </div>\n                      </div>\n                     <br/> \n                     <p>\n                     ${config.popUpMessages.description1} ${payOption} ${config.popUpMessages.description2} ${selectedPaymentMethod} ${config.popUpMessages.description3}\n                      </p>\n                      <br/>\n                      <form id='alipayPaymentForm' action=\"${config.webservices.checkout.placeOrderFromHistory}\" method=\"POST\" novalidate=\"true\">\n                        <input type =\"hidden\" name='paymentProvider' value =\"${availablePayOption}\">\n                        <input type =\"hidden\" name='orderCode' value =\"${number}\">\n                        <button type=\"submit\" class=\"button is-primary\">` + config.popUpMessages.continueButtonText + ' ' + payOption + `</button>\n                      </form>\n                  </div>`\n  popin.open({\n    html: template,\n    modifiers: 'is-big is-relative nonPaymentPopin',\n    modal: true,\n    label: config.wechat.qrCodePopin.title,\n    opener: null,\n    forceInert: true,\n    manageFocus: true,\n    outerClose: true\n  }).then(() => {\n    window.addEventListener('click', onDocumentPopinClose)\n  })\n}\n\nfunction proceedWithOption(e) {\n  const form = e.target\n  e.preventDefault()\n  xhr.submit(form, {\n  }).then((res) => {\n    if (res.isSuccess) {\n        handleAlipayPayment(res)\n    } else {\n      window.location.replace(config.currentLocale + res.url)\n    }\n  }).catch((err) => {\n    console.error(err)\n  })\n}\n\nfunction init() {\n  bind(document.body, '#cnPlaceOrderForm', 'submit', placeChinesePayOrder)\n  bind(document.body, '.proceed-payment', 'click', proceedPayment)\n  bind(document.body, '#alipayPaymentForm', 'submit', proceedWithOption)\n}\n\nexport default { \n  init \n}"],"sourceRoot":""}