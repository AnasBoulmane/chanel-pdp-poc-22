{"version":3,"sources":["webpack:///./patterns/scripts/pages/account/add-an-address.js"],"names":["ADD_ADDRESS_CONTAINER_SELECTOR","ADDED_ADDRESS_ELEMENT_SELECTOR","ADD_ADDRESS_BUTTON_SELECTOR","ADD_ADDRESS_CANCEL_BUTTON_SELECTOR","ADD_ADDRESS_FORM_SELECTOR","ADD_ADDRESS_DIALOG_SELECTOR","DIALOG_LEAVE_BUTTON_SELECTOR","DIALOG_CANCEL_BUTTON_SELECTOR","DIALOG_CLOSE_BUTTON_SELECTOR","DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR","DIALOG_WRONG_ADDRESS_CLOSE_BUTTON_SELECTOR","ADD_ADDRESS_BAR_TITLE_ELM","FORM_INPUT_ELEMENTS","ADDRESSES_EMPTY_MESSAGE_SELECTOR","SET_DEFAULT_CHECKBOX","COUNTRY_SELECT","PHONE_COUNTRY_SELECT","ADDRESS_ZIP_CODE_SELECTOR","ADDRESS_TOWN_CITY_SELECTOR","DYNAMIC_HIDDEN_FIELDS","COUNTRY_SELECTED","config","country","toLowerCase","countryCodes","gb","jp","ca","au","countryCode","STATIC_COUNTRY_CODE_LABEL","AddAnAddressManager","Base","constructor","el","toUpperCase","then","module","default","init","e","displayAddAddressForm","dataLayer","push","eventCategory","eventAction","eventLabel","event","formIsEdited","displayLeaveCancelDialog","hideAddAddressForm","focusElement","select","removeDuplicateValue","form","delegateTarget","addSelector","classList","add","disabled","invalid","length","remove","sendAddressesCTA","preventDefault","input","MobilePhoneValidation","isValid","addAnAddress","formElm","document","Manager","publish","ACCOUNT_ADDRESS_LEAVE_MODAL_CLOSED","inputZipCode","hasAttribute","removeAttribute","stopImmediatePropagation","closeModal","window","removeEventListener","onEscapeButtonClicked","params","action","dialogId","modal","setAttribute","key","keyCode","onDialogCancelButtonClicked","onDisableInputs","getCurrentCountryType","radioContainer","body","radioButtons","getCollection","checkbox","checked","data","forEach","radio","onlyBillingText","contains","eCommercecountry","onActivateButtons","onChooseBillingButton","countryISO","Promise","resolve","arrCountries","locales","account","ecommCountries","ecommerceCountry","find","isEcommerce","selectorCountry","countrySelected","getSelectedOptionValue","getEcommerceCountry","inputBillingAddress","value","billingRadio","id","modalWrapperElm","target","closest","capAdresseModal","formIsActive","clickedElement","clickedElementName","tagName","parentElementName","parentNode","rootElementName","buttons","elements","indexOf","isDescending","cancelLeaveModalIsDisplayed","notifyAccountAddressLeaveModal","tmpAddressesList","bindEvents","bind","onAddAddressButtonClicked","onCancelButtonClicked","onSaveButtonClicked","onDialogLeaveButtonClicked","onUserConfirmedWrongAddress","onEnableRadioButtons","onCountrySelectorUpdated","subscribe","MODAL_IS_OPEN","onDialogLeaveCancelOpened","addAddressButtonElm","addAddressFormElm","addressMyaccount","addSearchElm","zipaddress","countryIsoCode","countryField","countryCodesOption","phoneCCodeEle","innerHTML","code","att","createAttribute","setAttributeNode","dispatchEvent","Event","wrapper","selectboxes","selectbox","zipCodeVariation","activeCountryLabel","addEventListener","onDocumentClicked","ACCOUNT_ADD_ADDRESS_STATUS","elm","removeChild","spanElm","textContent","selectElm","shippingCompany","shippingCompanyInput","reset","onRemoveTabIndex","scrollTo","offset_x","offset_y","hiddenInput","options","selectedIndex","text","hideDynamicFields","fieldsBlock","zipCode","townCity","style","height","opacity","updateAddresses","tmp","createElement","html","addressesElm","removeEmptyMessage","userConfirmedAddress","displayAgain","skipValidationElm","appendChild","firstChild","manageDataObj","paramsData","xhr","Object","assign","updateUI","catch","statusCode","displayWrongAddressDialog","fields","payload","CHECK_RESPONSE","focusNewAddedAddress","defaultEuropeWrapper","inputs","isoCode","namesToExclude","Array","from","filter","required","name","type","selectedOptions","innerText","dialogElm","popin","open","role","modifiers","opener","manageFocus","forceInert","outerClose","page","formInputsElms","inputElm","addAddressContainerElement","hide","emptyMessageElement","city","district","cityParent","parentElement","districtParent","citySelectboxValue","districtSelectboxValue","isModalOpened","isLeavingFormFromHeader","ACCOUNT_ADDRESS_LEAVE_MODAL","eAction"],"mappings":"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","file":"chunks/addAnAddress.js?v=3.23.0","sourcesContent":["import Base from 'modules/base'\nimport * as xhr from 'modules/fetch'\nimport bind from 'delegate'\nimport { Manager, MODAL_IS_OPEN, ACCOUNT_ADD_ADDRESS_STATUS, ACCOUNT_ADDRESS_LEAVE_MODAL, ACCOUNT_ADDRESS_LEAVE_MODAL_CLOSED, CHECK_RESPONSE } from 'lib/events'\nimport { select, closest, getCollection } from 'lib/selectors'\nimport { focusElement, getSelectedOptionValue} from 'lib/helpers'\nimport popin from 'modules/popin'\nimport * as MobilePhoneValidation from '../../config/mobile-phone-validation'\nimport zipCodeVariation from '../account/zip-code-variation'\n\n\n\n// Selectors\nconst ADD_ADDRESS_CONTAINER_SELECTOR = 'div[id=addEditAddressContainer]'\nconst ADDED_ADDRESS_ELEMENT_SELECTOR = 'li.account__category:first-child article h3'\nconst ADD_ADDRESS_BUTTON_SELECTOR = 'button[type=button].js-add-an-address'\nconst ADD_ADDRESS_CANCEL_BUTTON_SELECTOR = 'button[type=button].js-add-edit-address-cancel'\nconst ADD_ADDRESS_FORM_SELECTOR = 'form[id=addressForm]'\nconst ADD_ADDRESS_DIALOG_SELECTOR = 'div[id=\"js-modal-prompt-leave-add-address-form\"]'\nconst DIALOG_LEAVE_BUTTON_SELECTOR = 'button[id=\"modal_leave_buttons_ok\"]'\nconst DIALOG_CANCEL_BUTTON_SELECTOR = 'button[id=\"modal_leave_buttons_ko\"]'\nconst DIALOG_CLOSE_BUTTON_SELECTOR = 'div.yes-no-modal button.popin__close.js-popin-close'\nconst DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR = 'button.is-tertiary.js-popin-close'\nconst DIALOG_WRONG_ADDRESS_CLOSE_BUTTON_SELECTOR = 'button.is-icon.popin__close.js-popin-close'\nconst ADD_ADDRESS_BAR_TITLE_ELM = 'div.heading-block.has-thin-separator h2'\nconst FORM_INPUT_ELEMENTS = 'input.label-input__input, .selectbox__input'\nconst ADDRESSES_EMPTY_MESSAGE_SELECTOR = 'div.context p'\nconst SET_DEFAULT_CHECKBOX = 'input#makeDefault'\nconst COUNTRY_SELECT = '.is-myaccount-select > select[name=\"countryIso\"]'\nconst PHONE_COUNTRY_SELECT = '.js-country-iso > select[name=\"phoneCountryCode\"]'\nconst ADDRESS_ZIP_CODE_SELECTOR = '.js-address-zip-code'\nconst ADDRESS_TOWN_CITY_SELECTOR = '.js-address-town-city'\nconst DYNAMIC_HIDDEN_FIELDS = '.dynamic-complementary-fields-block'\nconst COUNTRY_SELECTED = config.country.toLowerCase()\nconst countryCodes = {gb:\"+44 (GB)\", jp:\"+81 (JP)\", ca:\"+1 (CA)\", au:\"+61 (AU)\"}\nconst countryCode = countryCodes[COUNTRY_SELECTED]\nconst STATIC_COUNTRY_CODE_LABEL = '.static-country-label'\n\nclass AddAnAddressManager extends Base {\n\n  constructor(el) {\n    if (config.country.toUpperCase() === 'CN') {\n      import('./cn-address').then((module) => {\n        module.default.init()\n      })\n    }\n    super(el)\n    this.el = el\n    this.params = {\n      formIsActive: false,\n      tmpAddressesList: null,\n      clickedElement: null,\n      cancelLeaveModalIsDisplayed: false,\n      form: null,\n      dialogId: 'dialogLeaveCancel',\n      eCommercecountry: true\n    }\n    this.bindEvents()\n    this.getCurrentCountryType()\n  }\n\n  /**\n   * Called to set events\n   */\n  bindEvents() {\n    bind(this.el, ADD_ADDRESS_BUTTON_SELECTOR, 'click', this.onAddAddressButtonClicked)\n    bind(this.el, ADD_ADDRESS_CANCEL_BUTTON_SELECTOR, 'click', this.onCancelButtonClicked)\n    bind(this.el, ADD_ADDRESS_FORM_SELECTOR, 'submit', this.onSaveButtonClicked)\n    bind(document.body, DIALOG_LEAVE_BUTTON_SELECTOR, 'click', this.onDialogLeaveButtonClicked)\n    bind(document.body, DIALOG_CANCEL_BUTTON_SELECTOR, 'click', this.onDialogCancelButtonClicked)\n    bind(document.body, DIALOG_WRONG_ADDRESS_CLOSE_BUTTON_SELECTOR, 'click', this.onDialogCancelButtonClicked)\n    bind(document.body, DIALOG_CLOSE_BUTTON_SELECTOR, 'click', this.onDialogCancelButtonClicked)\n    bind(document.body, DIALOG_WRONG_ADDRESS_ISCORRECT_BUTTON_SELECTOR, 'click', this.onUserConfirmedWrongAddress)\n    bind(document.body, SET_DEFAULT_CHECKBOX, 'click', this.onEnableRadioButtons)\n    bind(document.body, COUNTRY_SELECT, 'change', this.onCountrySelectorUpdated)\n    Manager.subscribe(MODAL_IS_OPEN, this.onDialogLeaveCancelOpened)\n  }\n\n  /**\n   * Display address form\n   * @param e {MouseEvent}: contains event properties\n   */\n  displayAddAddressForm(e) {\n\te.stopImmediatePropagation()\n\n    // Hide button\n    const addAddressButtonElm = e.delegateTarget\n    addAddressButtonElm.classList.add('is-hidden')\n    // Display AddAddressForm\n    const addAddressFormElm = select(ADD_ADDRESS_CONTAINER_SELECTOR, this.el)\n    addAddressFormElm.classList.remove('is-hidden')\n    const addressMyaccount = select('.js-daumkr')\n    addressMyaccount ? addressMyaccount.setAttribute('hidden', '') : null\n    const addSearchElm = select('.js-search-btn')\n    addSearchElm ? addSearchElm.removeAttribute('hidden') : null \n    const zipaddress = select('.js-address-field-block')\n    zipaddress ? zipaddress.setAttribute('hidden', '') : null\n    const countryIsoCode = select(PHONE_COUNTRY_SELECT, document.body)\n    const countryField = select('.selectbox.js-country-iso')\n    if ((config.country.toLowerCase() == 'gb' || config.country.toLowerCase() == 'jp' || config.country.toLowerCase() == 'ru' || config.country.toLowerCase() == 'ca') && countryIsoCode) {\n    \tconst countryCodesOption = getCollection('#pos_countryCode option')\n        const phoneCCodeEle = select('span', select('.selectbox__wrapper.phone_selectbox'))\n    \tif (phoneCCodeEle) {\n    \t\t\tphoneCCodeEle.innerHTML = countryCode\n    \t}\n    \tcountryCodesOption.forEach((code) => { \n            var att = document.createAttribute(\"selected\")\n            att.value = \"selected\" \n               if(code.innerHTML == countryCode) {                                    \n                code.setAttributeNode(att);\n               }\n               else {\n                code.removeAttribute(\"selected\")\n               }\n        })\n        countryIsoCode.dispatchEvent(new Event('change'))        \t\n    }\n    if (countryIsoCode && countryField) {\n      const wrapper = closest(countryField, '.js-label-input')\n      !countryField.classList.contains('has-content') ? countryField.classList.add('has-content') : null\n      !wrapper.classList.contains('has-content') ? wrapper.classList.add('has-content') : null\n      !countryIsoCode.classList.contains('has-content') ? countryIsoCode.classList.add('has-content') : null\n    }\n    /*// Scroll to add address bar title\n    const barTitleElm = select(ADD_ADDRESS_BAR_TITLE_ELM, this.el)\n    window.scrollTo(0, barTitleElm.scrollTop);*/\n    \n    /* Add class has-content in order to display the selected country */\n    const selectorCountry = select(COUNTRY_SELECT, document.body)\n    if (selectorCountry) {\n      const selectboxes = getCollection('.selectbox.js-address-country, .selectbox.js-phone-number-select, [data-phone-pattern-code]')\n      selectboxes.forEach(selectbox => {\n        const wrapper = closest(selectbox, '.js-label-input')\n        !selectbox.classList.contains('has-content') ? selectbox.classList.add('has-content') : null\n        !wrapper.classList.contains('has-content') ? wrapper.classList.add('has-content') : null\n        !selectorCountry.classList.contains('has-content') ? selectorCountry.classList.add('has-content') : null\n      })\n      // Triggers CHANGE event in order to force Cap Address updating Country code\n      selectorCountry.dispatchEvent(new Event('change'))\n      zipCodeVariation()\n    }    \n\n    if(config.country === 'RU'){\n      const activeCountryLabel = select(STATIC_COUNTRY_CODE_LABEL)\n      if(activeCountryLabel){\n        !activeCountryLabel.classList.contains('has-content') ? activeCountryLabel.classList.add('has-content') : null\n      }      \n    }\n\n    // Move focus to form title\n    focusElement(select(ADD_ADDRESS_BAR_TITLE_ELM, this.el))\n\n    // bind document event\n    this.params.formIsActive = true\n    document.addEventListener('mousedown', this.onDocumentClicked)\n   // update form status\n    Manager.publish(ACCOUNT_ADD_ADDRESS_STATUS, {formIsActive: true, formIsEdited: true})\n    this.removeDuplicateValue()\n  }\n\n  /**\n   * Hide the address form\n   */\n  hideAddAddressForm() {\n\n    // Hide \"Add an address\" container\n    const addAddressFormElm = select(ADD_ADDRESS_CONTAINER_SELECTOR, this.el)\n    addAddressFormElm.classList.add('is-hidden')\n    // Display a \"Add an address\" button\n    const addAddressButtonElm = select(ADD_ADDRESS_BUTTON_SELECTOR, this.el)\n    addAddressButtonElm.classList.remove('is-hidden')\n    \n    // Reset form to it's original state\n    const formElm = select(ADD_ADDRESS_FORM_SELECTOR, addAddressFormElm)\n    if(config.country !== 'KR' && config.country !== 'CN' && config.country !== 'CA') {\n    getCollection('.has-content', formElm).forEach((elm) => elm.classList.remove('has-content'))\n    }\n    getCollection('.has-error', formElm).forEach((elm) => elm.classList.remove('has-error'))\n    getCollection('p.error', formElm).forEach(elm => elm.parentNode.removeChild(elm))\n    getCollection('.js-button-fake-input span', formElm).forEach((spanElm) => spanElm.textContent = '')\n\n    const selectElm = select('span.selectbox__wrapper span', formElm)\n    if (selectElm){\n    selectElm.innerHTML = ''\n    }\n    const shippingCompany = select('#shipping-company', formElm)\n    if (shippingCompany && !shippingCompany.classList.contains('is-hidden')) {\n      const shippingCompanyInput = select('[name=\"companyName\"]', shippingCompany)\n      shippingCompany.classList.add('is-hidden')\n      shippingCompany.setAttribute('aria-hidden', true)\n      if (shippingCompanyInput) {\n        shippingCompanyInput.removeAttribute('required')\n        shippingCompanyInput.removeAttribute('aria-required')\n      }\n    }\n\n    formElm.reset()\n\n    this.onRemoveTabIndex()\n\n    // Scroll to AddAddress button location\n    window.scrollTo(addAddressButtonElm.offset_x, addAddressButtonElm.offset_y)\n\n    // Hide popin\n    this.closeModal()\n\n    // updates hidden input value for mobile phone number\n    if(config.country !== 'KR' && config.country !== 'RU' && config.country !== 'CN') {\n      const hiddenInput = select('#phoneCountryCodeHidden', document.body)\n      hiddenInput ? hiddenInput.value = '' : null\n    }\n\n    // updates checkbox and radio buttons, cleans selected value for country\n    const selectorCountry = select(COUNTRY_SELECT, document.body)\n    if (selectorCountry) {\n      const value = selectorCountry.options[selectorCountry.selectedIndex].text\n      select('.js-address-country .selectbox__wrapper > span', document.body).innerHTML = value\n      this.onDisableInputs()\n      this.getCurrentCountryType()\n    }\n    // hides the dynamic fields for CapAdresse\n    this.hideDynamicFields()\n\n    // unbind document event\n    this.params.formIsActive = false\n    document.removeEventListener('click', this.onDocumentClicked)\n\n    // Update form status\n    Manager.publish(ACCOUNT_ADD_ADDRESS_STATUS, { formIsActive: false, formIsEdited: false })\n  }\n\n  /**\n   * Hides dynamic Fields for Capadress\n   */\n  hideDynamicFields() {\n    const fieldsBlock = select(DYNAMIC_HIDDEN_FIELDS, document.body)\n    if (fieldsBlock && !fieldsBlock.hasAttribute('hidden')) {\n      const zipCode = select(ADDRESS_ZIP_CODE_SELECTOR, document.body)\n      const townCity = select(ADDRESS_TOWN_CITY_SELECTOR, document.body)\n      if ((zipCode && zipCode.value === '') && (townCity && townCity.value === '')) {\n        fieldsBlock.setAttribute('hidden', true)\n        fieldsBlock.style.height = 0\n        fieldsBlock.style.opacity = 0\n      }\n    }\n  }\n\n  /**\n   * Call this to update the default and additional addresses list\n   * response must contains the update HTML response\n   * @param data {Object}: JSON response\n   * @return {*}: return JSON response\n   */\n  updateAddresses(data) {\n    const tmp = document.createElement('div')\n    tmp.innerHTML = data.html\n    const addressesElm = select('div[data-manage]')\n    addressesElm.innerHTML = data.html\n    this.removeEmptyMessage()\n    return data\n  }\n\n  /**\n   * Call this to send and add an address\n   * @param form {HTMLFormElement}: contains address form element\n   * @param userConfirmedAddress {boolean}: (Optional) user confirm or discard the wrong address\n   * @param displayAgain {boolean}: (Optional) use once user discard a wrong address to avoid a display again\n   */\n  addAnAddress(form, userConfirmedAddress = false, displayAgain = true) {\n    // Add extra parameter to validate or not a wrong address\n    const skipValidationElm = document.createElement('input')\n    skipValidationElm.innerHTML = `<input id=\"skipValidation\" name=\"skipValidation\" type=\"hidden\" value=\"${userConfirmedAddress}\">`\n    form.appendChild(skipValidationElm.firstChild)\n\n    // Send XHR request\n    this.manageDataObj(form)\n    .then(paramsData => {\n      xhr.submit(form, { data: paramsData })\n      .then((data) => {\n        return Object.assign({updateUI: true}, data)\n      })\n      .catch((data) => {\n        if (data.statusCode === 422 && data.modal && displayAgain) {\n          this.displayWrongAddressDialog(data)\n        } else if (data.fields){\n            const payload = {\n              'data': data,\n              'form': form\n            }\n            Manager.publish(CHECK_RESPONSE, payload)\n        } else {\n          return Object.assign({updateUI: true}, data)\n        }\n      })\n      .then((data) => {\n        if (data && data.updateUI) {\n          if (data.html) {\n            this.updateAddresses(data)\n          }\n          this.hideAddAddressForm()\n          this.focusNewAddedAddress(data)\n          const defaultEuropeWrapper = select('#europe_default_section',document.body)\n          if (defaultEuropeWrapper) {\n            defaultEuropeWrapper.classList.remove('is-hidden')\n          }\n          this.sendAddressesCTA('added')\n        }\n      })\n    })\n  }\n\n/**\n  * Return new object from Form data\n */\n  manageDataObj(form) {\n    return new Promise((resolve) => {\n      const paramsData = {}\n      const inputs = getCollection('input, select', form)\n      let isoCode\n      const namesToExclude = ['phoneCountryCode', 'addressId', 'countryIso', 'useDeliveryAddressEU', '_useDeliveryAddressEU', 'qualityCode', 'skipValidation', '_shippingToBusinessAddress', 'billingAddress', 'shippingAddress', 'line2', 'district', 'provincia', 'shippingToBusinessAddress', 'defaultAddress' , 'municipality','village', 'building']\n      if((config.country.toLowerCase() === \"ru\") || (config.country.toLowerCase() === \"cn\")){\n        namesToExclude.push(\"postcode\")      \n      }\n      if(config.country.toLowerCase() === \"ca\"){\n        namesToExclude.push(\"phone\")\n      }\n      Array.from(inputs).filter(input =>\n        // We add an exception for phoneCountryCode && addressId as this field is used to normalized the\n        // required phoneCountryCodeField input && addressId\n         (input.required || namesToExclude.indexOf(input.name) !== -1)).forEach(input => {\n           if (input.type === 'radio' || input.type === 'checkbox') {\n             input.checked === true ? paramsData[input.name] = input.value : null\n           } else if (input.name === 'countryIso') {\n             isoCode = input.value === 'LT' ? input.value : null\n             paramsData[input.name] = input.value\n           } else if((config.country.toLowerCase() === \"cn\") && ((input.name === \"provincia\") || (input.name === \"district\") || (input.name === \"townCity\"))) {\n              paramsData[input.name] = input.selectedOptions[0].innerText;\n           } else if (input.name === 'postcode') {\n             paramsData[input.name] = isoCode ? `${isoCode}-${input.value}` : input.value\n           }\n           else {\n             input.value !== '' ? paramsData[input.name] = input.value : null\n           }\n         })\n      resolve(paramsData)\n    })\n  }\n\n\n  /**\n   * display a yes(leave) no(cancel) dialog\n   */\n  displayLeaveCancelDialog() {\n    this.params.cancelLeaveModalIsDisplayed = true\n    const dialogElm = select(ADD_ADDRESS_DIALOG_SELECTOR, this.el)\n    popin.open({\n      html: dialogElm.innerHTML,\n      role: 'dialog',\n      modifiers: '',\n      opener: null,\n      manageFocus: false,\n      forceInert: true,\n      modal: false,\n      action: 'dialogLeaveCancel',\n      outerClose: false\n    })\n\n    // Catch keyboard inputs (enter, a, b, esp ...)\n    window.addEventListener('keydown', this.onEscapeButtonClicked)\n    document.removeEventListener('mousedown', this.onDocumentClicked)\n  }\n\n  /**\n   * Call this to display a \"wrong address\" dialog\n   * @param data {Object}: JSON response\n   */\n  displayWrongAddressDialog(data) {\n    popin.open({\n      html: data.modal,\n      role: 'dialog',\n      modifiers: '',\n      opener: null,\n      manageFocus: false,\n      forceInert: true,\n      modal: true,\n      page: 'wrong address',\n      outerClose: false\n    })\n    window.addEventListener('keydown', this.onEscapeButtonClicked)\n    document.removeEventListener('mousedown', this.onDocumentClicked)\n  }\n\n  /**\n   * Call this to focus new added address\n   * response must contains the update HTML response\n   * @param data {Object}: JSON response\n   * @return {*}: return JSON response\n   */\n  focusNewAddedAddress(data) {\n    focusElement(select(ADDED_ADDRESS_ELEMENT_SELECTOR, this.el))\n    return data\n  }\n\n  /**\n   * Check if form has been edited\n   * @return {boolean}: true if form elements are edited, else false\n   */\n  formIsEdited() {\n    const formInputsElms = getCollection(FORM_INPUT_ELEMENTS, this.el)\n    return formInputsElms.find(function (inputElm) {\n      return inputElm.value.length > 0\n    })\n  }\n\n  /**\n   * Check is passed element is descending of add address form\n   * @param elm {EventTarget}: element to check\n   * @return {boolean}: true is passed element is inside of form, else false\n   */\n  isDescending(elm) {\n    const addAddressContainerElement = select(ADD_ADDRESS_CONTAINER_SELECTOR, this.el)\n    return addAddressContainerElement.contains(elm)\n  }\n\n  /**\n   * Close the active modal\n   */\n  closeModal() {\n    this.params.cancelLeaveModalIsDisplayed = false\n    document.addEventListener('mousedown', this.onDocumentClicked)\n    popin.hide()\n    this.notifyAccountAddressLeaveModal(false)\n  }\n\n  /**\n   * Remove the empty tag\n   * This is occurred only when user create an address for first times\n   */\n  removeEmptyMessage () {\n    const emptyMessageElement = select(ADDRESSES_EMPTY_MESSAGE_SELECTOR, document.body)\n    if (emptyMessageElement) {\n      emptyMessageElement.classList.add(\"is-hidden\")\n    }\n  }\n\n\n  // EVENTS\n\n  /**\n   * Triggered once user click on \"Add an address\"\n   * Display the add an address form and hide the \"add an address\" button\n   * Don't use it for other purposes\n   * @param e {MouseEvent}: contains event properties\n   */\n  onAddAddressButtonClicked = (e) => {\n    this.displayAddAddressForm(e)\n\n    dataLayer.push({\n      eventCategory: 'addresses',\n      eventAction: 'add',\n      eventLabel: '',\n      event: 'uaevent'\n    })\n\n  }\n\n  /**\n   * Triggered once user click on \"Cancel\" from add an address form\n   * Don't use it for other purposes\n   * @param e {MouseEvent}: contains event properties\n   */\n  removeDuplicateValue (){\n    let city = select('[id=\"address.townCity\"]')\n    let district = select('[id=\"address.district\"]')\n    let cityParent = city.parentElement\n    let districtParent = district.parentElement\n    city.value = null\n    district.value = null\n    city.setAttribute(\"aria-disabled\", true)\n    district.setAttribute(\"aria-disabled\", true)\n    cityParent.classList.add('is-disabled')\n    districtParent.classList.add('is-disabled')\n    city.innerHTML = '';\n    district.innerHTML = '';\n    let citySelectboxValue = select('.js-address-city .selectbox__wrapper span')\n    citySelectboxValue.innerHTML = ' '\n    let districtSelectboxValue = select('.js-address-district .selectbox__wrapper span')\n    districtSelectboxValue.innerHTML = ' '\n  }\n  \n  onCancelButtonClicked = () => {\n    if (this.formIsEdited() && config.country != 'KR' && config.country != 'CN') {\n      this.displayLeaveCancelDialog()\n    } else {\n      this.hideAddAddressForm()\n      focusElement(select(ADD_ADDRESS_BUTTON_SELECTOR, this.el))\n      this.removeDuplicateValue()\n    }\n\n  }\n  /**\n   * Triggered once user click on \"Save\" from add an address form\n   * Don't use it for other purposes\n   * @param e {MouseEvent}: contains event properties\n   */\n  onSaveButtonClicked = (e) => {\n    const form = e.delegateTarget\n    const addSelector = select('.js-add-edit-address-save');\n    if (addSelector) {\n      addSelector.classList.add('is-disabled');\n      addSelector.disabled = true;\n    }\n    if (form.invalid.length) {\n      addSelector.classList.remove('is-disabled');\n      addSelector.disabled = false;\n      return\n    }\n    this.sendAddressesCTA('confirm')\n    e.preventDefault()\n    const input = select('[data-phone-pattern]')\n    if (input) {\n      MobilePhoneValidation.getUserNumber()\n      .then((isValid) => {\n        this.addAnAddress(form, false)\n      })\n    }\n    else {\n      this.addAnAddress(form, false)\n    }\n  }\n\n  /**\n   * Triggered once user confirmed is \"correct address\"\n   */\n  onUserConfirmedWrongAddress = () => {\n    const formElm = select(ADD_ADDRESS_FORM_SELECTOR, this.el)\n    this.addAnAddress(formElm, true)\n  }\n\n  /**\n   * Triggered once user click on \"Leave\" button from popin\n   * Don't use it for other purposes\n   * @param e {MouseEvent}: contains event properties\n   */\n  onDialogLeaveButtonClicked = () => {\n    this.hideAddAddressForm()\n    focusElement(select(ADD_ADDRESS_BUTTON_SELECTOR), document)\n    Manager.publish(ACCOUNT_ADDRESS_LEAVE_MODAL_CLOSED, {})\n  }\n\n /**\n  * Removes tabindex\n  */\n  onRemoveTabIndex = () => {\n    const inputZipCode = select('#addressForm input[name=\"postcode\"]')\n    if (inputZipCode && inputZipCode.hasAttribute('tabindex')) {\n      inputZipCode.removeAttribute('tabindex')\n    }\n  }\n\n  /**\n   * Triggered once user click on \"Cancel\" from popin\n   * Don't use it for other purposes\n   * @param e {MouseEvent}: contains event properties\n   */\n  onDialogCancelButtonClicked = (e) => {\n    e.stopImmediatePropagation()\n    this.closeModal()\n    window.removeEventListener('keydown', this.onEscapeButtonClicked)\n  }\n\n  /**\n   * Triggered once dialog is displayed\n   * @param params {Object}: contains dialog params (returned by popin.js)\n   */\n  onDialogLeaveCancelOpened = (params) => {\n    if (params.action === this.params.dialogId) {\n\n      // add and set attributes\n      params.modal.el.setAttribute('aria-labelledby', 'modal-leave-title')\n      params.modal.el.setAttribute('role', 'dialog')\n\n      // applied focus on close button\n      focusElement(select(DIALOG_CLOSE_BUTTON_SELECTOR, params.modal.el))\n    } else {\n      // WRONG ADDRESS DIALOG\n      focusElement(select(DIALOG_WRONG_ADDRESS_CLOSE_BUTTON_SELECTOR, params.modal.el))\n    }\n  }\n\n  /**\n   * Triggered once user clicked on keyboard inputs\n   * @param e {MouseEvent}: MouseEvent parameters\n   */\n  onEscapeButtonClicked = (e) => {\n    if ((e.key === 'Escape'|| e.key === 'Esc'|| e.keyCode === 27)) {\n      this.onDialogCancelButtonClicked(e)\n    }\n  }\n\n   /**\n   * Removes attribute CHECKED on type=select && type=radio, on country changement\n   */\n  onCountrySelectorUpdated = () => {\n    this.onDisableInputs()\n    this.getCurrentCountryType()\n  }\n\n\n  /**\n   * Cleans radio buttons and text\n   */\n  onDisableInputs = () => {\n    const radioContainer = select('div.add-edit-account-addresses', document.body)\n    const radioButtons = getCollection('div.add-edit-account-addresses input[type=radio]', document.body)\n    const checkbox = select(SET_DEFAULT_CHECKBOX, document.body)\n    if (checkbox) {\n      checkbox.checked = checkbox.data('checked') || false\n      checkbox.data('checked', '')\n    }\n    if (radioContainer){\n      radioContainer.classList.add('is-hidden')\n      radioButtons.forEach(radio => {\n        radio.checked = false\n        radio.setAttribute('disabled', \"disabled\")\n        radio.removeAttribute('required')\n        radio.setAttribute('aria-required', false)\n      })\n    }\n    const onlyBillingText = select('.js-account-billing-text', document.body)\n    if (onlyBillingText) {\n      !onlyBillingText.classList.contains('is-hidden') ? onlyBillingText.classList.add('is-hidden') : null\n    } \n  }\n\n  /**\n   * Triggered once user clicked on input checkbox\n   * \n   */\n  onEnableRadioButtons = () => {\n    this.getCurrentCountryType()\n    const checkbox = select(SET_DEFAULT_CHECKBOX, document.body)\n    const checked = checkbox.checked\n    const radioContainer = select('div.add-edit-account-addresses',document.body)\n    const radioButtons = getCollection('div.add-edit-account-addresses input[type=radio]', document.body)\n    \n    \n    if (checked) {\n      radioContainer.classList.remove('is-hidden')\n      this.params.eCommercecountry === true ? this.onActivateButtons(radioButtons) : this.onChooseBillingButton(radioButtons)\n    } else {\n      const onlyBillingText = select('.js-account-billing-text', document.body)\n      if (onlyBillingText) {\n        !onlyBillingText.classList.contains('is-hidden') ? onlyBillingText.classList.add('is-hidden') : null\n      } \n      radioContainer.classList.add('is-hidden')\n      radioButtons.forEach(radio => {\n        radio.checked = false\n        radio.setAttribute('disabled', \"disabled\")\n        radio.removeAttribute('required')\n        radio.setAttribute('aria-required', false)\n      })\n    }\n  }\n\n  /**\n   * Returns true if selected country is ecommerce country\n   */\n  getEcommerceCountry = (countryISO) => {\n    return new Promise((resolve) => {\n      const arrCountries = window.config.locales.account.ecommCountries\n      const ecommerceCountry = arrCountries.find(country => country === countryISO)\n      const isEcommerce = ecommerceCountry ? true : false\n      resolve(isEcommerce)\n    })\n  }\n\n  /**\n   * Returns parameter isEcommerce<Boolean> according to selected country  ecommerce type\n   */\n  getCurrentCountryType = () => {\n    const selectorCountry = select(COUNTRY_SELECT, document.body)\n    let countrySelected\n    selectorCountry ?  countrySelected = getSelectedOptionValue(selectorCountry,'upper') : countrySelected = null\n\n    if (countrySelected) {\n      this.getEcommerceCountry(countrySelected)\n        .then(isEcommerce => {\n          const inputBillingAddress = select('input[id=\"billingAddress\"]', document.body)\n          \n          isEcommerce === true ? inputBillingAddress.value = 'false' : inputBillingAddress.value = 'true'\n          return this.params.eCommercecountry = isEcommerce \n        })\n    }\n    else {\n      return false\n    }\n  }\n\n\n  /**\n   * Enables radio buttons and checks the first one\n   */\n  onActivateButtons = (radioButtons) => {\n    radioButtons.forEach(radio => {\n      radio.removeAttribute('disabled')\n      radio.setAttribute('required', true)\n      radio.setAttribute('aria-required', true)\n    })\n    radioButtons[0].checked = radioButtons[0].data('checked') || true\n    radioButtons[0].data('checked', true)\n  }\n\n  /**\n   * Enables billing radio button and checks it\n   */\n  onChooseBillingButton = (radioButtons) => {\n    const billingRadio = radioButtons.find(radio => radio.id === 'defaultTypeBilling')\n    const onlyBillingText = select('.js-account-billing-text', document.body)\n    onlyBillingText ? onlyBillingText.classList.remove('is-hidden') : null\n    \n    billingRadio.removeAttribute('disabled')\n    billingRadio.setAttribute('required', true)\n    billingRadio.setAttribute('aria-required', true)\n    billingRadio.checked = billingRadio.data('checked') || true\n    billingRadio.data('checked', true)\n  }\n\n  /**\n   * Used to detect if target element is inside form element\n   * @param e {MouseEvent}: mouse event properties\n   */\n  onDocumentClicked = (e) => {\n    const modalWrapperElm = e.target.closest('.popin-wrapper')\n    const capAdresseModal = select('.is-capAdresse-modal', modalWrapperElm)\n\n    if (this.params.formIsActive && !capAdresseModal) {\n      const clickedElement = e.target\n      const clickedElementName = clickedElement.tagName.toLowerCase()\n      const parentElementName = clickedElement.parentNode.tagName.toLowerCase()\n      const rootElementName = clickedElement.parentNode.parentNode.tagName.toLowerCase()\n      const buttons = ['a', 'button']\n      const elements = [rootElementName, parentElementName, clickedElementName]\n\n      // Is a BUTTON or A element\n      if (elements.indexOf(buttons[0]) > -1 || elements.indexOf(buttons[1]) > -1) {\n        this.params.clickedElement = clickedElement\n\n        // Is not descending element and modal is not displayed\n        if (!this.isDescending(clickedElement) && !this.params.cancelLeaveModalIsDisplayed) {\n          this.notifyAccountAddressLeaveModal(true)\n\n          e.preventDefault()\n          this.displayLeaveCancelDialog()\n        }\n      }\n    }\n  }\n\n  /**\n   * Notify/publish ACCOUNT_ADDRESS_LEAVE_MODAL status (for header)\n   * @param isModalOpened {Boolean}: tell if modal is opened or closed\n   */\n  notifyAccountAddressLeaveModal(isModalOpened) {\n    // If we clicked on a header link\n    if (this.params.clickedElement) {\n      const isLeavingFormFromHeader = this.params.clickedElement.closest('.js-header')\n      Manager.publish(ACCOUNT_ADDRESS_LEAVE_MODAL, {\n        isLeavingFormFromHeader,\n        isModalOpened,\n        clickedElement: this.params.clickedElement\n      })\n    }\n  }\n\n  sendAddressesCTA(eAction){\n    dataLayer.push({\n      eventCategory: 'addresses',\n      eventAction: eAction,\n      eventLabel: '',\n      event: eAction !== 'added' ? 'uaevent' : 'nievent'\n    })\n  }\n\n}\n\nexport default function (el) {\n  return new AddAnAddressManager(el)\n}\n"],"sourceRoot":""}