{"version":3,"sources":["webpack:///./node_modules/@use-gesture/core/actions/dist/use-gesture-core-actions.esm.js","webpack:///./node_modules/@use-gesture/core/dist/actions-8e12537b.esm.js","webpack:///./node_modules/@use-gesture/core/dist/maths-b2a210f4.esm.js","webpack:///./node_modules/@use-gesture/core/dist/use-gesture-core.esm.js","webpack:///./node_modules/@use-gesture/core/utils/dist/use-gesture-core-utils.esm.js","webpack:///./node_modules/@use-gesture/vanilla/dist/use-gesture-vanilla.esm.js","webpack:///./patterns/scripts/lib/helpers/camera-detect.js","webpack:///./patterns/scripts/lib/spring-animation.js","webpack:///./patterns/scripts/pages/pdp/index.js","webpack:///./patterns/scripts/pages/pdp/main.js","webpack:///./patterns/scripts/pages/pdp/popin-notify.js"],"names":["isCameraAvailableForVTO","callback","isProductTypeWithVTO","test","select","className","vtoContainer","errorContainer","isVtoLaunched","error","minMax","val","min","max","Math","is","arr","a","Array","isArray","obj","stringContains","Object","prototype","toString","call","pth","hasOwnProperty","svg","SVGElement","inp","HTMLInputElement","dom","nodeType","str","fnc","und","nil","hex","rgb","hsl","col","key","defaultInstanceSettings","defaultTweenSettings","cache","getDuration","stringKey","solver","cached","frame","elapsed","rest","duration","spring","mass","pMass","stiffness","pStiffness","damping","pDamping","velocity","pVelocity","pDuration","undefined","zeta","sqrt","omega0","omega1","x0","b","join","t","progress","exp","cos","sin","console","log","springEasing","list","listAll","manageQR","openReviewUnsubscribePopin","wishlistDataArray","wDLGA","window","dataLayerGA","productNameDL","pageLoad","ecommerce","detail","products","name","prepareForVto","product","browser","getBrowserInfo","is4ShadowProduct","basic","ctoIntensity","urlHasVto","location","href","indexOf","document","querySelector","is4ShadowFeatureFlipping","color","history","pushState","title","pathname","search","hasTwoIntensities","mainSku","code","altSku","then","renderVTO","ctaContainer","labels","config","locales","vto","autostart","localStorage","getItem","hasHash","tryOnAriaLabelValue","colorText","vtoButton","colorTextDescription","innerHTML","ariaLabelVal","getAttribute","concat","trim","setAttribute","PDP","el","isQuickView","closest","isCartView","quickViewHeading","pdpCtas","pdpText","selectedTabEl","LIVE_LOADING_TEXT","bleuLightLink","country","disclaimerTag","aTag","createElement","spanTag","classList","add","webservices","pdp","orderByPhoneDownLink","appendChild","productDetails","init","refresh","getElement","dataLayer","sub_category_level3","sessionStorage","CacheIndex","rePublishPageLoadData","PAGELOAD_WISHLIST","Manager","subscribe","wishlistData","get","replace","dataset","ref","dataBasic","basicRes","jsConfigSecond","availability","dataStock","stockRes","stock","buyNow","buyNowApplePayEnable","showNotifyMe","showNotifyMeForQuickView","displayPOSdataForCnC","variantSelector","hasWishlistSelector","setItem","stockLevel","isClickAndCollect","availableToCurrentUser","style","display","productDetailsCtasHandler","productName","clickAndCollectDisplayDl","sellableOnline","axisType","push","eventCategory","eventAction","eventLabel","event","wfjSizeSelector","disclaimerIndicator","disclaimerText","remove","wrapperElem","wrapperHeight","getComputedStyle","height","wishlist","sanitizeWishlistData","vtoEnabled","publish","showBoyFriendConfigurator","myBoyfriendCta","MYBOYFRIEND_SCRIPT","myBoyfriendJsUrl","MYBOYFRIEND_CSS","myBoyfriendCssUrl","MYBOYFRIEND_DATA","myBoyfriendBackofficeUrl","GreenSockGlobals","ctaSection","template","myBoyFriendCtaText","insertAdjacentHTML","script","src","id","defer","head","link","rel","NOTIFY_CONTAINER_SELECTOR","NOTIFY_TEXT_SELECTOR","productDetailsNotifyWrapperEl","productNotifyTextWrapperEl","pdpDisabledCtasWrapper","pdptextWrapper","removeAttribute","ProductDetails","onVariantChange","addEventListener","handlePopState","bindsEvents","bind","ON_COMPLETE_SCROLL_TO_ANCHOR","addFocusAfterClick","orderByPhoneDisclaimerLink","disclaimerLinkFocus","notifyMeQuickView","notifyMeClickQuickView","isMobile","selectAll","length","marginTop","bleuLightLinkDataLayer","CLIENT_HEIGHT","DLKit","fieldsBlock","fieldsBlockAnimate","clientHeight","TweenLite","fromTo","opacity","notifyMeForm","body","removeEventListener","submitNotifyMeQuickview","dBind","clickAndCollectClickDl","e","preventDefault","userEmail","value","productCode","productStatus","userPhoneNumber","notifyFlag","toUpperCase","notifyError","notifyField","getCollection","hasAttribute","forEach","input","field","focusElement","elementId","data","emailAddress","assign","phoneNumber","legalPrivacy","legacyConsent","phoneCountryCodeField","notifyMeCta","loader","Loader","button","create","delegateTarget","invalid","post","action","response","destroy","message","inputEl","type","setErrorMessage","thankyouMsg","popinThankyou","popinMessage","notifyMeQuickViewForm","thankyouMsgWrapper","thankyouTitle","catch","errorMessage","parent","parentNode","area","onPageLoad","notifyPopinButton","initPopinNotify","updateLoadingTxt","isLoading","text","updatedVisualChevronMargin","vtoWrapper","isVtoStarted","isVtoDenied","variantList","isWFJSizeSelector","redirect","noBrand","parentEl","loaderWrapper","params","sku","nobrand","quickView","target","includes","isVtoOnMobile","enableSyncCol","referenceEl","delay","loaderElement","width","panel","form","quickViewCart","entryNumber","elements","entryCode","entryQuantity","quantity","startLoader","elm","index","selectedEl","tabConf","JSON","parse","stringify","variant","gadata","category","url","updateHTML","onProductDownloaded","updateMeta","updateURL","productHead","setTimeout","moveFocus","TurnTo","initialize","success","Promise","resolve","VARIANT_UPDATED_MONETATE","VARIANT_UPDATED","initWishlistData","destroyReworkedPDP","initReworkedPDP","divApplicationVisualCarousel","item","contains","top","quickViewTitleId","content","wishlistEl","quickViewTitle","StickyManager","update","descriptionEl","description","tabbables","els","focus","scrollTo","left","behavior","appendParams","AFTER_REPLACE_STATE","pagePLP","PDP_STICKY","fromPLP","backPLP","isApplePay","productList","keys","hideMoreDetailsLink","PropagateLink","hideForPollux","megamuenuImages","img","srcSet","firstSectionTitle","navTab","items","refillPush","refillPushcmscomponent","path","position","onscroll","waitForElm","URL","medium","searchParams","campaign","source","minHeight","alt","linkItem","append","children","removeChild","prepend","moreDetailsElm","moreDetailsId","selector","observer","MutationObserver","mutations","disconnect","observe","childList","subtree","reviewUnsubscribeElement","popin","open","html","role","modifiers","opener","manageFocus","forceInert","modal","outerClose","onlyCallLastTimeout","timer","clearTimeout","initialPosition","fromTopToTransitionY","scrollToPosition","container","upperBound","lookDraging","to","y","ease","toggle","productDetailsContentHeader","setupMobile","main","footer","productDetailsContent","undoChanges","productDetailsContentClone","cloneNode","insertBefore","firstChild","thisWillBeChangedInJSP","pContent","manager","scrollY","getBoundingClientRect","lowerBound","gesture","DragGesture","active","movement","my","delta","dy","currentY","isExtended","scrollTop","set","immediateRender","pointer","touch","mouse","gesture2","carouselFrame","frameInitialPos","scrollHeight","isScrollLocked","overflow","direction","nextSibling","getMq","unbind","Function","pCarousel","pDetails","pHeadline","pReference","pPrice","pControls","innerText","reverse","p","subscriberEmailId","thankyouPopinMsg","thankuPopinTemplate","subscriberPhoneNumber","userEmailId","PopinNotify","constructor","acceptTemplate","ariaHiddenElements","tabindexArr","popinTabIndexArr","heightOfLegalTermRule","xhr","fetchNotifyMeUserDetails","res","uid","username","buildNotifyModal","showPopin","popinNotifyMe","popinTitle","buildAcceptModal","popinNotifyAvailableText","onDocumentPopinClose","popinLabel","label","openNotifyPopin","onNotificationClosed","notifierOpened","notifyMeWrapper","popinThankuWrapper","legalConsent","emailField","phoneField","showTerms","emailExist","phoneExist","phoneValidity","previousElementSibling","handleSubmit","popinCloseBtn","closePopin","legalTermsElm","legalTermsRulesElm","legalDiv","isChecked","checked","autoAlpha","fieldValidation","setCustomValidity","prefilledEmail","legalTerm","legalNotify","popinNotice","popinTermsAndConditionsRU","popinCloseLabel","notifyme","popinDescription","emailTitle","popinSubmitLabel","termsConditions","phonePattern","popinTermsAndConditions","popinAgreeCondition","popinDiscalimer","popinTermsAndConditionsCN","popinAgreeConditionCheck","notifyMeByMobile","popinError","opc","applePay","regex","emailPattern","popinCountryCodeLabel","account","phoneCountryCodes","popinPhoneNumberLabel","cookiePopin","popinEl","stopImmediatePropagation","hide","notifier","close","popinWrapper","stopPropagation","popinNotify","buildThankyouModal","continueShoppingBtnText","popinCloseHiddenText","onContinueShopping","inputEmail","handleResponse","inputPhone","checkValidity","popinMsg","notifyMeTemplate","getElementById","popinClose","continueShoppingBtn","notifyPhoneEmail","RegExp","popinEmailLabel","errors","fields","valueMissing","base","patternMismatch","notifyEmail","email","errorInputEmail","show","notifyMe","request","onShow","notifierOnShow","closeErrorNotifier","ele","popinSubmitBtn","notifierWrapper","notifierCloseBtn","notifierMsg","textContent","filledValue","emptyValue"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4N;AAClL;;;;;;;;;;;;;ACD1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoE;;AAEpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yBAAyB,uBAAuB;AAChD;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,MAAM,wDAAC;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,gEAAiB;AACpC,kBAAkB,wDAAC;AACnB;;AAEA;AACA,oBAAoB,wDAAC;AACrB;AACA,MAAM,wDAAC;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6EAA6E,qBAAqB;AAClG;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,wBAAwB,wDAAC;AACzB;;AAEA;AACA,0BAA0B,wDAAC;AAC3B;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,eAAe,wDAAC;AAChB;AACA,GAAG;;AAEH;AACA;AACA,8BAA8B,wDAAC;AAC/B,GAAG;;AAEH;AACA;AACA;;AAEA,QAAQ,IAAsC;AAC9C;AACA;AACA;;AAEA;AACA,uGAAuG,KAAK,GAAG,IAAI;AACnH;;AAEA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA,WAAW,wDAAC;AACZ;;AAEA;;AAEA,IAAI,IAAsC;AAC1C;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA,6GAA6G,eAAe;AAC5H;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA;;AAEA,GAAG;AACH;;AAEA;AACA,kEAAkE,2BAA2B;AAC7F;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH,mBAAmB;AACnB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL,qBAAqB,wDAAC;AACtB;AACA;;AAEA,IAAI,wDAAC;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,UAAU,IAAsC;AAChD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,QAAQ,IAAsC;AAC9C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,wDAAC;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D,gCAAgC;AAC3F;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH,sBAAsB,wDAAC;AACvB;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG,KAAK;AACR;AACA,+BAA+B,wDAAC;AAChC,+BAA+B,wDAAC;AAChC;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,2CAA2C;AAC3C;;AAEA,CAAC;;AAED,IAAI,IAAsC;AAC1C;AACA;AACA;AACA,gHAAgH,WAAW,cAAc,EAAE;AAC3I;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA,sHAAsH,SAAS,gBAAgB,EAAE;AACjJ;;AAEA;AACA,KAAK;;AAEL;AACA;AACA,sHAAsH,SAAS,eAAe,EAAE;AAChJ;;AAEA;AACA,KAAK;;AAEL;AACA;AACA,sHAAsH,SAAS,gBAAgB,EAAE;AACjJ;;AAEA;AACA;;AAEA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,0BAA0B,wDAAC;AAC3B,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,2DAA2D;AAC3D;AACA;;AAEA;AACA;AACA,gDAAgD;AAChD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,wDAAC;AACpB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oDAAoD;AACpD;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,UAAU,KAAsC;AAChD;AACA;AACA;;AAEA;AACA;AACA,IAAI,wDAAC;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA,4DAA4D,2BAA2B;AACvF;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,oBAAoB;AACpB;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA,sBAAsB,wDAAC;AACvB;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,mDAAmD;AACnD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,wDAAC;AACpB,IAAI,wDAAC;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,2DAA2D,gCAAgC;AAC3F;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,mBAAmB,wDAAC;AACpB,IAAI,wDAAC;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI,wDAAC;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,wDAAC;AACtC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,4DAA4D,gCAAgC;AAC5F;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAE6U;;;;;;;;;;;;;ACnoD7U;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEmE;;;;;;;;;;;;;AC7CnE;AAAA;AAAA;AAAA;AAAA;AAA8O;AAC7M;;AAEjC;AACA;AACA;AACA;AACA;;AAEA,aAAa,uBAAuB;AACpC;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,eAAe,6BAA6B;AAC5C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH,iBAAiB,0DAAO;AACxB;AACA,GAAG;;AAEH;AACA;AACA;AACA,GAAG,KAAK;AACR;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;;AAEA;AACA,gCAAgC;AAChC;;AAEA;AACA;AACA;AACA,YAAY,IAAsC;AAClD;AACA;AACA,SAAS,MAAM,EAEN;;AAET;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,qBAAqB,0DAAiB;AACtC,sCAAsC,kEAAc;AACpD;AACA,KAAK;AACL,GAAG;AACH;AACA,uBAAuB,0DAAiB;;AAExC;AACA,mCAAmC,kEAAc;AACjD;AACA,SAAS;AACT,OAAO,UAAU,IAAsC;AACvD;AACA;AACA;AACA;;AAEA,+DAA+D,IAAI;AACnE;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,IAAI,kEAAe;;AAEnB;AACA;;AAEA;AACA,iBAAiB,kEAAc;;AAE/B,yBAAyB,kEAAc,CAAC,kEAAc,GAAG;;AAEzD;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI,kEAAe;AACnB;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI,kEAAe;;AAEnB,IAAI,kEAAe;;AAEnB,IAAI,kEAAe,+BAA+B;;AAElD,IAAI,kEAAe,iCAAiC;;AAEpD,IAAI,kEAAe,qBAAqB;;AAExC,IAAI,kEAAe,mBAAmB;;AAEtC,IAAI,kEAAe;;AAEnB,IAAI,kEAAe;;AAEnB,IAAI,kEAAe;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA,QAAQ,kEAAO;AACf,8BAA8B,kEAAQ;AACtC,KAAK;AACL,gHAAgH;AAChH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,yBAAyB,0DAAS;AAClC;AACA;AACA;;AAEA;AACA,0EAA0E,kEAAc,CAAC,kEAAc,GAAG,wBAAwB;AAClI;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA,2BAA2B,kEAAK;AAChC;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,GAAG,kEAAS;;AAEnB;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sGAAsG;AACtG;;AAEA;AACA;AACA,wCAAwC,kEAAa;AACrD;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,OAAO,0DAAS;AAChB,QAAQ,IAAsC;AAC9C,2FAA2F,IAAI,4DAA4D,IAAI;AAC/J;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAE2C;;;;;;;;;;;;;;;;;;;;;;;;;AC5Y3C;AAAA;AAAA;AAAA;AAAgF;;;;;;;;;;;;;ACAhF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwI;AAC9F;AAC0B;AAC5B;AACA;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA,mBAAmB,4DAAU;;AAE7B;;AAEA,yDAAyD,aAAa;AACtE;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;;AAEA,qEAAqE;AACrE,EAAE,gFAAc,CAAC,oEAAU;AAC3B;AACA;AACA,GAAG;AACH;;AAEA,uEAAuE;AACvE,EAAE,gFAAc,CAAC,qEAAW;AAC5B;AACA;AACA,GAAG;AACH;;AAEA,uEAAuE;AACvE,EAAE,gFAAc,CAAC,qEAAW;AAC5B;AACA;AACA,GAAG;AACH;;AAEA,yEAAyE;AACzE,EAAE,gFAAc,CAAC,sEAAY;AAC7B;AACA;AACA,GAAG;AACH;;AAEA,qEAAqE;AACrE,EAAE,gFAAc,CAAC,oEAAU;AAC3B;AACA;AACA,GAAG;AACH;;AAEA,uEAAuE;AACvE,EAAE,gFAAc,CAAC,qEAAW;AAC5B;AACA;AACA,GAAG;AACH;;AAEA;AACA,kBAAkB,wEAAc;AAChC,kDAAkD;AAClD;AACA;AACA;AACA;AACA,KAAK,GAAG,6EAAmB;AAC3B;AACA;AACA;;AAEA,8DAA8D;AAC9D,yCAAyC,oEAAU,EAAE,qEAAW,EAAE,sEAAY,EAAE,qEAAW,EAAE,oEAAU,EAAE,qEAAW;AACpH;AACA;;AAEsG;;;;;;;;;;;;;AC3HtG;AAAA;AAAA;AAAA;AAEe,eAAeA,uBAAf,CAAuCC,QAAvC,EAAiD;AAC9D,QAAMC,oBAAoB,GAAG,oBAAoBC,IAApB,CAAyBC,4DAAM,CAAC,MAAD,CAAN,CAAeC,SAAxC,CAA7B;AACA,QAAMC,YAAY,GAAG,MAAMF,4DAAM,CAAC,wBAAD,CAAjC;AACA,QAAMG,cAAc,GAAG,MAAMH,4DAAM,CAAC,mBAAD,EAAsBE,YAAtB,CAAnC;AACA,QAAME,aAAa,GAAG,CAAC,CAACF,YAAxB;AACA,QAAMG,KAAK,GAAG,CAAC,CAACF,cAAhB;AAEA,SAAON,QAAQ,CAAC,EAAEC,oBAAoB,IAAIM,aAAxB,IAAyCC,KAA3C,CAAD,CAAf;AACD,C;;;;;;;;;;;;ACVD;AAAA;AAAA;AAAA,MAAMC,MAAM,GAAG,CAACC,GAAD,EAAMC,GAAN,EAAWC,GAAX,KAAmBC,IAAI,CAACF,GAAL,CAASE,IAAI,CAACD,GAAL,CAASF,GAAT,EAAcC,GAAd,CAAT,EAA6BC,GAA7B,CAAlC;;AAEA,MAAME,EAAE,GAAG;AACTC,KAAG,EAAGC,CAAD,IAAOC,KAAK,CAACC,OAAN,CAAcF,CAAd,CADH;AAETG,KAAG,EAAGH,CAAD,IAAOI,cAAc,CAACC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BR,CAA/B,CAAD,EAAoC,QAApC,CAFjB;AAGTS,KAAG,EAAGT,CAAD,IAAOF,EAAE,CAACK,GAAH,CAAOH,CAAP,KAAaA,CAAC,CAACU,cAAF,CAAiB,aAAjB,CAHhB;AAITC,KAAG,EAAGX,CAAD,IAAOA,CAAC,YAAYY,UAJhB;AAKTC,KAAG,EAAGb,CAAD,IAAOA,CAAC,YAAYc,gBALhB;AAMTC,KAAG,EAAGf,CAAD,IAAOA,CAAC,CAACgB,QAAF,IAAclB,EAAE,CAACa,GAAH,CAAOX,CAAP,CANjB;AAOTiB,KAAG,EAAGjB,CAAD,IAAO,OAAOA,CAAP,KAAa,QAPhB;AAQTkB,KAAG,EAAGlB,CAAD,IAAO,OAAOA,CAAP,KAAa,UARhB;AASTmB,KAAG,EAAGnB,CAAD,IAAO,OAAOA,CAAP,KAAa,WAThB;AAUToB,KAAG,EAAGpB,CAAD,IAAOF,EAAE,CAACqB,GAAH,CAAOnB,CAAP,KAAaA,CAAC,KAAK,IAVtB;AAWTqB,KAAG,EAAGrB,CAAD,IAAO,qCAAqCd,IAArC,CAA0Cc,CAA1C,CAXH;AAYTsB,KAAG,EAAGtB,CAAD,IAAO,OAAOd,IAAP,CAAYc,CAAZ,CAZH;AAaTuB,KAAG,EAAGvB,CAAD,IAAO,OAAOd,IAAP,CAAYc,CAAZ,CAbH;AAcTwB,KAAG,EAAGxB,CAAD,IAAQF,EAAE,CAACuB,GAAH,CAAOrB,CAAP,KAAaF,EAAE,CAACwB,GAAH,CAAOtB,CAAP,CAAb,IAA0BF,EAAE,CAACyB,GAAH,CAAOvB,CAAP,CAd9B;AAeTyB,KAAG,EAAGzB,CAAD,IAAO,CAAC0B,uBAAuB,CAAChB,cAAxB,CAAuCV,CAAvC,CAAD,IAA8C,CAAC2B,oBAAoB,CAACjB,cAArB,CAAoCV,CAApC,CAA/C,IAAyFA,CAAC,KAAK,SAA/F,IAA4GA,CAAC,KAAK;AAfrH,CAAX;AAkBA,MAAM4B,KAAK,GAAG,EAAd;AAEO,SAASC,WAAT,CAAqBC,SAArB,EAAgCC,MAAhC,EAAwC;AAC7C,QAAMC,MAAM,GAAGJ,KAAK,CAACE,SAAD,CAApB;;AACA,MAAIE,MAAJ,EAAY;AAAE,WAAOA,MAAP;AAAgB;;AAC9B,QAAMC,KAAK,GAAG,IAAI,CAAlB;AACA,MAAIC,OAAO,GAAG,CAAd;AACA,MAAIC,IAAI,GAAG,CAAX;;AACA,SAAO,IAAP,EAAa;AACXD,WAAO,IAAID,KAAX;;AACA,QAAIF,MAAM,CAACG,OAAD,CAAN,KAAoB,CAAxB,EAA2B;AACzBC,UAAI,IAAI,CAAR;;AACA,UAAIA,IAAI,IAAI,EAAZ,EAAgB;AAAE;AAAQ;AAC3B,KAHD,MAGO;AACLA,UAAI,GAAG,CAAP;AACD;AACF;;AAED,QAAMC,QAAQ,GAAGF,OAAO,GAAGD,KAAV,GAAkB,IAAnC;AACAL,OAAK,CAACE,SAAD,CAAL,GAAmBM,QAAnB;AACA,SAAOA,QAAP;AACD;AAED;;AACO,SAASC,MAAT,OAAuH;AAAA,MAAvG;AAAEC,QAAI,EAAEC,KAAR;AAAeC,aAAS,EAAEC,UAA1B;AAAsCC,WAAO,EAAEC,QAA/C;AAAyDC,YAAQ,EAAEC;AAAnE,GAAuG;AAAA,MAAvBC,SAAuB,uEAAXC,SAAW;AAE5H,QAAMT,IAAI,GAAG7C,MAAM,CAACK,EAAE,CAACqB,GAAH,CAAOoB,KAAP,IAAgB,CAAhB,GAAoBA,KAArB,EAA4B,EAA5B,EAAgC,GAAhC,CAAnB;AACA,QAAMC,SAAS,GAAG/C,MAAM,CAACK,EAAE,CAACqB,GAAH,CAAOsB,UAAP,IAAqB,GAArB,GAA2BA,UAA5B,EAAwC,EAAxC,EAA4C,IAA5C,CAAxB;AACA,QAAMC,OAAO,GAAGjD,MAAM,CAACK,EAAE,CAACqB,GAAH,CAAOwB,QAAP,IAAmB,EAAnB,GAAwBA,QAAzB,EAAmC,EAAnC,EAAuC,GAAvC,CAAtB;AACA,QAAMC,QAAQ,GAAGnD,MAAM,CAACK,EAAE,CAACqB,GAAH,CAAO0B,SAAP,IAAoB,CAApB,GAAwBA,SAAzB,EAAoC,EAApC,EAAwC,GAAxC,CAAvB;AACA,QAAMG,IAAI,GAAGN,OAAO,IAAI,IAAI7C,IAAI,CAACoD,IAAL,CAAUT,SAAS,GAAGF,IAAtB,CAAR,CAApB,CAN4H,CAMlE;;AAC1D,QAAMY,MAAM,GAAGrD,IAAI,CAACoD,IAAL,CAAUT,SAAS,GAAGF,IAAtB,CAAf,CAP4H,CAOhF;;AAC5C,QAAMa,MAAM,GAAGH,IAAI,GAAG,CAAP,GAAWE,MAAM,GAAGrD,IAAI,CAACoD,IAAL,CAAU,IAAID,IAAI,GAAGA,IAArB,CAApB,GAAiD,CAAhE,CAR4H,CAQzD;;AACnE,QAAMI,EAAE,GAAG,CAAX;AACA,QAAMC,CAAC,GAAGL,IAAI,GAAG,CAAP,GAAW,CAACA,IAAI,GAAGE,MAAP,GAAgB,CAACN,QAAlB,IAA8BO,MAAzC,GAAkD,CAACP,QAAD,GAAYM,MAAxE,CAV4H,CAY5H;;AACA,MAAId,QAAQ,GAAGU,SAAS,IAAIjB,WAAW,kBAAW,CAACU,KAAD,EAAQE,UAAR,EAAoBE,QAApB,EAA8BE,SAA9B,EAAyCS,IAAzC,CAA8C,GAA9C,CAAX,QAAkEvB,MAAlE,CAAvC;;AAEA,WAASA,MAAT,CAAgBwB,CAAhB,EAAmB;AACjB,QAAIC,QAAQ,GAAGpB,QAAQ,GAAIA,QAAQ,GAAGmB,CAAZ,GAAiB,IAApB,GAA2BA,CAAlD;;AACA,QAAIP,IAAI,GAAG,CAAX,EAAc;AAAE;AACdQ,cAAQ,GAAG3D,IAAI,CAAC4D,GAAL,CAAS,CAACD,QAAD,GAAYR,IAAZ,GAAmBE,MAA5B,KAAuCE,EAAE,GAAGvD,IAAI,CAAC6D,GAAL,CAASP,MAAM,GAAGK,QAAlB,CAAL,GAAmCH,CAAC,GAAGxD,IAAI,CAAC8D,GAAL,CAASR,MAAM,GAAGK,QAAlB,CAA9E,CAAX;AACD,KAFD,MAEO;AAAE;AACPA,cAAQ,GAAG,CAACJ,EAAE,GAAGC,CAAC,GAAGG,QAAV,IAAsB3D,IAAI,CAAC4D,GAAL,CAAS,CAACD,QAAD,GAAYN,MAArB,CAAjC;AACD;;AACD,QAAIK,CAAC,KAAK,CAAN,IAAWA,CAAC,KAAK,CAArB,EAAwB;AAAE,aAAOA,CAAP;AAAW;;AACrC,WAAO,IAAIC,QAAX;AACD;;AAEDI,SAAO,CAACC,GAAR,CAAY;AAAEzB,YAAF;AAAYI,aAAZ;AAAuBE;AAAvB,GAAZ;AAEA,SAAO;AAAEoB,gBAAY,EAAE/B,MAAhB;AAAwBK;AAAxB,GAAP;AACD,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAI2B,IAAI,GAAG,EAAX;AACA,IAAIC,OAAO,GAAE,EAAb;AACAC,QAAQ;AACRC,0BAA0B;AAE1B,IAAIC,iBAAJ;AACA,MAAMC,KAAK,GAAGC,MAAM,CAACC,WAArB;AACA,MAAMC,aAAa,GAAGH,KAAK,IAAIA,KAAK,CAACI,QAAN,CAAeC,SAAxB,IAAqCL,KAAK,CAACI,QAAN,CAAeC,SAAf,CAAyBC,MAA9D,GAAuEN,KAAK,CAACI,QAAN,CAAeC,SAAf,CAAyBC,MAAzB,CAAgCC,QAAhC,CAAyC,CAAzC,EAA4CC,IAAnH,GAA0H,EAAhJ;;AAEA,MAAMC,aAAa,GAAIC,OAAD,IAAa;AACjC,QAAMC,OAAO,GAAGC,mEAAc,EAA9B;AACA,QAAMC,gBAAgB,GAAGH,OAAO,CAACI,KAAR,CAAcD,gBAAvC;AACA,QAAME,YAAY,GAAGL,OAAO,CAACI,KAAR,CAAcC,YAAnC;AACA,QAAMC,SAAS,GAAGf,MAAM,CAACgB,QAAP,CAAgBC,IAAhB,CAAqBC,OAArB,CAA6B,MAA7B,IAAuC,CAAC,CAA1D;AACA,QAAMlG,YAAY,GAAGmG,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAArB;AACA,QAAMC,wBAAwB,GAAGZ,OAAO,CAACY,wBAAzC;AACA,QAAMC,KAAK,GAAG,aAAd;;AAGA,MAAI,UAAUzG,IAAV,CAAe6F,OAAO,CAACH,IAAvB,CAAJ,EAAkC;AAChC;AACD;;AAEDgB,SAAO,CAACC,SAAR,CAAkB,EAAlB,EAAsBL,QAAQ,CAACM,KAA/B,EAAsCzB,MAAM,CAACgB,QAAP,CAAgBU,QAAhB,GAA2B1B,MAAM,CAACgB,QAAP,CAAgBW,MAAjF;;AAEA,MAAIf,gBAAgB,IAAIS,wBAAxB,EAAkD;AAChD;AACA,YAAOP,YAAP;AACE,WAAK,kBAAL;AACE;AACAL,eAAO,CAACmB,iBAAR,GAA4B,KAA5B;AACAnB,eAAO,CAACoB,OAAR,aAAqBpB,OAAO,CAACqB,IAA7B;AACA;;AACF,WAAK,gBAAL;AACE;AACArB,eAAO,CAACoB,OAAR,aAAqBpB,OAAO,CAACqB,IAA7B;AACArB,eAAO,CAACsB,MAAR,GAAiBtB,OAAO,CAACqB,IAAzB;AACArB,eAAO,CAACmB,iBAAR,GAA4B,IAA5B;AACA;;AACF;AACEnB,eAAO,CAACoB,OAAR,GAAkBpB,OAAO,CAACqB,IAA1B;AAbJ;AAeD;;AAED,4MAAuBE,IAAvB,CAA4B,MAAM;AAChCC,aAAS,CAACxB,OAAD,EAAU;AACjByB,kBAAY,EAAE,MAAMpH,4DAAM,CAAC,yCAAD,CADT;AAEjBE,kBAFiB;AAGjBmH,YAAM,EAAEC,mDAAM,CAACC,OAAP,CAAeC,GAHN;AAIjBC,eAAS,EAAE,CAAC,CAACvC,MAAM,CAACwC,YAAP,CAAoBC,OAApB,CAA4B,SAA5B,CAAF,IAA4CC,+CAAOA;AAJ7C,KAAV,CAAT;AAMD,GAPD;AAQD,CA3CD;;AA6CA,SAASC,mBAAT,GAA+B;AAC7B,QAAMC,SAAS,GAAG9H,4DAAM,CAAC,0BAAD,CAAxB;AACA,QAAM+H,SAAS,GAAG/H,4DAAM,CAAC,2BAAD,CAAxB;;AACA,MAAI+H,SAAS,IAAID,SAAjB,EAA4B;AAC1B,UAAME,oBAAoB,GAAGF,SAAS,CAACG,SAAvC;AACA,QAAIC,YAAY,GAAGH,SAAS,CAACI,YAAV,CAAuB,YAAvB,CAAnB;AACAD,gBAAY,GAAGA,YAAY,CAACE,MAAb,CAAoBJ,oBAAoB,CAACK,IAArB,EAApB,CAAf;AACAN,aAAS,CAACO,YAAV,CAAuB,YAAvB,EAAqCJ,YAArC;AACD;AACF;;AAED,SAASK,GAAT,CAAaC,EAAb,EAAiB;AACf,QAAMC,WAAW,GAAG,CAAC,CAACD,EAAE,CAACE,OAAH,CAAW,iBAAX,CAAtB;AACA,QAAMC,UAAU,GAAG,CAAC,CAACH,EAAE,CAACE,OAAH,CAAW,2BAAX,CAArB;AACA,QAAME,gBAAgB,GAAG5I,4DAAM,CAAC,wBAAD,CAA/B;;AACA,QAAM6I,OAAO,GAAG,MAAML,EAAE,CAAClC,aAAH,CAAiB,wBAAjB,CAAtB;;AACA,QAAMwC,OAAO,GAAG,MAAMN,EAAE,CAAClC,aAAH,CAAiB,iBAAjB,CAAtB;;AACA,QAAMoB,YAAY,GAAGxC,MAAM,CAACwC,YAA5B;AACA,MAAIqB,aAAa,GAAG,IAApB;AACA,QAAMC,iBAAiB,GAAGhJ,4DAAM,CAAC,qBAAD,CAAN,GAAgCA,4DAAM,CAAC,2CAAD,CAAtC,GAAsFA,4DAAM,CAAC,kBAAD,CAAtH;AACA,QAAMiJ,aAAa,GAAGjJ,4DAAM,CAAC,4BAAD,CAA5B;AAEE;AACJ;AACA;;AACC,MAAIkF,MAAM,CAACoC,MAAP,CAAc4B,OAAd,IAAuB,IAAvB,IAA+BhE,MAAM,CAACoC,MAAP,CAAc4B,OAAd,IAAuB,IAAtD,IAA8DhE,MAAM,CAACoC,MAAP,CAAc4B,OAAd,IAAuB,IAAzF,EAA+F;AAC5F,UAAMC,aAAa,GAAGnJ,4DAAM,CAAC,iCAAD,CAA5B;;AACA,QAAImJ,aAAJ,EAAmB;AACf,UAAIC,IAAI,GAAG/C,QAAQ,CAACgD,aAAT,CAAuB,GAAvB,CAAX;AACA,UAAIC,OAAO,GAAGjD,QAAQ,CAACgD,aAAT,CAAuB,MAAvB,CAAd;AACAD,UAAI,CAACd,YAAL,CAAkB,KAAlB,EAAyB,UAAzB;AACAc,UAAI,CAACd,YAAL,CAAkB,MAAlB;AACAc,UAAI,CAACG,SAAL,CAAeC,GAAf,CAAmB,MAAnB,EAA2B,cAA3B,EAA2C,SAA3C,EAAsD,gBAAtD,EAAwE,kBAAxE;AACAF,aAAO,CAACrB,SAAR,aAAuB/C,MAAM,CAACoC,MAAP,CAAcmC,WAAd,CAA0BC,GAA1B,CAA8BC,oBAArD;AACAP,UAAI,CAACQ,WAAL,CAAiBN,OAAjB;AACAH,mBAAa,CAACS,WAAd,CAA0BR,IAA1B;AACH;AACF,GA1Bc,CA4Bf;;;AACA,MAAIS,cAAJ;AAEA;AACF;AACA;;AACE,WAASC,IAAT,GAA8B;AAAA,QAAhBC,OAAgB,uEAAN,IAAM;;AAC9B;AACF;AACA;AACM,UAAMC,UAAU,GAAE3D,QAAQ,CAACC,aAAT,CAAuB,iBAAvB,CAAlB;AACA,QAAG0D,UAAH,EACEC,SAAS,CAAC,CAAD,CAAT,CAAaC,mBAAb,GAAiC,YAAjC,CADF,KAGED,SAAS,CAAC,CAAD,CAAT,CAAaC,mBAAb,GAAiC,cAAjC;AACL;AACH;AACA;;AAEC,QAAGrB,OAAO,MAAM,EAAEsB,cAAc,CAACxC,OAAf,CAAuB,SAAvB,MAAsC,MAAxC,CAAhB,EAAiE;AAC9DyC,wEAAU,CAACC,qBAAX,CAAiCC,4DAAjC;AACAC,wDAAO,CAACC,SAAR,CAAkBF,4DAAlB,EAAsCG,YAAD,IAAkB;AACrDzF,yBAAiB,GAAGyF,YAApB;AACD,OAFD;AAGAC,+DAAG,CAACpD,mDAAM,CAACmC,WAAP,CAAmB9D,OAAnB,CAA2BgF,OAA3B,CAAmC,KAAnC,YAA6C9B,OAAO,GAAG+B,OAAV,CAAkBC,GAA/D,6CAAD,CAAH,CACE3D,IADF,CACQ4D,SAAD,IAAe;AAAA;;AAChB,YAAIC,QAAQ,GAAGD,SAAf;AACFJ,iEAAG,0BAACM,cAAc,CAACrF,OAAhB,oFAAC,sBAAwBsF,YAAzB,2DAAC,uBAAsCN,OAAtC,CAA8C,KAA9C,YAAwD9B,OAAO,GAAG+B,OAAV,CAAkBC,GAA1E,kBAAD,CAAH,CACG3D,IADH,CACSgE,SAAD,IAAe;AACnB,gBAAMC,QAAQ,GAAGD,SAAS,CAACE,KAA3B;AACAL,kBAAQ,CAACK,KAAT,GAAiBD,QAAjB;AACAJ,kBAAQ,CAACM,MAAT,CAAgBC,oBAAhB,GAAuCJ,SAAS,CAACG,MAAV,CAAiBC,oBAAxD;AACAP,kBAAQ,CAACQ,YAAT,GAAwBL,SAAS,CAACK,YAAlC;AACAR,kBAAQ,CAACS,wBAAT,GAAoCN,SAAS,CAACM,wBAA9C;AACAT,kBAAQ,CAACU,oBAAT,GAAgCP,SAAS,CAACO,oBAA1C;AACJ,gBAAMC,eAAe,GAAG1L,4DAAM,CAAC,UAAD,CAA9B;AACI,gBAAM2L,mBAAmB,GAAG3L,4DAAM,CAAC,eAAD,CAAlC;AACAmK,wBAAc,CAACyB,OAAf,CAAuB,aAAvB,EAAsCb,QAAQ,CAAChF,KAAT,CAAeN,IAArD;AACA0E,wBAAc,CAACyB,OAAf,CAAuB,aAAvB,EAAsCb,QAAQ,CAAC/D,IAA/C;AACAmD,wBAAc,CAACyB,OAAf,CAAuB,mBAAvB,EAA4CT,QAAQ,CAACU,UAArD;AACA1B,wBAAc,CAACyB,OAAf,CAAuB,mBAAvB,EAA4CT,QAAQ,CAACW,iBAArD;;AACH,cAAIf,QAAQ,CAACgB,sBAAT,KAAkC,KAAtC,EAA6C;AACxCL,2BAAe,GAAGA,eAAe,CAACM,KAAhB,CAAsBC,OAAtB,GAAgC,MAAnC,GAA4C,EAA3D;AACAN,+BAAmB,GAAGA,mBAAmB,CAACK,KAApB,CAA0BC,OAA1B,GAAoC,MAAvC,GAAgD,EAAnE;AACH,WAHF,MAGQ;AACHP,2BAAe,GAAGA,eAAe,CAACM,KAAhB,CAAsBC,OAAtB,GAAgC,OAAnC,GAA6C,EAA5D;AACAN,+BAAmB,GAAGA,mBAAmB,CAACK,KAApB,CAA0BC,OAA1B,GAAoC,OAAvC,GAAiD,EAApE;AACH;;AAEC,cAAId,QAAQ,IAAI,CAAC1C,WAAjB,EAA8B;AAC5ByD,0FAAyB,CAACnB,QAAD,CAAzB;AACD;;AAED,gBAAMoB,WAAW,GAAG/G,aAAa,GAAGA,aAAH,GAAmB2F,QAAQ,CAAChF,KAAT,CAAeN,IAAnE;;AACA,cAAI0F,QAAQ,CAACW,iBAAb,EAAgC;AAC9BM,oCAAwB,CAACD,WAAD,CAAxB;AACD,WAFD,MAGK,IAAIhB,QAAQ,CAACU,UAAT,KAAwB,UAAxB,IAAsCd,QAAQ,CAACsB,cAA/C,KAAkEnH,MAAM,CAACoC,MAAP,CAAcgF,QAAd,KAA2B,SAA3B,IAAwCpH,MAAM,CAACoC,MAAP,CAAcgF,QAAd,KAA2B,SAArI,CAAJ,EAAqJ;AACxJpH,kBAAM,CAAC+E,SAAP,CAAiBsC,IAAjB,CAAsB;AACpBC,2BAAa,EAAE,aADK;AAEpBC,yBAAW,EAAE,SAFO;AAGpBC,wBAAU,EAAEP,WAHQ;AAIpBQ,mBAAK,EAAE;AAJa,aAAtB;AAMD;;AACD,cAAIxB,QAAQ,IAAIA,QAAQ,CAACW,iBAAzB,EAA4C;AAC1C,kBAAMc,eAAe,GAAG5M,4DAAM,CAAC,oBAAD,CAA9B;AACA,gBAAI6M,mBAAmB,GAAG7M,4DAAM,CAAC,uBAAD,CAAhC;AACA,gBAAI8M,cAAc,GAAG9M,4DAAM,CAAC,kBAAD,CAA3B;AACA6M,+BAAmB,GAAGA,mBAAmB,CAACE,MAApB,EAAH,GAAkC,EAArD;AACAD,0BAAc,GAAGA,cAAc,CAACC,MAAf,EAAH,GAA6B,EAA3C;;AACA,gBAAIH,eAAJ,EAAqB;AACnB,oBAAMI,WAAW,GAAGhN,4DAAM,CAAC,oBAAD,EAAuB4M,eAAvB,CAA1B;;AACA,kBAAII,WAAJ,EAAiB;AACjB,sBAAMC,aAAa,GAAG/H,MAAM,CAACgI,gBAAP,CAAwBF,WAAxB,EAAqCG,MAA3D;AACAH,2BAAW,CAAChB,KAAZ,CAAkBmB,MAAlB,GAA2BF,aAA3B;AACC;AACF;AACF,WAlDkB,CAmDnB;;;AACA,cAAI,CAACtE,UAAD,IAAe,CAACF,WAApB,EAAiC;AAC/B,kBAAM2E,QAAQ,GAAGC,wFAAoB,CAACrI,iBAAD,CAArC;AACA+F,oBAAQ,CAAC,cAAD,CAAR,GAA2BqC,QAA3B;AACA1H,yBAAa,CAACqF,QAAD,CAAb;;AAEA,gBAAIA,QAAQ,CAACvD,GAAT,CAAa8F,UAAjB,EAA6B;AAC3B/C,gEAAO,CAACgD,OAAR,CAAgB,cAAhB,EAAgCxC,QAAhC;AACD,aAFD,MAEO;AACLR,gEAAO,CAACgD,OAAR,CAAgB,iBAAhB,EAAmCxC,QAAnC;AACD;AACF;;AACD,cAAIA,QAAQ,CAACyC,yBAAb,EAAwC;AACtC,kBAAMC,cAAc,GAAGzN,4DAAM,CAAC,qBAAD,CAA7B;AACA,kBAAM0N,kBAAkB,GAAGxI,MAAM,CAACoC,MAAP,CAAcqG,gBAAzC;AACA,kBAAMC,eAAe,GAAG1I,MAAM,CAACoC,MAAP,CAAcuG,iBAAtC;AACA,kBAAMC,gBAAgB,GAAG5I,MAAM,CAACoC,MAAP,CAAcyG,wBAAvC;AACA7I,kBAAM,CAAC8I,gBAAP,GAA0B,EAA1B;;AACA,gBAAI,CAACP,cAAL,EAAqB;AACnB,oBAAMQ,UAAU,GAAGjO,4DAAM,CAAC,wBAAD,CAAzB;AACA,oBAAMkO,QAAQ,GAAG,8lBAUP5G,mDAAM,CAAC6G,kBAVA,8GAAjB;AAgBAF,wBAAU,CAACG,kBAAX,CAA8B,WAA9B,EAA2CF,QAA3C;AACD;;AACD,kBAAMG,MAAM,GAAGhI,QAAQ,CAACgD,aAAT,CAAuB,QAAvB,CAAf;AACAgF,kBAAM,CAACC,GAAP,GAAaZ,kBAAb;AACAW,kBAAM,CAACE,EAAP,GAAY,wBAAZ;AACAF,kBAAM,CAAC/F,YAAP,CAAoB,UAApB,EAAgCwF,gBAAhC;AACAO,kBAAM,CAACG,KAAP,GAAe,IAAf;AACAnI,oBAAQ,CAACoI,IAAT,CAAc7E,WAAd,CAA0ByE,MAA1B;AAEA,gBAAIK,IAAI,GAAGrI,QAAQ,CAACgD,aAAT,CAAuB,MAAvB,CAAX;AACAqF,gBAAI,CAACC,GAAL,GAAW,YAAX;AACAD,gBAAI,CAACvI,IAAL,GAAYyH,eAAZ;AACAvH,oBAAQ,CAACoI,IAAT,CAAc7E,WAAd,CAA0B8E,IAA1B;AACD,WArCD,MAqCO;AACL,kBAAMjB,cAAc,GAAGzN,4DAAM,CAAC,qBAAD,CAA7B;;AACA,gBAAIyN,cAAJ,EAAoB;AAACA,4BAAc,CAACnF,YAAf,CAA4B,QAA5B,EAAqC,QAArC;AAA+C;AACrE;;AACD,gBAAMsG,yBAAyB,GAAG,YAAlC;AACA,gBAAMC,oBAAoB,GAAG,iBAA7B;AACA,gBAAMC,6BAA6B,GAAG9O,4DAAM,CAAC4O,yBAAD,CAA5C;AACA,gBAAMG,0BAA0B,GAAG/O,4DAAM,CAAC6O,oBAAD,CAAzC;AACA,gBAAMG,sBAAsB,GAAGhP,4DAAM,CAAC,sBAAD,CAArC;AACA,gBAAMiP,cAAc,GAAGjP,4DAAM,CAAC,iBAAD,CAA7B;;AACA,cAAI+K,QAAQ,CAACQ,YAAb,EAA2B;AACzB,gBAAGJ,QAAQ,CAACU,UAAT,IAAuB,aAAvB,IAAwCV,QAAQ,CAACU,UAAT,IAAuB,WAAlE,EAA8E;AAC5E,kBAAGmD,sBAAH,EAA0B;AACxBA,sCAAsB,CAACjC,MAAvB;AACD;;AACD,kBAAGkC,cAAH,EAAkB;AAChBA,8BAAc,CAACC,eAAf,CAA+B,QAA/B;AACD;AACF;;AACD,gBAAIJ,6BAA6B,IAAI,IAArC,EAA2C;AACzCA,2CAA6B,CAACvF,SAA9B,CAAwCwD,MAAxC,CAA+C,WAA/C;AACD;;AACD,gBAAIgC,0BAA0B,IAAI,IAAlC,EAAwC;AACtCA,wCAA0B,CAACxF,SAA3B,CAAqCwD,MAArC,CAA4C,WAA5C;AACD;AACF,WAfD,MAeO;AACL,gBAAGiC,sBAAH,EAA0B;AACxBA,oCAAsB,CAACE,eAAvB,CAAuC,QAAvC;AACD;;AACD,gBAAGD,cAAH,EAAkB;AAChBA,4BAAc,CAAC3G,YAAf,CAA4B,QAA5B,EAAqC,QAArC;AACD;;AACD,gBAAIwG,6BAA6B,IAAI,IAArC,EAA2C;AACzCA,2CAA6B,CAACvF,SAA9B,CAAwCC,GAAxC,CAA4C,WAA5C;AACD;;AACD,gBAAIuF,0BAA0B,IAAI,IAAlC,EAAwC;AACtCA,wCAA0B,CAACxF,SAA3B,CAAqCC,GAArC,CAAyC,WAAzC;AACD;AACF;AACJ,SA5ID;AA6ID,OAhJH;AAiJC;;AAEAK,kBAAc,GAAG,IAAIsF,wDAAJ,CAAmB3G,EAAnB,EAAuB;AAAE4G,qBAAF;AAAmB3G;AAAnB,KAAvB,CAAjB;AACAoB,kBAAc,CAACC,IAAf;AACA5E,UAAM,CAACmK,gBAAP,CAAwB,UAAxB,EAAoCC,2DAApC;AACAC,eAAW;AACXrK,UAAM,CAACkK,eAAP,GAAyBA,eAAe,CAACI,IAAhB,CAAqB,IAArB,CAAzB;AACCjF,sDAAO,CAACC,SAAR,CAAkBiF,uEAAlB,EAAgDC,kBAAhD;AAEA,UAAMC,0BAA0B,GAAG3P,4DAAM,CAAC,wCAAD,CAAzC;AACA,QAAI2P,0BAAJ,EACEA,0BAA0B,CAACN,gBAA3B,CAA4C,OAA5C,EAAqDO,mBAArD;AAEF,UAAMC,iBAAiB,GAAG7P,4DAAM,CAAC,sBAAD,CAAhC;;AACA,QAAI6P,iBAAJ,EAAuB;AACrBA,uBAAiB,CAACR,gBAAlB,CAAmC,OAAnC,EAA4CS,sBAA5C;AACD;;AACD,QAAI9P,4DAAM,CAAC,wBAAD,CAAN,IAAoC,CAAC+P,6DAAQ,EAAjD,EAAqD;AAClDC,qEAAS,CAAC,4BAAD,CAAT,CAAwCC,MAAxC,IAAkD,CAAlD,GAAsDjQ,4DAAM,CAAC,wBAAD,CAAN,CAAiCgM,KAAjC,CAAuCkE,SAAvC,GAAmD,GAAzG,GAA+G,EAA/G;AACD;;AAEF,QAAGjH,aAAH,EAAkB;AAChBkH,4BAAsB;AACvB;AACJ;;AAED,MAAIC,aAAa,GAAG,CAApB;;AAEA,WAASD,sBAAT,GAAkC;AAChClH,iBAAa,CAACoG,gBAAd,CAA+B,OAA/B,EAAwC,MAAM;AAC5C,YAAMlD,WAAW,GAAGlD,aAAa,CAACd,YAAd,CAA2B,WAA3B,CAApB;AACAjD,YAAM,CAAC+E,SAAP,CAAiBsC,IAAjB,CAAsB;AACpB,yBAAiB,qBADG;AAEpB,uBAAe,mBAFK;AAGpB,gCAAiBJ,WAAjB,CAHoB;AAIpB,iBAAS;AAJW,OAAtB;AAMD,KARD;AASD;;AAED,WAAS2D,sBAAT,GAAkC;AAChCzJ,YAAQ,CAACgK,KAAT,CAAe9D,IAAf,CAAoB,WAApB,EAAiC;AAC/B,qBAAe,iBADgB;AAE/B,oBAAcpC,cAAc,CAACxC,OAAf,CAAuB,aAAvB;AAFiB,KAAjC;AAIA,UAAM2I,WAAW,GAAGtQ,4DAAM,CAAC,gDAAD,CAA1B;;AACA,QAAIsQ,WAAJ,EAAiB;AACfC,wBAAkB,CAACD,WAAD,CAAlB;AACD;AACF;;AAED,WAASC,kBAAT,CAA4BD,WAA5B,EAAyC;AACvC;AACAA,eAAW,CAACtE,KAAZ,CAAkBmB,MAAlB,GAA2B,MAA3B;AACAiD,iBAAa,GAAGE,WAAW,CAACE,YAA5B;AACAF,eAAW,CAACpB,eAAZ,CAA4B,OAA5B,EAJuC,CAKvC;;AACAuB,aAAS,CAACC,MAAV,CAAiBJ,WAAjB,EAA8B,EAA9B,EAAkC;AAAEnD,YAAM,EAAE,CAAV;AAAawD,aAAO,EAAC;AAArB,KAAlC,EAA4D;AAACxD,YAAM,EAAEiD,aAAT;AAAwBO,aAAO,EAAE;AAAjC,KAA5D;AACA,UAAMC,YAAY,GAAG5Q,4DAAM,CAAC,gCAAD,EAAmCqG,QAAQ,CAACwK,IAA5C,CAA3B;;AACA,QAAGD,YAAH,EAAiB;AACfA,kBAAY,CAACE,mBAAb,CAAiC,QAAjC,EAA2CC,uBAA3C;AACAH,kBAAY,CAACvB,gBAAb,CAA8B,QAA9B,EAAwC0B,uBAAxC;AACD;AACF;;AAED,WAAS3E,wBAAT,CAAkC3G,IAAlC,EAAwC;AACtCY,YAAQ,CAACgK,KAAT,CAAe9D,IAAf,CAAoB,oCAApB,EAA0D;AACxDE,iBAAW,EAAE,SAD2C;AAExDC,gBAAU,EAAEjH;AAF4C,KAA1D;AAID;;AAEDuL,wCAAK,CAACxI,EAAD,EAAK,8CAAL,EAAqD,OAArD,EAA8DyI,sBAA9D,CAAL;;AAEA,WAASA,sBAAT,GAAkC;AAChC5K,YAAQ,CAACgK,KAAT,CAAe9D,IAAf,CAAoB,kCAApB,EAAwD;AACtDE,iBAAW,EAAE,OADyC;AAEtDC,gBAAU,EAAEtH;AAF0C,KAAxD;AAID;AAED;AACF;AACA;;;AACE,QAAMwL,YAAY,GAAG5Q,4DAAM,CAAC,gCAAD,EAAmCqG,QAAQ,CAACwK,IAA5C,CAA3B;;AACA,MAAGD,YAAH,EAAiB;AACfA,gBAAY,CAACE,mBAAb,CAAiC,QAAjC,EAA2CC,uBAA3C;AACAH,gBAAY,CAACvB,gBAAb,CAA8B,QAA9B,EAAwC0B,uBAAxC;AACD;;AAED,WAASA,uBAAT,CAAiCG,CAAjC,EAAoC;AAClCA,KAAC,CAACC,cAAF;AACA,UAAMC,SAAS,GAAGpR,4DAAM,CAAC,4BAAD,CAAN,GAAuCA,4DAAM,CAAC,4BAAD,CAAN,CAAqCqR,KAA5E,GAAoF,IAAtG;AACA,UAAMC,WAAW,GAAGtR,4DAAM,CAAC,2BAAD,CAAN,GAAsCA,4DAAM,CAAC,2BAAD,CAAN,CAAoCqR,KAA1E,GAAkF,IAAtG;AACA,UAAME,aAAa,GAAGvR,4DAAM,CAAC,6BAAD,CAAN,GAAwCA,4DAAM,CAAC,6BAAD,CAAN,CAAsCqR,KAA9E,GAAsF,IAA5G;AACA,UAAMG,eAAe,GAAGxR,4DAAM,CAAC,2BAAD,CAAN,GAAsCA,4DAAM,CAAC,2BAAD,CAAN,CAAoCqR,KAA1E,GAAkF,IAA1G;AACA,QAAII,UAAU,GAAG,KAAjB;;AACA,QAAInK,mDAAM,CAAC4B,OAAP,CAAewI,WAAf,MAAgC,IAApC,EAA0C;AACxC,YAAMC,WAAW,GAAG3R,4DAAM,CAAC,cAAD,CAA1B;AACA,YAAM4R,WAAW,GAAGC,mEAAa,CAAC,kBAAD,CAAjC;;AACA,UAAIT,SAAS,IAAI,EAAb,IAAmBI,eAAe,IAAI,EAA1C,EAA+C;AAC7C,YAAIG,WAAW,CAACG,YAAZ,CAAyB,QAAzB,CAAJ,EAAwC;AACtCH,qBAAW,CAACzC,eAAZ,CAA4B,QAA5B;AACD;;AACDyC,mBAAW,CAACrJ,YAAZ,CAAyB,aAAzB,EAAwC,KAAxC;AACAqJ,mBAAW,CAACpI,SAAZ,CAAsBC,GAAtB,CAA0B,OAA1B;AACAoI,mBAAW,CAACG,OAAZ,CAAoBC,KAAK,IAAI;AAC3B,gBAAMC,KAAK,GAAGD,KAAK,CAACtJ,OAAN,CAAc,QAAd,CAAd;AACAsJ,eAAK,CAAC1J,YAAN,CAAmB,cAAnB,EAAmC,IAAnC;AACA2J,eAAK,CAAC1I,SAAN,CAAgBC,GAAhB,CAAoB,WAApB;AACD,SAJD;AAKA0I,yEAAY,CAACP,WAAD,CAAZ;AACAF,kBAAU,GAAG,IAAb;AACD,OAbD,MAaO;AACLE,mBAAW,CAACrJ,YAAZ,CAAyB,QAAzB,EAAmC,EAAnC;AACAqJ,mBAAW,CAACrJ,YAAZ,CAAyB,aAAzB,EAAwC,KAAxC;AACAqJ,mBAAW,CAACpI,SAAZ,CAAsBwD,MAAtB,CAA6B,OAA7B;AACA6E,mBAAW,CAACG,OAAZ,CAAoBC,KAAK,IAAI;AAC3B,gBAAMzD,EAAE,GAAGyD,KAAK,CAAC7J,YAAN,CAAmB,IAAnB,CAAX;AACA,gBAAMgK,SAAS,mBAAY5D,EAAZ,CAAf;AACA,gBAAM0D,KAAK,GAAGD,KAAK,CAACtJ,OAAN,CAAc,QAAd,CAAd;;AACA,cAAI,CAAC1I,4DAAM,iBAASmS,SAAT,SAAX,EAAoC;AAClCH,iBAAK,CAAC9C,eAAN,CAAsB,cAAtB,EAAsC,IAAtC;AACA+C,iBAAK,CAAC1I,SAAN,CAAgBwD,MAAhB,CAAuB,WAAvB;AACD;AACF,SARD;AASA0E,kBAAU,GAAG,KAAb;AACD;AACF;;AACD,QAAIW,IAAI,GAAG;AACTC,kBAAY,EAAEjB,SADL;AAETE,iBAAW,EAAEA,WAFJ;AAGTC,mBAAa,EAAEA;AAHN,KAAX;;AAKA,QAAIjK,mDAAM,CAAC4B,OAAP,CAAewI,WAAf,MAAgC,IAApC,EAA0C;AACxCxQ,YAAM,CAACoR,MAAP,CAAcF,IAAd,EAAoB;AAClBG,mBAAW,EAAEf,eADK;AAElBgB,oBAAY,EAAExS,4DAAM,CAAC,4BAAD,CAAN,GAAuCA,4DAAM,CAAC,4BAAD,CAAN,CAAqCqR,KAA5E,GAAoF,IAFhF;AAGlBoB,qBAAa,EAAEzS,4DAAM,CAAC,4BAAD,CAAN,GAAuCA,4DAAM,CAAC,4BAAD,CAAN,CAAqCqR,KAA5E,GAAoF,IAHjF;AAIlBqB,6BAAqB,EAAE1S,4DAAM,CAAC,qCAAD,CAAN,GAAgDA,4DAAM,CAAC,qCAAD,CAAN,CAA8CqR,KAA9F,GAAsG;AAJ3G,OAApB;AAMD;;AACD,UAAMsB,WAAW,GAAG3S,4DAAM,CAAC,iDAAD,CAA1B;AACA,QAAI4S,MAAJ;;AACA,QAAID,WAAJ,EAAiB;AACfC,YAAM,GAAG,IAAIC,0DAAJ,CAAWF,WAAX,EAAwB;AAAEG,cAAM,EAAE;AAAV,OAAxB,CAAT;AACAF,YAAM,CAAC9I,IAAP;AACA8I,YAAM,CAACG,MAAP;AACD;;AACD,QAAI7B,CAAC,CAAC8B,cAAF,CAAiBC,OAAjB,CAAyBhD,MAAzB,KAAoC,CAApC,IAAyC,CAACwB,UAA9C,EAA0D;AACxDyB,gEAAI,CAAChC,CAAC,CAAC8B,cAAF,CAAiBG,MAAlB,EAA0B;AAAEf;AAAF,OAA1B,CAAJ,CACGlL,IADH,CACSkM,QAAD,IAAc;AAClBR,cAAM,CAACS,OAAP;;AACA,YAAID,QAAQ,CAACE,OAAb,EAAsB;AACpB,gBAAMC,OAAO,GAAGvT,4DAAM,wBAAgBoT,QAAQ,CAAC3N,IAAzB,SAAtB;;AACA,cAAI8N,OAAJ,EAAa;AACXA,mBAAO,CAACC,IAAR,GAAe,SAAf;AACAC,2BAAe,CAACF,OAAD,EAAUH,QAAQ,CAACE,OAAnB,CAAf;AACD;AACF,SAND,MAMO;AACL,cAAII,WAAW,GAAGpM,mDAAM,CAACqM,aAAP,CAAqBC,YAArB,CAAkCjJ,OAAlC,CAA0C,kBAA1C,oBAAyEyG,SAAzE,eAAlB;;AACA,cAAG9J,mDAAM,CAAC4B,OAAP,CAAewI,WAAf,MAAgC,IAAnC,EAAyC;AACvCgC,uBAAW,GAAGA,WAAW,CAAC/I,OAAZ,CAAoB,iBAApB,oBAAkD6G,eAAlD,eAAd;AACD;;AACD,gBAAMqC,qBAAqB,GAAG7T,4DAAM,CAAC,wBAAD,CAApC;AACA,gBAAM8T,kBAAkB,GAAG9T,4DAAM,CAAC,2BAAD,CAAjC;AACA,gBAAM+T,aAAa,GAAG/T,4DAAM,CAAC,iDAAD,CAA5B;;AACA,cAAI6T,qBAAJ,EAA2B;AACzBA,iCAAqB,CAAC7H,KAAtB,CAA4BC,OAA5B,GAAsC,MAAtC;AACA6H,8BAAkB,CAAC9H,KAAnB,CAAyBC,OAAzB,GAAmC,OAAnC;AACAjM,wEAAM,CAAC,2CAAD,CAAN,CAAoDiI,SAApD,GAAgEyL,WAAhE;AACAjD,qBAAS,CAACC,MAAV,CAAiBmD,qBAAjB,EAAwC,EAAxC,EAA4C;AAAE1G,oBAAM,EAAE0G,qBAAqB,CAACrD,YAAhC;AAA8CG,qBAAO,EAAE;AAAvD,aAA5C,EAAwG;AAACxD,oBAAM,EAAE,CAAT;AAAYwD,qBAAO,EAAE;AAArB,aAAxG;AACAF,qBAAS,CAACC,MAAV,CAAiBoD,kBAAjB,EAAqC,EAArC,EAAyC;AAAE3G,oBAAM,EAAE,CAAV;AAAawD,qBAAO,EAAE;AAAtB,aAAzC,EAAoE;AAACxD,oBAAM,EAAE2G,kBAAkB,CAACtD,YAA5B;AAA0CG,qBAAO,EAAE;AAAnD,aAApE;AACA,gBAAIoD,aAAJ,EACE7B,iEAAY,CAAC6B,aAAD,CAAZ;AACH;;AACD1N,kBAAQ,CAACgK,KAAT,CAAe9D,IAAf,CAAoB,WAApB,EAAiC;AAC/B,2BAAe,kBADgB;AAE/B,0BAAcpC,cAAc,CAACxC,OAAf,CAAuB,aAAvB;AAFiB,WAAjC;AAID;AACF,OA/BH,EA+BKqM,KA/BL,CA+BY3T,KAAD,IAAW;AAClBoE,eAAO,CAACC,GAAR,CAAYrE,KAAZ;AACH,OAjCD;AAkCD,KAnCD,MAmCO;AACLuS,YAAM,CAACS,OAAP;AACD;AACF;;AAED,WAASI,eAAT,CAAyBzB,KAAzB,EAAgCsB,OAAhC,EAAwC;AAEtC,QAAI,CAACtB,KAAL,EAAY;AACV;AACD;;AAED,UAAMC,KAAK,GAAGD,KAAK,CAACtJ,OAAN,CAAc,QAAd,CAAd;AAEAsJ,SAAK,CAAC1J,YAAN,CAAmB,cAAnB,EAAmC,IAAnC;;AAEA,QAAI2J,KAAJ,EAAW;AACTA,WAAK,CAAC1I,SAAN,CAAgBC,GAAhB,CAAoB,WAApB;AACD,KAZqC,CAatC;;;AACAyK,gBAAY,CAACjC,KAAD,EAAQsB,OAAR,CAAZ;AACD;;AAED,WAASW,YAAT,CAAsBjC,KAAtB,EAA6BsB,OAA7B,EAAqC;AACnC,QAAI,CAACtB,KAAL,EAAY;AACV;AACD;;AACD,UAAMkC,MAAM,GAAGlC,KAAK,CAACtJ,OAAN,CAAc,QAAd,KAA2BsJ,KAAK,CAACmC,UAAhD;AACA,QAAIC,IAAI,GAAGF,MAAM,CAAC5N,aAAP,CAAqB,QAArB,CAAX,CALmC,CAMnC;;AACA,QAAI,CAAC8N,IAAL,EAAW;AACTA,UAAI,GAAG/N,QAAQ,CAACgD,aAAT,CAAuB,GAAvB,CAAP;AACA+K,UAAI,CAAC9L,YAAL,CAAkB,IAAlB,EAAwB,YAAxB;AACA8L,UAAI,CAAC7K,SAAL,CAAeC,GAAf,CAAmB,OAAnB;AACA4K,UAAI,CAACnM,SAAL,GAAiBqL,OAAjB;AACAY,YAAM,CAACtK,WAAP,CAAmBwK,IAAnB;AACD,KAND,MAOK;AACHA,UAAI,CAACnM,SAAL,GAAiBqL,OAAjB;AACD;;AACDpB,qEAAY,CAACF,KAAD,CAAZ;AACAA,SAAK,CAAC9C,eAAN,CAAsB,UAAtB;AACA8C,SAAK,CAAC1J,YAAN,CAAmB,kBAAnB,EAAuC,4BAAvC;AACD;;AAED,WAASiH,WAAT,GAAuB;AACrBrK,UAAM,CAACmK,gBAAP,CAAwB,MAAxB,EAAgCgF,UAAhC;AACA,UAAMC,iBAAiB,GAAGtU,4DAAM,CAAC,YAAD,CAAhC;;AACA,QAAIsU,iBAAJ,EAAuB;AACrBA,uBAAiB,CAACjF,gBAAlB,CAAmC,OAAnC,EAA4CkF,sDAA5C;AACD;AACF;AAED;AACF;AACA;;;AACE,WAASlB,OAAT,GAAmB;AACjBnO,UAAM,CAAC4L,mBAAP,CAA2B,UAA3B,EAAuCxB,2DAAvC;AACAzF,kBAAc,CAACwJ,OAAf;AACD;;AACD,WAASmB,gBAAT,CAA0BC,SAA1B,EAAqC;AAEnC,QAAIzL,iBAAiB,IAAIyL,SAAzB,EAAoC;AAClCzL,uBAAiB,CAACf,SAAlB,GAA8Be,iBAAiB,CAAC4B,OAAlB,CAA0B8J,IAAxD;AACD,KAFD,MAEO;AACL1L,uBAAiB,CAACf,SAAlB,GAA8B,EAA9B;AACD;AAEF;;AAED,MAAI2K,MAAM,GAAG,IAAb;AACA;AACF;AACA;;AACE,WAASxD,eAAT,CAAyBiC,KAAzB,EAAgC1E,KAAhC,EAAuC;AAErC,UAAMgI,0BAA0B,GAAG3U,4DAAM,CAAC,2DAAD,CAAzC;AACA,UAAM4U,UAAU,GAAG5U,4DAAM,CAAC,eAAD,CAAzB;AACA,UAAM6U,YAAY,GAAG,CAAC,CAAC7U,4DAAM,CAAC,wBAAD,EAA2B4U,UAA3B,CAA7B;AACA,UAAME,WAAW,GAAG,CAAC,CAAC9U,4DAAM,CAAC,0CAAD,EAA6C4U,UAA7C,CAA5B;AACA,UAAMG,WAAW,GAAG/E,+DAAS,CAAC,kBAAD,CAAT,CAA8BC,MAA9B,GAAuC,CAA3D;AACA,UAAM+E,iBAAiB,GAAGhV,4DAAM,CAAC,oBAAD,CAAhC;AACA,UAAMiV,QAAQ,GAAG,KAAjB;AAEA,QAAIC,OAAO,GAAC/K,cAAc,CAACxC,OAAf,CAAuB,SAAvB,CAAZ;AAEA,QAAIwN,QAAQ,GAAG1M,WAAW,GAAGD,EAAE,CAACE,OAAH,CAAW,YAAX,CAAH,GAA8B1I,4DAAM,CAAC,UAAD,CAA9D;AACAmV,YAAQ,GAAGN,YAAY,IAAI,CAACC,WAAjB,IAAgC,CAAC/E,6DAAQ,EAAzC,GAA8C6E,UAA9C,GAA2DO,QAAtE;AAEA,UAAMC,aAAa,GAAGpV,4DAAM,CAAC,qBAAD,CAAN,GAAgCA,4DAAM,CAAC,0CAAD,CAAtC,GAAoFmV,QAA1G;AAEA,UAAME,MAAM,GAAG;AACbjD,UAAI,EAAE;AACJkD,WAAG,EAAEjE,KADD;AAEJkE,eAAO,EAACL;AAFJ;AADO,KAAf;;AAOA,QAAIzM,WAAJ,EAAiB;AACf4M,YAAM,CAACjD,IAAP,CAAYoD,SAAZ,GAAwB,IAAxB;;AACA,UAAI,CAAE7I,KAAK,CAAC8I,MAAN,CAAaxV,SAAb,CAAuByV,QAAvB,CAAgC,oBAAhC,CAAN,EAA8D;AAC5D,YAAI,CAAC9C,MAAL,EAAa;AACV4B,0BAAgB,CAAC,IAAD,CAAhB;AACD5B,gBAAM,GAAG,IAAIC,0DAAJ,CAAWuC,aAAX,EAA0B;AACjCO,yBAAa,EAAE,CAAC,CAAC3V,4DAAM,CAAC,oDAAD,CAAR,IAAkE,CAAC,CAACA,4DAAM,CAAC,cAAD,CADxD;AAEjC4V,yBAAa,EAAE,CAACnN,WAFiB;AAGjCoN,uBAAW,EAAET,aAHoB;AAIjCU,iBAAK,EAAE;AAJ0B,WAA1B,CAAT;AAMAlD,gBAAM,CAAC9I,IAAP;AACA8I,gBAAM,CAACG,MAAP,CAAc,MAAM;AAClB,kBAAMgD,aAAa,GAAG/V,4DAAM,CAAC,SAAD,CAA5B;AACA,gBAAI+V,aAAJ,EAAmBA,aAAa,CAAC/J,KAAd,CAAoBgK,KAApB,GAA4B,MAA5B;AACpB,WAHD;AAID;AACF;AACF;;AAED,QAAIrN,UAAJ,EAAgB;AACd,YAAMsN,KAAK,GAAGzN,EAAE,CAACE,OAAH,CAAW,iBAAX,CAAd;AACA,YAAMwN,IAAI,GAAGD,KAAK,CAAC3P,aAAN,CAAoB,MAApB,CAAb;AAEA+O,YAAM,CAACjD,IAAP,CAAY+D,aAAZ,GAA4B,IAA5B;;AAEA,UAAID,IAAJ,EAAU;AACRb,cAAM,CAACjD,IAAP,CAAYgE,WAAZ,GAA0BF,IAAI,CAACG,QAAL,CAAcC,SAAd,CAAwBjF,KAAlD;AACAgE,cAAM,CAACjD,IAAP,CAAYmE,aAAZ,GAA4BL,IAAI,CAACG,QAAL,CAAcG,QAAd,CAAuBnF,KAAnD;AACD;AACF;;AAED,QAAI0D,WAAJ,EAAiB;AACfnV,iFAAuB,CAAE6W,WAAD,IAAiB;AACvC,YAAIA,WAAJ,EAAgB;AACd,cAAI,CAAC7D,MAAL,EAAa;AACX,gBAAIiC,YAAY,IAAI,CAACC,WAAjB,IAAgC,CAAC/E,6DAAQ,EAA7C,EAAiD;AAC/C6C,oBAAM,GAAG,IAAIC,0DAAJ,CAAW+B,UAAX,EAAuB;AAACkB,qBAAK,EAAE;AAAR,eAAvB,CAAT;AACD,aAFD,MAEO;AACLtB,8BAAgB,CAAC,IAAD,CAAhB;AACA5B,oBAAM,GAAG,IAAIC,0DAAJ,CAAWsC,QAAX,EAAqB;AAC5BQ,6BAAa,EAAE,CAAC,CAAC3V,4DAAM,CAAC,oDAAD,CAAR,IAAkE,CAAC,CAACA,4DAAM,CAAC,cAAD,CAD7D;AAE5B4V,6BAAa,EAAE,CAACnN,WAFY;AAG5BoN,2BAAW,EAAEV,QAHe;AAI5BW,qBAAK,EAAE;AAJqB,eAArB,CAAT;AAMD;;AACDlD,kBAAM,CAAC9I,IAAP;AACA8I,kBAAM,CAACG,MAAP,CAAc,MAAM;AAClB,oBAAMgD,aAAa,GAAG/V,4DAAM,CAAC,SAAD,CAA5B;AACA,kBAAI+V,aAAJ,EAAmBA,aAAa,CAAC/J,KAAd,CAAoBgK,KAApB,GAA4B,MAA5B;AACpB,aAHD;AAID;AACF;AACF,OArBsB,CAAvB;AAsBD,KAvBD,MAuBO;AACH,UAAI,CAACpD,MAAL,EAAa;AACdA,cAAM,GAAG,IAAIC,0DAAJ,CAAW7S,4DAAM,CAAC,UAAD,CAAjB,EAA+B;AAAC8V,eAAK,EAAC;AAAP,SAA/B,CAAT;AACAlD,cAAM,CAAC9I,IAAP;AACA8I,cAAM,CAACG,MAAP,CAAc,MAAM;AACrB,gBAAMgD,aAAa,GAAG/V,4DAAM,CAAC,SAAD,CAA5B;AACM,cAAI+V,aAAJ,EAAmBA,aAAa,CAAC/J,KAAd,CAAoBgK,KAApB,GAA4B,MAA5B;AACvB,SAHD;AAID;AACD;;AAEDxN,MAAE,CAACF,YAAH,CAAgB,aAAhB,EAA+B,IAA/B,EA1FqC,CA4FrC;;AACAuJ,uEAAa,CAAC,iCAAD,CAAb,CAAiDE,OAAjD,CAAyD,CAAC2E,GAAD,EAAMC,KAAN,KAAgB;AACvE,YAAMC,UAAU,GAAG5W,4DAAM,CAAC,uBAAD,EAA0B0W,GAA1B,CAAzB;;AACA,UAAIE,UAAJ,EAAgB;AACd,YAAIC,OAAO,GAAG3R,MAAM,CAACwC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B,KAAgD,IAA9D;AACAkP,eAAO,GAAGC,IAAI,CAACC,KAAL,CAAWF,OAAX,CAAV;AACAA,eAAO,CAAC,gBAAD,CAAP,GAA4BF,KAA5B;AACAE,eAAO,CAAC,MAAD,CAAP,GAAkB3R,MAAM,CAACgB,QAAP,CAAgBC,IAAlC;AACAjB,cAAM,CAACwC,YAAP,CAAoBkE,OAApB,CAA4B,eAA5B,EAA6CkL,IAAI,CAACE,SAAL,CAAeH,OAAf,CAA7C;AACD;AACF,KATD;AAWAnM,6DAAG,CAACpD,mDAAM,CAACmC,WAAP,CAAmBC,GAAnB,CAAuBuN,OAAxB,EAAiC5B,MAAjC,CAAH,CAA4CnO,IAA5C,CAAiDkL,IAAI,IAAI;AACvD,UAAI6C,QAAQ,IAAI,CAACxM,WAAb,IAA4B2J,IAAI,CAAC8E,MAAL,CAAY7R,QAAZ,CAAqB8R,QAArB,KAAkC,SAAlE,EAA6E;AAC3EjS,cAAM,CAACgB,QAAP,CAAgBC,IAAhB,GAAuBiM,IAAI,CAACgF,GAA5B;AACA,eAAO,IAAP;AACD;;AACD/D,aAAO;AACP7K,QAAE,CAACF,YAAH,CAAgB,aAAhB,EAA+B,KAA/B;AAEA+O,gBAAU,CAACjF,IAAD,CAAV;AACAkF,yBAAmB,CAAClF,IAAI,CAAC8E,MAAN,CAAnB;AAEAzG,eAAS,CAACC,MAAV,CAAiBlI,EAAjB,EAAqB,EAArB,EAAyB;AAAEmI,eAAO,EAAE;AAAX,OAAzB,EAAyC;AAAEA,eAAO,EAAE;AAAX,OAAzC;;AAEA,UAAI,CAAClI,WAAL,EAAkB;AAChB8O,kBAAU,CAACnF,IAAD,CAAV;AACAoF,iBAAS,CAACpF,IAAI,CAACgF,GAAN,CAAT;AAEA,cAAMK,WAAW,GAAGzX,4DAAM,CAAC,yBAAD,CAAN,CAAkC0I,OAAlC,CAA0C,IAA1C,CAApB;AACA+O,mBAAW,CAACnP,YAAZ,CAAyB,UAAzB,EAAqC,IAArC;AACAoP,kBAAU,CAAC,MAAM;AACfC,mBAAS;AACV,SAFS,EAEP,EAFO,CAAV;AAIA7N,YAAI,CAAC,KAAD,CAAJ;;AACA,YAAI5E,MAAM,CAAC0S,MAAX,EAAmB;AACjB1S,gBAAM,CAAC0S,MAAP,CAAcC,UAAd;AACD;AACF;;AACD,aAAO,IAAP;AACD,KA7BD,EA8BG7D,KA9BH,CA8BS,MAAM;AACX2D,eAAS;AACV,KAhCH,EAiCGzQ,IAjCH,CAiCQ4Q,OAAO,IAAI;AACf,UAAIrP,WAAJ,EAAiB;AACfyJ,yEAAY,CAACtJ,gBAAD,CAAZ;AACAJ,UAAE,CAACE,OAAH,CAAW,qBAAX,EAAkCJ,YAAlC,CAA+C,aAA/C,EAA8D,OAA9D;AACAuB,sBAAc,GAAG,IAAIsF,wDAAJ,CAAmB3G,EAAnB,EAAuB;AAAE4G,yBAAF;AAAmB3G;AAAnB,SAAvB,CAAjB;AACAoB,sBAAc,CAACC,IAAf;AACA,cAAM+F,iBAAiB,GAAG7P,4DAAM,CAAC,sBAAD,CAAhC;;AACA,YAAI6P,iBAAJ,EAAuB;AACrBA,2BAAiB,CAACR,gBAAlB,CAAmC,OAAnC,EAA4CS,sBAA5C;AACD;AACF;;AACDtH,QAAE,CAAC0G,eAAH,CAAmB,aAAnB;AACA,aAAO,IAAI6I,OAAJ,CAAYC,OAAO,IAAI;AAC5BpY,mFAAuB,CAAE6W,WAAD,IAAiB;AACvC,cAAIA,WAAJ,EAAiB;AACf,gBAAG7D,MAAH,EAAU;AACR4B,8BAAgB,CAAC,KAAD,CAAhB;AACA5B,oBAAM,CAACS,OAAP,CAAe2E,OAAf;AACApF,oBAAM,GAAG,IAAT;AACD,aAJD,MAIOoF,OAAO;AACf,WAND,MAMO;AACL,gBAAGpF,MAAH,EAAU;AACR4B,8BAAgB,CAAC,KAAD,CAAhB;AACA5B,oBAAM,CAACS,OAAP,CAAe2E,OAAf;AACApF,oBAAM,GAAG,IAAT;AACD;AACF;AACF,SAdsB,CAAvB;AAeD,OAhBM,EAiBN1L,IAjBM,CAiBD,MAAM;AACV,YAAI4Q,OAAJ,EAAa;AACXvN,4DAAO,CAACgD,OAAR,CAAgB0K,mEAAhB,EAA0CzP,EAA1C;AACA+B,4DAAO,CAACgD,OAAR,CAAgB2K,0DAAhB,EAAiC1P,EAAjC;;AACA,cAAI,EAAEqM,YAAY,IAAI,CAACC,WAAnB,CAAJ,EAAqC;AACnC6C,qBAAS;AACV;AACF;AACF,OAzBM,EA0BNzQ,IA1BM,CA0BD,MAAMiR,kFAAgB,EA1BrB,EA2BNjR,IA3BM,CA2BD,MAAM;AACVkR,0BAAkB;AAClBA,0BAAkB,GAAGC,mDAAe,EAApC;AACD,OA9BM,EA+BNnR,IA/BM,CA+BD,MAAM;AAAG;AACb,cAAMoR,4BAA4B,GAAGzG,mEAAa,CAAC,2DAAD,CAAlD;;AACA,YAAIyG,4BAAJ,EAAkC;AAChCA,sCAA4B,CAACvG,OAA7B,CAAqCwG,IAAI,IAAI;AAC3C,gBAAI,CAACA,IAAI,CAAChP,SAAL,CAAeiP,QAAf,CAAwB,qBAAxB,CAAL,EAAqDD,IAAI,CAACvM,KAAL,CAAWyM,GAAX,aAAoB9D,0BAA0B,CAAC3I,KAA3B,CAAiCyM,GAArD;AACtD,WAFD;AAGD;AACF,OAtCM,CAAP;AAuCD,KApFH;AAqFD;AAED;AACF;AACA;;;AACE,WAASpB,UAAT,CAAoBjF,IAApB,EAA0B;AACxB,QAAI,EAAE,aAAaA,IAAf,CAAJ,EAA0B;AACxB3N,aAAO,CAACpE,KAAR,CAAc,gEAAd;AACD;;AAED,QAAIqY,gBAAJ,CALwB,CAOxB;;AACA,QAAIjQ,WAAJ,EAAiB;AACfiQ,sBAAgB,GAAGlQ,EAAE,CAAClC,aAAH,CAAiB,UAAjB,EAA6BiI,EAAhD;AACD,KAVuB,CAYxB;;;AACAhE,sDAAO,CAACgD,OAAR,CAAgB,WAAhB,EAA6B/E,EAA7B;AACAA,MAAE,CAACP,SAAH,GAAemK,IAAI,CAACuG,OAApB;AACA,UAAMC,UAAU,GAAG5Y,4DAAM,CAAC,sBAAD,CAAzB;;AACA,QAAI4Y,UAAJ,EAAgB;AACdrO,wDAAO,CAACgD,OAAR,CAAgB2K,0DAAhB,EAAiC1P,EAAjC;AACD;;AAED,QAAIkQ,gBAAJ,EAAsB;AACpB,YAAMG,cAAc,GAAGrQ,EAAE,CAAClC,aAAH,CAAiB,UAAjB,CAAvB;;AAEA,UAAIuS,cAAJ,EAAoB;AAClBA,sBAAc,CAACtK,EAAf,GAAoBmK,gBAApB;AACD;AACF;;AAEDnO,sDAAO,CAACgD,OAAR,CAAgB,SAAhB,EAA2B/E,EAA3B;AACAsQ,8DAAa,CAACC,MAAd;AACAlR,uBAAmB;AAEnB,WAAOuK,IAAP;AACD;AAED;AACF;AACA;;;AACE,WAASmF,UAAT,CAAoBnF,IAApB,EAA0B;AACxB/L,YAAQ,CAACM,KAAT,GAAiByL,IAAI,CAACzL,KAAL,IAAcN,QAAQ,CAACM,KAAxC;AACA,UAAMqS,aAAa,GAAGhZ,4DAAM,CAAC,wBAAD,CAA5B;;AACA,QAAIgZ,aAAJ,EAAmB;AACjBA,mBAAa,CAAC1Q,YAAd,CAA2B,OAA3B,EAAoC8J,IAAI,CAAC6G,WAAzC;AACD;;AACD,WAAO7G,IAAP;AACD;AAED;AACF;AACA;;;AACE,WAASuF,SAAT,GAAqB;AACnB,UAAMuB,SAAS,GAAGlJ,+DAAS,CAAC,YAAD,EAAenG,cAAc,CAACsP,GAAf,CAAmBzE,IAAlC,CAA3B;;AACA,QAAIwE,SAAS,CAACjJ,MAAV,GAAmB,CAAvB,EAA0B;AACxBiJ,eAAS,CAAC,CAAD,CAAT,CAAaE,KAAb;AACAlU,YAAM,CAACmU,QAAP,CAAgB;AACdZ,WAAG,EAAE,CADS;AAEda,YAAI,EAAE,CAFQ;AAGdC,gBAAQ,EAAE;AAHI,OAAhB;AAKD;AACF;AAED;AACF;AACA;;;AACE,WAAS/B,SAAT,CAAmBJ,GAAnB,EAAwB;AACtB,QAAIlR,QAAQ,GAAGhB,MAAM,CAACgB,QAAtB;AACA,QAAIsT,YAAY,GAAG,EAAnB;;AACA,QAAItT,QAAQ,CAACW,MAAT,CAAgBT,OAAhB,CAAwB,KAAxB,KAAkC,CAAC,CAAvC,EAA0C;AACtCoT,kBAAY,GAAG,OAAQrP,cAAc,CAACxC,OAAf,CAAuB,YAAvB,MAAyC,MAA1C,GAAoD,EAApD,GAAyD,gBAAgBwC,cAAc,CAACxC,OAAf,CAAuB,YAAvB,CAAhF,KACLwC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,MAA0C,MAA3C,GAAqD,EAArD,GAA0D,kBAAkBwC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CADtE,KAELwC,cAAc,CAACxC,OAAf,CAAuB,YAAvB,MAAyC,MAA1C,GAAoD,EAApD,GAAyD,iBAAiBwC,cAAc,CAACxC,OAAf,CAAuB,YAAvB,CAFpE,KAGLwC,cAAc,CAACxC,OAAf,CAAuB,cAAvB,MAA2C,MAA5C,GAAsD,EAAtD,GAA2D,mBAAmBwC,cAAc,CAACxC,OAAf,CAAuB,cAAvB,CAHxE,KAILwC,cAAc,CAACxC,OAAf,CAAuB,SAAvB,MAAsC,MAAvC,GAAiD,EAAjD,GAAsD,cAAcwC,cAAc,CAACxC,OAAf,CAAuB,SAAvB,CAJ9D,CAAf;AAKF,KANF,MAMQ;AACJ6R,kBAAY,GAAG,OAAQrP,cAAc,CAACxC,OAAf,CAAuB,SAAvB,MAAsC,MAAvC,GAAiD,EAAjD,GAAsD,aAAawC,cAAc,CAACxC,OAAf,CAAuB,SAAvB,CAA1E,CAAf;AACF;;AACFyP,OAAG,GAAGA,GAAG,IAAKoC,YAAY,CAACvJ,MAAb,IAAuB,CAAxB,GAA6B,EAA7B,GAAkCuJ,YAAtC,CAAT;AACAtU,UAAM,CAACuB,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,EAA7B,EAAiC0Q,GAAjC;AACA7M,sDAAO,CAACgD,OAAR,CAAgBkM,8DAAhB;AACD;AAED;AACF;AACA;AACA;;;AACE,WAASpF,UAAT,GAAsB;AACpB,UAAMqF,OAAO,GAAG5C,IAAI,CAACC,KAAL,CAAWrP,YAAY,CAACC,OAAb,CAAqB,SAArB,CAAX,CAAhB;AACA,UAAMgS,UAAU,GAAG3Z,4DAAM,CAAC,mBAAD,CAAzB;;AAEA,QAAI0Z,OAAO,IAAIA,OAAO,CAACE,OAAvB,EAAgC;AAC5BF,aAAO,CAACE,OAAR,GAAkB,KAAlB;AACAF,aAAO,CAACG,OAAR,GAAkB,IAAlB;AACAnS,kBAAY,CAACkE,OAAb,CAAqB,SAArB,EAAgCkL,IAAI,CAACE,SAAL,CAAe0C,OAAf,CAAhC;AACH;;AAED,UAAMI,UAAU,GAAG9Z,4DAAM,CAAC,qBAAD,EAAyB2Z,UAAzB,CAAzB;;AACA,QAAIG,UAAJ,EAAgB;AACfA,gBAAU,CAACxR,YAAX,CAAwB,QAAxB,EAAkC,EAAlC;AACAwR,gBAAU,CAACpR,OAAX,CAAmB,eAAnB,EAAoCa,SAApC,CAA8CwD,MAA9C,CAAqD,aAArD;AACA;AACF;AAED;AACF;AACA;;;AACE,WAASuK,mBAAT,CAA6BlF,IAA7B,EAAmC;AAC/B,QAAGA,IAAH,EAAS;AACP,UAAI,CAACjN,WAAL,EAAkB;AACdA,mBAAW,GAAG;AACVE,kBAAQ,EAAE,EADA;AAEV0U,qBAAW,EAAE;AAFH,SAAd;AAIH;;AACD,UAAI3H,IAAI,CAAC7Q,cAAL,CAAoB,UAApB,KAAmCL,MAAM,CAAC8Y,IAAP,CAAY5H,IAAI,CAAC/M,QAAjB,EAA2B4K,MAA3B,IAAqC,CAA5E,EAA+E;AAC3E9K,mBAAW,CAACE,QAAZ,GAAuB+M,IAAI,CAAC/M,QAA5B,CAD2E,CAE3E;;AACAgB,gBAAQ,CAACgK,KAAT,CAAe9D,IAAf,CAAoB,8BAApB,EAAoD6F,IAAI,CAAC/M,QAAzD;AACH;;AACD,UAAI+M,IAAI,CAAC7Q,cAAL,CAAoB,aAApB,KAAsCL,MAAM,CAAC8Y,IAAP,CAAY5H,IAAI,CAAC2H,WAAjB,EAA8B9J,MAA9B,IAAwC,CAAlF,EAAqF;AACjF/O,cAAM,CAACoR,MAAP,CAAcnN,WAAW,CAAC4U,WAA1B,EAAuC3H,IAAI,CAAC2H,WAA5C;AACH;;AACDE,yBAAmB;;AACnB,UAAI9P,cAAc,CAACxC,OAAf,CAAuB,SAAvB,MAAsC,MAA1C,EAAkD;AAChDuS,sFAAa;AACbC,qBAAa;AACd;AACF;;AACD,QAAIC,eAAe,GAAGpK,+DAAS,CAAC,oBAAD,CAA/B;AACAoK,mBAAe,CAACrI,OAAhB,CAAyBsI,GAAD,IAAS;AAC/B,UAAIC,MAAM,GAAGD,GAAG,CAAClS,YAAJ,CAAiB,aAAjB,CAAb;AACAkS,SAAG,CAAC/R,YAAJ,CAAiB,QAAjB,EAA2BgS,MAA3B;AACD,KAHD;AAIH;;AAID,WAAS5K,kBAAT,GAA8B;AAC5B,UAAM6K,iBAAiB,GAAGva,4DAAM,CAAC,qDAAD,CAAhC;;AACA,QAAIua,iBAAJ,EAAuB;AACrBrI,uEAAY,CAACqI,iBAAD,CAAZ;AACD;AACF;;AAED,WAAS3K,mBAAT,GAA+B;AAC7B,UAAM4K,MAAM,GAAGxa,4DAAM,CAAC,qBAAD,CAArB;;AACA,QAAIwa,MAAJ,EAAY;AACVA,YAAM,CAAClS,YAAP,CAAoB,UAApB,EAAgC,IAAhC;AACA4J,uEAAY,CAACsI,MAAD,CAAZ;AACD;AACF;;AAED,SAAO;AAAE1Q,QAAF;AAAQuJ;AAAR,GAAP;AAED;;AAED,IAAI+E,kBAAJ;AAEe,yEAAU5P,EAAV,EAAc;AAC3B,QAAMkB,GAAG,GAAG,IAAInB,GAAJ,CAAQC,EAAR,CAAZ;AACA,MAAIC,WAAW,GAAG,CAAC,CAACD,EAAE,CAACE,OAAH,CAAW,iBAAX,CAApB;;AACA,MAAID,WAAJ,EAAiB;AACf;AACA4P,uDAAe;AACf3O,OAAG,CAACI,IAAJ;AACD,GAJD,MAIO;AACLsO,sBAAkB,GAAGC,mDAAe,EAApC;AACA3O,OAAG,CAACI,IAAJ,GAFK,CAGL;AACA;AACA;AACA;AACA;AACD;;AAED,SAAOJ,GAAP;AACD;;AAED,SAASyQ,aAAT,GAAyB;AACvBvV,MAAI,CAAC2H,IAAL,CAAU,oDAAV,EAAgE,aAAhE,EAA+E,+BAA/E,EAA+G,kBAA/G,EAAkI,iBAAlI,EAAoJ,uBAApJ;AACA1H,SAAO,CAAC0H,IAAR,CAAa,eAAb,EAA6B,UAA7B,EAAwC,WAAxC,EAAoD,eAApD,EAAoE,cAApE,EAAoF,6BAApF;AACE3H,MAAI,CAACmN,OAAL,CAAawG,IAAI,IAAI;AACnB,QAAIvY,4DAAM,CAACuY,IAAD,CAAV,EAAkB;AAChBvY,kEAAM,CAACuY,IAAD,CAAN,CAAajQ,YAAb,CAA0B,QAA1B,EAAoC,EAApC;AACD;AACF,GAJD;AAKAzD,SAAO,CAACkN,OAAR,CAAiB0I,KAAD,IAAW;AACzBzK,mEAAS,CAACyK,KAAD,CAAT,CAAiB1I,OAAjB,CAA0BwG,IAAD,IAAUA,IAAI,CAACjQ,YAAL,CAAkB,QAAlB,EAA4B,EAA5B,CAAnC;AACD,GAFD;AAIA0H,iEAAS,CAAC,mBAAD,CAAT,CAA+B+B,OAA/B,CAAwCwG,IAAD,IAAUA,IAAI,CAACjQ,YAAL,CAAkB,eAAlB,EAAmC,eAAnC,CAAjD;AACA,QAAMoS,UAAU,GAAG1a,4DAAM,CAAC,8BAAD,CAAzB;;AACA,MAAI0a,UAAJ,EAAgB;AACd;AACAA,cAAU,CAACpS,YAAX,CAAwB,eAAxB,EAAwC,cAAxC;AACD;;AAED,QAAMqS,sBAAsB,GAAG3a,4DAAM,CAAC,iBAAD,CAArC;;AACA,MAAI2a,sBAAJ,EAA4B;AAC1B;AACAA,0BAAsB,CAACrS,YAAvB,CAAoC,eAApC,EAAoD,cAApD;AACD;;AAEC,MAAIpC,QAAQ,GAAGhB,MAAM,CAACgB,QAAtB;AACA,MAAIsT,YAAY,GAAG,EAAnB;;AACA,MAAItT,QAAQ,CAACW,MAAT,CAAgBT,OAAhB,CAAwB,KAAxB,KAAkC,CAAC,CAAvC,EAA0C;AACvCoT,gBAAY,GAAG,OAAQrP,cAAc,CAACxC,OAAf,CAAuB,YAAvB,MAAyC,MAA1C,GAAoD,EAApD,GAAyD,gBAAgBwC,cAAc,CAACxC,OAAf,CAAuB,YAAvB,CAAhF,KACZwC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,MAA0C,MAA3C,GAAqD,EAArD,GAA0D,kBAAkBwC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CAD/D,KAEZwC,cAAc,CAACxC,OAAf,CAAuB,YAAvB,MAAyC,MAA1C,GAAoD,EAApD,GAAyD,iBAAiBwC,cAAc,CAACxC,OAAf,CAAuB,YAAvB,CAF7D,KAGZwC,cAAc,CAACxC,OAAf,CAAuB,cAAvB,MAA2C,MAA5C,GAAsD,EAAtD,GAA2D,mBAAmBwC,cAAc,CAACxC,OAAf,CAAuB,cAAvB,CAHjE,KAIZwC,cAAc,CAACxC,OAAf,CAAuB,SAAvB,MAAsC,MAAvC,GAAiD,EAAjD,GAAsD,cAAcwC,cAAc,CAACxC,OAAf,CAAuB,SAAvB,CAJvD,CAAf;AAKD,GANF,MAMQ;AACJ6R,gBAAY,GAAG,OAAQrP,cAAc,CAACxC,OAAf,CAAuB,SAAvB,MAAsC,MAAvC,GAAiD,EAAjD,GAAsD,aAAawC,cAAc,CAACxC,OAAf,CAAuB,SAAvB,CAA1E,CAAf;AACF;;AACFqI,iEAAS,CAAC,4BAAD,CAAT,CAAwC+B,OAAxC,CAAgDb,CAAC,IAAI;AACnD,QAAI0J,IAAI,GAAG1J,CAAC,CAAC/K,IAAb;AACA+K,KAAC,CAAC7B,gBAAF,CAAmB,OAAnB,EAA2B,YAAU;AACnC6B,OAAC,CAAC/K,IAAF,GAASyU,IAAI,IAAKpB,YAAY,CAACvJ,MAAb,IAAuB,CAAxB,GAA6B,EAA7B,GAAkCuJ,YAAtC,CAAb;AACD,KAFD;AAGD,GALD;;AAMA,MAAGxZ,4DAAM,CAAC,wBAAD,CAAT,EAAoC;AAClC0K,6DAAG,CAACpD,mDAAM,CAACmC,WAAP,CAAmB9D,OAAnB,CAA2BgF,OAA3B,CAAmC,KAAnC,YAA6C3K,4DAAM,CAAC,wBAAD,CAAN,CAAiC4K,OAAjC,CAAyCC,GAAtF,6CAAD,CAAH,CACC3D,IADD,CACOkL,IAAD,IAAU;AACZ1M,mBAAa,CAAC0M,IAAD,CAAb;;AAEA,UAAIA,IAAI,CAAC5K,GAAL,CAAS8F,UAAb,EAAyB;AACvB/C,0DAAO,CAACgD,OAAR,CAAgB,cAAhB,EAAgC6E,IAAhC;AACD,OAFD,MAEO;AACL7H,0DAAO,CAACgD,OAAR,CAAgB,iBAAhB,EAAmC6E,IAAnC;AACD;AACJ,KATD;AAUD;;AACDpS,8DAAM,CAAC,gBAAD,CAAN,CAAyBgM,KAAzB,CAA+B6O,QAA/B,GAA0C,QAA1C;;AAEA3V,QAAM,CAAC4V,QAAP,GAAkB,MAAM;AACtB9a,gEAAM,CAAC,gBAAD,CAAN,CAAyBkP,eAAzB,CAAyC,OAAzC;AACAlP,gEAAM,CAAC,oBAAD,CAAN,CAA6BkP,eAA7B,CAA6C,OAA7C;AACD,GAHD;;AAKC6L,YAAU,CAAC,8BAAD,CAAV,CAA2C7T,IAA3C,CAAgDwP,GAAG,IAAIA,GAAG,CAACpO,YAAJ,CAAiB,QAAjB,EAA2B,EAA3B,CAAvD;AAEN;;AAED,SAASxD,QAAT,GAAoB;AAClB,MAAIsS,GAAG,GAAG,IAAI4D,GAAJ,CAAQ9V,MAAM,CAACgB,QAAP,CAAgBC,IAAxB,CAAV;AACA,MAAI8U,MAAM,GAAG7D,GAAG,CAAC8D,YAAJ,CAAiBxQ,GAAjB,CAAqB,YAArB,CAAb;AACA,MAAIyQ,QAAQ,GAAG/D,GAAG,CAAC8D,YAAJ,CAAiBxQ,GAAjB,CAAqB,cAArB,CAAf;AACA,MAAIiO,OAAO,GAAGvB,GAAG,CAAC8D,YAAJ,CAAiBxQ,GAAjB,CAAqB,aAArB,CAAd;AACA,MAAI0Q,MAAM,GAAGhE,GAAG,CAAC8D,YAAJ,CAAiBxQ,GAAjB,CAAqB,YAArB,CAAb;AACA,MAAI6K,OAAO,GAAG6B,GAAG,CAAC8D,YAAJ,CAAiBxQ,GAAjB,CAAqB,SAArB,CAAd;AACAP,gBAAc,CAACyB,OAAf,CAAuB,YAAvB,EAAoCqP,MAApC;AACA9Q,gBAAc,CAACyB,OAAf,CAAuB,cAAvB,EAAsCuP,QAAtC;AACAhR,gBAAc,CAACyB,OAAf,CAAuB,aAAvB,EAAqC+M,OAArC;AACAxO,gBAAc,CAACyB,OAAf,CAAuB,YAAvB,EAAoCwP,MAApC;AACAjR,gBAAc,CAACyB,OAAf,CAAuB,SAAvB,EAAiC2J,OAAjC;AAEA3Q,MAAI,CAAC2H,IAAL,CAAU,eAAV,EAA2B,WAA3B,EAAwC,YAAxC,EAAqD,oBAArD,EAA2E,aAA3E,EAA0F,cAA1F,EAA0G,YAA1G;AACA1H,SAAO,CAAC0H,IAAR,CAAa,mBAAb,EAAiC,kBAAjC;AACA0N,qBAAmB;;AACnB,MAAI1E,OAAO,IAAIA,OAAO,KAAK,MAA3B,EAAkC;AAEhC4E,iBAAa;AAEbna,gEAAM,CAAC,SAAD,CAAN,CAAkBgM,KAAlB,CAAwBmB,MAAxB,GAAiC,MAAjC;AACAnN,gEAAM,CAAC,SAAD,CAAN,CAAkBgM,KAAlB,CAAwBqP,SAAxB,GAAoC,GAApC;AACArb,gEAAM,CAAC,cAAD,CAAN,CAAuBsb,GAAvB,GAA6B,QAA7B;;AAEA,QAAGtb,4DAAM,CAAC,mBAAD,CAAT,EAA+B;AAC7BA,kEAAM,CAAC,mBAAD,CAAN,CAA4BgM,KAA5B,CAAkCqP,SAAlC,GAA8C,GAA9C;AACD;;AAED,QAAIE,QAAQ,GAAIvb,4DAAM,CAAC,+BAAD,CAAtB;AACAub,YAAQ,CAACpH,UAAT,CAAoBqH,MAApB,CAA2B,GAAGD,QAAQ,CAACE,QAAvC;AACAF,YAAQ,CAACpH,UAAT,CAAoBuH,WAApB,CAAgCH,QAAhC;AAEAA,YAAQ,GAAIvb,4DAAM,CAAC,+CAAD,CAAlB;AACAub,YAAQ,CAACpH,UAAT,CAAoBwH,OAApB,CAA4B,GAAGJ,QAAQ,CAACE,QAAxC;AACAF,YAAQ,CAACjT,YAAT,CAAsB,QAAtB,EAA+B,EAA/B;AACAiT,YAAQ,CAACrM,eAAT,CAAyB,MAAzB;AACD;AAEF;;AACD,SAAS+K,mBAAT,GAA+B;AAC7B,QAAM2B,cAAc,GAAG5b,4DAAM,CAAC,yBAAD,CAA7B;;AACA,MAAG4b,cAAH,EAAmB;AACjB,UAAMC,aAAa,GAAG7b,4DAAM,CAAC4b,cAAc,CAACzT,YAAf,CAA4B,MAA5B,CAAD,CAA5B;;AACA,QAAG,CAAC0T,aAAJ,EAAmB;AACjBD,oBAAc,CAACtT,YAAf,CAA4B,QAA5B,EAAsC,EAAtC;AACD;AACF;AACF;;AAED,SAASyS,UAAT,CAAoBe,QAApB,EAA8B;AAC5B,SAAO,IAAI/D,OAAJ,CAAYC,OAAO,IAAI;AAC1B,QAAIhY,4DAAM,CAAC8b,QAAD,CAAV,EAAsB;AAClB,aAAO9D,OAAO,CAAChY,4DAAM,CAAC8b,QAAD,CAAP,CAAd;AACH;;AAED,UAAMC,QAAQ,GAAG,IAAIC,gBAAJ,CAAqBC,SAAS,IAAI;AAC/C,UAAIjc,4DAAM,CAAC8b,QAAD,CAAV,EAAsB;AAClB9D,eAAO,CAAChY,4DAAM,CAAC8b,QAAD,CAAP,CAAP;AACAC,gBAAQ,CAACG,UAAT;AACH;AACJ,KALgB,CAAjB;AAOAH,YAAQ,CAACI,OAAT,CAAiB9V,QAAQ,CAACwK,IAA1B,EAAgC;AAC5BuL,eAAS,EAAE,IADiB;AAE5BC,aAAO,EAAE;AAFmB,KAAhC;AAIH,GAhBM,CAAP;AAiBD;;AAED,SAAStX,0BAAT,GAAsC;AACpC,QAAMuX,wBAAwB,GAAGtc,4DAAM,CAAC,8BAAD,CAAN,IAA0C,IAA3E;;AACA,MAAGsc,wBAAH,EAA6B;AAC3BC,0DAAK,CAACC,IAAN,CAAW;AACTC,UAAI,EAAEzc,4DAAM,CAAC,8BAAD,CAAN,CAAuCiI,SADpC;AAETyU,UAAI,EAAE,QAFG;AAGTC,eAAS,EAAE,oBAHF;AAITC,YAAM,EAAE,IAJC;AAKTC,iBAAW,EAAE,IALJ;AAMTC,gBAAU,EAAE,IANH;AAOTC,WAAK,EAAE,IAPE;AAQTC,gBAAU,EAAE;AARH,KAAX;AAUD;AACF,C;;;;;;;;;;;;;;;;;;;;;;;;;;ACniCD;;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA,SAASC,mBAAT,CAA6B3a,GAA7B,EAAkCwT,KAAlC,EAAyCjW,QAAzC,EAAmD;AACjD,QAAMqd,KAAK,GAAGD,mBAAmB,CAAC3a,GAAD,CAAjC;AACA,MAAI4a,KAAJ,EAAWC,YAAY,CAACD,KAAD,CAAZ;AACXD,qBAAmB,CAAC3a,GAAD,CAAnB,GAA2BoV,UAAU,CAAC7X,QAAD,EAAWiW,KAAX,CAArC;AACD;;AAED,IAAIsH,eAAJ;;AACA,MAAMC,oBAAoB,GAAI5E,GAAD,IAASA,GAAG,GAAG2E,eAA5C;;AAEA,MAAM;AAAEzY,cAAF;AAAgB1B;AAAhB,IAA6BC,mEAAM,CAAC;AAAEC,MAAI,EAAE,CAAR;AAAWE,WAAS,EAAE,GAAtB;AAA2BE,SAAO,EAAE;AAApC,CAAD,CAAzC;;AAEA,MAAM+Z,gBAAgB,GAAG,UAACC,SAAD,QAAwD;AAAA,MAA5C;AAAE9E,OAAF;AAAO+E;AAAP,GAA4C;AAAA,MAAvBC,WAAuB,uEAAT,IAAS;AAC/E,MAAIA,WAAW,IAAIhF,GAAG,KAAK+E,UAA3B,EAAuCD,SAAS,CAAChU,SAAV,CAAoBwD,MAApB,CAA2B,yCAA3B,EAAvC,KACK,IAAI,CAAC0Q,WAAD,IAAgBhF,GAAG,KAAK+E,UAA5B,EAAwCD,SAAS,CAAChU,SAAV,CAAoBC,GAApB,CAAwB,yCAAxB,EAFkC,CAI/E;;AACAiH,WAAS,CAACiN,EAAV,CAAaH,SAAb,EAAwBta,QAAQ,GAAG,IAAnC,EAAyC;AAAE0a,KAAC,EAAEN,oBAAoB,CAAC5E,GAAD,CAAzB;AAAgCmF,QAAI,EAAEjZ;AAAtC,GAAzC;AACAsY,qBAAmB,CAAC,kBAAD,EAAqBha,QAAQ,GAAG,CAAX,GAAe,CAApC,EAAuC,MAAM;AAC9D,QAAIwa,WAAJ,EAAiBF,SAAS,CAAChU,SAAV,CAAoBsU,MAApB,CAA2B,yCAA3B,EAAsEpF,GAAG,KAAK+E,UAA9E;AAClB,GAFkB,CAAnB;AAGD,CATD;;AAWA,MAAMM,2BAA2B,mRAAjC;;AAUA,MAAMC,WAAW,GAAG,MAAM;AACxB,QAAMC,IAAI,GAAGhe,4DAAM,CAAC,sBAAD,CAAnB;AACA,QAAMie,MAAM,GAAGje,4DAAM,CAAC,kBAAD,CAArB;AACA,QAAMud,SAAS,GAAGvd,4DAAM,CAAC,oBAAD,CAAxB;AACA,QAAMke,qBAAqB,GAAGle,4DAAM,CAAC,4CAAD,EAA+Cge,IAA/C,CAApC;AACA,MAAIG,WAAJ;;AACA,MAAID,qBAAJ,EAA2B;AACzB,UAAME,0BAA0B,GAAGF,qBAAqB,CAACG,SAAtB,CAAgC,IAAhC,CAAnC;AACAd,aAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEe,YAAX,CAAwBF,0BAAxB,EAAoDb,SAAS,CAACgB,UAA9D;AACAhB,aAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAEnP,kBAAX,CAA8B,YAA9B,EAA4C0P,2BAA5C;AACAI,yBAAqB,CAAC5V,YAAtB,CAAmC,aAAnC,EAAkD,MAAlD;AACA4V,yBAAqB,CAAC5V,YAAtB,CAAmC,QAAnC,EAA6C,EAA7C;AACA6V,eAAW,GAAGK,sBAAsB,CAAC;AAAER,UAAF;AAAQS,cAAQ,EAAEL;AAAlB,KAAD,CAApC;AACD;;AACD,MAAIH,MAAJ,EAAY;AACVV,aAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAE3T,WAAX,CAAuBqU,MAAvB;AACAS,8DAAO,CAACnR,OAAR,CAAgB,SAAhB,EAA2BgQ,SAA3B;AACD;;AAEDH,iBAAe,GAAGlY,MAAM,CAACyZ,OAAP,IAAkBpB,SAAS,CAACqB,qBAAV,GAAkCnG,GAAlC,IAAyC,CAA3D,CAAlB;AACA,QAAMoG,UAAU,GAAGzB,eAAe,GAAG,EAArC;AACA,QAAMI,UAAU,GAAG,EAAnB;AACAF,kBAAgB,CAACC,SAAD,EAAY;AAAE9E,OAAG,EAAE2E,eAAP;AAAwBI;AAAxB,GAAZ,CAAhB;AAEA,QAAMsB,OAAO,GAAG,IAAIC,gEAAJ,CAAgBxB,SAAhB,EAA2B,SAAkD;AAAA,QAAjD;AAAEyB,YAAF;AAAUC,cAAQ,EAAE,GAAGC,EAAH,CAApB;AAA4BC,WAAK,EAAE,GAAGC,EAAH;AAAnC,KAAiD;AAC3F,UAAMC,QAAQ,GAAG9B,SAAS,CAACqB,qBAAV,GAAkCnG,GAAlC,GAAwC2G,EAAzD;AACA,UAAME,UAAU,GAAGD,QAAQ,GAAG,CAACR,UAAU,GAAGrB,UAAd,IAA4B,CAA1D;AAEA,QAAID,SAAS,CAACgC,SAAd,EAAyB,OAJkE,CAI1D;;AACjC,QAAI,EAAEF,QAAQ,GAAGR,UAAX,IAAyBQ,QAAQ,GAAG7B,UAAtC,CAAJ,EAAuD;AACvD,QAAIwB,MAAJ,EAAYvO,SAAS,CAAC+O,GAAV,CAAcjC,SAAd,EAAyB;AAAEI,OAAC,EAAEN,oBAAoB,CAACgC,QAAD,CAAzB;AAAqCI,qBAAe,EAAE;AAAtD,KAAzB,EAAZ,KACK,IAAIP,EAAE,IAAI,CAAC,EAAX,EAAe5B,gBAAgB,CAACC,SAAD,EAAY;AAAE9E,SAAG,EAAE+E,UAAP;AAAmBA;AAAnB,KAAZ,CAAhB,CAAf,KACA,IAAI0B,EAAE,IAAI,EAAV,EAAc5B,gBAAgB,CAACC,SAAD,EAAY;AAAE9E,SAAG,EAAE2E,eAAP;AAAwBI;AAAxB,KAAZ,CAAhB,CAAd,KACA,IAAI8B,UAAU,IAAID,QAAQ,IAAI,KAAK7B,UAAnC,EAA+CF,gBAAgB,CAACC,SAAD,EAAY;AAAE9E,SAAG,EAAE+E,UAAP;AAAmBA;AAAnB,KAAZ,EAA6C,KAA7C,CAAhB,CAA/C,KACA,IAAI,CAAC8B,UAAD,IAAeD,QAAQ,IAAI,CAAC,EAAD,GAAMjC,eAArC,EAAsDE,gBAAgB,CAACC,SAAD,EAAY;AAAE9E,SAAG,EAAE2E,eAAP;AAAwBI;AAAxB,KAAZ,EAAkD,KAAlD,CAAhB,CAAtD,KACAF,gBAAgB,CAACC,SAAD,EAAY;AAAE9E,SAAG,EAAEyG,EAAE,IAAI,CAAN,GAAU9B,eAAV,GAA4BI,UAAnC;AAA+CA;AAA/C,KAAZ,CAAhB;AACN,GAZe,EAYb;AAAEkC,WAAO,EAAE;AAAEC,WAAK,EAAE,IAAT;AAAeC,WAAK,EAAE;AAAtB;AAAX,GAZa,CAAhB;;AAeA,QAAMC,QAAQ,GAAG,CAAC,MAAM;AACtB,UAAMC,aAAa,GAAG9f,4DAAM,CAAC,2BAAD,CAA5B;AACA,UAAM+f,eAAe,GAAG7a,MAAM,CAACyZ,OAAP,IAAkBmB,aAAa,CAAClB,qBAAd,GAAsCnG,GAAtC,IAA6C,CAA/D,CAAxB;AACA,UAAMuH,YAAY,GAAIF,aAAa,CAACE,YAAd,GAA6BF,aAAa,CAAClB,qBAAd,GAAsCzR,MAAzF;AACA,QAAI8S,cAAc,GAAG,KAArB;AAEAH,iBAAa,CAACzQ,gBAAd,CAA+B,QAA/B,EAAyC,MAAM;AAC7C,YAAM;AAAEoJ,WAAF;AAAOtL;AAAP,UAAkB2S,aAAa,CAAClB,qBAAd,EAAxB;AACA,YAAMS,QAAQ,GAAG5G,GAAG,GAAGsH,eAAvB;;AACA,UAAIV,QAAQ,GAAG,CAAX,IAAgBS,aAAa,CAACP,SAAlC,EAA6C;AAC3C9a,eAAO,CAACC,GAAR,CAAY,qBAAZ;AACA+L,iBAAS,CAAC+O,GAAV,CAAcM,aAAd,EAA6B;AAAEI,kBAAQ,EAAE;AAAZ,SAA7B;AACAD,sBAAc,GAAG,IAAjB;AACD;AACF,KARD;AAUA,WAAO,IAAIlB,gEAAJ,CAAgBe,aAAhB,EAA+B,SAA0E;AAAA,UAAzE;AAAEd,cAAF;AAAUC,gBAAQ,EAAE,GAAGC,EAAH,CAApB;AAA4BC,aAAK,EAAE,GAAGC,EAAH,CAAnC;AAA2Ce,iBAAS,EAAE,GAAEA,SAAF;AAAtD,OAAyE;AAC9G,YAAM;AAAE1H,WAAF;AAAOtL;AAAP,UAAkB2S,aAAa,CAAClB,qBAAd,EAAxB;AACA,YAAMS,QAAQ,GAAG5G,GAAG,GAAG2G,EAAN,GAAWW,eAA5B;AAGA,UAAII,SAAS,GAAG,CAAZ,IAAiB,CAACL,aAAa,CAACP,SAApC,EAA+C;AAC/C,UAAIY,SAAS,GAAG,CAAZ,IAAiBL,aAAa,CAACP,SAAd,IAA2BS,YAAhD,EAA8D;AAC9D,UAAI,CAACC,cAAD,IAAmBH,aAAa,CAACP,SAAjC,IAA8CO,aAAa,CAACP,SAAd,GAA0BS,YAA5E,EAA0F,OAPoB,CAOZ;;AAElG,UAAIhB,MAAJ,EAAY;AACVvO,iBAAS,CAAC+O,GAAV,CAAcM,aAAd,EAA6B;AAAEnC,WAAC,EAAE0B,QAAL;AAAeI,yBAAe,EAAE;AAAhC,SAA7B;AACD,OAFD,MAGK;AACHhP,iBAAS,CAAC+O,GAAV,CAAcM,aAAd,EAA6B;AAAEI,kBAAQ,EAAE,IAAZ;AAAkBT,yBAAe,EAAE;AAAnC,SAA7B;AACAhP,iBAAS,CAACiN,EAAV,CAAaoC,aAAb,EAA4B7c,QAAQ,GAAG,IAAvC,EAA6C;AAAE0a,WAAC,EAAE,CAAL;AAAQC,cAAI,EAAEjZ;AAAd,SAA7C;AACA,YAAI,CAACsb,cAAD,IAAmBf,EAAE,IAAI,CAAC,EAA9B,EAAkC5B,gBAAgB,CAACC,SAAD,EAAY;AAAE9E,aAAG,EAAE+E,UAAP;AAAmBA;AAAnB,SAAZ,CAAhB;AAClCyC,sBAAc,GAAG,KAAjB;AACD;AACF,KAlBM,EAkBJ;AAAEP,aAAO,EAAE;AAAEC,aAAK,EAAE,IAAT;AAAeC,aAAK,EAAE;AAAtB;AAAX,KAlBI,CAAP;AAmBD,GAnCgB,GAAjB;;AAqCA,SAAO,MAAM;AACX,QAAI1B,qBAAJ,EAA2B;AAAA;;AACzBle,kEAAM,CAAC,2BAAD,EAA8Bud,SAA9B,CAAN,CAA+CxQ,MAA/C;AACA/M,kEAAM,CAAC,iCAAD,EAAoCud,SAApC,CAAN,CAAqDxQ,MAArD;AACAmR,2BAAqB,CAAChP,eAAtB,CAAsC,aAAtC;AACAgP,2BAAqB,CAAChP,eAAtB,CAAsC,QAAtC;AACA,sBAAAiP,WAAW,UAAX;AACD;;AACD,QAAIF,MAAJ,EAAY;AACV5X,cAAQ,CAACwK,IAAT,CAAcyN,YAAd,CAA2BL,MAA3B,EAAmCje,4DAAM,CAAC,OAAD,CAAN,CAAgBogB,WAAnD;AACA1B,gEAAO,CAACnR,OAAR,CAAgB,SAAhB,EAA2BgQ,SAA3B;AACD;;AACDuB,WAAO,CAACzL,OAAR;AACAwM,YAAQ,CAACxM,OAAT;AACD,GAdD;AAeD,CA3FD;;AA6FA,SAASvJ,IAAT,GAAgB;AACd,QAAMiG,QAAQ,GAAG,MAAMsQ,yDAAK,OAAO,QAAnC;;AACA5b,SAAO,CAACC,GAAR,CAAY;AAAEqL,YAAQ,EAAEA,QAAQ;AAApB,GAAZ;AACA,MAAIuQ,MAAM,GAAGvQ,QAAQ,KAAKgO,WAAW,EAAhB,GAAqBwC,QAA1C;AAEA7B,4DAAO,CAAClU,SAAR,CAAkB,oBAAlB,EAAwC,MAAM;AAAA;;AAC5C,eAAA8V,MAAM,UAAN;AACAA,UAAM,GAAGvQ,QAAQ,KAAKgO,WAAW,EAAhB,GAAqBwC,QAAtC;AACD,GAHD;AAKA,SAAOD,MAAP;AACD;;AAGD;;AAGA,MAAM9B,sBAAsB,GAAG,SAAwB;AAAA,MAAvB;AAAER,QAAF;AAAQS;AAAR,GAAuB;AACrDT,MAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEzU,SAAN,CAAgBC,GAAhB,CAAoB,SAApB;AACAnD,UAAQ,CAACwK,IAAT,CAActH,SAAd,CAAwBC,GAAxB,CAA4B,SAA5B;AACA,QAAMgX,SAAS,GAAGxgB,4DAAM,CAAC,uBAAD,EAA0Bge,IAA1B,CAAxB;AACA,QAAMyC,QAAQ,GAAGzgB,4DAAM,CAAC,wBAAD,EAA2Bye,QAA3B,CAAvB;AACA,QAAMiC,SAAS,GAAG1gB,4DAAM,CAAC,wBAAD,EAA2Bye,QAA3B,CAAxB;AACA,QAAMkC,UAAU,GAAG3gB,4DAAM,CAAC,6BAAD,EAAgCye,QAAhC,CAAzB;AACA,QAAMmC,MAAM,GAAG5gB,4DAAM,CAAC,iCAAD,EAAoCye,QAApC,CAArB;AACA,QAAMoC,SAAS,GAAG7gB,4DAAM,CAAC,4BAAD,CAAxB;AACA6gB,WAAS,CAACvY,YAAV,CAAuB,QAAvB,EAAiC,EAAjC;AACAkY,WAAS,CAACjX,SAAV,CAAoBC,GAApB,CAAwB,0BAAxB;AACAgX,WAAS,CAACjX,SAAV,CAAoBwD,MAApB,CAA2B,sBAA3B,EAAmD,oBAAnD;AACA0T,UAAQ,CAACnC,YAAT,CAAsBsC,MAAtB,EAA8BF,SAAS,CAACN,WAAxC;AACAK,UAAQ,CAACnC,YAAT,CAAsBqC,UAAtB,EAAkCC,MAAM,CAACR,WAAzC;AACAO,YAAU,CAAC1Y,SAAX,oFAA6F0Y,UAAU,CAACG,SAAxG;AACA9Q,iEAAS,CAAC,+BAAD,EAAkC0Q,SAAlC,CAAT,CAAsDK,OAAtD,GAAgEhP,OAAhE,CAAyEiP,CAAD,IAAOL,UAAU,CAACrC,YAAX,CAAwB0C,CAAxB,EAA2BL,UAAU,CAACpC,UAAtC,CAA/E;AACA,SAAO,MAAM;AACXP,QAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEzU,SAAN,CAAgBwD,MAAhB,CAAuB,SAAvB;AACA1G,YAAQ,CAACwK,IAAT,CAActH,SAAd,CAAwBwD,MAAxB,CAA+B,SAA/B;AACAyT,aAAS,CAACjX,SAAV,CAAoBwD,MAApB,CAA2B,0BAA3B;AACAyT,aAAS,CAACjX,SAAV,CAAoBC,GAApB,CAAwB,sBAAxB,EAAgD,oBAAhD;AACAqX,aAAS,CAAC3R,eAAV,CAA0B,QAA1B;AACD,GAND;AAOD,CAvBD,C;;;;;;;;;;;;;;;;;;;;;;;ACvJA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAI+R,iBAAJ;AACA,IAAIC,gBAAgB,GAAG,EAAvB;AACA,IAAIC,mBAAJ;AACA,IAAIC,qBAAqB,GAAG,EAA5B;AACA,IAAIC,WAAW,GAAE,EAAjB;AACA,IAAI7P,eAAe,GAAG,EAAtB;;AAEA,MAAM8P,WAAN,CAAkB;AAChBC,aAAW,GAAG;AACZ,SAAKjO,OAAL,GAAe,EAAf;AACA,SAAKkO,cAAL,GAAsB,IAAtB;AACA,SAAKC,kBAAL,GAA0B,IAA1B;AACA,SAAKC,WAAL,GAAmB,IAAnB;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,qBAAL,GAA6B,CAA7B;AACA,SAAKP,WAAL,GAAmB,EAAnB;AACD;;AAEDvX,MAAI,GAAG;AACL,QAAIxC,mDAAM,CAAC4B,OAAP,CAAewI,WAAf,OAAiC,IAAjC,IAAyCpK,mDAAM,CAAC4B,OAAP,CAAewI,WAAf,OAAiC,IAA9E,EAAoF;AAClFmQ,wDAAA,WAAW3c,MAAM,CAACoC,MAAP,CAAcmC,WAAd,CAA0BqY,wBAArC,GAAiE5a,IAAjE,CAAuE6a,GAAD,IAAS;AAC7EV,mBAAW,GAAGU,GAAG,CAACC,GAAlB;AACAxQ,uBAAe,GAAGuQ,GAAG,CAACE,QAAtB;AACA,aAAKC,gBAAL;AACA,aAAKC,SAAL,CAAe7a,mDAAM,CAAC8a,aAAP,CAAqBC,UAApC;AACD,OALD;AAMD,KAPD,MAOO;AACL,WAAKC,gBAAL;AACA,WAAKH,SAAL,CAAe7a,mDAAM,CAAC8a,aAAP,CAAqBG,wBAApC;AACD;;AAEDrd,UAAM,CAACmB,QAAP,CAAgBgK,KAAhB,CAAsB9D,IAAtB,CAA2B,WAA3B,EAAwC;AACtCG,gBAAU,EAAGvC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CADyB;AAEtC8E,iBAAW,EAAE,WAFyB;AAGtCE,WAAK,EAAE;AAH+B,KAAxC;AAKA,SAAK8U,kBAAL,GAA0BzR,gEAAS,CAAC,uBAAD,CAAnC;AAEA9K,UAAM,CAACmK,gBAAP,CAAwB,OAAxB,EAAiC,KAAKmT,oBAAtC;AACD;;AACDL,WAAS,CAACM,UAAD,EAAa;AACpBlG,0DAAK,CAACC,IAAN,CAAW;AACTC,UAAI,EAAE,KAAK+E,cADF;AAET7E,eAAS,EAAE,2CAFF;AAGTI,WAAK,EAAE,IAHE;AAITL,UAAI,EAAE,QAJG;AAKTgG,WAAK,EAAED,UALE;AAMT7F,YAAM,EAAE,IANC;AAOTE,gBAAU,EAAE,IAPH;AAQTD,iBAAW,EAAE,IARJ;AASTG,gBAAU,EAAE;AATH,KAAX,EAUG9V,IAVH,CAUQ,MAAM;AACZ,WAAKwa,WAAL,GAAmB1R,gEAAS,CAAC,iBAAD,CAA5B;AACA,WAAK2S,eAAL;AACApY,wDAAO,CAACC,SAAR,CAAkB,oBAAlB,EAAwCoY,oBAAxC;AACArY,wDAAO,CAACC,SAAR,CAAkB,cAAlB,EAAkCqY,cAAlC;AACA,YAAMC,eAAe,GAAG9iB,6DAAM,CAAC,yBAAD,CAA9B;AACA,YAAM+iB,kBAAkB,GAAG/iB,6DAAM,CAAC,uBAAD,CAAjC;AACA,YAAMgjB,YAAY,GAAGhjB,6DAAM,CAAC,gBAAD,CAA3B;AACA,YAAMijB,UAAU,GAAGjjB,6DAAM,CAAC,aAAD,CAAzB;AACA,YAAMkjB,UAAU,GAAGljB,6DAAM,CAAC,qBAAD,CAAzB;;AACA,UAAIgjB,YAAJ,EAAkB;AAChBA,oBAAY,CAAC3T,gBAAb,CAA8B,OAA9B,EAAuC,KAAK8T,SAA5C;AACAF,kBAAU,CAAC5T,gBAAX,CAA4B,UAA5B,EAAwC,KAAK+T,UAA7C;AACD;;AACD,UAAIJ,YAAY,IAAI1b,mDAAM,CAAC4B,OAAP,CAAewI,WAAf,MAAgC,IAApD,EAA0D;AACxDwR,kBAAU,CAAC7T,gBAAX,CAA4B,UAA5B,EAAwC,KAAKgU,UAA7C;AACAH,kBAAU,CAAC7T,gBAAX,CAA4B,SAA5B,EAAuC,KAAKiU,aAA5C;AACD;;AACDR,qBAAe,GAAGA,eAAe,CAACS,sBAAhB,CAAuCha,SAAvC,CAAiDC,GAAjD,CAAqD,mBAArD,CAAH,GAA+EuZ,kBAAkB,CAACQ,sBAAnB,CAA0Cha,SAA1C,CAAoDC,GAApD,CAAwD,mBAAxD,CAA9F;AACD,KA7BD;AA8BD;;AACDmZ,iBAAe,GAAG;AAChB,UAAMzM,IAAI,GAAGlW,6DAAM,CAAC,eAAD,CAAnB;;AACA,QAAIkW,IAAJ,EAAU;AACRA,UAAI,CAAC7G,gBAAL,CAAsB,QAAtB,EAAgCmU,YAAhC;AACA,YAAMV,eAAe,GAAG9iB,6DAAM,CAAC,yBAAD,EAA4BqG,QAAQ,CAACwK,IAArC,CAA9B;AACA,YAAM4S,aAAa,GAAGzjB,6DAAM,CAAC,iBAAD,EAAoB8iB,eAApB,CAA5B;AACAW,mBAAa,CAACpU,gBAAd,CAA+B,OAA/B,EAAwC,KAAKqU,UAA7C;AACD;AACF;;AAEDP,WAAS,GAAG;AACV,UAAMQ,aAAa,GAAG3jB,6DAAM,CAAC,gBAAD,CAA5B;;AAEA,QAAI2jB,aAAJ,EAAmB;AACjB,YAAMC,kBAAkB,GAAG5jB,6DAAM,CAAC,wBAAD,CAAjC;AACA,YAAM6jB,QAAQ,GAAG7jB,6DAAM,CAAC,sBAAD,CAAvB;AACA,YAAM8jB,SAAS,GAAGH,aAAa,CAACI,OAAhC,CAHiB,CAKjB;;AACA,UAAI,CAAC,KAAKnC,qBAAV,EAAiC;AAC/BgC,0BAAkB,CAAC1U,eAAnB,CAAmC,QAAnC;AACA,aAAK0S,qBAAL,GAA6BgC,kBAAkB,CAACpT,YAAhD;AACAoT,0BAAkB,CAAC5X,KAAnB,CAAyBmB,MAAzB,GAAkC,CAAlC;AACD;;AAED,UAAI2W,SAAJ,EAAe;AACbH,qBAAa,CAACzU,eAAd,CAA8B,UAA9B;AACAgD,yEAAY,CAAC2R,QAAD,CAAZ;AACD,OAHD,MAGO;AACLA,gBAAQ,CAAC3U,eAAT,CAAyB,UAAzB;AACAgD,yEAAY,CAACyR,aAAD,CAAZ;AACD,OAlBgB,CAoBjB;;;AACAlT,eAAS,CAACC,MAAV,CAAiBkT,kBAAjB,EAAsCE,SAAS,GAAG,CAAH,GAAO,EAAtD,EACE;AAAEE,iBAAS,EAAEF,SAAS,GAAG,CAAH,GAAO,EAA7B;AAAiC3W,cAAM,EAAE2W,SAAS,GAAG,CAAH,GAAO,KAAKlC;AAA9D,OADF,EAEE;AAAEoC,iBAAS,EAAEF,SAAS,GAAG,CAAH,GAAO,EAA7B;AAAiC3W,cAAM,EAAE2W,SAAS,GAAG,KAAKlC,qBAAR,GAAgC;AAAlF,OAFF;AAID;AACF;;AAEDwB,YAAU,CAAClS,CAAD,EAAI;AACZ,UAAM+R,UAAU,GAAG/R,CAAC,CAACuE,MAArB;AACA,UAAMyN,UAAU,GAAGljB,6DAAM,CAAC,qBAAD,CAAzB;AACAikB,mBAAe,CAAChB,UAAD,EAAaC,UAAb,CAAf;AACD;;AAEDG,YAAU,CAACnS,CAAD,EAAI;AACZ,UAAMgS,UAAU,GAAGhS,CAAC,CAACuE,MAArB;AACA,UAAMwN,UAAU,GAAGjjB,6DAAM,CAAC,aAAD,CAAzB;AACAikB,mBAAe,CAACf,UAAD,EAAaD,UAAb,CAAf;AACD;;AAEDK,eAAa,CAACpS,CAAD,EAAI;AACf,UAAMgS,UAAU,GAAGhS,CAAC,CAACuE,MAArB;AACAyN,cAAU,CAACgB,iBAAX,CAA6B,EAA7B;AACD;;AAED5B,kBAAgB,GAAG;AAEjB,QAAI6B,cAAc,GAAG,EAArB;AACA,QAAIC,SAAS,GAAG,EAAhB;AACA,QAAIC,WAAW,GAAG,QAAQ/c,mDAAM,CAAC8a,aAAP,CAAqBkC,WAA7B,SAAlB;;AACA,QAAIhd,mDAAM,CAAC4B,OAAP,KAAmB,IAAvB,EAA6B;AAC3Bkb,eAAS,GAAG,oTAGmD9c,mDAAM,CAAC8a,aAAP,CAAqBmC,yBAHxE,kCAINF,WAJM,qBAAZ;AAMD;;AACD,QAAIla,cAAc,CAACxC,OAAf,CAAuB,uBAAvB,KAAmD,MAAvD,EAA+D;AAC7D,UAAIwC,cAAc,CAACxC,OAAf,CAAuB,eAAvB,CAAJ,EAA6C;AAC5Cwc,sBAAc,GAAGha,cAAc,CAACxC,OAAf,CAAuB,eAAvB,CAAjB;AACC;;AACF,UAAIL,mDAAM,CAAC4B,OAAP,KAAmB,IAAvB,EAA6B;AAC7Bkb,iBAAS,aAAIC,WAAJ,CAAT;AACC;AACF;;AAED,SAAK7C,cAAL,GACE,sFACwEla,mDAAM,CAAC8a,aAAP,CAAqBoC,eAD7F,qHAE4Fld,mDAAM,CAACmC,WAAP,CAAmBgb,QAF/G,wFAGmEnd,mDAAM,CAAC8a,aAAP,CAAqBC,UAHxF,8EAIwD/a,mDAAM,CAAC8a,aAAP,CAAqBsC,gBAJ7E,oOAO2Fpd,mDAAM,CAAC8a,aAAP,CAAqBK,UAPhH,8NAQoLnb,mDAAM,CAAC8a,aAAP,CAAqBuC,UARzM,iBAQgOR,cARhO,qIAWwEha,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CAXxE,uGAY4EwC,cAAc,CAACxC,OAAf,CAAuB,mBAAvB,CAZ5E,4BAaKyc,SAbL,8NAiBkC9c,mDAAM,CAAC8a,aAAP,CAAqBwC,gBAjBvD,gHADF;AAyBD;;AAED1C,kBAAgB,GAAG;AACjB,QAAI2C,eAAe,GAAG,EAAtB;AAAA,QACIC,YAAY,GAAG,EADnB;;AAEA,QAAGxd,mDAAM,CAAC4B,OAAP,CAAewI,WAAf,MAAgC,IAAnC,EAAyC;AACvCmT,qBAAe,GAAG,wTAGkDvd,mDAAM,CAAC8a,aAAP,CAAqB2C,uBAHvE,2LAODzd,mDAAM,CAAC8a,aAAP,CAAqB4C,mBAPpB,+LAaH1d,mDAAM,CAAC8a,aAAP,CAAqB6C,eAblB,gDAAlB;AAgBAH,kBAAY,GAAG,sCAAf;AACD,KAlBD,MAkBO;AACLD,qBAAe,GAAG,2SAG6Cvd,mDAAM,CAAC8a,aAAP,CAAqB8C,yBAHlE,qVAS6C5d,mDAAM,CAAC8a,aAAP,CAAqB+C,wBATlE,4CAAlB;AAYAL,kBAAY,GAAG,aAAf;AACD;;AAED,SAAKtD,cAAL,GACE,+GACiGla,mDAAM,CAAC8a,aAAP,CAAqBoC,eADtH,qHAE4Fld,mDAAM,CAACmC,WAAP,CAAmB2b,gBAF/G,wFAGmE9d,mDAAM,CAAC8a,aAAP,CAAqBC,UAHxF,8EAIwD/a,mDAAM,CAAC8a,aAAP,CAAqBsC,gBAJ7E,yHAMuFpd,mDAAM,CAAC8a,aAAP,CAAqBiD,UAN5G,8OAU2F/d,mDAAM,CAAC8a,aAAP,CAAqBK,UAVhH,iNAYkBvd,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB+d,GAAtB,CAA0BC,QAA1B,CAAmCC,KAAnC,CAAyCC,YAZ3D,iEAY2Hne,mDAAM,CAAC8a,aAAP,CAAqBuC,UAZhJ,wEAaiDtD,WAbjD,qVAoBuE/Z,mDAAM,CAAC8a,aAAP,CAAqBsD,qBApB5F,4PAqBkNpe,mDAAM,CAACC,OAAP,CAAeoe,OAAf,CAAuBC,iBAAvB,WAA4Cte,mDAAM,CAAC4B,OAAnD,EArBlN,eAqBoR5B,mDAAM,CAAC4B,OArB3R,gRA0BsG5B,mDAAM,CAAC8a,aAAP,CAAqByD,qBA1B3H,6MA2BqKf,YA3BrK,0FA2B2PtT,eA3B3P,gFA+BIqT,eA/BJ,0FAgCwE1a,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CAhCxE,uGAiC4EwC,cAAc,CAACxC,OAAf,CAAuB,mBAAvB,CAjC5E,wOAqCkCL,mDAAM,CAAC8a,aAAP,CAAqBwC,gBArCvD,gHADF;AA6CD;;AAEDpC,sBAAoB,CAACtR,CAAD,EAAI;AACtB,UAAM4U,WAAW,GAAG9lB,6DAAM,CAAC,sBAAD,CAA1B;AACA,UAAM+lB,OAAO,GAAG/lB,6DAAM,CAAC,aAAD,CAAtB;;AACA,QAAK+lB,OAAO,IAAI,CAACA,OAAO,CAACvN,QAAR,CAAiBtH,CAAC,CAACuE,MAAnB,CAAZ,IAA0C,CAACqQ,WAA5C,IACEC,OAAO,IAAI,CAACA,OAAO,CAACvN,QAAR,CAAiBtH,CAAC,CAACuE,MAAnB,CAAZ,IAA0CqQ,WAA1C,IAAyD,CAACA,WAAW,CAACtN,QAAZ,CAAqBtH,CAAC,CAACuE,MAAvB,CADhE,EACiG;AAC/FvE,OAAC,CAAC8U,wBAAF;AACA9gB,YAAM,CAAC4L,mBAAP,CAA2B,SAA3B,EAAsC,KAAK0R,oBAA3C;AACA,YAAMM,eAAe,GAAG9iB,6DAAM,CAAC,yBAAD,CAA9B;AACA,YAAM+iB,kBAAkB,GAAG/iB,6DAAM,CAAC,uBAAD,CAAjC;AACA8iB,qBAAe,GAAGA,eAAe,CAACS,sBAAhB,CAAuCha,SAAvC,CAAiDwD,MAAjD,CAAwD,mBAAxD,CAAH,GAAkFgW,kBAAkB,CAACQ,sBAAnB,CAA0Cha,SAA1C,CAAoDwD,MAApD,CAA2D,mBAA3D,CAAjG;AACAwP,4DAAK,CAAC0J,IAAN;;AACA,UAAIC,wDAAQ,CAACnJ,KAAb,EAAoB;AAClBmJ,gEAAQ,CAACC,KAAT;AACD;AACF,KAXD,MAWO;AACL,YAAMC,YAAY,GAAGpmB,6DAAM,CAAC,gBAAD,CAA3B;;AACA,UAAIkmB,wDAAQ,CAACnJ,KAAT,IAAkB,CAACqJ,YAAvB,EAAqC;AACnCF,gEAAQ,CAACC,KAAT;AACD;AACF;AAEF;;AACDzC,YAAU,CAAExS,CAAF,EAAK;AACbA,KAAC,CAACmV,eAAF;AACA,UAAMvD,eAAe,GAAG9iB,6DAAM,CAAC,yBAAD,CAA9B;AACA,UAAM+iB,kBAAkB,GAAG/iB,6DAAM,CAAC,uBAAD,CAAjC;AACA8iB,mBAAe,GAAGA,eAAe,CAACS,sBAAhB,CAAuCha,SAAvC,CAAiDwD,MAAjD,CAAwD,mBAAxD,CAAH,GAAkFgW,kBAAkB,CAACQ,sBAAnB,CAA0Cha,SAA1C,CAAoDwD,MAApD,CAA2D,mBAA3D,CAAjG;AACAwP,0DAAK,CAAC0J,IAAN;AACD;;AA5Re;;AA+RlB,MAAMK,WAAW,GAAG,IAAIhF,WAAJ,EAApB;;AACA,MAAM/M,eAAe,GAAG,MAAM;AAC5B+R,aAAW,CAACxc,IAAZ;AACD,CAFD;;AAGA,SAASyc,kBAAT,GAA8B;AAC5BpF,qBAAmB,GACjB,+EACkE7Z,mDAAM,CAACqM,aAAP,CAAqB0O,UADvF,uEAEkDnB,gBAFlD,oLAKgD5Z,mDAAM,CAACqM,aAAP,CAAqB6S,uBALrE,sDAMmClf,mDAAM,CAACqM,aAAP,CAAqB8S,oBANxD,4CADF;AAWD;;AACD,SAASC,kBAAT,GAA8B;AAC5BxhB,QAAM,CAACmB,QAAP,CAAgBgK,KAAhB,CAAsB9D,IAAtB,CAA2B,WAA3B,EAAwC;AACtCG,cAAU,EAAGvC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CADyB;AAEtC8E,eAAW,EAAE,cAFyB;AAGtCE,SAAK,EAAG;AAH8B,GAAxC;AAKA4P,wDAAK,CAAC0J,IAAN;AACD;;AACD,SAASxS,eAAT,CAAyBH,OAAzB,EAAkC;AAChC,QAAMrB,KAAK,GAAG0U,UAAU,CAACje,OAAX,CAAmB,QAAnB,CAAd;AACAie,YAAU,CAACre,YAAX,CAAwB,cAAxB,EAAwC,IAAxC;;AAEA,MAAI2J,KAAJ,EAAW;AACTA,SAAK,CAAC1I,SAAN,CAAgBC,GAAhB,CAAoB,WAApB;AACD;;AAED,QAAM0K,MAAM,GAAGyS,UAAU,CAACje,OAAX,CAAmB,QAAnB,KAAgCie,UAAU,CAACxS,UAA1D;AACA,MAAIC,IAAI,GAAGF,MAAM,CAAC5N,aAAP,CAAqB,QAArB,CAAX,CATgC,CAUhC;;AACA,MAAI,CAAC8N,IAAL,EAAW;AACTA,QAAI,GAAG/N,QAAQ,CAACgD,aAAT,CAAuB,GAAvB,CAAP;AACA+K,QAAI,CAAC9L,YAAL,CAAkB,IAAlB,EAAwB,kBAAxB;AACA8L,QAAI,CAAC7K,SAAL,CAAeC,GAAf,CAAmB,OAAnB;AACA4K,QAAI,CAACnM,SAAL,GAAiBqL,OAAjB;AACAY,UAAM,CAACtK,WAAP,CAAmBwK,IAAnB;AACD,GAND,MAOK;AACHA,QAAI,CAACnM,SAAL,GAAiBqL,OAAjB;AACD;;AAEDqT,YAAU,CAACnT,IAAX,GAAkB,SAAlB;AACAtB,mEAAY,CAACyU,UAAD,CAAZ;AACAA,YAAU,CAACre,YAAX,CAAwB,cAAxB,EAAwC,IAAxC;AACAqe,YAAU,CAACzX,eAAX,CAA2B,uBAA3B;AACAyX,YAAU,CAACre,YAAX,CAAwB,kBAAxB,EAA2C,kCAA3C;AACAqe,YAAU,CAACzX,eAAX,CAA2B,UAA3B;AACD;;AAED,SAAS0X,cAAT,CAAwBxU,IAAxB,EAA8B;AAC5B,MAAIA,IAAI,CAAC,SAAD,CAAR,EAAqB;AACnB,QAAIA,IAAI,CAAC,MAAD,CAAJ,IAAgB,aAApB,EAAmC;AACjC,YAAMyU,UAAU,GAAG7mB,6DAAM,CAAC,qBAAD,CAAzB;AACA6mB,gBAAU,CAAC3C,iBAAX,CAA6B9R,IAAI,CAAC,SAAD,CAAjC;AACAyU,gBAAU,CAACC,aAAX;AACD,KAJD,MAKK;AACHrT,qBAAe,CAACrB,IAAI,CAAC,SAAD,CAAL,CAAf;AACD;AACF,GATD,MAUK;AACH,QAAI6O,iBAAiB,IAAI,EAArB,IAA2BG,qBAAqB,IAAI,EAAxD,EAA4D;AAC1DF,sBAAgB,GAAG5Z,mDAAM,CAACqM,aAAP,CAAqBoT,QAArB,CAA8Bpc,OAA9B,CAAsC,kBAAtC,oBAAqEsW,iBAArE,gBAAmGtW,OAAnG,CAA2G,iBAA3G,oBAAyIyW,qBAAzI,eAAnB;AACD,KAFD,MAEO,IAAIA,qBAAqB,IAAI,EAA7B,EAAiC;AACtCF,sBAAgB,GAAG5Z,mDAAM,CAACqM,aAAP,CAAqBC,YAArB,CAAkCjJ,OAAlC,CAA0C,kBAA1C,oBAAyEyW,qBAAzE,eAAnB;AACD,KAFM,MAEA;AACLF,sBAAgB,GAAG5Z,mDAAM,CAACqM,aAAP,CAAqBC,YAArB,CAAkCjJ,OAAlC,CAA0C,kBAA1C,oBAAyEsW,iBAAzE,eAAnB;AACD;;AACDsF,sBAAkB;AAClB,UAAMS,gBAAgB,GAAG3gB,QAAQ,CAAC4gB,cAAT,CAAwB,eAAxB,CAAzB;AACAD,oBAAgB,CAAC/e,SAAjB,GAA6BkZ,mBAA7B;AACAjc,UAAM,CAACmB,QAAP,CAAgBgK,KAAhB,CAAsB9D,IAAtB,CAA2B,WAA3B,EAAwC;AACtCG,gBAAU,EAAGvC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CADyB;AAEtC8E,iBAAW,EAAE,aAFyB;AAGtCE,WAAK,EAAG;AAH8B,KAAxC;AAKA,UAAMmW,eAAe,GAAG9iB,6DAAM,CAAC,yBAAD,EAA2BqG,QAAQ,CAACwK,IAApC,CAA9B;;AACA,QAAGiS,eAAH,EAAoB;AAClBA,qBAAe,CAACvZ,SAAhB,CAA0BwD,MAA1B,CAAiC,wBAAjC;AACA+V,qBAAe,CAACvZ,SAAhB,CAA0BC,GAA1B,CAA8B,sBAA9B;AACAsZ,qBAAe,CAACxa,YAAhB,CAA6B,YAA7B,EAA2ChB,mDAAM,CAACqM,aAAP,CAAqB0O,UAAhE;AACD;;AACD2E,oBAAgB,CAACzd,SAAjB,CAA2BwD,MAA3B,CAAkC,mBAAlC;AACAia,oBAAgB,CAACzd,SAAjB,CAA2BC,GAA3B,CAA+B,mBAA/B;AACAwd,oBAAgB,CAAC1e,YAAjB,CAA8B,kBAA9B,EAAkDhB,mDAAM,CAACqM,aAAP,CAAqB8S,oBAAvE;AACA,UAAMS,UAAU,GAAGlnB,6DAAM,yBAAyB8iB,eAAzB,CAAzB;AACAoE,cAAU,CAACpG,SAAX,GAAuBxZ,mDAAM,CAACqM,aAAP,CAAqB8S,oBAA5C;AACA,UAAMhD,aAAa,GAAGzjB,6DAAM,oBAAoB8iB,eAApB,CAA5B;;AACA,QAAGW,aAAH,EAAkB;AAChBvR,uEAAY,CAACuR,aAAD,CAAZ;AACD;;AACD,UAAM0D,mBAAmB,GAAGnnB,6DAAM,CAAC,mBAAD,CAAlC;;AACA,QAAGmnB,mBAAH,EAAwB;AACtBA,yBAAmB,CAAC9X,gBAApB,CAAqC,OAArC,EAA8CqX,kBAA9C;AACD;AACF;AACF;;AACD,SAASlD,YAAT,CAAsBtS,CAAtB,EAAyB;AACvB,QAAMgF,IAAI,GAAGhF,CAAC,CAACuE,MAAf;AACAvE,GAAC,CAACC,cAAF;AACAjM,QAAM,CAACmB,QAAP,CAAgBgK,KAAhB,CAAsB9D,IAAtB,CAA2B,WAA3B,EAAwC;AACtCG,cAAU,EAAGvC,cAAc,CAACxC,OAAf,CAAuB,aAAvB,CADyB;AAEtC8E,eAAW,EAAE,YAFyB;AAGtCE,SAAK,EAAG;AAH8B,GAAxC;AAMA,QAAMga,UAAU,GAAG3mB,6DAAM,CAAC,aAAD,CAAzB;AACA,QAAM6mB,UAAU,GAAG7mB,6DAAM,CAAC,qBAAD,CAAzB;AACA,QAAMonB,gBAAgB,GAAGpnB,6DAAM,CAAC,2BAAD,CAA/B;AACA,QAAM2R,WAAW,GAAG3R,6DAAM,CAAC,cAAD,CAA1B;AAEA,MAAIyR,UAAU,GAAG,KAAjB;;AACA,MAAI2V,gBAAJ,EAAsB;AACpBhG,yBAAqB,GAAGyF,UAAU,CAACxV,KAAnC;AACA6E,QAAI,CAAC4Q,aAAL;AACA,UAAMlV,WAAW,GAAGC,oEAAa,CAAC,kBAAD,CAAjC;;AACA,QAAI8U,UAAU,CAACtV,KAAX,IAAoB,EAApB,IAA0BwV,UAAU,CAACxV,KAAX,IAAkB,EAAhD,EAAqD;AACnD,UAAIM,WAAW,CAACG,YAAZ,CAAyB,QAAzB,CAAJ,EAAwC;AACtCH,mBAAW,CAACzC,eAAZ,CAA4B,QAA5B;AACD;;AACDyC,iBAAW,CAACrJ,YAAZ,CAAyB,aAAzB,EAAwC,KAAxC;AACAqJ,iBAAW,CAACpI,SAAZ,CAAsBC,GAAtB,CAA0B,OAA1B;AACAoI,iBAAW,CAACG,OAAZ,CAAoBC,KAAK,IAAI;AAC3B,cAAMC,KAAK,GAAGD,KAAK,CAACtJ,OAAN,CAAc,QAAd,CAAd;AACAsJ,aAAK,CAAC1J,YAAN,CAAmB,cAAnB,EAAmC,IAAnC;AACA2J,aAAK,CAAC1I,SAAN,CAAgBC,GAAhB,CAAoB,WAApB;AACD,OAJD;AAKA0I,uEAAY,CAACP,WAAD,CAAZ;AACAF,gBAAU,GAAG,IAAb;AACD,KAbD,MAaO;AACLE,iBAAW,CAACrJ,YAAZ,CAAyB,QAAzB,EAAmC,EAAnC;AACAqJ,iBAAW,CAACrJ,YAAZ,CAAyB,aAAzB,EAAwC,KAAxC;AACAqJ,iBAAW,CAACpI,SAAZ,CAAsBwD,MAAtB,CAA6B,OAA7B;AACA6E,iBAAW,CAACG,OAAZ,CAAoBC,KAAK,IAAI;AAC3B,cAAMzD,EAAE,GAAGyD,KAAK,CAAC7J,YAAN,CAAmB,IAAnB,CAAX;AACA,cAAMgK,SAAS,mBAAY5D,EAAZ,CAAf;AACA,cAAM0D,KAAK,GAAGD,KAAK,CAACtJ,OAAN,CAAc,QAAd,CAAd;;AACA,YAAI,CAAC1I,6DAAM,iBAASmS,SAAT,SAAX,EAAoC;AAClCH,eAAK,CAAC9C,eAAN,CAAsB,cAAtB,EAAsC,IAAtC;AACA+C,eAAK,CAAC1I,SAAN,CAAgBwD,MAAhB,CAAuB,WAAvB;AACD;AACF,OARD;AASA0E,gBAAU,GAAG,KAAb;AACD;;AACD,QAAIyE,IAAI,CAACjD,OAAL,CAAahD,MAAb,IAAuBwB,UAA3B,EAAuC;AACrC;AACD;AACF;;AACD,MAAGkV,UAAH,EAAe;AACb1F,qBAAiB,GAAG0F,UAAU,CAACtV,KAA/B;AACA,UAAMoU,YAAY,GAAG,IAAI4B,MAAJ,CAAWniB,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB+d,GAAtB,CAA0BC,QAA1B,CAAmCC,KAAnC,CAAyCC,YAApD,CAArB;AACA,UAAM/C,KAAK,GAAGpb,mDAAM,CAAC8a,aAAP,CAAqBkF,eAAnC;;AACA,QAAIX,UAAU,CAACtV,KAAX,IAAoB,EAApB,IAA0B,CAAC+V,gBAA/B,EAAiD;AAC/C,WAAK9T,OAAL,GAAepO,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsBggB,MAAtB,CAA6BrR,IAA7B,CAAkCsR,MAAlC,CAAyCC,YAAzC,CAAsDC,IAArE;AACA,WAAKpU,OAAL,GAAe,KAAKA,OAAL,CAAa3I,OAAb,CAAqB,WAArB,EAAkC+X,KAAlC,CAAf;AACAjP,qBAAe,CAAC,KAAKH,OAAN,CAAf;AACD,KAJD,MAKK,IAAI,CAACmS,YAAY,CAAC1lB,IAAb,CAAkB4mB,UAAU,CAACtV,KAA7B,CAAD,IAAwC,CAAC+V,gBAA7C,EAA+D;AAClE,UAAI9f,mDAAM,CAAC4B,OAAP,KAAmB,IAAvB,EAA6B;AAC1B,aAAKoK,OAAL,GAAepO,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsBggB,MAAtB,CAA6BrR,IAA7B,CAAkCsR,MAAlC,CAAyCG,eAAzC,CAAyDC,WAAxE;AACH,OAFA,MAEM;AACN,aAAKtU,OAAL,GAAepO,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsBggB,MAAtB,CAA6BrR,IAA7B,CAAkCsR,MAAlC,CAAyCG,eAAzC,CAAyDE,KAAxE;AACA;;AACA,YAAMC,eAAe,GAAG9nB,6DAAM,CAAC,mBAAD,CAA9B;;AACA,UAAI8nB,eAAJ,EAAqB;AACnBA,uBAAe,CAAC/a,MAAhB;AACD;;AACD0G,qBAAe,CAAC,KAAKH,OAAN,CAAf;AACA,KAXG,MAWG,IAAIhM,mDAAM,CAAC4B,OAAP,KAAmB,IAAnB,IAA2BgN,IAAI,CAACjD,OAAL,CAAahD,MAA5C,EAAoD;AACvD;AACA,KAFG,MAGH;AACH4R,2DAAA,CAAW3L,IAAX,EACGhP,IADH,CACQkL,IAAI,IAAI;AACZwU,sBAAc,CAACxU,IAAD,CAAd;AACD,OAHH,EAGK4B,KAHL,CAGW,MAAM;AACbkS,gEAAQ,CAAC6B,IAAT,CAAc;AACZtiB,cAAI,EAAEP,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB2e,QAAtB,CAA+B8B,QAA/B,CAAwCtF,KADlC;AAEZpP,iBAAO,EAAEpO,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB2e,QAAtB,CAA+B+B,OAA/B,CAAuC3U,OAFpC;AAGZ6S,eAAK,EAAEjhB,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB2e,QAAtB,CAA+B8B,QAA/B,CAAwC7B,KAHnC;AAIZ+B,gBAAM,EAAE,MAAM;AACZC,0BAAc;AACf;AANW,SAAd;AAQD,OAZH;AAaD;AACF;AACF;;AACD,SAASC,kBAAT,CAA4BlX,CAA5B,EAA+B;AAC7BA,GAAC,CAACmV,eAAF;AACD;;AAED,SAASzD,oBAAT,GAAgC;AAC9B,QAAMwD,YAAY,GAAGpmB,6DAAM,CAAC,gBAAD,CAA3B;AACAomB,cAAY,GAAGA,YAAY,CAAC9d,YAAb,CAA0B,aAA1B,EAAyC,KAAzC,CAAH,GAAqD,IAAjE;AACA,QAAMqZ,gBAAgB,GAAG2E,WAAW,CAAC3E,gBAArC;;AACA,MAAIA,gBAAJ,EAAsB;AACpBA,oBAAgB,CAAC5P,OAAjB,CAAyB,UAAUsW,GAAV,EAAe;AACtCA,SAAG,CAACnZ,eAAJ,CAAoB,UAApB;AACD,KAFD;AAGD;;AAED,QAAMuS,kBAAkB,GAAG6E,WAAW,CAAC7E,kBAAvC;;AACA,MAAIA,kBAAJ,EAAwB;AACtBA,sBAAkB,CAAC1P,OAAnB,CAA2B,UAAUsW,GAAV,EAAe;AACxCA,SAAG,CAAC/f,YAAJ,CAAiB,aAAjB,EAAgC,KAAhC;AACD,KAFD;AAGD;;AAED,QAAMoZ,WAAW,GAAG4E,WAAW,CAAC5E,WAAhC;;AACA,MAAIA,WAAJ,EAAiB;AACfA,eAAW,CAAC3P,OAAZ,CAAoB,UAAUsW,GAAV,EAAe;AACjCA,SAAG,CAAC/f,YAAJ,CAAiB,UAAjB,EAA6B,IAA7B;AACD,KAFD;AAGD;;AAED,QAAMggB,cAAc,GAAGtoB,6DAAM,CAAC,gBAAD,CAA7B;AACAkS,mEAAY,CAACoW,cAAD,CAAZ;AACD;;AAED,SAASzF,cAAT,GAA2B;AACzB,MAAIqD,wDAAQ,CAACnJ,KAAb,EAAoB;AAClB,UAAMwL,eAAe,GAAGvoB,6DAAM,CAAC,oBAAD,CAA9B;AACA,UAAMwoB,gBAAgB,GAAGxoB,6DAAM,CAAC,iDAAD,CAA/B;AACA,UAAMyoB,WAAW,GAAGzoB,6DAAM,CAAC,+BAAD,CAA1B;AACAuoB,mBAAe,GAAGA,eAAe,CAACjgB,YAAhB,CAA6B,YAA7B,EAA2CpD,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB2e,QAAtB,CAA+B8B,QAA/B,CAAwCtF,KAAnF,CAAH,GAA+F,IAA9G;AACA8F,oBAAgB,GAAGA,gBAAgB,CAACE,WAAjB,GAA+BxjB,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB2e,QAAtB,CAA+B8B,QAA/B,CAAwC7B,KAA1E,GAAkF,IAAlG;AACAsC,eAAW,GAAGA,WAAW,CAACC,WAAZ,GAA0BxjB,MAAM,CAACoC,MAAP,CAAcC,OAAd,CAAsB2e,QAAtB,CAA+B+B,OAA/B,CAAuC3U,OAApE,GAA8E,IAAzF;AACA6U,kBAAc;AACf;AACF;;AAED,SAASA,cAAT,GAA0B;AACxB,QAAMI,eAAe,GAAGvoB,6DAAM,CAAC,oBAAD,CAA9B;;AACA,MAAIuoB,eAAJ,EAAqB;AACnBA,mBAAe,CAAChf,SAAhB,CAA0BC,GAA1B,CAA8B,iBAA9B;AACA,UAAM0d,UAAU,GAAGlnB,6DAAM,CAAC,uCAAD,CAAzB;AACAknB,cAAU,GAAGA,UAAU,CAAC5e,YAAX,CAAwB,UAAxB,EAAoC,IAApC,CAAH,GAA+C,IAAzD;AACAqe,cAAU,GAAGA,UAAU,CAACre,YAAX,CAAwB,UAAxB,EAAoC,IAApC,CAAH,GAA+C,IAAzD;AACAtI,iEAAM,CAAC,gBAAD,CAAN,CAAyBsI,YAAzB,CAAsC,UAAtC,EAAkD,IAAlD;AACAge,eAAW,CAAC3E,gBAAZ,GAA+B3R,gEAAS,CAAC,gCAAD,CAAxC;AACAuY,mBAAe,CAAClZ,gBAAhB,CAAiC,OAAjC,EAA0C+Y,kBAA1C;AACD;AACF;;AAED,SAASnE,eAAT,CAAyB0E,WAAzB,EAAsCC,UAAtC,EAAkD;AAChD,MAAID,WAAW,CAACtX,KAAZ,IAAqB,EAArB,IAA0BuX,UAAU,CAACvX,KAAX,IAAoB,EAAlD,EAAsD;AACpD,QAAIuX,UAAU,CAAC9W,YAAX,CAAwB,eAAxB,CAAJ,EAA8C;AAC5C8W,gBAAU,CAAC1Z,eAAX,CAA2B,eAA3B;AACD;AACF,GAJD,MAIO,IAAIyZ,WAAW,CAACtX,KAAZ,IAAqB,EAArB,IAA2BuX,UAAU,CAACvX,KAAX,IAAoB,EAAnD,EAAuD;AAC5D,QAAIsX,WAAW,CAAC7W,YAAZ,CAAyB,eAAzB,CAAJ,EAA+C;AAC7C6W,iBAAW,CAACzZ,eAAZ,CAA4B,eAA5B;AACD;AACF,GAJM,MAIA;AACLyZ,eAAW,CAACrgB,YAAZ,CAAyB,eAAzB,EAA0C,IAA1C;AACAsgB,cAAU,CAACtgB,YAAX,CAAwB,eAAxB,EAAyC,IAAzC;AACD;AACF;;AAEciM,8EAAf,E","file":"chunks/pdp.js?v=3.23","sourcesContent":["export { C as ConfigResolverMap, E as EngineMap, e as dragAction, h as hoverAction, m as moveAction, f as pinchAction, r as registerAction, s as scrollAction, w as wheelAction } from '../../dist/actions-8e12537b.esm.js';\nimport '../../dist/maths-b2a210f4.esm.js';\n","import { V, c as computeRubberband } from './maths-b2a210f4.esm.js';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nconst EVENT_TYPE_MAP = {\n  pointer: {\n    start: 'down',\n    change: 'move',\n    end: 'up'\n  },\n  mouse: {\n    start: 'down',\n    change: 'move',\n    end: 'up'\n  },\n  touch: {\n    start: 'start',\n    change: 'move',\n    end: 'end'\n  },\n  gesture: {\n    start: 'start',\n    change: 'change',\n    end: 'end'\n  }\n};\n\nfunction capitalize(string) {\n  if (!string) return '';\n  return string[0].toUpperCase() + string.slice(1);\n}\n\nfunction toHandlerProp(device, action = '', capture = false) {\n  const deviceProps = EVENT_TYPE_MAP[device];\n  const actionKey = deviceProps ? deviceProps[action] || action : action;\n  return 'on' + capitalize(device) + capitalize(actionKey) + (capture ? 'Capture' : '');\n}\nconst pointerCaptureEvents = ['gotpointercapture', 'lostpointercapture'];\nfunction parseProp(prop) {\n  let eventKey = prop.substring(2).toLowerCase();\n  const passive = !!~eventKey.indexOf('passive');\n  if (passive) eventKey = eventKey.replace('passive', '');\n  const captureKey = pointerCaptureEvents.includes(eventKey) ? 'capturecapture' : 'capture';\n  const capture = !!~eventKey.indexOf(captureKey);\n  if (capture) eventKey = eventKey.replace('capture', '');\n  return {\n    device: eventKey,\n    capture,\n    passive\n  };\n}\nfunction toDomEventType(device, action = '') {\n  const deviceProps = EVENT_TYPE_MAP[device];\n  const actionKey = deviceProps ? deviceProps[action] || action : action;\n  return device + actionKey;\n}\nfunction isTouch(event) {\n  return 'touches' in event;\n}\nfunction getPointerType(event) {\n  if (isTouch(event)) return 'touch';\n  if ('pointerType' in event) return event.pointerType;\n  return 'mouse';\n}\n\nfunction getCurrentTargetTouchList(event) {\n  return Array.from(event.touches).filter(e => {\n    var _event$currentTarget, _event$currentTarget$;\n\n    return e.target === event.currentTarget || ((_event$currentTarget = event.currentTarget) === null || _event$currentTarget === void 0 ? void 0 : (_event$currentTarget$ = _event$currentTarget.contains) === null || _event$currentTarget$ === void 0 ? void 0 : _event$currentTarget$.call(_event$currentTarget, e.target));\n  });\n}\n\nfunction getTouchList(event) {\n  return event.type === 'touchend' || event.type === 'touchcancel' ? event.changedTouches : event.targetTouches;\n}\n\nfunction getValueEvent(event) {\n  return isTouch(event) ? getTouchList(event)[0] : event;\n}\n\nfunction distanceAngle(P1, P2) {\n  const dx = P2.clientX - P1.clientX;\n  const dy = P2.clientY - P1.clientY;\n  const cx = (P2.clientX + P1.clientX) / 2;\n  const cy = (P2.clientY + P1.clientY) / 2;\n  const distance = Math.hypot(dx, dy);\n  const angle = -(Math.atan2(dx, dy) * 180) / Math.PI;\n  const origin = [cx, cy];\n  return {\n    angle,\n    distance,\n    origin\n  };\n}\nfunction touchIds(event) {\n  return getCurrentTargetTouchList(event).map(touch => touch.identifier);\n}\nfunction touchDistanceAngle(event, ids) {\n  const [P1, P2] = Array.from(event.touches).filter(touch => ids.includes(touch.identifier));\n  return distanceAngle(P1, P2);\n}\nfunction pointerId(event) {\n  const valueEvent = getValueEvent(event);\n  return isTouch(event) ? valueEvent.identifier : valueEvent.pointerId;\n}\nfunction pointerValues(event) {\n  const valueEvent = getValueEvent(event);\n  return [valueEvent.clientX, valueEvent.clientY];\n}\nconst LINE_HEIGHT = 40;\nconst PAGE_HEIGHT = 800;\nfunction wheelValues(event) {\n  let {\n    deltaX,\n    deltaY,\n    deltaMode\n  } = event;\n\n  if (deltaMode === 1) {\n    deltaX *= LINE_HEIGHT;\n    deltaY *= LINE_HEIGHT;\n  } else if (deltaMode === 2) {\n    deltaX *= PAGE_HEIGHT;\n    deltaY *= PAGE_HEIGHT;\n  }\n\n  return [deltaX, deltaY];\n}\nfunction scrollValues(event) {\n  var _ref, _ref2;\n\n  const {\n    scrollX,\n    scrollY,\n    scrollLeft,\n    scrollTop\n  } = event.currentTarget;\n  return [(_ref = scrollX !== null && scrollX !== void 0 ? scrollX : scrollLeft) !== null && _ref !== void 0 ? _ref : 0, (_ref2 = scrollY !== null && scrollY !== void 0 ? scrollY : scrollTop) !== null && _ref2 !== void 0 ? _ref2 : 0];\n}\nfunction getEventDetails(event) {\n  const payload = {};\n  if ('buttons' in event) payload.buttons = event.buttons;\n\n  if ('shiftKey' in event) {\n    const {\n      shiftKey,\n      altKey,\n      metaKey,\n      ctrlKey\n    } = event;\n    Object.assign(payload, {\n      shiftKey,\n      altKey,\n      metaKey,\n      ctrlKey\n    });\n  }\n\n  return payload;\n}\n\nfunction call(v, ...args) {\n  if (typeof v === 'function') {\n    return v(...args);\n  } else {\n    return v;\n  }\n}\nfunction noop() {}\nfunction chain(...fns) {\n  if (fns.length === 0) return noop;\n  if (fns.length === 1) return fns[0];\n  return function () {\n    let result;\n\n    for (const fn of fns) {\n      result = fn.apply(this, arguments) || result;\n    }\n\n    return result;\n  };\n}\nfunction assignDefault(value, fallback) {\n  return Object.assign({}, fallback, value || {});\n}\n\nconst BEFORE_LAST_KINEMATICS_DELAY = 32;\nclass Engine {\n  constructor(ctrl, args, key) {\n    this.ctrl = ctrl;\n    this.args = args;\n    this.key = key;\n\n    if (!this.state) {\n      this.state = {};\n      this.computeValues([0, 0]);\n      this.computeInitial();\n      if (this.init) this.init();\n      this.reset();\n    }\n  }\n\n  get state() {\n    return this.ctrl.state[this.key];\n  }\n\n  set state(state) {\n    this.ctrl.state[this.key] = state;\n  }\n\n  get shared() {\n    return this.ctrl.state.shared;\n  }\n\n  get eventStore() {\n    return this.ctrl.gestureEventStores[this.key];\n  }\n\n  get timeoutStore() {\n    return this.ctrl.gestureTimeoutStores[this.key];\n  }\n\n  get config() {\n    return this.ctrl.config[this.key];\n  }\n\n  get sharedConfig() {\n    return this.ctrl.config.shared;\n  }\n\n  get handler() {\n    return this.ctrl.handlers[this.key];\n  }\n\n  reset() {\n    const {\n      state,\n      shared,\n      ingKey,\n      args\n    } = this;\n    shared[ingKey] = state._active = state.active = state._blocked = state._force = false;\n    state._step = [false, false];\n    state.intentional = false;\n    state._movement = [0, 0];\n    state._distance = [0, 0];\n    state._direction = [0, 0];\n    state._delta = [0, 0];\n    state._bounds = [[-Infinity, Infinity], [-Infinity, Infinity]];\n    state.args = args;\n    state.axis = undefined;\n    state.memo = undefined;\n    state.elapsedTime = 0;\n    state.direction = [0, 0];\n    state.distance = [0, 0];\n    state.overflow = [0, 0];\n    state._movementBound = [false, false];\n    state.velocity = [0, 0];\n    state.movement = [0, 0];\n    state.delta = [0, 0];\n    state.timeStamp = 0;\n  }\n\n  start(event) {\n    const state = this.state;\n    const config = this.config;\n\n    if (!state._active) {\n      this.reset();\n      this.computeInitial();\n      state._active = true;\n      state.target = event.target;\n      state.currentTarget = event.currentTarget;\n      state.lastOffset = config.from ? call(config.from, state) : state.offset;\n      state.offset = state.lastOffset;\n    }\n\n    state.startTime = state.timeStamp = event.timeStamp;\n  }\n\n  computeValues(values) {\n    const state = this.state;\n    state._values = values;\n    state.values = this.config.transform(values);\n  }\n\n  computeInitial() {\n    const state = this.state;\n    state._initial = state._values;\n    state.initial = state.values;\n  }\n\n  compute(event) {\n    const {\n      state,\n      config,\n      shared\n    } = this;\n    state.args = this.args;\n    let dt = 0;\n\n    if (event) {\n      state.event = event;\n      if (config.preventDefault && event.cancelable) state.event.preventDefault();\n      state.type = event.type;\n      shared.touches = this.ctrl.pointerIds.size || this.ctrl.touchIds.size;\n      shared.locked = !!document.pointerLockElement;\n      Object.assign(shared, getEventDetails(event));\n      shared.down = shared.pressed = shared.buttons % 2 === 1 || shared.touches > 0;\n      dt = event.timeStamp - state.timeStamp;\n      state.timeStamp = event.timeStamp;\n      state.elapsedTime = state.timeStamp - state.startTime;\n    }\n\n    if (state._active) {\n      const _absoluteDelta = state._delta.map(Math.abs);\n\n      V.addTo(state._distance, _absoluteDelta);\n    }\n\n    if (this.axisIntent) this.axisIntent(event);\n    const [_m0, _m1] = state._movement;\n    const [t0, t1] = config.threshold;\n    const {\n      _step,\n      values\n    } = state;\n\n    if (config.hasCustomTransform) {\n      if (_step[0] === false) _step[0] = Math.abs(_m0) >= t0 && values[0];\n      if (_step[1] === false) _step[1] = Math.abs(_m1) >= t1 && values[1];\n    } else {\n      if (_step[0] === false) _step[0] = Math.abs(_m0) >= t0 && Math.sign(_m0) * t0;\n      if (_step[1] === false) _step[1] = Math.abs(_m1) >= t1 && Math.sign(_m1) * t1;\n    }\n\n    state.intentional = _step[0] !== false || _step[1] !== false;\n    if (!state.intentional) return;\n    const movement = [0, 0];\n\n    if (config.hasCustomTransform) {\n      const [v0, v1] = values;\n      movement[0] = _step[0] !== false ? v0 - _step[0] : 0;\n      movement[1] = _step[1] !== false ? v1 - _step[1] : 0;\n    } else {\n      movement[0] = _step[0] !== false ? _m0 - _step[0] : 0;\n      movement[1] = _step[1] !== false ? _m1 - _step[1] : 0;\n    }\n\n    if (this.restrictToAxis && !state._blocked) this.restrictToAxis(movement);\n    const previousOffset = state.offset;\n    const gestureIsActive = state._active && !state._blocked || state.active;\n\n    if (gestureIsActive) {\n      state.first = state._active && !state.active;\n      state.last = !state._active && state.active;\n      state.active = shared[this.ingKey] = state._active;\n\n      if (event) {\n        if (state.first) {\n          if ('bounds' in config) state._bounds = call(config.bounds, state);\n          if (this.setup) this.setup();\n        }\n\n        state.movement = movement;\n        this.computeOffset();\n      }\n    }\n\n    const [ox, oy] = state.offset;\n    const [[x0, x1], [y0, y1]] = state._bounds;\n    state.overflow = [ox < x0 ? -1 : ox > x1 ? 1 : 0, oy < y0 ? -1 : oy > y1 ? 1 : 0];\n    state._movementBound[0] = state.overflow[0] ? state._movementBound[0] === false ? state._movement[0] : state._movementBound[0] : false;\n    state._movementBound[1] = state.overflow[1] ? state._movementBound[1] === false ? state._movement[1] : state._movementBound[1] : false;\n    const rubberband = state._active ? config.rubberband || [0, 0] : [0, 0];\n    state.offset = computeRubberband(state._bounds, state.offset, rubberband);\n    state.delta = V.sub(state.offset, previousOffset);\n    this.computeMovement();\n\n    if (gestureIsActive && (!state.last || dt > BEFORE_LAST_KINEMATICS_DELAY)) {\n      state.delta = V.sub(state.offset, previousOffset);\n      const absoluteDelta = state.delta.map(Math.abs);\n      V.addTo(state.distance, absoluteDelta);\n      state.direction = state.delta.map(Math.sign);\n      state._direction = state._delta.map(Math.sign);\n\n      if (!state.first && dt > 0) {\n        state.velocity = [absoluteDelta[0] / dt, absoluteDelta[1] / dt];\n      }\n    }\n  }\n\n  emit() {\n    const state = this.state;\n    const shared = this.shared;\n    const config = this.config;\n    if (!state._active) this.clean();\n    if ((state._blocked || !state.intentional) && !state._force && !config.triggerAllEvents) return;\n    const memo = this.handler(_objectSpread2(_objectSpread2(_objectSpread2({}, shared), state), {}, {\n      [this.aliasKey]: state.values\n    }));\n    if (memo !== undefined) state.memo = memo;\n  }\n\n  clean() {\n    this.eventStore.clean();\n    this.timeoutStore.clean();\n  }\n\n}\n\nfunction selectAxis([dx, dy], threshold) {\n  const absDx = Math.abs(dx);\n  const absDy = Math.abs(dy);\n\n  if (absDx > absDy && absDx > threshold) {\n    return 'x';\n  }\n\n  if (absDy > absDx && absDy > threshold) {\n    return 'y';\n  }\n\n  return undefined;\n}\n\nclass CoordinatesEngine extends Engine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"aliasKey\", 'xy');\n  }\n\n  reset() {\n    super.reset();\n    this.state.axis = undefined;\n  }\n\n  init() {\n    this.state.offset = [0, 0];\n    this.state.lastOffset = [0, 0];\n  }\n\n  computeOffset() {\n    this.state.offset = V.add(this.state.lastOffset, this.state.movement);\n  }\n\n  computeMovement() {\n    this.state.movement = V.sub(this.state.offset, this.state.lastOffset);\n  }\n\n  axisIntent(event) {\n    const state = this.state;\n    const config = this.config;\n\n    if (!state.axis && event) {\n      const threshold = typeof config.axisThreshold === 'object' ? config.axisThreshold[getPointerType(event)] : config.axisThreshold;\n      state.axis = selectAxis(state._movement, threshold);\n    }\n\n    state._blocked = (config.lockDirection || !!config.axis) && !state.axis || !!config.axis && config.axis !== state.axis;\n  }\n\n  restrictToAxis(v) {\n    if (this.config.axis || this.config.lockDirection) {\n      switch (this.state.axis) {\n        case 'x':\n          v[1] = 0;\n          break;\n\n        case 'y':\n          v[0] = 0;\n          break;\n      }\n    }\n  }\n\n}\n\nconst identity = v => v;\nconst DEFAULT_RUBBERBAND = 0.15;\nconst commonConfigResolver = {\n  enabled(value = true) {\n    return value;\n  },\n\n  preventDefault(value = false) {\n    return value;\n  },\n\n  triggerAllEvents(value = false) {\n    return value;\n  },\n\n  rubberband(value = 0) {\n    switch (value) {\n      case true:\n        return [DEFAULT_RUBBERBAND, DEFAULT_RUBBERBAND];\n\n      case false:\n        return [0, 0];\n\n      default:\n        return V.toVector(value);\n    }\n  },\n\n  from(value) {\n    if (typeof value === 'function') return value;\n    if (value != null) return V.toVector(value);\n  },\n\n  transform(value, _k, config) {\n    const transform = value || config.shared.transform;\n    this.hasCustomTransform = !!transform;\n\n    if (process.env.NODE_ENV === 'development') {\n      const originalTransform = transform || identity;\n      return v => {\n        const r = originalTransform(v);\n\n        if (!isFinite(r[0]) || !isFinite(r[1])) {\n          console.warn(`[@use-gesture]: config.transform() must produce a valid result, but it was: [${r[0]},${[1]}]`);\n        }\n\n        return r;\n      };\n    }\n\n    return transform || identity;\n  },\n\n  threshold(value) {\n    return V.toVector(value, 0);\n  }\n\n};\n\nif (process.env.NODE_ENV === 'development') {\n  Object.assign(commonConfigResolver, {\n    domTarget(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`domTarget\\` option has been renamed to \\`target\\`.`);\n      }\n\n      return NaN;\n    },\n\n    lockDirection(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`lockDirection\\` option has been merged with \\`axis\\`. Use it as in \\`{ axis: 'lock' }\\``);\n      }\n\n      return NaN;\n    },\n\n    initial(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`initial\\` option has been renamed to \\`from\\`.`);\n      }\n\n      return NaN;\n    }\n\n  });\n}\n\nconst DEFAULT_AXIS_THRESHOLD = 0;\nconst coordinatesConfigResolver = _objectSpread2(_objectSpread2({}, commonConfigResolver), {}, {\n  axis(_v, _k, {\n    axis\n  }) {\n    this.lockDirection = axis === 'lock';\n    if (!this.lockDirection) return axis;\n  },\n\n  axisThreshold(value = DEFAULT_AXIS_THRESHOLD) {\n    return value;\n  },\n\n  bounds(value = {}) {\n    if (typeof value === 'function') {\n      return state => coordinatesConfigResolver.bounds(value(state));\n    }\n\n    if ('current' in value) {\n      return () => value.current;\n    }\n\n    if (typeof HTMLElement === 'function' && value instanceof HTMLElement) {\n      return value;\n    }\n\n    const {\n      left = -Infinity,\n      right = Infinity,\n      top = -Infinity,\n      bottom = Infinity\n    } = value;\n    return [[left, right], [top, bottom]];\n  }\n\n});\n\nconst DISPLACEMENT = 10;\nconst KEYS_DELTA_MAP = {\n  ArrowRight: (factor = 1) => [DISPLACEMENT * factor, 0],\n  ArrowLeft: (factor = 1) => [-DISPLACEMENT * factor, 0],\n  ArrowUp: (factor = 1) => [0, -DISPLACEMENT * factor],\n  ArrowDown: (factor = 1) => [0, DISPLACEMENT * factor]\n};\nclass DragEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'dragging');\n  }\n\n  reset() {\n    super.reset();\n    const state = this.state;\n    state._pointerId = undefined;\n    state._pointerActive = false;\n    state._keyboardActive = false;\n    state._preventScroll = false;\n    state._delayed = false;\n    state.swipe = [0, 0];\n    state.tap = false;\n    state.canceled = false;\n    state.cancel = this.cancel.bind(this);\n  }\n\n  setup() {\n    const state = this.state;\n\n    if (state._bounds instanceof HTMLElement) {\n      const boundRect = state._bounds.getBoundingClientRect();\n\n      const targetRect = state.currentTarget.getBoundingClientRect();\n      const _bounds = {\n        left: boundRect.left - targetRect.left + state.offset[0],\n        right: boundRect.right - targetRect.right + state.offset[0],\n        top: boundRect.top - targetRect.top + state.offset[1],\n        bottom: boundRect.bottom - targetRect.bottom + state.offset[1]\n      };\n      state._bounds = coordinatesConfigResolver.bounds(_bounds);\n    }\n  }\n\n  cancel() {\n    const state = this.state;\n    if (state.canceled) return;\n    state.canceled = true;\n    state._active = false;\n    setTimeout(() => {\n      this.compute();\n      this.emit();\n    }, 0);\n  }\n\n  setActive() {\n    this.state._active = this.state._pointerActive || this.state._keyboardActive;\n  }\n\n  clean() {\n    this.pointerClean();\n    this.state._pointerActive = false;\n    this.state._keyboardActive = false;\n    super.clean();\n  }\n\n  pointerDown(event) {\n    const config = this.config;\n    const state = this.state;\n    if (event.buttons != null && (Array.isArray(config.pointerButtons) ? !config.pointerButtons.includes(event.buttons) : config.pointerButtons !== -1 && config.pointerButtons !== event.buttons)) return;\n    this.ctrl.setEventIds(event);\n\n    if (config.pointerCapture) {\n      event.target.setPointerCapture(event.pointerId);\n    }\n\n    if (state._pointerActive) return;\n    this.start(event);\n    this.setupPointer(event);\n    state._pointerId = pointerId(event);\n    state._pointerActive = true;\n    this.computeValues(pointerValues(event));\n    this.computeInitial();\n\n    if (config.preventScrollAxis && getPointerType(event) !== 'mouse') {\n      state._active = false;\n      this.setupScrollPrevention(event);\n    } else if (config.delay > 0) {\n      this.setupDelayTrigger(event);\n\n      if (config.triggerAllEvents) {\n        this.compute(event);\n        this.emit();\n      }\n    } else {\n      this.startPointerDrag(event);\n    }\n  }\n\n  startPointerDrag(event) {\n    const state = this.state;\n    state._active = true;\n    state._preventScroll = true;\n    state._delayed = false;\n    this.compute(event);\n    this.emit();\n  }\n\n  pointerMove(event) {\n    const state = this.state;\n    const config = this.config;\n    if (!state._pointerActive) return;\n    if (state.type === event.type && event.timeStamp === state.timeStamp) return;\n    const id = pointerId(event);\n    if (state._pointerId !== undefined && id !== state._pointerId) return;\n\n    const _values = pointerValues(event);\n\n    if (document.pointerLockElement === event.target) {\n      state._delta = [event.movementX, event.movementY];\n    } else {\n      state._delta = V.sub(_values, state._values);\n      this.computeValues(_values);\n    }\n\n    V.addTo(state._movement, state._delta);\n    this.compute(event);\n\n    if (state._delayed && state.intentional) {\n      this.timeoutStore.remove('dragDelay');\n      state.active = false;\n      this.startPointerDrag(event);\n      return;\n    }\n\n    if (config.preventScrollAxis && !state._preventScroll) {\n      if (state.axis) {\n        if (state.axis === config.preventScrollAxis || config.preventScrollAxis === 'xy') {\n          state._active = false;\n          this.clean();\n          return;\n        } else {\n          this.timeoutStore.remove('startPointerDrag');\n          this.startPointerDrag(event);\n          return;\n        }\n      } else {\n        return;\n      }\n    }\n\n    this.emit();\n  }\n\n  pointerUp(event) {\n    this.ctrl.setEventIds(event);\n\n    try {\n      if (this.config.pointerCapture && event.target.hasPointerCapture(event.pointerId)) {\n        ;\n        event.target.releasePointerCapture(event.pointerId);\n      }\n    } catch (_unused) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(`[@use-gesture]: If you see this message, it's likely that you're using an outdated version of \\`@react-three/fiber\\`. \\n\\nPlease upgrade to the latest version.`);\n      }\n    }\n\n    const state = this.state;\n    const config = this.config;\n    if (!state._active || !state._pointerActive) return;\n    const id = pointerId(event);\n    if (state._pointerId !== undefined && id !== state._pointerId) return;\n    this.state._pointerActive = false;\n    this.setActive();\n    this.compute(event);\n    const [dx, dy] = state._distance;\n    state.tap = dx <= config.tapsThreshold && dy <= config.tapsThreshold;\n\n    if (state.tap && config.filterTaps) {\n      state._force = true;\n    } else {\n      const [dirx, diry] = state.direction;\n      const [vx, vy] = state.velocity;\n      const [mx, my] = state.movement;\n      const [svx, svy] = config.swipe.velocity;\n      const [sx, sy] = config.swipe.distance;\n      const sdt = config.swipe.duration;\n\n      if (state.elapsedTime < sdt) {\n        if (Math.abs(vx) > svx && Math.abs(mx) > sx) state.swipe[0] = dirx;\n        if (Math.abs(vy) > svy && Math.abs(my) > sy) state.swipe[1] = diry;\n      }\n    }\n\n    this.emit();\n  }\n\n  pointerClick(event) {\n    if (!this.state.tap) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  setupPointer(event) {\n    const config = this.config;\n    const device = config.device;\n\n    if (process.env.NODE_ENV === 'development') {\n      try {\n        if (device === 'pointer' && config.preventScrollDelay === undefined) {\n          const currentTarget = 'uv' in event ? event.sourceEvent.currentTarget : event.currentTarget;\n          const style = window.getComputedStyle(currentTarget);\n\n          if (style.touchAction === 'auto') {\n            console.warn(`[@use-gesture]: The drag target has its \\`touch-action\\` style property set to \\`auto\\`. It is recommended to add \\`touch-action: 'none'\\` so that the drag gesture behaves correctly on touch-enabled devices. For more information read this: https://use-gesture.netlify.app/docs/extras/#touch-action.\\n\\nThis message will only show in development mode. It won't appear in production. If this is intended, you can ignore it.`, currentTarget);\n          }\n        }\n      } catch (_unused2) {}\n    }\n\n    if (config.pointerLock) {\n      event.currentTarget.requestPointerLock();\n    }\n\n    if (!config.pointerCapture) {\n      this.eventStore.add(this.sharedConfig.window, device, 'change', this.pointerMove.bind(this));\n      this.eventStore.add(this.sharedConfig.window, device, 'end', this.pointerUp.bind(this));\n      this.eventStore.add(this.sharedConfig.window, device, 'cancel', this.pointerUp.bind(this));\n    }\n  }\n\n  pointerClean() {\n    if (this.config.pointerLock && document.pointerLockElement === this.state.currentTarget) {\n      document.exitPointerLock();\n    }\n  }\n\n  preventScroll(event) {\n    if (this.state._preventScroll && event.cancelable) {\n      event.preventDefault();\n    }\n  }\n\n  setupScrollPrevention(event) {\n    persistEvent(event);\n    this.eventStore.add(this.sharedConfig.window, 'touch', 'change', this.preventScroll.bind(this), {\n      passive: false\n    });\n    this.eventStore.add(this.sharedConfig.window, 'touch', 'end', this.clean.bind(this));\n    this.eventStore.add(this.sharedConfig.window, 'touch', 'cancel', this.clean.bind(this));\n    this.timeoutStore.add('startPointerDrag', this.startPointerDrag.bind(this), this.config.preventScrollDelay, event);\n  }\n\n  setupDelayTrigger(event) {\n    this.state._delayed = true;\n    this.timeoutStore.add('dragDelay', () => {\n      this.state._step = [0, 0];\n      this.startPointerDrag(event);\n    }, this.config.delay);\n  }\n\n  keyDown(event) {\n    const deltaFn = KEYS_DELTA_MAP[event.key];\n\n    if (deltaFn) {\n      const state = this.state;\n      const factor = event.shiftKey ? 10 : event.altKey ? 0.1 : 1;\n      state._delta = deltaFn(factor);\n      this.start(event);\n      state._keyboardActive = true;\n      V.addTo(state._movement, state._delta);\n      this.compute(event);\n      this.emit();\n    }\n  }\n\n  keyUp(event) {\n    if (!(event.key in KEYS_DELTA_MAP)) return;\n    this.state._keyboardActive = false;\n    this.setActive();\n    this.compute(event);\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    const device = this.config.device;\n    bindFunction(device, 'start', this.pointerDown.bind(this));\n\n    if (this.config.pointerCapture) {\n      bindFunction(device, 'change', this.pointerMove.bind(this));\n      bindFunction(device, 'end', this.pointerUp.bind(this));\n      bindFunction(device, 'cancel', this.pointerUp.bind(this));\n      bindFunction('lostPointerCapture', '', this.pointerUp.bind(this));\n    }\n\n    bindFunction('key', 'down', this.keyDown.bind(this));\n    bindFunction('key', 'up', this.keyUp.bind(this));\n\n    if (this.config.filterTaps) {\n      bindFunction('click', '', this.pointerClick.bind(this), {\n        capture: true,\n        passive: false\n      });\n    }\n  }\n\n}\n\nfunction persistEvent(event) {\n  'persist' in event && typeof event.persist === 'function' && event.persist();\n}\n\nconst isBrowser = typeof window !== 'undefined' && window.document && window.document.createElement;\n\nfunction supportsTouchEvents() {\n  return isBrowser && 'ontouchstart' in window;\n}\n\nfunction isTouchScreen() {\n  return supportsTouchEvents() || isBrowser && window.navigator.maxTouchPoints > 1;\n}\n\nfunction supportsPointerEvents() {\n  return isBrowser && 'onpointerdown' in window;\n}\n\nfunction supportsPointerLock() {\n  return isBrowser && 'exitPointerLock' in window.document;\n}\n\nfunction supportsGestureEvents() {\n  try {\n    return 'constructor' in GestureEvent;\n  } catch (e) {\n    return false;\n  }\n}\n\nconst SUPPORT = {\n  isBrowser,\n  gesture: supportsGestureEvents(),\n  touch: isTouchScreen(),\n  touchscreen: isTouchScreen(),\n  pointer: supportsPointerEvents(),\n  pointerLock: supportsPointerLock()\n};\n\nconst DEFAULT_PREVENT_SCROLL_DELAY = 250;\nconst DEFAULT_DRAG_DELAY = 180;\nconst DEFAULT_SWIPE_VELOCITY = 0.5;\nconst DEFAULT_SWIPE_DISTANCE = 50;\nconst DEFAULT_SWIPE_DURATION = 250;\nconst DEFAULT_DRAG_AXIS_THRESHOLD = {\n  mouse: 0,\n  touch: 0,\n  pen: 8\n};\nconst dragConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  device(_v, _k, {\n    pointer: {\n      touch = false,\n      lock = false,\n      mouse = false\n    } = {}\n  }) {\n    this.pointerLock = lock && SUPPORT.pointerLock;\n    if (SUPPORT.touch && touch) return 'touch';\n    if (this.pointerLock) return 'mouse';\n    if (SUPPORT.pointer && !mouse) return 'pointer';\n    if (SUPPORT.touch) return 'touch';\n    return 'mouse';\n  },\n\n  preventScrollAxis(value, _k, {\n    preventScroll\n  }) {\n    this.preventScrollDelay = typeof preventScroll === 'number' ? preventScroll : preventScroll || preventScroll === undefined && value ? DEFAULT_PREVENT_SCROLL_DELAY : undefined;\n    if (!SUPPORT.touchscreen || preventScroll === false) return undefined;\n    return value ? value : preventScroll !== undefined ? 'y' : undefined;\n  },\n\n  pointerCapture(_v, _k, {\n    pointer: {\n      capture = true,\n      buttons = 1\n    } = {}\n  }) {\n    this.pointerButtons = buttons;\n    return !this.pointerLock && this.device === 'pointer' && capture;\n  },\n\n  threshold(value, _k, {\n    filterTaps = false,\n    tapsThreshold = 3,\n    axis = undefined\n  }) {\n    const threshold = V.toVector(value, filterTaps ? tapsThreshold : axis ? 1 : 0);\n    this.filterTaps = filterTaps;\n    this.tapsThreshold = tapsThreshold;\n    return threshold;\n  },\n\n  swipe({\n    velocity = DEFAULT_SWIPE_VELOCITY,\n    distance = DEFAULT_SWIPE_DISTANCE,\n    duration = DEFAULT_SWIPE_DURATION\n  } = {}) {\n    return {\n      velocity: this.transform(V.toVector(velocity)),\n      distance: this.transform(V.toVector(distance)),\n      duration\n    };\n  },\n\n  delay(value = 0) {\n    switch (value) {\n      case true:\n        return DEFAULT_DRAG_DELAY;\n\n      case false:\n        return 0;\n\n      default:\n        return value;\n    }\n  },\n\n  axisThreshold(value) {\n    if (!value) return DEFAULT_DRAG_AXIS_THRESHOLD;\n    return _objectSpread2(_objectSpread2({}, DEFAULT_DRAG_AXIS_THRESHOLD), value);\n  }\n\n});\n\nif (process.env.NODE_ENV === 'development') {\n  Object.assign(dragConfigResolver, {\n    useTouch(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`useTouch\\` option has been renamed to \\`pointer.touch\\`. Use it as in \\`{ pointer: { touch: true } }\\`.`);\n      }\n\n      return NaN;\n    },\n\n    experimental_preventWindowScrollY(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`experimental_preventWindowScrollY\\` option has been renamed to \\`preventScroll\\`.`);\n      }\n\n      return NaN;\n    },\n\n    swipeVelocity(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeVelocity\\` option has been renamed to \\`swipe.velocity\\`. Use it as in \\`{ swipe: { velocity: 0.5 } }\\`.`);\n      }\n\n      return NaN;\n    },\n\n    swipeDistance(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeDistance\\` option has been renamed to \\`swipe.distance\\`. Use it as in \\`{ swipe: { distance: 50 } }\\`.`);\n      }\n\n      return NaN;\n    },\n\n    swipeDuration(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeDuration\\` option has been renamed to \\`swipe.duration\\`. Use it as in \\`{ swipe: { duration: 250 } }\\`.`);\n      }\n\n      return NaN;\n    }\n\n  });\n}\n\nconst SCALE_ANGLE_RATIO_INTENT_DEG = 30;\nconst PINCH_WHEEL_RATIO = 100;\nclass PinchEngine extends Engine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'pinching');\n\n    _defineProperty(this, \"aliasKey\", 'da');\n  }\n\n  init() {\n    this.state.offset = [1, 0];\n    this.state.lastOffset = [1, 0];\n    this.state._pointerEvents = new Map();\n  }\n\n  reset() {\n    super.reset();\n    const state = this.state;\n    state._touchIds = [];\n    state.canceled = false;\n    state.cancel = this.cancel.bind(this);\n    state.turns = 0;\n  }\n\n  computeOffset() {\n    const {\n      type,\n      movement,\n      lastOffset\n    } = this.state;\n\n    if (type === 'wheel') {\n      this.state.offset = V.add(movement, lastOffset);\n    } else {\n      this.state.offset = [(1 + movement[0]) * lastOffset[0], movement[1] + lastOffset[1]];\n    }\n  }\n\n  computeMovement() {\n    const {\n      offset,\n      lastOffset\n    } = this.state;\n    this.state.movement = [offset[0] / lastOffset[0], offset[1] - lastOffset[1]];\n  }\n\n  axisIntent() {\n    const state = this.state;\n    const [_m0, _m1] = state._movement;\n\n    if (!state.axis) {\n      const axisMovementDifference = Math.abs(_m0) * SCALE_ANGLE_RATIO_INTENT_DEG - Math.abs(_m1);\n      if (axisMovementDifference < 0) state.axis = 'angle';else if (axisMovementDifference > 0) state.axis = 'scale';\n    }\n  }\n\n  restrictToAxis(v) {\n    if (this.config.lockDirection) {\n      if (this.state.axis === 'scale') v[1] = 0;else if (this.state.axis === 'angle') v[0] = 0;\n    }\n  }\n\n  cancel() {\n    const state = this.state;\n    if (state.canceled) return;\n    setTimeout(() => {\n      state.canceled = true;\n      state._active = false;\n      this.compute();\n      this.emit();\n    }, 0);\n  }\n\n  touchStart(event) {\n    this.ctrl.setEventIds(event);\n    const state = this.state;\n    const ctrlTouchIds = this.ctrl.touchIds;\n\n    if (state._active) {\n      if (state._touchIds.every(id => ctrlTouchIds.has(id))) return;\n    }\n\n    if (ctrlTouchIds.size < 2) return;\n    this.start(event);\n    state._touchIds = Array.from(ctrlTouchIds).slice(0, 2);\n    const payload = touchDistanceAngle(event, state._touchIds);\n    this.pinchStart(event, payload);\n  }\n\n  pointerStart(event) {\n    if (event.buttons != null && event.buttons % 2 !== 1) return;\n    this.ctrl.setEventIds(event);\n    event.target.setPointerCapture(event.pointerId);\n    const state = this.state;\n    const _pointerEvents = state._pointerEvents;\n    const ctrlPointerIds = this.ctrl.pointerIds;\n\n    if (state._active) {\n      if (Array.from(_pointerEvents.keys()).every(id => ctrlPointerIds.has(id))) return;\n    }\n\n    if (_pointerEvents.size < 2) {\n      _pointerEvents.set(event.pointerId, event);\n    }\n\n    if (state._pointerEvents.size < 2) return;\n    this.start(event);\n    const payload = distanceAngle(...Array.from(_pointerEvents.values()));\n    this.pinchStart(event, payload);\n  }\n\n  pinchStart(event, payload) {\n    const state = this.state;\n    state.origin = payload.origin;\n    this.computeValues([payload.distance, payload.angle]);\n    this.computeInitial();\n    this.compute(event);\n    this.emit();\n  }\n\n  touchMove(event) {\n    if (!this.state._active) return;\n    const payload = touchDistanceAngle(event, this.state._touchIds);\n    this.pinchMove(event, payload);\n  }\n\n  pointerMove(event) {\n    const _pointerEvents = this.state._pointerEvents;\n\n    if (_pointerEvents.has(event.pointerId)) {\n      _pointerEvents.set(event.pointerId, event);\n    }\n\n    if (!this.state._active) return;\n    const payload = distanceAngle(...Array.from(_pointerEvents.values()));\n    this.pinchMove(event, payload);\n  }\n\n  pinchMove(event, payload) {\n    const state = this.state;\n    const prev_a = state._values[1];\n    const delta_a = payload.angle - prev_a;\n    let delta_turns = 0;\n    if (Math.abs(delta_a) > 270) delta_turns += Math.sign(delta_a);\n    this.computeValues([payload.distance, payload.angle - 360 * delta_turns]);\n    state.origin = payload.origin;\n    state.turns = delta_turns;\n    state._movement = [state._values[0] / state._initial[0] - 1, state._values[1] - state._initial[1]];\n    this.compute(event);\n    this.emit();\n  }\n\n  touchEnd(event) {\n    this.ctrl.setEventIds(event);\n    if (!this.state._active) return;\n\n    if (this.state._touchIds.some(id => !this.ctrl.touchIds.has(id))) {\n      this.state._active = false;\n      this.compute(event);\n      this.emit();\n    }\n  }\n\n  pointerEnd(event) {\n    const state = this.state;\n    this.ctrl.setEventIds(event);\n\n    try {\n      event.target.releasePointerCapture(event.pointerId);\n    } catch (_unused) {}\n\n    if (state._pointerEvents.has(event.pointerId)) {\n      state._pointerEvents.delete(event.pointerId);\n    }\n\n    if (!state._active) return;\n\n    if (state._pointerEvents.size < 2) {\n      state._active = false;\n      this.compute(event);\n      this.emit();\n    }\n  }\n\n  gestureStart(event) {\n    if (event.cancelable) event.preventDefault();\n    const state = this.state;\n    if (state._active) return;\n    this.start(event);\n    this.computeValues([event.scale, event.rotation]);\n    state.origin = [event.clientX, event.clientY];\n    this.compute(event);\n    this.emit();\n  }\n\n  gestureMove(event) {\n    if (event.cancelable) event.preventDefault();\n    if (!this.state._active) return;\n    const state = this.state;\n    this.computeValues([event.scale, event.rotation]);\n    state.origin = [event.clientX, event.clientY];\n    const _previousMovement = state._movement;\n    state._movement = [event.scale - 1, event.rotation];\n    state._delta = V.sub(state._movement, _previousMovement);\n    this.compute(event);\n    this.emit();\n  }\n\n  gestureEnd(event) {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute(event);\n    this.emit();\n  }\n\n  wheel(event) {\n    const modifierKey = this.config.modifierKey;\n    if (modifierKey && !event[modifierKey]) return;\n    if (!this.state._active) this.wheelStart(event);else this.wheelChange(event);\n    this.timeoutStore.add('wheelEnd', this.wheelEnd.bind(this));\n  }\n\n  wheelStart(event) {\n    this.start(event);\n    this.wheelChange(event);\n  }\n\n  wheelChange(event) {\n    const isR3f = ('uv' in event);\n\n    if (!isR3f) {\n      if (event.cancelable) {\n        event.preventDefault();\n      }\n\n      if (process.env.NODE_ENV === 'development' && !event.defaultPrevented) {\n        console.warn(`[@use-gesture]: To properly support zoom on trackpads, try using the \\`target\\` option.\\n\\nThis message will only appear in development mode.`);\n      }\n    }\n\n    const state = this.state;\n    state._delta = [-wheelValues(event)[1] / PINCH_WHEEL_RATIO * state.offset[0], 0];\n    V.addTo(state._movement, state._delta);\n    this.state.origin = [event.clientX, event.clientY];\n    this.compute(event);\n    this.emit();\n  }\n\n  wheelEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    const device = this.config.device;\n\n    if (!!device) {\n      bindFunction(device, 'start', this[device + 'Start'].bind(this));\n      bindFunction(device, 'change', this[device + 'Move'].bind(this));\n      bindFunction(device, 'end', this[device + 'End'].bind(this));\n      bindFunction(device, 'cancel', this[device + 'End'].bind(this));\n    } else {\n      bindFunction('wheel', '', this.wheel.bind(this), {\n        passive: false\n      });\n    }\n  }\n\n}\n\nconst pinchConfigResolver = _objectSpread2(_objectSpread2({}, commonConfigResolver), {}, {\n  device(_v, _k, {\n    shared,\n    pointer: {\n      touch = false\n    } = {}\n  }) {\n    const sharedConfig = shared;\n    if (sharedConfig.target && !SUPPORT.touch && SUPPORT.gesture) return 'gesture';\n    if (SUPPORT.touch && touch) return 'touch';\n\n    if (SUPPORT.touchscreen) {\n      if (SUPPORT.pointer) return 'pointer';\n      if (SUPPORT.touch) return 'touch';\n    }\n  },\n\n  bounds(_v, _k, {\n    scaleBounds = {},\n    angleBounds = {}\n  }) {\n    const _scaleBounds = state => {\n      const D = assignDefault(call(scaleBounds, state), {\n        min: -Infinity,\n        max: Infinity\n      });\n      return [D.min, D.max];\n    };\n\n    const _angleBounds = state => {\n      const A = assignDefault(call(angleBounds, state), {\n        min: -Infinity,\n        max: Infinity\n      });\n      return [A.min, A.max];\n    };\n\n    if (typeof scaleBounds !== 'function' && typeof angleBounds !== 'function') return [_scaleBounds(), _angleBounds()];\n    return state => [_scaleBounds(state), _angleBounds(state)];\n  },\n\n  threshold(value, _k, config) {\n    this.lockDirection = config.axis === 'lock';\n    const threshold = V.toVector(value, this.lockDirection ? [0.1, 3] : 0);\n    return threshold;\n  },\n\n  modifierKey(value) {\n    if (value === undefined) return 'ctrlKey';\n    return value;\n  }\n\n});\n\nclass MoveEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'moving');\n  }\n\n  move(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    if (!this.state._active) this.moveStart(event);else this.moveChange(event);\n    this.timeoutStore.add('moveEnd', this.moveEnd.bind(this));\n  }\n\n  moveStart(event) {\n    this.start(event);\n    this.computeValues(pointerValues(event));\n    this.compute(event);\n    this.computeInitial();\n    this.emit();\n  }\n\n  moveChange(event) {\n    if (!this.state._active) return;\n    const values = pointerValues(event);\n    const state = this.state;\n    state._delta = V.sub(values, state._values);\n    V.addTo(state._movement, state._delta);\n    this.computeValues(values);\n    this.compute(event);\n    this.emit();\n  }\n\n  moveEnd(event) {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute(event);\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('pointer', 'change', this.move.bind(this));\n    bindFunction('pointer', 'leave', this.moveEnd.bind(this));\n  }\n\n}\n\nconst moveConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  mouseOnly: (value = true) => value\n});\n\nclass ScrollEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'scrolling');\n  }\n\n  scroll(event) {\n    if (!this.state._active) this.start(event);\n    this.scrollChange(event);\n    this.timeoutStore.add('scrollEnd', this.scrollEnd.bind(this));\n  }\n\n  scrollChange(event) {\n    if (event.cancelable) event.preventDefault();\n    const state = this.state;\n    const values = scrollValues(event);\n    state._delta = V.sub(values, state._values);\n    V.addTo(state._movement, state._delta);\n    this.computeValues(values);\n    this.compute(event);\n    this.emit();\n  }\n\n  scrollEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('scroll', '', this.scroll.bind(this));\n  }\n\n}\n\nconst scrollConfigResolver = coordinatesConfigResolver;\n\nclass WheelEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'wheeling');\n  }\n\n  wheel(event) {\n    if (!this.state._active) this.start(event);\n    this.wheelChange(event);\n    this.timeoutStore.add('wheelEnd', this.wheelEnd.bind(this));\n  }\n\n  wheelChange(event) {\n    const state = this.state;\n    state._delta = wheelValues(event);\n    V.addTo(state._movement, state._delta);\n    const [ox, oy] = state.overflow;\n    const [dx, dy] = state._delta;\n    const [dirx, diry] = state._direction;\n\n    if (ox < 0 && dx > 0 && dirx < 0 || ox > 0 && dx < 0 && dirx > 0) {\n      state._movement[0] = state._movementBound[0];\n    }\n\n    if (oy < 0 && dy > 0 && diry < 0 || oy > 0 && dy < 0 && diry > 0) {\n      state._movement[1] = state._movementBound[1];\n    }\n\n    this.compute(event);\n    this.emit();\n  }\n\n  wheelEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('wheel', '', this.wheel.bind(this));\n  }\n\n}\n\nconst wheelConfigResolver = coordinatesConfigResolver;\n\nclass HoverEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'hovering');\n  }\n\n  enter(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    this.start(event);\n    this.computeValues(pointerValues(event));\n    this.compute(event);\n    this.emit();\n  }\n\n  leave(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    const state = this.state;\n    if (!state._active) return;\n    state._active = false;\n    const values = pointerValues(event);\n    state._movement = state._delta = V.sub(values, state._values);\n    this.computeValues(values);\n    this.compute(event);\n    state.delta = state.movement;\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('pointer', 'enter', this.enter.bind(this));\n    bindFunction('pointer', 'leave', this.leave.bind(this));\n  }\n\n}\n\nconst hoverConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  mouseOnly: (value = true) => value\n});\n\nconst EngineMap = new Map();\nconst ConfigResolverMap = new Map();\nfunction registerAction(action) {\n  EngineMap.set(action.key, action.engine);\n  ConfigResolverMap.set(action.key, action.resolver);\n}\nconst dragAction = {\n  key: 'drag',\n  engine: DragEngine,\n  resolver: dragConfigResolver\n};\nconst hoverAction = {\n  key: 'hover',\n  engine: HoverEngine,\n  resolver: hoverConfigResolver\n};\nconst moveAction = {\n  key: 'move',\n  engine: MoveEngine,\n  resolver: moveConfigResolver\n};\nconst pinchAction = {\n  key: 'pinch',\n  engine: PinchEngine,\n  resolver: pinchConfigResolver\n};\nconst scrollAction = {\n  key: 'scroll',\n  engine: ScrollEngine,\n  resolver: scrollConfigResolver\n};\nconst wheelAction = {\n  key: 'wheel',\n  engine: WheelEngine,\n  resolver: wheelConfigResolver\n};\n\nexport { ConfigResolverMap as C, EngineMap as E, SUPPORT as S, _objectSpread2 as _, _defineProperty as a, touchIds as b, chain as c, toHandlerProp as d, dragAction as e, pinchAction as f, hoverAction as h, isTouch as i, moveAction as m, parseProp as p, registerAction as r, scrollAction as s, toDomEventType as t, wheelAction as w };\n","function clamp(v, min, max) {\n  return Math.max(min, Math.min(v, max));\n}\nconst V = {\n  toVector(v, fallback) {\n    if (v === undefined) v = fallback;\n    return Array.isArray(v) ? v : [v, v];\n  },\n\n  add(v1, v2) {\n    return [v1[0] + v2[0], v1[1] + v2[1]];\n  },\n\n  sub(v1, v2) {\n    return [v1[0] - v2[0], v1[1] - v2[1]];\n  },\n\n  addTo(v1, v2) {\n    v1[0] += v2[0];\n    v1[1] += v2[1];\n  },\n\n  subTo(v1, v2) {\n    v1[0] -= v2[0];\n    v1[1] -= v2[1];\n  }\n\n};\n\nfunction rubberband(distance, dimension, constant) {\n  if (dimension === 0 || Math.abs(dimension) === Infinity) return Math.pow(distance, constant * 5);\n  return distance * dimension * constant / (dimension + constant * distance);\n}\n\nfunction rubberbandIfOutOfBounds(position, min, max, constant = 0.15) {\n  if (constant === 0) return clamp(position, min, max);\n  if (position < min) return -rubberband(min - position, max - min, constant) + min;\n  if (position > max) return +rubberband(position - max, max - min, constant) + max;\n  return position;\n}\nfunction computeRubberband(bounds, [Vx, Vy], [Rx, Ry]) {\n  const [[X0, X1], [Y0, Y1]] = bounds;\n  return [rubberbandIfOutOfBounds(Vx, X0, X1, Rx), rubberbandIfOutOfBounds(Vy, Y0, Y1, Ry)];\n}\n\nexport { V, computeRubberband as c, rubberbandIfOutOfBounds as r };\n","import { S as SUPPORT, C as ConfigResolverMap, _ as _objectSpread2, a as _defineProperty, t as toDomEventType, i as isTouch, b as touchIds, E as EngineMap, c as chain, p as parseProp, d as toHandlerProp } from './actions-8e12537b.esm.js';\nimport './maths-b2a210f4.esm.js';\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nconst sharedConfigResolver = {\n  target(value) {\n    if (value) {\n      return () => 'current' in value ? value.current : value;\n    }\n\n    return undefined;\n  },\n\n  enabled(value = true) {\n    return value;\n  },\n\n  window(value = SUPPORT.isBrowser ? window : undefined) {\n    return value;\n  },\n\n  eventOptions({\n    passive = true,\n    capture = false\n  } = {}) {\n    return {\n      passive,\n      capture\n    };\n  },\n\n  transform(value) {\n    return value;\n  }\n\n};\n\nconst _excluded = [\"target\", \"eventOptions\", \"window\", \"enabled\", \"transform\"];\nfunction resolveWith(config = {}, resolvers) {\n  const result = {};\n\n  for (const [key, resolver] of Object.entries(resolvers)) {\n    switch (typeof resolver) {\n      case 'function':\n        if (process.env.NODE_ENV === 'development') {\n          const r = resolver.call(result, config[key], key, config);\n          if (!Number.isNaN(r)) result[key] = r;\n        } else {\n          result[key] = resolver.call(result, config[key], key, config);\n        }\n\n        break;\n\n      case 'object':\n        result[key] = resolveWith(config[key], resolver);\n        break;\n\n      case 'boolean':\n        if (resolver) result[key] = config[key];\n        break;\n    }\n  }\n\n  return result;\n}\nfunction parse(config, gestureKey) {\n  const _ref = config,\n        {\n    target,\n    eventOptions,\n    window,\n    enabled,\n    transform\n  } = _ref,\n        rest = _objectWithoutProperties(_ref, _excluded);\n\n  const _config = {\n    shared: resolveWith({\n      target,\n      eventOptions,\n      window,\n      enabled,\n      transform\n    }, sharedConfigResolver)\n  };\n\n  if (gestureKey) {\n    const resolver = ConfigResolverMap.get(gestureKey);\n    _config[gestureKey] = resolveWith(_objectSpread2({\n      shared: _config.shared\n    }, rest), resolver);\n  } else {\n    for (const key in rest) {\n      const resolver = ConfigResolverMap.get(key);\n\n      if (resolver) {\n        _config[key] = resolveWith(_objectSpread2({\n          shared: _config.shared\n        }, rest[key]), resolver);\n      } else if (process.env.NODE_ENV === 'development') {\n        if (!['drag', 'pinch', 'scroll', 'wheel', 'move', 'hover'].includes(key)) {\n          if (key === 'domTarget') {\n            throw Error(`[@use-gesture]: \\`domTarget\\` option has been renamed to \\`target\\`.`);\n          }\n\n          console.warn(`[@use-gesture]: Unknown config key \\`${key}\\` was used. Please read the documentation for further information.`);\n        }\n      }\n    }\n  }\n\n  return _config;\n}\n\nclass EventStore {\n  constructor(ctrl) {\n    _defineProperty(this, \"_listeners\", []);\n\n    this._ctrl = ctrl;\n  }\n\n  add(element, device, action, handler, options) {\n    const type = toDomEventType(device, action);\n\n    const eventOptions = _objectSpread2(_objectSpread2({}, this._ctrl.config.shared.eventOptions), options);\n\n    element.addEventListener(type, handler, eventOptions);\n\n    this._listeners.push(() => element.removeEventListener(type, handler, eventOptions));\n  }\n\n  clean() {\n    this._listeners.forEach(remove => remove());\n\n    this._listeners = [];\n  }\n\n}\n\nclass TimeoutStore {\n  constructor() {\n    _defineProperty(this, \"_timeouts\", new Map());\n  }\n\n  add(key, callback, ms = 140, ...args) {\n    this.remove(key);\n\n    this._timeouts.set(key, window.setTimeout(callback, ms, ...args));\n  }\n\n  remove(key) {\n    const timeout = this._timeouts.get(key);\n\n    if (timeout) window.clearTimeout(timeout);\n  }\n\n  clean() {\n    this._timeouts.forEach(timeout => void window.clearTimeout(timeout));\n\n    this._timeouts.clear();\n  }\n\n}\n\nclass Controller {\n  constructor(handlers) {\n    _defineProperty(this, \"gestures\", new Set());\n\n    _defineProperty(this, \"_targetEventStore\", new EventStore(this));\n\n    _defineProperty(this, \"gestureEventStores\", {});\n\n    _defineProperty(this, \"gestureTimeoutStores\", {});\n\n    _defineProperty(this, \"handlers\", {});\n\n    _defineProperty(this, \"config\", {});\n\n    _defineProperty(this, \"pointerIds\", new Set());\n\n    _defineProperty(this, \"touchIds\", new Set());\n\n    _defineProperty(this, \"state\", {\n      shared: {\n        shiftKey: false,\n        metaKey: false,\n        ctrlKey: false,\n        altKey: false\n      }\n    });\n\n    resolveGestures(this, handlers);\n  }\n\n  setEventIds(event) {\n    if (isTouch(event)) {\n      this.touchIds = new Set(touchIds(event));\n    } else if ('pointerId' in event) {\n      if (event.type === 'pointerup' || event.type === 'pointercancel') this.pointerIds.delete(event.pointerId);else if (event.type === 'pointerdown') this.pointerIds.add(event.pointerId);\n    }\n  }\n\n  applyHandlers(handlers, nativeHandlers) {\n    this.handlers = handlers;\n    this.nativeHandlers = nativeHandlers;\n  }\n\n  applyConfig(config, gestureKey) {\n    this.config = parse(config, gestureKey);\n  }\n\n  clean() {\n    this._targetEventStore.clean();\n\n    for (const key of this.gestures) {\n      this.gestureEventStores[key].clean();\n      this.gestureTimeoutStores[key].clean();\n    }\n  }\n\n  effect() {\n    if (this.config.shared.target) this.bind();\n    return () => this._targetEventStore.clean();\n  }\n\n  bind(...args) {\n    const sharedConfig = this.config.shared;\n    const eventOptions = sharedConfig.eventOptions;\n    const props = {};\n    let target;\n\n    if (sharedConfig.target) {\n      target = sharedConfig.target();\n      if (!target) return;\n    }\n\n    const bindFunction = bindToProps(props, eventOptions, !!target);\n\n    if (sharedConfig.enabled) {\n      for (const gestureKey of this.gestures) {\n        if (this.config[gestureKey].enabled) {\n          const Engine = EngineMap.get(gestureKey);\n          new Engine(this, args, gestureKey).bind(bindFunction);\n        }\n      }\n\n      for (const eventKey in this.nativeHandlers) {\n        bindFunction(eventKey, '', event => this.nativeHandlers[eventKey](_objectSpread2(_objectSpread2({}, this.state.shared), {}, {\n          event,\n          args\n        })), undefined, true);\n      }\n    }\n\n    for (const handlerProp in props) {\n      props[handlerProp] = chain(...props[handlerProp]);\n    }\n\n    if (!target) return props;\n\n    for (const handlerProp in props) {\n      const {\n        device,\n        capture,\n        passive\n      } = parseProp(handlerProp);\n\n      this._targetEventStore.add(target, device, '', props[handlerProp], {\n        capture,\n        passive\n      });\n    }\n  }\n\n}\n\nfunction setupGesture(ctrl, gestureKey) {\n  ctrl.gestures.add(gestureKey);\n  ctrl.gestureEventStores[gestureKey] = new EventStore(ctrl);\n  ctrl.gestureTimeoutStores[gestureKey] = new TimeoutStore();\n}\n\nfunction resolveGestures(ctrl, internalHandlers) {\n  if (internalHandlers.drag) setupGesture(ctrl, 'drag');\n  if (internalHandlers.wheel) setupGesture(ctrl, 'wheel');\n  if (internalHandlers.scroll) setupGesture(ctrl, 'scroll');\n  if (internalHandlers.move) setupGesture(ctrl, 'move');\n  if (internalHandlers.pinch) setupGesture(ctrl, 'pinch');\n  if (internalHandlers.hover) setupGesture(ctrl, 'hover');\n}\n\nconst bindToProps = (props, eventOptions, withPassiveOption) => (device, action, handler, options = {}, isNative = false) => {\n  var _options$capture, _options$passive;\n\n  const capture = (_options$capture = options.capture) !== null && _options$capture !== void 0 ? _options$capture : eventOptions.capture;\n  const passive = (_options$passive = options.passive) !== null && _options$passive !== void 0 ? _options$passive : eventOptions.passive;\n  let handlerProp = isNative ? device : toHandlerProp(device, action, capture);\n  if (withPassiveOption && passive) handlerProp += 'Passive';\n  props[handlerProp] = props[handlerProp] || [];\n  props[handlerProp].push(handler);\n};\n\nconst RE_NOT_NATIVE = /^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;\n\nfunction sortHandlers(_handlers) {\n  const native = {};\n  const handlers = {};\n  const actions = new Set();\n\n  for (let key in _handlers) {\n    if (RE_NOT_NATIVE.test(key)) {\n      actions.add(RegExp.lastMatch);\n      handlers[key] = _handlers[key];\n    } else {\n      native[key] = _handlers[key];\n    }\n  }\n\n  return [handlers, native, actions];\n}\n\nfunction registerGesture(actions, handlers, handlerKey, key, internalHandlers, config) {\n  if (!actions.has(handlerKey)) return;\n\n  if (!EngineMap.has(key)) {\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(`[@use-gesture]: You've created a custom handler that that uses the \\`${key}\\` gesture but isn't properly configured.\\n\\nPlease add \\`${key}Action\\` when creating your handler.`);\n    }\n\n    return;\n  }\n\n  const startKey = handlerKey + 'Start';\n  const endKey = handlerKey + 'End';\n\n  const fn = state => {\n    let memo = undefined;\n    if (state.first && startKey in handlers) handlers[startKey](state);\n    if (handlerKey in handlers) memo = handlers[handlerKey](state);\n    if (state.last && endKey in handlers) handlers[endKey](state);\n    return memo;\n  };\n\n  internalHandlers[key] = fn;\n  config[key] = config[key] || {};\n}\n\nfunction parseMergedHandlers(mergedHandlers, mergedConfig) {\n  const [handlers, nativeHandlers, actions] = sortHandlers(mergedHandlers);\n  const internalHandlers = {};\n  registerGesture(actions, handlers, 'onDrag', 'drag', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onWheel', 'wheel', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onScroll', 'scroll', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onPinch', 'pinch', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onMove', 'move', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onHover', 'hover', internalHandlers, mergedConfig);\n  return {\n    handlers: internalHandlers,\n    config: mergedConfig,\n    nativeHandlers\n  };\n}\n\nexport { Controller, parseMergedHandlers };\n","export { r as rubberbandIfOutOfBounds } from '../../dist/maths-b2a210f4.esm.js';\n","import { registerAction, dragAction, pinchAction, wheelAction, scrollAction, moveAction, hoverAction } from '@use-gesture/core/actions';\nexport * from '@use-gesture/core/actions';\nimport { Controller, parseMergedHandlers } from '@use-gesture/core';\nexport * from '@use-gesture/core/utils';\nexport * from '@use-gesture/core/types';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nconst Recognizer = function Recognizer(target, handlers, config, gestureKey, nativeHandlers) {\n  this._gestureKey = gestureKey;\n  this._ctrl = new Controller(handlers);\n\n  this._ctrl.applyHandlers(handlers, nativeHandlers);\n\n  this._ctrl.applyConfig(_objectSpread2(_objectSpread2({}, config), {}, {\n    target\n  }), this._gestureKey);\n\n  this._ctrl.effect();\n};\n\nRecognizer.prototype.destroy = function () {\n  this._ctrl.clean();\n};\n\nconst DragGesture = function DragGesture(target, handler, config = {}) {\n  registerAction(dragAction);\n  return new Recognizer(target, {\n    drag: handler\n  }, config, 'drag');\n};\n\nconst PinchGesture = function PinchGesture(target, handler, config = {}) {\n  registerAction(pinchAction);\n  return new Recognizer(target, {\n    pinch: handler\n  }, config, 'pinch');\n};\n\nconst WheelGesture = function WheelGesture(target, handler, config = {}) {\n  registerAction(wheelAction);\n  return new Recognizer(target, {\n    wheel: handler\n  }, config, 'wheel');\n};\n\nconst ScrollGesture = function ScrollGesture(target, handler, config = {}) {\n  registerAction(scrollAction);\n  return new Recognizer(target, {\n    scroll: handler\n  }, config, 'scroll');\n};\n\nconst MoveGesture = function MoveGesture(target, handler, config = {}) {\n  registerAction(moveAction);\n  return new Recognizer(target, {\n    move: handler\n  }, config, 'move');\n};\n\nconst HoverGesture = function HoverGesture(target, handler, config = {}) {\n  registerAction(hoverAction);\n  return new Recognizer(target, {\n    hover: handler\n  }, config, 'hover');\n};\n\nfunction createGesture(actions) {\n  actions.forEach(registerAction);\n  return function (target, _handlers, _config = {}) {\n    const {\n      handlers,\n      nativeHandlers,\n      config\n    } = parseMergedHandlers(_handlers, _config);\n    return new Recognizer(target, handlers, config, undefined, nativeHandlers);\n  };\n}\n\nconst Gesture = function Gesture(target, handlers, config = {}) {\n  const gestureFunction = createGesture([dragAction, pinchAction, scrollAction, wheelAction, moveAction, hoverAction]);\n  return gestureFunction(target, handlers, config);\n};\n\nexport { DragGesture, Gesture, HoverGesture, MoveGesture, PinchGesture, ScrollGesture, WheelGesture };\n","import { select } from 'lib/selectors'\n\nexport default async function isCameraAvailableForVTO(callback) {\n  const isProductTypeWithVTO = /(Eyewear|Makeup)/g.test(select('body').className)\n  const vtoContainer = await select('.vto__container--inner')\n  const errorContainer = await select(\".permissionDenied\", vtoContainer)\n  const isVtoLaunched = !!vtoContainer\n  const error = !!errorContainer\n\n  return callback(!(isProductTypeWithVTO && isVtoLaunched && error))\n}\n","const minMax = (val, min, max) => Math.min(Math.max(val, min), max)\n\nconst is = {\n  arr: (a) => Array.isArray(a),\n  obj: (a) => stringContains(Object.prototype.toString.call(a), 'Object'),\n  pth: (a) => is.obj(a) && a.hasOwnProperty('totalLength'),\n  svg: (a) => a instanceof SVGElement,\n  inp: (a) => a instanceof HTMLInputElement,\n  dom: (a) => a.nodeType || is.svg(a),\n  str: (a) => typeof a === 'string',\n  fnc: (a) => typeof a === 'function',\n  und: (a) => typeof a === 'undefined',\n  nil: (a) => is.und(a) || a === null,\n  hex: (a) => /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a),\n  rgb: (a) => /^rgb/.test(a),\n  hsl: (a) => /^hsl/.test(a),\n  col: (a) => (is.hex(a) || is.rgb(a) || is.hsl(a)),\n  key: (a) => !defaultInstanceSettings.hasOwnProperty(a) && !defaultTweenSettings.hasOwnProperty(a) && a !== 'targets' && a !== 'keyframes',\n};\n\nconst cache = {};\n\nexport function getDuration(stringKey, solver) {\n  const cached = cache[stringKey];\n  if (cached) { return cached; }\n  const frame = 1 / 6;\n  let elapsed = 0;\n  let rest = 0;\n  while (true) {\n    elapsed += frame;\n    if (solver(elapsed) === 1) {\n      rest += 1;\n      if (rest >= 16) { break; }\n    } else {\n      rest = 0;\n    }\n  }\n\n  const duration = elapsed * frame * 1000;\n  cache[stringKey] = duration;\n  return duration;\n}\n\n/***/\nexport function spring({ mass: pMass, stiffness: pStiffness, damping: pDamping, velocity: pVelocity }, pDuration = undefined) {\n\n  const mass = minMax(is.und(pMass) ? 1 : pMass, .1, 100);\n  const stiffness = minMax(is.und(pStiffness) ? 100 : pStiffness, .1, 1000);\n  const damping = minMax(is.und(pDamping) ? 10 : pDamping, .1, 100);\n  const velocity = minMax(is.und(pVelocity) ? 0 : pVelocity, .1, 100);\n  const zeta = damping / (2 * Math.sqrt(stiffness * mass)); // damping ratio\n  const omega0 = Math.sqrt(stiffness / mass); // undamped angular frequency of the oscillator (rad/ms)\n  const omega1 = zeta < 1 ? omega0 * Math.sqrt(1 - zeta * zeta) : 0; // exponential decay\n  const x0 = 1;\n  const b = zeta < 1 ? (zeta * omega0 + -velocity) / omega1 : -velocity + omega0;\n\n  // eslint-disable-next-line no-var\n  var duration = pDuration || getDuration(`spring(${[pMass, pStiffness, pDamping, pVelocity].join(',')})`, solver)\n\n  function solver(t) {\n    let progress = duration ? (duration * t) / 1000 : t;\n    if (zeta < 1) { // Under damped\n      progress = Math.exp(-progress * zeta * omega0) * (x0 * Math.cos(omega1 * progress) + b * Math.sin(omega1 * progress));\n    } else { // Critically damped\n      progress = (x0 + b * progress) * Math.exp(-progress * omega0);\n    }\n    if (t === 0 || t === 1) { return t; }\n    return 1 - progress;\n  }\n\n  console.log({ duration, stiffness, damping })\n\n  return { springEasing: solver, duration };\n}\n","import ProductDetails from './product-details'\nimport {AFTER_REPLACE_STATE, Manager, ON_COMPLETE_SCROLL_TO_ANCHOR, VARIANT_UPDATED, VARIANT_UPDATED_MONETATE, YAPI_PAGELOAD_RECEIVED , PAGELOAD_WISHLIST} from 'lib/events'\nimport {get, post} from 'modules/fetch'\nimport {getCollection, select, selectAll} from 'lib/selectors'\nimport Loader from 'ui/widgets/loader'\nimport config from 'lib/config'\nimport * as dBind from 'delegate'\nimport StickyManager from 'ui/sticky/manager'\nimport productDetailsCtasHandler from './product-details-ctas-handler'\nimport {initWishlistData} from 'lib/wishlist/wishlist-ui'\nimport { sanitizeWishlistData } from 'lib/wishlist/wishlist-yapi'\nimport { focusElement, getBrowserInfo, handlePopState, isMobile } from 'lib/helpers'\nimport isCameraAvailableForVTO from '../../lib/helpers/camera-detect'\nimport initPopinNotify from './popin-notify'\nimport CacheIndex from 'modules/cache/pages/index'\nimport {hasHash} from '../index'\nimport {PropagateLink} from '../../modules/propagate-link'\nimport popin from 'modules/popin'\nimport { init as initReworkedPDP } from './main'\n\nlet list = [];\nlet listAll= [];\nmanageQR()\nopenReviewUnsubscribePopin()\n\nlet wishlistDataArray\nconst wDLGA = window.dataLayerGA\nconst productNameDL = wDLGA && wDLGA.pageLoad.ecommerce && wDLGA.pageLoad.ecommerce.detail ? wDLGA.pageLoad.ecommerce.detail.products[0].name : ''\n\nconst prepareForVto = (product) => {\n  const browser = getBrowserInfo()\n  const is4ShadowProduct = product.basic.is4ShadowProduct\n  const ctoIntensity = product.basic.ctoIntensity\n  const urlHasVto = window.location.href.indexOf('#vto') > -1\n  const vtoContainer = document.querySelector('.vto__container')\n  const is4ShadowFeatureFlipping = product.is4ShadowFeatureFlipping\n  const color = 'color: aqua'\n\n\n  if (/IE|Edge/.test(browser.name)) {\n    return\n  }\n\n  history.pushState(\"\", document.title, window.location.pathname + window.location.search);\n\n  if (is4ShadowProduct && is4ShadowFeatureFlipping) {\n    // ONE-47999 :  4shadows products can have two intensities depending on market\n    switch(ctoIntensity) {\n      case 'APACCTOIntensity':\n        // only one intensity for markets /th, /tw, /sg, /hk-zh, /hk-en, /my\n        product.hasTwoIntensities = false\n        product.mainSku = `${product.code}-3`\n        break\n      case 'WWCTOIntensity':\n        // two intensities\n        product.mainSku = `${product.code}-1`\n        product.altSku = product.code\n        product.hasTwoIntensities = true\n        break\n      default:\n        product.mainSku = product.code\n    }\n  }\n\n  import('../../ui/vto').then(() => {\n    renderVTO(product, {\n      ctaContainer: () => select('.product-details .product-details__ctas'),\n      vtoContainer,\n      labels: config.locales.vto,\n      autostart: !!window.localStorage.getItem('vtoOpen') || hasHash,\n    })\n  })\n}\n\nfunction tryOnAriaLabelValue() {\n  const colorText = select('.pdp-sticky__description')\n  const vtoButton = select('.vto-open__wrapper button')\n  if (vtoButton && colorText) {\n    const colorTextDescription = colorText.innerHTML\n    let ariaLabelVal = vtoButton.getAttribute('aria-label')\n    ariaLabelVal = ariaLabelVal.concat(colorTextDescription.trim())\n    vtoButton.setAttribute('aria-label', ariaLabelVal)\n  }\n}\n\nfunction PDP(el) {\n  const isQuickView = !!el.closest('[role=\"dialog\"]')\n  const isCartView = !!el.closest('.sidepanel-quickview.cart')\n  const quickViewHeading = select('.product-details__head')\n  const pdpCtas = () => el.querySelector('.product-details__ctas')\n  const pdpText = () => el.querySelector('.notify-me-text')\n  const localStorage = window.localStorage\n  let selectedTabEl = null\n  const LIVE_LOADING_TEXT = select('.sidepanel__wrapper') ? select('.sidepanel__wrapper #js-live-loading-text') : select('.js-live-loading')\n  const bleuLightLink = select('.product-details__bll-link')\n\n    /*\n  * Add link with disclaimer text for order by phone CTA (Only for RU, LX & MX market)\n  */\n if (window.config.country=='RU' || window.config.country=='LX' || window.config.country=='MX') {\n    const disclaimerTag = select('#disclaimer-phone-order-content')\n    if (disclaimerTag) {\n        let aTag = document.createElement('a')\n        let spanTag = document.createElement('span')\n        aTag.setAttribute('rel', 'nofollow')\n        aTag.setAttribute('href', `#tabNavigation`)\n        aTag.classList.add('link', 'is-underline', 'is-gray', 'is-paddingLeft', 'link-order-phone')\n        spanTag.innerHTML = `${window.config.webservices.pdp.orderByPhoneDownLink}`\n        aTag.appendChild(spanTag)\n        disclaimerTag.appendChild(aTag)\n    }\n  }\n\n  // Reference has to be kept to unbind when variant is changed\n  let productDetails\n\n  /*\n    * Bind JS behaviours\n    */\n  function init(refresh = true) {\n  /*\n    *Analytics requirement on pageload for refill push component\n       */\n      const getElement= document.querySelector('.discover__link')\n      if(getElement)\n        dataLayer[0].sub_category_level3='refillable';\n      else\n        dataLayer[0].sub_category_level3='unrefillable';\n   /*\n    *Analytics requirement on pageload for refill push component\n       */\n\n\tif(pdpCtas() && !(sessionStorage.getItem('nobrand') === 'true')) {\n  \t\tCacheIndex.rePublishPageLoadData(PAGELOAD_WISHLIST)\n  \t\tManager.subscribe(PAGELOAD_WISHLIST, (wishlistData) => {\n  \t\t  wishlistDataArray = wishlistData\n  \t\t})\n  \t\tget(config.webservices.product.replace('{0}', `${pdpCtas().dataset.ref}?options=basic,vto,variants&site=chanel`))\n  \t\t\t.then((dataBasic) => {\n          let basicRes = dataBasic;\n        get(jsConfigSecond.product?.availability?.replace('{0}', `${pdpCtas().dataset.ref}?site=chanel`))\n          .then((dataStock) => {\n            const stockRes = dataStock.stock;\n            basicRes.stock = stockRes;\n            basicRes.buyNow.buyNowApplePayEnable = dataStock.buyNow.buyNowApplePayEnable;\n            basicRes.showNotifyMe = dataStock.showNotifyMe;\n            basicRes.showNotifyMeForQuickView = dataStock.showNotifyMeForQuickView;\n            basicRes.displayPOSdataForCnC = dataStock.displayPOSdataForCnC;\n  \t\t\t\t  const variantSelector = select('.variant')\n            const hasWishlistSelector = select('.has-wishlist')\n            sessionStorage.setItem('productName', basicRes.basic.name)\n            sessionStorage.setItem('productCode', basicRes.code)\n            sessionStorage.setItem('productStockLevel', stockRes.stockLevel)\n            sessionStorage.setItem('isClickAndCollect', stockRes.isClickAndCollect)\n  \t\t    \tif (basicRes.availableToCurrentUser===false) {\n              variantSelector ? variantSelector.style.display = \"none\" : '';\n              hasWishlistSelector ? hasWishlistSelector.style.display = \"none\" : '';\n  \t\t      } else {\n              variantSelector ? variantSelector.style.display = \"block\" : '';\n              hasWishlistSelector ? hasWishlistSelector.style.display = \"block\" : '';\n  \t\t      }\n\n            if (stockRes && !isQuickView) {\n              productDetailsCtasHandler(basicRes)\n            }\n\n            const productName = productNameDL ? productNameDL : basicRes.basic.name\n            if (stockRes.isClickAndCollect) {\n              clickAndCollectDisplayDl(productName)\n            }\n            else if (stockRes.stockLevel === \"IN_STOCK\" && basicRes.sellableOnline && (window.config.axisType === \"jewelry\" || window.config.axisType === \"watches\")) {\n              window.dataLayer.push({\n                eventCategory: 'add to cart',\n                eventAction: 'display',\n                eventLabel: productName,\n                event: 'nievent'\n              });\n            }\n            if (stockRes && stockRes.isClickAndCollect) {\n              const wfjSizeSelector = select('.wfj-size-dropdown')\n              let disclaimerIndicator = select('.disclaimer-indicator')\n              let disclaimerText = select('#disclaimer-text')\n              disclaimerIndicator ? disclaimerIndicator.remove() : ''\n              disclaimerText ? disclaimerText.remove() : ''\n              if (wfjSizeSelector) {\n                const wrapperElem = select('.dropdown__wrapper', wfjSizeSelector)\n                if (wrapperElem) {\n                const wrapperHeight = window.getComputedStyle(wrapperElem).height\n                wrapperElem.style.height = wrapperHeight\n                }\n              }\n            }\n            // avoid duplications on button vto\n            if (!isCartView && !isQuickView) {\n              const wishlist = sanitizeWishlistData(wishlistDataArray)\n              basicRes['wishlistData'] = wishlist\n              prepareForVto(basicRes)\n\n              if (basicRes.vto.vtoEnabled) {\n                Manager.publish('VTO_CAN_SHOW', basicRes)\n              } else {\n                Manager.publish('VTO_CANNOT_SHOW', basicRes)\n              }\n            }\n            if (basicRes.showBoyFriendConfigurator) {\n              const myBoyfriendCta = select('.js-myboyfriend-cta')\n              const MYBOYFRIEND_SCRIPT = window.config.myBoyfriendJsUrl\n              const MYBOYFRIEND_CSS = window.config.myBoyfriendCssUrl\n              const MYBOYFRIEND_DATA = window.config.myBoyfriendBackofficeUrl\n              window.GreenSockGlobals = {}\n              if (!myBoyfriendCta) {\n                const ctaSection = select('.product-details__ctas')\n                const template = `\n                <p class = \"myboyfriend-cta js-myboyfriend-cta\">\n                  <button name=\"boyconfigurator\" class=\"button is-secondary is-fullwidth\">\n                    <span class=\"button__wrapper\">\n                      <span class=\"button__icon\">\n                              <svg class=\"icon is-large is-watchCTA\" focusable=\"false\" viewBox=\"0 0 1 1\" aria-hidden=\"true\">\n                        <use xlink:href=\"/_ui/responsive/theme-onechanel/assets/icons.svg#ic_Watch\"/>\n                      </svg>\n                      </span>\n                      <span>`\n                        + config.myBoyFriendCtaText +\n                      `</span>\n                    </span>\n                  </button>\n                </p>\n                `\n                ctaSection.insertAdjacentHTML('beforeEnd', template)\n              }\n              const script = document.createElement('script')\n              script.src = MYBOYFRIEND_SCRIPT\n              script.id = 'myboyfriend-script-tag'\n              script.setAttribute('data-url', MYBOYFRIEND_DATA);\n              script.defer = true\n              document.head.appendChild(script)\n\n              let link = document.createElement('link')\n              link.rel = 'stylesheet'\n              link.href = MYBOYFRIEND_CSS\n              document.head.appendChild(link)\n            } else {\n              const myBoyfriendCta = select('.js-myboyfriend-cta')\n              if (myBoyfriendCta) {myBoyfriendCta.setAttribute('hidden','hidden')}\n            }\n            const NOTIFY_CONTAINER_SELECTOR = '.notify-me'\n            const NOTIFY_TEXT_SELECTOR = '.notify-me-text'\n            const productDetailsNotifyWrapperEl = select(NOTIFY_CONTAINER_SELECTOR)\n            const productNotifyTextWrapperEl = select(NOTIFY_TEXT_SELECTOR)\n            const pdpDisabledCtasWrapper = select('.notify-text-visible')\n            const pdptextWrapper = select('.notify-me-text')\n            if (basicRes.showNotifyMe) {\n              if(stockRes.stockLevel == 'COMING_SOON' || stockRes.stockLevel == 'OUT_STOCK'){\n                if(pdpDisabledCtasWrapper){\n                  pdpDisabledCtasWrapper.remove()\n                }\n                if(pdptextWrapper){\n                  pdptextWrapper.removeAttribute('hidden')\n                }\n              }\n              if (productDetailsNotifyWrapperEl != null) {\n                productDetailsNotifyWrapperEl.classList.remove('is-hidden')\n              }\n              if (productNotifyTextWrapperEl != null) {\n                productNotifyTextWrapperEl.classList.remove('is-hidden')\n              }\n            } else {\n              if(pdpDisabledCtasWrapper){\n                pdpDisabledCtasWrapper.removeAttribute('hidden')\n              }\n              if(pdptextWrapper){\n                pdptextWrapper.setAttribute('hidden','hidden')\n              }\n              if (productDetailsNotifyWrapperEl != null) {\n                productDetailsNotifyWrapperEl.classList.add('is-hidden')\n              }\n              if (productNotifyTextWrapperEl != null) {\n                productNotifyTextWrapperEl.classList.add('is-hidden')\n              }\n            }\n  \t\t    })\n  \t\t  })\n  \t\t}\n\n\t    productDetails = new ProductDetails(el, { onVariantChange, isQuickView })\n\t    productDetails.init()\n\t    window.addEventListener('popstate', handlePopState)\n\t    bindsEvents()\n\t    window.onVariantChange = onVariantChange.bind(this)\n      Manager.subscribe(ON_COMPLETE_SCROLL_TO_ANCHOR, addFocusAfterClick)\n\n      const orderByPhoneDisclaimerLink = select('.order-by-phone-text .link-order-phone')\n      if (orderByPhoneDisclaimerLink)\n        orderByPhoneDisclaimerLink.addEventListener('click', disclaimerLinkFocus)\n\n      const notifyMeQuickView = select(\"#notify-me-quickview\")\n      if (notifyMeQuickView) {\n        notifyMeQuickView.addEventListener('click', notifyMeClickQuickView)\n      }\n      if (select(\".jewelry-legal-mention\" )&& !isMobile()) {\n         selectAll('.jewelry-legal-mention > p').length == 1 ? select('.manual-link-container').style.marginTop = '0' : ''\n       }\n\n      if(bleuLightLink) {\n        bleuLightLinkDataLayer()\n      }\n  }\n\n  let CLIENT_HEIGHT = 0\n\n  function bleuLightLinkDataLayer() {\n    bleuLightLink.addEventListener('click', () => {\n      const productName = bleuLightLink.getAttribute('data-name')\n      window.dataLayer.push({\n        'eventCategory': 'product interaction',\n        'eventAction': 'blue_light_lenses',\n        'eventLabel': `${productName}`,\n        'event': 'uaevent'\n      })\n    })\n  }\n\n  function notifyMeClickQuickView() {\n    document.DLKit.push('notify-me', {\n      'eventAction': 'click quickview',\n      'eventLabel': sessionStorage.getItem('productName')\n    })\n    const fieldsBlock = select('.quick-view-notify-me .collapse-panel__content')\n    if (fieldsBlock) {\n      fieldsBlockAnimate(fieldsBlock)\n    }\n  }\n\n  function fieldsBlockAnimate(fieldsBlock) {\n    // calculate element real height and reset it to 0\n    fieldsBlock.style.height = 'auto'\n    CLIENT_HEIGHT = fieldsBlock.clientHeight\n    fieldsBlock.removeAttribute('style')\n    // Start animation\n    TweenLite.fromTo(fieldsBlock, .3, { height: 0, opacity:0 }, {height: CLIENT_HEIGHT, opacity: 1})\n    const notifyMeForm = select('form[id=formNotifyMeQuickView]', document.body)\n    if(notifyMeForm) {\n      notifyMeForm.removeEventListener('submit', submitNotifyMeQuickview)\n      notifyMeForm.addEventListener('submit', submitNotifyMeQuickview)\n    }\n  }\n\n  function clickAndCollectDisplayDl(name) {\n    document.DLKit.push('when-click-and-collect-cta-display', {\n      eventAction: 'display',\n      eventLabel: name\n    })\n  }\n\n  dBind(el, '.product-details__ctas .js-click-and-collect', 'click', clickAndCollectClickDl)\n\n  function clickAndCollectClickDl() {\n    document.DLKit.push('when-click-and-collect-cta-click', {\n      eventAction: 'click',\n      eventLabel: productNameDL\n    })\n  }\n\n  /*\n  * Bind notify me quickview submit event\n  */\n  const notifyMeForm = select('form[id=formNotifyMeQuickView]', document.body)\n  if(notifyMeForm) {\n    notifyMeForm.removeEventListener('submit', submitNotifyMeQuickview)\n    notifyMeForm.addEventListener('submit', submitNotifyMeQuickview)\n  }\n\n  function submitNotifyMeQuickview(e) {\n    e.preventDefault()\n    const userEmail = select('input[name=\"emailAddress\"]') ? select('input[name=\"emailAddress\"]').value : null\n    const productCode = select('input[name=\"productCode\"]') ? select('input[name=\"productCode\"]').value : null\n    const productStatus = select('input[name=\"productStatus\"]') ? select('input[name=\"productStatus\"]').value : null\n    const userPhoneNumber = select('input[name=\"phoneNumber\"]') ? select('input[name=\"phoneNumber\"]').value : null\n    let notifyFlag = false\n    if (config.country.toUpperCase() == \"CN\") {\n      const notifyError = select('#notifyError')\n      const notifyField = getCollection('.js-notify-field')\n      if (userEmail == '' && userPhoneNumber == '' ) {\n        if (notifyError.hasAttribute(\"hidden\")) {\n          notifyError.removeAttribute(\"hidden\")\n        }\n        notifyError.setAttribute('aria-hidden', false)\n        notifyError.classList.add('error')\n        notifyField.forEach(input => {\n          const field = input.closest('.field')\n          input.setAttribute('aria-invalid', true)\n          field.classList.add('has-error')\n        })\n        focusElement(notifyError)\n        notifyFlag = true\n      } else {\n        notifyError.setAttribute('hidden', '')\n        notifyError.setAttribute('aria-hidden', false)\n        notifyError.classList.remove('error')\n        notifyField.forEach(input => {\n          const id = input.getAttribute('id')\n          const elementId = `error-${id}`\n          const field = input.closest('.field')\n          if (!select(`[id=\"${elementId}\"]`)) {\n            input.removeAttribute('aria-invalid', true)\n            field.classList.remove('has-error')\n          }\n        })\n        notifyFlag = false\n      }\n    }\n    let data = {\n      emailAddress: userEmail,\n      productCode: productCode,\n      productStatus: productStatus\n    }\n    if (config.country.toUpperCase() == \"CN\") {\n      Object.assign(data, {\n        phoneNumber: userPhoneNumber,\n        legalPrivacy: select('input[name=\"legalPrivacy\"]') ? select('input[name=\"legalPrivacy\"]').value : null,\n        legacyConsent: select('input[name=\"legalConsent\"]') ? select('input[name=\"legalConsent\"]').value : null,\n        phoneCountryCodeField: select('input[name=\"phoneCountryCodeField\"]') ? select('input[name=\"phoneCountryCodeField\"]').value : null\n      })\n    }\n    const notifyMeCta = select('#formNotifyMeQuickView .button-notify-me button')\n    let loader\n    if (notifyMeCta) {\n      loader = new Loader(notifyMeCta, { button: true })\n      loader.init()\n      loader.create()\n    }\n    if (e.delegateTarget.invalid.length === 0 && !notifyFlag) {\n      post(e.delegateTarget.action, { data })\n        .then((response) => {\n          loader.destroy()\n          if (response.message) {\n            const inputEl = select(`input[name=\"${response.name}\"]`)\n            if (inputEl) {\n              inputEl.type = 'invalid'\n              setErrorMessage(inputEl, response.message)\n            }\n          } else {\n            let thankyouMsg = config.popinThankyou.popinMessage.replace(/{emailaddress}/gi, `<strong>${userEmail}</strong>`)\n            if(config.country.toUpperCase() == \"CN\") {\n              thankyouMsg = thankyouMsg.replace(/{phonenumber}/gi, `<strong>${userPhoneNumber}</strong>`)\n            }\n            const notifyMeQuickViewForm = select(\"#formNotifyMeQuickView\")\n            const thankyouMsgWrapper = select(\".thanku-wrapper-quickview\")\n            const thankyouTitle = select(\".thanku-wrapper-quickview .thanku-popin-heading\")\n            if (notifyMeQuickViewForm) {\n              notifyMeQuickViewForm.style.display = \"none\";\n              thankyouMsgWrapper.style.display = \"block\";\n              select(\".thanku-wrapper-quickview #thankuPopinMsg\").innerHTML = thankyouMsg\n              TweenLite.fromTo(notifyMeQuickViewForm, .5, { height: notifyMeQuickViewForm.clientHeight, opacity: 1 }, {height: 0, opacity: 0})\n              TweenLite.fromTo(thankyouMsgWrapper, .5, { height: 0, opacity: 0 }, {height: thankyouMsgWrapper.clientHeight, opacity: 1})\n              if (thankyouTitle)\n                focusElement(thankyouTitle)\n            }\n            document.DLKit.push('notify-me', {\n              'eventAction': 'submit quickview',\n              'eventLabel': sessionStorage.getItem('productName')\n            })\n          }\n        }).catch((error) => {\n          console.log(error)\n      })\n    } else {\n      loader.destroy()\n    }\n  }\n\n  function setErrorMessage(input, message){\n\n    if (!input) {\n      return\n    }\n\n    const field = input.closest('.field')\n\n    input.setAttribute('aria-invalid', true)\n\n    if (field) {\n      field.classList.add('has-error')\n    }\n    // Write error message\n    errorMessage(input, message)\n  }\n\n  function errorMessage(input, message){\n    if (!input) {\n      return\n    }\n    const parent = input.closest('.field') || input.parentNode\n    let area = parent.querySelector('.error')\n    // Create error message if not there\n    if (!area) {\n      area = document.createElement('p')\n      area.setAttribute('id', 'emailError')\n      area.classList.add('error')\n      area.innerHTML = message\n      parent.appendChild(area)\n    }\n    else {\n      area.innerHTML = message\n    }\n    focusElement(input)\n    input.removeAttribute('tabindex')\n    input.setAttribute('aria-describedby', 'emailError notifyEmailDesc')\n  }\n\n  function bindsEvents() {\n    window.addEventListener('load', onPageLoad)\n    const notifyPopinButton = select('.notify-me')\n    if (notifyPopinButton) {\n      notifyPopinButton.addEventListener('click', initPopinNotify)\n    }\n  }\n\n  /*\n   * Destroy references to every js component bound\n   */\n  function destroy() {\n    window.removeEventListener('popstate', handlePopState)\n    productDetails.destroy()\n  }\n  function updateLoadingTxt(isLoading) {\n\n    if (LIVE_LOADING_TEXT && isLoading) {\n      LIVE_LOADING_TEXT.innerHTML = LIVE_LOADING_TEXT.dataset.text\n    } else {\n      LIVE_LOADING_TEXT.innerHTML = ''\n    }\n\n  }\n\n  let loader = null\n  /*\n   * Handle variant change\n   */\n  function onVariantChange(value, event) {\n\n    const updatedVisualChevronMargin = select('.application_visual-carousel-navigation .js-carousel-next')\n    const vtoWrapper = select(\".vto__wrapper\")\n    const isVtoStarted = !!select('.vto-eyewear-container', vtoWrapper)\n    const isVtoDenied = !!select('.vto-eyewear-container .permissionDenied', vtoWrapper)\n    const variantList = selectAll('.js-variant-list').length > 0\n    const isWFJSizeSelector = select('.wfj-size-dropdown')\n    const redirect = false\n\n    let noBrand=sessionStorage.getItem('nobrand')\n\n    let parentEl = isQuickView ? el.closest('.sidepanel') : select('.js-main')\n    parentEl = isVtoStarted && !isVtoDenied && !isMobile() ? vtoWrapper : parentEl\n\n    const loaderWrapper = select('.sidepanel__wrapper') ? select('.sidepanel__wrapper .sidepanel-quickview'): parentEl\n\n    const params = {\n      data: {\n        sku: value,\n        nobrand:noBrand\n      }\n    }\n\n    if (isQuickView) {\n      params.data.quickView = true\n      if (!(event.target.className.includes('js-tabpanel-anchor'))) {\n        if (!loader) {\n           updateLoadingTxt(true)\n          loader = new Loader(loaderWrapper, {\n            isVtoOnMobile: !!select('.page-productDetails-Makeup .vto__container--inner') && !!select('.interceptor'),\n            enableSyncCol: !isQuickView,\n            referenceEl: loaderWrapper,\n            delay: 0\n          })\n          loader.init()\n          loader.create(() => {\n            const loaderElement = select('.loader')\n            if (loaderElement) loaderElement.style.width = '100%'\n          })\n        }\n      }\n    }\n\n    if (isCartView) {\n      const panel = el.closest('[role=\"dialog\"]')\n      const form = panel.querySelector('form')\n\n      params.data.quickViewCart = true\n\n      if (form) {\n        params.data.entryNumber = form.elements.entryCode.value\n        params.data.entryQuantity = form.elements.quantity.value\n      }\n    }\n\n    if (variantList) {\n      isCameraAvailableForVTO((startLoader) => {\n        if (startLoader){\n          if (!loader) {\n            if (isVtoStarted && !isVtoDenied && !isMobile()) {\n              loader = new Loader(vtoWrapper, {delay: 0})\n            } else {\n              updateLoadingTxt(true)\n              loader = new Loader(parentEl, {\n                isVtoOnMobile: !!select('.page-productDetails-Makeup .vto__container--inner') && !!select('.interceptor'),\n                enableSyncCol: !isQuickView,\n                referenceEl: parentEl,\n                delay: 0\n              })\n            }\n            loader.init()\n            loader.create(() => {\n              const loaderElement = select('.loader')\n              if (loaderElement) loaderElement.style.width = '100%'\n            })\n          }\n        }\n      })\n    } else {\n        if (!loader) {\n    \t  loader = new Loader(select('.js-main'), {delay:0})\n    \t  loader.init()\n    \t  loader.create(() => {\n    \t\tconst loaderElement = select('.loader')\n            if (loaderElement) loaderElement.style.width = '100%'\n    \t  })\n    \t}\n    }\n\n    el.setAttribute('aria-hidden', true)\n\n    //get current active tab\n    getCollection('.variant [role=\"navigation\"] li').forEach((elm, index) => {\n      const selectedEl = select('[aria-current=\"true\"]', elm)\n      if (selectedEl) {\n        let tabConf = window.localStorage.getItem('activeTabConf') || '{}'\n        tabConf = JSON.parse(tabConf)\n        tabConf['activeTabIndex'] = index\n        tabConf['href'] = window.location.href\n        window.localStorage.setItem('activeTabConf', JSON.stringify(tabConf))\n      }\n    })\n\n    get(config.webservices.pdp.variant, params).then(data => {\n      if (redirect && !isQuickView && data.gadata.pageLoad.category === 'eyewear') {\n        window.location.href = data.url\n        return true\n      }\n      destroy()\n      el.setAttribute('aria-hidden', false)\n\n      updateHTML(data)\n      onProductDownloaded(data.gadata)\n\n      TweenLite.fromTo(el, .5, { opacity: 0 }, { opacity: 1 })\n\n      if (!isQuickView) {\n        updateMeta(data)\n        updateURL(data.url)\n\n        const productHead = select('.product-details__title').closest('h1')\n        productHead.setAttribute('tabindex', '-1')\n        setTimeout(() => {\n          moveFocus()\n        }, 50)\n\n        init(false)\n        if (window.TurnTo) {\n          window.TurnTo.initialize()\n        }\n      }\n      return true\n    })\n      .catch(() => {\n        moveFocus()\n      })\n      .then(success => {\n        if (isQuickView) {\n          focusElement(quickViewHeading)\n          el.closest('.sidepanel__wrapper').setAttribute('aria-hidden', 'false')\n          productDetails = new ProductDetails(el, { onVariantChange, isQuickView })\n          productDetails.init()\n          const notifyMeQuickView = select(\"#notify-me-quickview\")\n          if (notifyMeQuickView) {\n            notifyMeQuickView.addEventListener('click', notifyMeClickQuickView)\n          }\n        }\n        el.removeAttribute('aria-hidden')\n        return new Promise(resolve => {\n          isCameraAvailableForVTO((startLoader) => {\n            if (startLoader) {\n              if(loader){\n                updateLoadingTxt(false)\n                loader.destroy(resolve)\n                loader = null\n              } else resolve()\n            } else {\n              if(loader){\n                updateLoadingTxt(false)\n                loader.destroy(resolve)\n                loader = null\n              }\n            }\n          })\n        })\n        .then(() => {\n          if (success) {\n            Manager.publish(VARIANT_UPDATED_MONETATE, el)\n            Manager.publish(VARIANT_UPDATED, el)\n            if (!(isVtoStarted && !isVtoDenied)) {\n              moveFocus()\n            }\n          }\n        })\n        .then(() => initWishlistData())\n        .then(() => {\n          destroyReworkedPDP()\n          destroyReworkedPDP = initReworkedPDP()\n        })\n        .then(() => {  // added styling to application visual component after variant is changed\n          const divApplicationVisualCarousel = getCollection('.application_visual-carousel-navigation .js-carousel-next')\n          if (divApplicationVisualCarousel) {\n            divApplicationVisualCarousel.forEach(item => {\n              if (!item.classList.contains('axis-carousel__next')) item.style.top = `${updatedVisualChevronMargin.style.top}`\n            })\n          }\n        })\n      })\n  }\n\n  /*\n   * Replace html content with new content and (un)bind JS\n   */\n  function updateHTML(data) {\n    if (!('content' in data)) {\n      console.error('A content property containing the HTML is expected in the JSON')\n    }\n\n    let quickViewTitleId\n\n    // store the title's id so we can put it back after HTML replace (a11y)\n    if (isQuickView) {\n      quickViewTitleId = el.querySelector('.heading').id\n    }\n\n    // Remove\n    Manager.publish('unbindDom', el)\n    el.innerHTML = data.content\n    const wishlistEl = select('.wishlist-page-title')\n    if (wishlistEl) {\n      Manager.publish(VARIANT_UPDATED, el)\n    }\n\n    if (quickViewTitleId) {\n      const quickViewTitle = el.querySelector('.heading')\n\n      if (quickViewTitle) {\n        quickViewTitle.id = quickViewTitleId\n      }\n    }\n\n    Manager.publish('bindDom', el)\n    StickyManager.update()\n    tryOnAriaLabelValue()\n\n    return data\n  }\n\n  /*\n   * Update title and meta description after variant is changed\n   */\n  function updateMeta(data) {\n    document.title = data.title || document.title\n    const descriptionEl = select('meta[name=description]')\n    if (descriptionEl) {\n      descriptionEl.setAttribute('value', data.description)\n    }\n    return data\n  }\n\n  /*\n   * Focus on h1 after variant is changed\n   */\n  function moveFocus() {\n    const tabbables = selectAll('[tabindex]', productDetails.els.text)\n    if (tabbables.length > 0) {\n      tabbables[0].focus()\n      window.scrollTo({\n        top: 0,\n        left: 0,\n        behavior: 'auto'\n      })\n    }\n  }\n\n  /*\n   * Update url using replace state when variant is changed\n   */\n  function updateURL(url) {\n    var location = window.location;\n    let appendParams = ''\n    if (location.search.indexOf('utm') != -1) {\n        appendParams = `?` + ((sessionStorage.getItem('utm_medium') === 'null') ? '' : 'utm_medium=' + sessionStorage.getItem('utm_medium')) +\n                ((sessionStorage.getItem('utm_content') === 'null') ? '' : '&utm_content=' + sessionStorage.getItem('utm_content')) +\n                ((sessionStorage.getItem('utm_source') === 'null') ? '' : '&utm_source=' + sessionStorage.getItem('utm_source')) +\n                ((sessionStorage.getItem('utm_campaign') === 'null') ? '' : '&utm_campaign=' + sessionStorage.getItem('utm_campaign')) +\n                ((sessionStorage.getItem('nobrand') === 'null') ? '' : '&nobrand=' + sessionStorage.getItem('nobrand'))\n     } else {\n        appendParams = `?` + ((sessionStorage.getItem('nobrand') === 'null') ? '' : 'nobrand=' + sessionStorage.getItem('nobrand'))\n     }\n    url = url + ((appendParams.length == 1) ? '' : appendParams)\n    window.history.pushState('', '', url)\n    Manager.publish(AFTER_REPLACE_STATE)\n  }\n\n  /**\n   * this page is triggered on load page\n   * it send data to datalayer only if user come from PLP\n   */\n  function onPageLoad() {\n    const pagePLP = JSON.parse(localStorage.getItem('pagePLP'))\n    const PDP_STICKY = select('.pdp-sticky > div')\n\n    if (pagePLP && pagePLP.fromPLP) {\n        pagePLP.fromPLP = false\n        pagePLP.backPLP = true\n        localStorage.setItem('pagePLP', JSON.stringify(pagePLP))\n    }\n\n    const isApplePay = select('li.js-apple-pay-btn' , PDP_STICKY)\n    if (isApplePay) {\n     isApplePay.setAttribute('hidden', '')\n     isApplePay.closest('.form-buttons').classList.remove('is-splitted')\n    }\n  }\n\n  /**\n   * send datalayer when product downloaded\n   */\n  function onProductDownloaded(data) {\n      if(data) {\n        if (!dataLayerGA) {\n            dataLayerGA = {\n                pageLoad: {},\n                productList: {}\n            }\n        }\n        if (data.hasOwnProperty(\"pageLoad\") && Object.keys(data.pageLoad).length != 0) {\n            dataLayerGA.pageLoad = data.pageLoad\n            //TODO: actually we need just to update quickviewAddToBag object of dataLayer and CTA button with new variant id.\n            document.DLKit.push('when-user-click-product-page', data.pageLoad)\n        }\n        if (data.hasOwnProperty(\"productList\") && Object.keys(data.productList).length != 0) {\n            Object.assign(dataLayerGA.productList, data.productList)\n        }\n        hideMoreDetailsLink()\n        if (sessionStorage.getItem('nobrand') === 'true') {\n          PropagateLink()\n          hideForPollux()\n        }\n      }\n      let megamuenuImages = selectAll('.js-megamenu-image')\n      megamuenuImages.forEach((img) => {\n        let srcSet = img.getAttribute('data-srcset')\n        img.setAttribute('srcset', srcSet)\n      })\n  }\n\n\n\n  function addFocusAfterClick() {\n    const firstSectionTitle = select('#js-sticky-appears>.section[tabindex=\"-1\"] .heading')\n    if (firstSectionTitle) {\n      focusElement(firstSectionTitle)\n    }\n  }\n\n  function disclaimerLinkFocus() {\n    const navTab = select('.tabpanel__tabs nav')\n    if (navTab) {\n      navTab.setAttribute('tabindex', '-1')\n      focusElement(navTab)\n    }\n  }\n\n  return { init, destroy }\n\n}\n\nlet destroyReworkedPDP\n\nexport default function (el) {\n  const pdp = new PDP(el)\n  let isQuickView = !!el.closest('[role=\"dialog\"]')\n  if (isQuickView) {\n    //For quickview, directly initialize as we already have the YAPI_PAGELOAD_RECEIVED\n    initReworkedPDP()\n    pdp.init()\n  } else {\n    destroyReworkedPDP = initReworkedPDP()\n    pdp.init()\n    //Wait for the /pageload call to return response. We don't need to wait for the response processing (YAPI_PAGELOAD_COMPLETE) as this is not using CSRFToken\n    // Manager.subscribe(YAPI_PAGELOAD_RECEIVED, () => {\n    //   destroyReworkedPDP = initReworkedPDP()\n    //   pdp.init()\n    // })\n  }\n\n  return pdp\n}\n\nfunction hideForPollux() {\n  list.push('.product-details__ctas  > :not(.vto-open__wrapper)', '.pdp-sticky', '.product-details__price-block','#disclaimer-text','.notify-me-text','.top-banner-component')\n  listAll.push('.context > ul','.content','.is-price','.no-shoppable','.is-wishlist', '.product-details__backorder')\n    list.forEach(item => {\n      if (select(item)) {\n        select(item).setAttribute('hidden', '')\n      }\n    })\n    listAll.forEach((items) => {\n      selectAll(items).forEach((item) => item.setAttribute('hidden', ''));\n    });\n\n    selectAll('.product__content').forEach((item) => item.setAttribute('oncontextmenu', \"return false;\"))\n    const refillPush = select('#fill-or-refill-product-link')\n    if (refillPush) {\n      // disable right click\n      refillPush.setAttribute('oncontextmenu','return false')\n    }\n\n    const refillPushcmscomponent = select('#refill-linktag')\n    if (refillPushcmscomponent) {\n      // disable right click\n      refillPushcmscomponent.setAttribute('oncontextmenu','return false')\n    }\n\n      var location = window.location;\n      let appendParams = ''\n      if (location.search.indexOf('utm') != -1) {\n         appendParams = `?` + ((sessionStorage.getItem('utm_medium') === 'null') ? '' : 'utm_medium=' + sessionStorage.getItem('utm_medium')) +\n          ((sessionStorage.getItem('utm_content') === 'null') ? '' : '&utm_content=' + sessionStorage.getItem('utm_content')) +\n          ((sessionStorage.getItem('utm_source') === 'null') ? '' : '&utm_source=' + sessionStorage.getItem('utm_source')) +\n          ((sessionStorage.getItem('utm_campaign') === 'null') ? '' : '&utm_campaign=' + sessionStorage.getItem('utm_campaign')) +\n          ((sessionStorage.getItem('nobrand') === 'null') ? '' : '&nobrand=' + sessionStorage.getItem('nobrand'))\n       } else {\n          appendParams = `?` + ((sessionStorage.getItem('nobrand') === 'null') ? '' : 'nobrand=' + sessionStorage.getItem('nobrand'))\n       }\n      selectAll(\"[data-test='product_link']\").forEach(e => {\n        let path = e.href;\n        e.addEventListener('click',function(){\n          e.href = path + ((appendParams.length == 1) ? '' : appendParams);\n        })\n      })\n      if(select('.product-details__ctas')){\n        get(config.webservices.product.replace('{0}', `${select('.product-details__ctas').dataset.ref}?options=basic,vto,variants&site=chanel`))\n        .then((data) => {\n            prepareForVto(data)\n\n            if (data.vto.vtoEnabled) {\n              Manager.publish('VTO_CAN_SHOW', data)\n            } else {\n              Manager.publish('VTO_CANNOT_SHOW', data)\n            }\n        })\n      }\n      select('.header__outer').style.position = 'static'\n\n      window.onscroll = () => {\n        select('.header__outer').removeAttribute('style')\n        select('.header__level-one').removeAttribute('style')\n      }\n\n       waitForElm('*[id^=\"iframe-notification\"]').then(elm => elm.setAttribute('hidden', '') );\n\n}\n\nfunction manageQR() {\n  let url = new URL(window.location.href)\n  let medium = url.searchParams.get('utm_medium')\n  let campaign = url.searchParams.get('utm_campaign')\n  let content = url.searchParams.get('utm_content')\n  let source = url.searchParams.get('utm_source')\n  let nobrand = url.searchParams.get('nobrand')\n  sessionStorage.setItem('utm_medium',medium)\n  sessionStorage.setItem('utm_campaign',campaign)\n  sessionStorage.setItem('utm_content',content)\n  sessionStorage.setItem('utm_source',source)\n  sessionStorage.setItem('nobrand',nobrand)\n\n  list.push('.header__root', '.nav-left', '.nav-right','.footer__end-links', '.breadcrumb', '.js-chat-btn', '.subfooter')\n  listAll.push('.footer__sections','.hide-for-pollux')\n  hideMoreDetailsLink()\n  if (nobrand && nobrand === 'true'){\n\n    hideForPollux()\n\n    select('.footer').style.height = 'auto'\n    select('.footer').style.minHeight = '0'\n    select('.logo_header').alt = 'CHANEL'\n\n    if(select('.tabpanel__panels')){\n      select('.tabpanel__panels').style.minHeight = '0'\n    }\n\n    let linkItem  = select('[data-event-label=\"homepage\"]')\n    linkItem.parentNode.append(...linkItem.children)\n    linkItem.parentNode.removeChild(linkItem)\n\n    linkItem  = select('.footer__logo > [data-event-label=\"homepage\"]')\n    linkItem.parentNode.prepend(...linkItem.children)\n    linkItem.setAttribute('hidden','')\n    linkItem.removeAttribute('href')\n  }\n\n}\nfunction hideMoreDetailsLink() {\n  const moreDetailsElm = select('.js-more-details-anchor')\n  if(moreDetailsElm) {\n    const moreDetailsId = select(moreDetailsElm.getAttribute('href'))\n    if(!moreDetailsId) {\n      moreDetailsElm.setAttribute('hidden', '')\n    }\n  }\n}\n\nfunction waitForElm(selector) {\n  return new Promise(resolve => {\n      if (select(selector)) {\n          return resolve(select(selector));\n      }\n\n      const observer = new MutationObserver(mutations => {\n          if (select(selector)) {\n              resolve(select(selector));\n              observer.disconnect();\n          }\n      });\n\n      observer.observe(document.body, {\n          childList: true,\n          subtree: true\n      });\n  });\n}\n\nfunction openReviewUnsubscribePopin() {\n  const reviewUnsubscribeElement = select('.js-review-unsubscribe-popin') || null\n  if(reviewUnsubscribeElement) {\n    popin.open({\n      html: select('.js-review-unsubscribe-popin').innerHTML,\n      role: 'dialog',\n      modifiers: 'review-unsubscribe',\n      opener: null,\n      manageFocus: true,\n      forceInert: true,\n      modal: true,\n      outerClose: true\n    })\n  }\n}\n","/* eslint-disable import/prefer-default-export */\n/* eslint-disable no-use-before-define */\n\nimport { DragGesture } from '@use-gesture/vanilla'\nimport { getMq } from 'lib/helpers'\nimport { select, selectAll } from 'lib/selectors'\nimport { spring } from 'lib/spring-animation'\nimport manager from 'lib/events/manager'\n\nfunction onlyCallLastTimeout(key, delay, callback) {\n  const timer = onlyCallLastTimeout[key]\n  if (timer) clearTimeout(timer)\n  onlyCallLastTimeout[key] = setTimeout(callback, delay)\n}\n\nlet initialPosition\nconst fromTopToTransitionY = (top) => top - initialPosition\n\nconst { springEasing, duration } = spring({ mass: 1, stiffness: 170, damping: 26 })\n\nconst scrollToPosition = (container, { top, upperBound }, lookDraging = true) => {\n  if (lookDraging && top !== upperBound) container.classList.remove('product-details-card__content--expanded')\n  else if (!lookDraging && top === upperBound) container.classList.add('product-details-card__content--expanded')\n\n  // TweenLite.set(container, { top, transitionDuration: 2 })\n  TweenLite.to(container, duration / 1000, { y: fromTopToTransitionY(top), ease: springEasing })\n  onlyCallLastTimeout('scrollToPosition', duration * 1 / 2, () => {\n    if (lookDraging) container.classList.toggle('product-details-card__content--expanded', top === upperBound)\n  })\n}\n\nconst productDetailsContentHeader = `\n  <div class=\"product-details__content--head\">\n    <button type=\"button\" class=\"button collapse__button js-collapse-pop\" data-test=\"btncollapse\" >\n      <span class=\"is-sr-only collapse_text\">\n        maximizeText\n      </span>\n    </button>\n  </div>\n`\n\nconst setupMobile = () => {\n  const main = select('.js-main-content.pdp')\n  const footer = select('footer.js-footer')\n  const container = select('#js-sticky-appears')\n  const productDetailsContent = select('.product-details .product-details__content', main)\n  let undoChanges\n  if (productDetailsContent) {\n    const productDetailsContentClone = productDetailsContent.cloneNode(true)\n    container?.insertBefore(productDetailsContentClone, container.firstChild);\n    container?.insertAdjacentHTML('afterbegin', productDetailsContentHeader);\n    productDetailsContent.setAttribute(\"aria-hidden\", 'true')\n    productDetailsContent.setAttribute('hidden', '')\n    undoChanges = thisWillBeChangedInJSP({ main, pContent: productDetailsContentClone })\n  }\n  if (footer) {\n    container?.appendChild(footer);\n    manager.publish('bindDom', container)\n  }\n\n  initialPosition = window.scrollY + (container.getBoundingClientRect().top || 0)\n  const lowerBound = initialPosition + 15\n  const upperBound = 10\n  scrollToPosition(container, { top: initialPosition, upperBound })\n\n  const gesture = new DragGesture(container, ({ active, movement: [, my], delta: [, dy], }) => {\n    const currentY = container.getBoundingClientRect().top + dy\n    const isExtended = currentY < (lowerBound + upperBound) / 2\n\n    if (container.scrollTop) return; //\n    if (!(currentY < lowerBound && currentY > upperBound)) return\n    if (active) TweenLite.set(container, { y: fromTopToTransitionY(currentY), immediateRender: true })\n    else if (my <= -40) scrollToPosition(container, { top: upperBound, upperBound })\n    else if (my >= 40) scrollToPosition(container, { top: initialPosition, upperBound })\n    else if (isExtended && currentY <= 50 + upperBound) scrollToPosition(container, { top: upperBound, upperBound }, false)\n    else if (!isExtended && currentY >= -50 + initialPosition) scrollToPosition(container, { top: initialPosition, upperBound }, false)\n    else scrollToPosition(container, { top: my >= 0 ? initialPosition : upperBound, upperBound })\n  }, { pointer: { touch: true, mouse: true } })\n\n\n  const gesture2 = (() => {\n    const carouselFrame = select('.js-frame.carousel__frame')\n    const frameInitialPos = window.scrollY + (carouselFrame.getBoundingClientRect().top || 0)\n    const scrollHeight =  carouselFrame.scrollHeight - carouselFrame.getBoundingClientRect().height\n    let isScrollLocked = false\n\n    carouselFrame.addEventListener('scroll', () => {\n      const { top, height } = carouselFrame.getBoundingClientRect()\n      const currentY = top - frameInitialPos\n      if (currentY > 0 && carouselFrame.scrollTop) {\n        console.log('scrolling is locked')\n        TweenLite.set(carouselFrame, { overflow: 'hidden' })\n        isScrollLocked = true\n      }\n    })\n\n    return new DragGesture(carouselFrame, ({ active, movement: [, my], delta: [, dy], direction: [,direction] }) => {\n      const { top, height } = carouselFrame.getBoundingClientRect()\n      const currentY = top + dy - frameInitialPos\n\n\n      if (direction < 0 && !carouselFrame.scrollTop) return\n      if (direction > 0 && carouselFrame.scrollTop >= scrollHeight) return\n      if (!isScrollLocked && carouselFrame.scrollTop && carouselFrame.scrollTop < scrollHeight) return; //\n\n      if (active) {\n        TweenLite.set(carouselFrame, { y: currentY, immediateRender: true })\n      }\n      else {\n        TweenLite.set(carouselFrame, { overflow: null, immediateRender: true })\n        TweenLite.to(carouselFrame, duration / 1000, { y: 0, ease: springEasing })\n        if (!isScrollLocked && my <= -10) scrollToPosition(container, { top: upperBound, upperBound })\n        isScrollLocked = false\n      }\n    }, { pointer: { touch: true, mouse: true } })\n  })()\n\n  return () => {\n    if (productDetailsContent) {\n      select('.product-details__content', container).remove()\n      select('.product-details__content--head', container).remove()\n      productDetailsContent.removeAttribute(\"aria-hidden\")\n      productDetailsContent.removeAttribute('hidden')\n      undoChanges?.()\n    }\n    if (footer) {\n      document.body.insertBefore(footer, select('#main').nextSibling);\n      manager.publish('bindDom', container)\n    }\n    gesture.destroy()\n    gesture2.destroy()\n  }\n}\n\nfunction init() {\n  const isMobile = () => getMq() === 'mobile'\n  console.log({ isMobile: isMobile() })\n  let unbind = isMobile() ? setupMobile() : Function\n\n  manager.subscribe('WINDOW_WAS_RESIZED', () => {\n    unbind?.()\n    unbind = isMobile() ? setupMobile() : Function\n  })\n\n  return unbind\n}\n\n\nexport { init }\n\n\nconst thisWillBeChangedInJSP = ({ main, pContent }) => {\n  main?.classList.add('new-pdp')\n  document.body.classList.add('new-pdp')\n  const pCarousel = select('.js-main-pdp-carousel', main)\n  const pDetails = select('.product-details__text', pContent)\n  const pHeadline = select('.product-details__head', pContent)\n  const pReference = select('.product-details__reference', pContent)\n  const pPrice = select('.product-details__bar.has-price', pContent)\n  const pControls = select('.product-details__controls')\n  pControls.setAttribute('hidden', '')\n  pCarousel.classList.add('js-new-main-pdp-carousel')\n  pCarousel.classList.remove('js-main-pdp-carousel', 'carousel-crossfade')\n  pDetails.insertBefore(pPrice, pHeadline.nextSibling)\n  pDetails.insertBefore(pReference, pPrice.nextSibling)\n  pReference.innerHTML = `<span class=\"product-details__description\" data-reffshcode=\"A7XXX\">${pReference.innerText}</span>`\n  selectAll('.product-details__description', pHeadline).reverse().forEach((p) => pReference.insertBefore(p, pReference.firstChild))\n  return () => {\n    main?.classList.remove('new-pdp')\n    document.body.classList.remove('new-pdp')\n    pCarousel.classList.remove('js-new-main-pdp-carousel')\n    pCarousel.classList.add('js-main-pdp-carousel', 'carousel-crossfade')\n    pControls.removeAttribute('hidden')\n  }\n}\n","import popin from '../../modules/popin'\nimport config from '../../lib/config'\nimport { select, selectAll, getCollection} from '../../lib/selectors'\nimport { focusElement } from '../../lib/helpers'\nimport * as xhr from '../../modules/fetch'\nimport notifier from 'modules/notifier'\nimport { Manager } from 'lib/events'\n\nlet subscriberEmailId\nlet thankyouPopinMsg = ''\nlet thankuPopinTemplate\nlet subscriberPhoneNumber = ''\nlet userEmailId =''\nlet userPhoneNumber = ''\n\nclass PopinNotify {\n  constructor() {\n    this.message = \"\"\n    this.acceptTemplate = null\n    this.ariaHiddenElements = null\n    this.tabindexArr = null\n    this.popinTabIndexArr = null\n    this.heightOfLegalTermRule = 0\n    this.userEmailId = \"\"\n  }\n\n  init() {\n    if (config.country.toUpperCase() === 'KR' || config.country.toUpperCase() === 'CN') {\n      xhr.get(`${window.config.webservices.fetchNotifyMeUserDetails}`).then((res) => {\n        userEmailId = res.uid\n        userPhoneNumber = res.username\n        this.buildNotifyModal()\n        this.showPopin(config.popinNotifyMe.popinTitle)\n      })\n    } else {\n      this.buildAcceptModal()\n      this.showPopin(config.popinNotifyMe.popinNotifyAvailableText)\n    }\n\n    window.document.DLKit.push('notify-me', {\n      eventLabel : sessionStorage.getItem('productName'),\n      eventAction: 'click pdp',\n      event: 'uaevent'\n    })\n    this.ariaHiddenElements = selectAll('[aria-hidden=\"false\"]')\n\n    window.addEventListener('click', this.onDocumentPopinClose)\n  }\n  showPopin(popinLabel) {\n    popin.open({\n      html: this.acceptTemplate,\n      modifiers: 'is-big is-relative popin-notifyMe_wrapper',\n      modal: true,\n      role: 'dialog',\n      label: popinLabel,\n      opener: null,\n      forceInert: true,\n      manageFocus: true,\n      outerClose: true\n    }).then(() => {\n      this.tabindexArr = selectAll('[tabindex=\"-1\"]')\n      this.openNotifyPopin()\n      Manager.subscribe('notificationClosed', onNotificationClosed)\n      Manager.subscribe('onNotifierIn', notifierOpened)\n      const notifyMeWrapper = select('.popin-notifyMe_wrapper')\n      const popinThankuWrapper = select('.popin-thanku-wrapper')\n      const legalConsent = select('#legal-consent')\n      const emailField = select('#inputEmail')\n      const phoneField = select('#notify-phoneNumber')\n      if (legalConsent) {\n        legalConsent.addEventListener('click', this.showTerms)\n        emailField.addEventListener('focusout', this.emailExist)\n      }\n      if (legalConsent || config.country.toUpperCase() == \"CN\") {\n        phoneField.addEventListener('focusout', this.phoneExist)\n        phoneField.addEventListener('focusin', this.phoneValidity)\n      }\n      notifyMeWrapper ? notifyMeWrapper.previousElementSibling.classList.add(\"notify-me-overlay\") : popinThankuWrapper.previousElementSibling.classList.add(\"notify-me-overlay\")\n    })\n  }\n  openNotifyPopin() {\n    const form = select('#formNotifyMe')\n    if (form) {\n      form.addEventListener('submit', handleSubmit)\n      const notifyMeWrapper = select('.popin-notifyMe_wrapper', document.body)\n      const popinCloseBtn = select('.js-popin-close', notifyMeWrapper)\n      popinCloseBtn.addEventListener('click', this.closePopin)\n    }\n  }\n\n  showTerms() {\n    const legalTermsElm = select('#legal-consent')\n\n    if (legalTermsElm) {\n      const legalTermsRulesElm = select('div#notify-legal-terms')\n      const legalDiv = select('div#additional-terms')\n      const isChecked = legalTermsElm.checked\n\n      // Used only for first times to get height\n      if (!this.heightOfLegalTermRule) {\n        legalTermsRulesElm.removeAttribute('hidden')\n        this.heightOfLegalTermRule = legalTermsRulesElm.clientHeight\n        legalTermsRulesElm.style.height = 0\n      }\n\n      if (isChecked) {\n        legalTermsElm.removeAttribute('tabindex')\n        focusElement(legalDiv)\n      } else {\n        legalDiv.removeAttribute('tabindex')\n        focusElement(legalTermsElm)\n      }\n\n      // Start animation for both check and unchecked\n      TweenLite.fromTo(legalTermsRulesElm, (isChecked ? 1 : .4),\n        { autoAlpha: isChecked ? 0 : .5, height: isChecked ? 0 : this.heightOfLegalTermRule },\n        { autoAlpha: isChecked ? 1 : .0, height: isChecked ? this.heightOfLegalTermRule : 0 }\n      )\n    }\n  }\n\n  emailExist(e) {\n    const emailField = e.target\n    const phoneField = select('#notify-phoneNumber')\n    fieldValidation(emailField, phoneField)\n  }\n\n  phoneExist(e) {\n    const phoneField = e.target\n    const emailField = select('#inputEmail')\n    fieldValidation(phoneField, emailField)\n  }\n\n  phoneValidity(e) {\n    const phoneField = e.target\n    phoneField.setCustomValidity('')\n  }\n\n  buildAcceptModal() {\n\n    let prefilledEmail = \"\"\n    let legalTerm = \"\"\n    let legalNotify = `<p>` + config.popinNotifyMe.popinNotice + `</p>`\n    if (config.country === 'RU') {\n      legalTerm = `<div class=\"field notify-field custom-error-legal-term notify-ru-check\">\n         <span class=\"checkbox\"> \n         <input id=\"legal-consent\" type=\"checkbox\"  name=\"legalConsent\" required=\"true\" aria-required=\"true\">\n         <label for=\"legal-consent\" class=\"notify-legal-consent\">` + config.popinNotifyMe.popinTermsAndConditionsRU + `</label></span>\n         `+ legalNotify +`\n        </div>`\n    }\n    if (sessionStorage.getItem('IS_USER_AUTHENTICATED') == 'true') {  \n      if (sessionStorage.getItem('lastUsedEmail')) {\n       prefilledEmail = sessionStorage.getItem('lastUsedEmail')  \n       }\n      if (config.country === 'RU') {\n      legalTerm=`${legalNotify}`; \n      }\n    }\n\n    this.acceptTemplate =\n      `\n      <div class=\"notify-popin-text\" id=\"notifyMePopin\" data-close-label=\"` + config.popinNotifyMe.popinCloseLabel + `\">\n      <form class=\"notify-me-form\" novalidate=\"true\" id = \"formNotifyMe\" method=\"post\" action=\"`+ config.webservices.notifyme + `\">\n        <div class=\"notify-me-heading\" role=\"heading\" aria-level=\"1\">` + config.popinNotifyMe.popinTitle + `</div>\n        <p class=\"notify-desc-email\" id=\"notifyEmailDesc\">` + config.popinNotifyMe.popinDescription + `</p>\n        <div class=\"field\" id = \"notifyMeInput\">\n          <div class=\"label-input js-label-input is-ready\">\n            <label class=\"label-input__label notify-field-label-with-value\" for=\"inputEmail\">` + config.popinNotifyMe.popinLabel + `</label>\n            <input class=\"label-input__input\" name = \"emailAddress\" id = \"inputEmail\" type= \"email\" aria-required=\"true\" autocomplete=\"email\" aria-describedby=\"notifyEmailDesc\" title=\"${config.popinNotifyMe.emailTitle}\" value=` + prefilledEmail + `></input>\n          </div>\n        </div>\n        <input type= \"hidden\" id=\"productCode\" name=\"productCode\" value = ` + sessionStorage.getItem('productCode') + `></input>\n        <input type= \"hidden\" id=\"productStatus\" name=\"productStatus\" value = ` + sessionStorage.getItem('productStockLevel') + ` ></input>\n        `+ legalTerm +`\n        <div class=\"popin-button-wrapper\">\n            <button type=\"submit\" class=\"button is-primary notify-submit\">\n              <span class=\"button__wrapper\">\n                <span class=\"label\">` + config.popinNotifyMe.popinSubmitLabel + `</span>\n              </span>\n            </button>\n        </div>\n        </form>\n      </div>\n     `\n  }\n\n  buildNotifyModal() {\n    let termsConditions = '',\n        phonePattern = ''\n    if(config.country.toUpperCase() == \"KR\") { \n      termsConditions = ` <div class=\"field notify-field custom_error_msg_termsCondition\">\n            <span class=\"checkbox\">\n              <input id=\"legal-consent\" type=\"checkbox\" name=\"legalConsent\" required=\"true\" aria-required=\"true\">\n              <label for=\"legal-consent\" class=\"notify-legal-consent\">` + config.popinNotifyMe.popinTermsAndConditions + `</label>\n            </span>\n            <div id=\"additional-terms\">\n              <div id=\"notify-legal-terms\" class=\"notify-legal-consent\" hidden> \n                <p>` + config.popinNotifyMe.popinAgreeCondition + `</p>\n              </div>\n            </div>\n          </div>\n          <div class=\"notify-field-consent\">\n            <div class=\"is-not-spaced is-light\">\n              <p>` + config.popinNotifyMe.popinDiscalimer + `</p>\n            </div> \n          </div>`\n      phonePattern = '^(010|011|016|017|018|019)[0-9\\\\s]*$'\n    } else {\n      termsConditions = `<div class=\"field notify-field custom_error_msg_termsCondition\">\n        <span class=\"checkbox\">\n          <input id=\"legalPrivacy\" type=\"checkbox\" name=\"legalPrivacy\" required = \"true\" aria-required=\"true\">\n          <label for=\"legalPrivacy\" class=\"notify-legal-consent\">` + config.popinNotifyMe.popinTermsAndConditionsCN + `</label>\n        </span>\n      </div>\n      <div class=\"field notify-field custom-error-legal-term\">\n        <span class=\"checkbox\">\n          <input id=\"legalConsent\" type=\"checkbox\" name=\"legalConsent\" required = \"true\" aria-required=\"true\">\n          <label for=\"legalConsent\" class=\"notify-legal-consent\">` + config.popinNotifyMe.popinAgreeConditionCheck + `</label>\n        </span>\n      </div>`\n      phonePattern = '^[1][0-9]*$'\n    }\n\n    this.acceptTemplate =\n      `\n      <div class=\"notify-popin-text js-notify-by-email-phone\" id=\"notifyMePopin\" data-close-label=\"` + config.popinNotifyMe.popinCloseLabel + `\">\n      <form class=\"notify-me-form\" novalidate=\"true\" id = \"formNotifyMe\" method=\"post\" action=\"`+ config.webservices.notifyMeByMobile + `\">\n        <div class=\"notify-me-heading\" role=\"heading\" aria-level=\"1\">` + config.popinNotifyMe.popinTitle + `</div>\n        <p class=\"notify-desc-email\" id=\"notifyEmailDesc\">` + config.popinNotifyMe.popinDescription + `</p>\n        \n        <p tabindex=\"-1\" id=\"notifyError\" class=\"notify-error\" hidden aria-hidden=\"true\">` + config.popinNotifyMe.popinError + `</p>\n        \n        <div class=\"field\" id = \"notifyMeInput\">\n          <div class=\"label-input js-label-input is-ready\">\n            <label class=\"label-input__label notify-field-label-with-value\" for=\"inputEmail\">` + config.popinNotifyMe.popinLabel + `</label>\n            <input class=\"label-input__input js-notify-field\" name = \"emailAddress\" id = \"inputEmail\" type= \"email\" autocomplete=\"email\" data-type=\"email\" \n            pattern=\"`+ window.config.locales.opc.applePay.regex.emailPattern + `\" maxlength=\"255\" aria-required=\"true\" title=\"${config.popinNotifyMe.emailTitle}\"\n            aria-describedby=\"notifyEmailDesc\" value=${userEmailId}></input>\n          </div>\n        </div>\n        \n        <div class=\"fields-block phone-section\">\n          <div class=\"field is-third is-third-sm notify-field has-static-input is-ready\">\n            <div class=\"label-input js-label-input\">\n              <label class=\"label-input__label\" for=\"notify-countryCode\">` + config.popinNotifyMe.popinCountryCodeLabel + `</label>\n              <input class=\"label-input__input\" id=\"notify-countryCode\" name=\"phoneCountryCodeField\"  data-phone-pattern-code=\"billing-phone\" type=\"text\"  readonly=\"readonly\" autocomplete=\"tel-country-code\" value=\"${config.locales.account.phoneCountryCodes[`${config.country}`]} (${config.country})\">\n            </div>\n          </div>\n          <div class=\"field notify-field \">\n            <div class=\"label-input js-label-input is-ready\">\n               <label class=\"label-input__label notify-field-label-with-value\" for=\"notify-phoneNumber\">` + config.popinNotifyMe.popinPhoneNumberLabel + `</label>\n               <input class=\"label-input__input js-notify-field\" type=\"tel\" aria-required=\"true\" autocomplete=\"tel-national\" name=\"phoneNumber\" data-type=\"tel\" pattern=\"${phonePattern}\" data-phone-pattern=\"wc-billing-phone\" id=\"notify-phoneNumber\" value=\"${userPhoneNumber}\">\n            </div>\n          </div>\n        </div>\n        ${termsConditions}\n        <input type= \"hidden\" id=\"productCode\" name=\"productCode\" value = ` + sessionStorage.getItem('productCode') + `></input>\n        <input type= \"hidden\" id=\"productStatus\" name=\"productStatus\" value = ` + sessionStorage.getItem('productStockLevel') + ` ></input>\n        <div class=\"popin-button-wrapper\">\n            <button type=\"submit\" class=\"button is-primary notify-submit\">\n              <span class=\"button__wrapper\">\n                <span class=\"label\">` + config.popinNotifyMe.popinSubmitLabel + `</span>\n              </span>\n            </button>\n        </div>\n        </form>\n      </div>\n     `\n  }\n\n  onDocumentPopinClose(e) {\n    const cookiePopin = select('#onetrust-banner-sdk')\n    const popinEl = select('.popin__col')\n    if ((popinEl && !popinEl.contains(e.target) && !cookiePopin)\n      || (popinEl && !popinEl.contains(e.target) && cookiePopin && !cookiePopin.contains(e.target))) {\n      e.stopImmediatePropagation()\n      window.removeEventListener('keydown', this.onDocumentPopinClose)\n      const notifyMeWrapper = select('.popin-notifyMe_wrapper')\n      const popinThankuWrapper = select('.popin-thanku-wrapper')\n      notifyMeWrapper ? notifyMeWrapper.previousElementSibling.classList.remove(\"notify-me-overlay\") : popinThankuWrapper.previousElementSibling.classList.remove(\"notify-me-overlay\")\n      popin.hide()\n      if (notifier.modal) {\n        notifier.close()\n      }\n    } else {\n      const popinWrapper = select('.popin-wrapper')\n      if (notifier.modal && !popinWrapper) {\n        notifier.close()\n      }\n    }\n\n  }\n  closePopin (e) {\n    e.stopPropagation()\n    const notifyMeWrapper = select('.popin-notifyMe_wrapper')\n    const popinThankuWrapper = select('.popin-thanku-wrapper')\n    notifyMeWrapper ? notifyMeWrapper.previousElementSibling.classList.remove(\"notify-me-overlay\") : popinThankuWrapper.previousElementSibling.classList.remove(\"notify-me-overlay\")\n    popin.hide()\n  }\n}\n\nconst popinNotify = new PopinNotify()\nconst initPopinNotify = () => {\n  popinNotify.init()\n}\nfunction buildThankyouModal() {\n  thankuPopinTemplate =\n    `\n  <div class=\"thanku-popin-heading\" role=\"heading\" aria-level=\"1\">` + config.popinThankyou.popinTitle + `</div>\n  <p class=\"thanku-popin-desc\" id=\"thankuPopinMsg\">`+ thankyouPopinMsg +`</p>\n  <div class=\"continue-button-wrapper\">\n      <button type=\"button\" id=\"continueShopping\" class=\"button\">\n          <span class=\"continue-shopping-label\">` + config.popinThankyou.continueShoppingBtnText + `</span>\n          <span class=\"is-sr-only\">` + config.popinThankyou.popinCloseHiddenText + `</span>\n      </button>\n  </div>\n   `\n}\nfunction onContinueShopping() {\n  window.document.DLKit.push('notify-me', {\n    eventLabel : sessionStorage.getItem('productName'),\n    eventAction: 'continue pdp',\n    event : 'uaevent'\n  })\n  popin.hide()\n}\nfunction setErrorMessage(message) {\n  const field = inputEmail.closest('.field')\n  inputEmail.setAttribute('aria-invalid', true)\n\n  if (field) {\n    field.classList.add('has-error')\n  }\n\n  const parent = inputEmail.closest('.field') || inputEmail.parentNode\n  let area = parent.querySelector('.error')\n  // Create error message if not there\n  if (!area) {\n    area = document.createElement('p')\n    area.setAttribute('id', 'error-inputEmail')\n    area.classList.add('error')\n    area.innerHTML = message\n    parent.appendChild(area)\n  }\n  else {\n    area.innerHTML = message\n  }\n\n  inputEmail.type = 'invalid'\n  focusElement(inputEmail)\n  inputEmail.setAttribute('aria-invalid', true)\n  inputEmail.removeAttribute('data-aria-describedby')\n  inputEmail.setAttribute('aria-describedby','error-inputEmail notifyEmailDesc')\n  inputEmail.removeAttribute('tabindex')\n}\n\nfunction handleResponse(data) {\n  if (data[\"message\"]) {\n    if (data[\"name\"] == \"phoneNumber\") {\n      const inputPhone = select('#notify-phoneNumber')\n      inputPhone.setCustomValidity(data[\"message\"])\n      inputPhone.checkValidity()\n    }\n    else {\n      setErrorMessage(data[\"message\"])\n    }\n  }\n  else {\n    if (subscriberEmailId != '' && subscriberPhoneNumber != '') {\n      thankyouPopinMsg = config.popinThankyou.popinMsg.replace(/{emailaddress}/gi, `<strong>${subscriberEmailId}</strong>`).replace(/{phonenumber}/gi, `<strong>${subscriberPhoneNumber}</strong>`)\n    } else if (subscriberPhoneNumber != '') {\n      thankyouPopinMsg = config.popinThankyou.popinMessage.replace(/{emailaddress}/gi, `<strong>${subscriberPhoneNumber}</strong>`)\n    } else {\n      thankyouPopinMsg = config.popinThankyou.popinMessage.replace(/{emailaddress}/gi, `<strong>${subscriberEmailId}</strong>`)\n    }\n    buildThankyouModal()\n    const notifyMeTemplate = document.getElementById('notifyMePopin')\n    notifyMeTemplate.innerHTML = thankuPopinTemplate\n    window.document.DLKit.push('notify-me', {\n      eventLabel : sessionStorage.getItem('productName'),\n      eventAction: 'confirm pdp',\n      event : 'nievent'\n    })\n    const notifyMeWrapper = select('.popin-notifyMe_wrapper',document.body)\n    if(notifyMeWrapper) {\n      notifyMeWrapper.classList.remove('popin-notifyMe_wrapper')\n      notifyMeWrapper.classList.add('popin-thanku-wrapper')\n      notifyMeWrapper.setAttribute('aria-label', config.popinThankyou.popinTitle)\n    }\n    notifyMeTemplate.classList.remove('notify-popin-text')\n    notifyMeTemplate.classList.add('thanku-popin-text')\n    notifyMeTemplate.setAttribute('data-close-label', config.popinThankyou.popinCloseHiddenText)\n    const popinClose = select(`.js-popin-close span`, notifyMeWrapper)\n    popinClose.innerText = config.popinThankyou.popinCloseHiddenText\n    const popinCloseBtn = select(`.js-popin-close`, notifyMeWrapper)\n    if(popinCloseBtn) {\n      focusElement(popinCloseBtn)\n    }\n    const continueShoppingBtn = select('#continueShopping')\n    if(continueShoppingBtn) {\n      continueShoppingBtn.addEventListener('click', onContinueShopping)\n    }\n  }\n}\nfunction handleSubmit(e) {\n  const form = e.target\n  e.preventDefault()\n  window.document.DLKit.push('notify-me', {\n    eventLabel : sessionStorage.getItem('productName'),\n    eventAction: 'submit pdp',\n    event : 'uaevent'\n  })\n\n  const inputEmail = select('#inputEmail')\n  const inputPhone = select('#notify-phoneNumber')\n  const notifyPhoneEmail = select('.js-notify-by-email-phone')\n  const notifyError = select('#notifyError')\n\n  let notifyFlag = false\n  if (notifyPhoneEmail) {\n    subscriberPhoneNumber = inputPhone.value\n    form.checkValidity()\n    const notifyField = getCollection('.js-notify-field')\n    if (inputEmail.value == '' && inputPhone.value=='' ) {\n      if (notifyError.hasAttribute(\"hidden\")) {\n        notifyError.removeAttribute(\"hidden\")\n      }\n      notifyError.setAttribute('aria-hidden', false)\n      notifyError.classList.add('error')\n      notifyField.forEach(input => {\n        const field = input.closest('.field')\n        input.setAttribute('aria-invalid', true)\n        field.classList.add('has-error')\n      })\n      focusElement(notifyError)\n      notifyFlag = true\n    } else {\n      notifyError.setAttribute('hidden', '')\n      notifyError.setAttribute('aria-hidden', false)\n      notifyError.classList.remove('error')\n      notifyField.forEach(input => {\n        const id = input.getAttribute('id')\n        const elementId = `error-${id}`\n        const field = input.closest('.field')\n        if (!select(`[id=\"${elementId}\"]`)) {\n          input.removeAttribute('aria-invalid', true)\n          field.classList.remove('has-error')\n        }\n      })\n      notifyFlag = false\n    }\n    if (form.invalid.length || notifyFlag) {\n      return\n    }\n  }\n  if(inputEmail) {\n    subscriberEmailId = inputEmail.value\n    const emailPattern = new RegExp(window.config.locales.opc.applePay.regex.emailPattern)\n    const label = config.popinNotifyMe.popinEmailLabel\n    if (inputEmail.value == '' && !notifyPhoneEmail) {\n      this.message = window.config.locales.errors.form.fields.valueMissing.base\n      this.message = this.message.replace(/{label}/gi, label)\n      setErrorMessage(this.message)\n    }\n    else if (!emailPattern.test(inputEmail.value) && !notifyPhoneEmail) {\n      if (config.country === 'RU') {\n         this.message = window.config.locales.errors.form.fields.patternMismatch.notifyEmail\n     } else {\n      this.message = window.config.locales.errors.form.fields.patternMismatch.email\n     }\n      const errorInputEmail = select('#error-inputEmail')\n      if (errorInputEmail) {\n        errorInputEmail.remove()\n      }\n      setErrorMessage(this.message)\n     } else if (config.country === 'RU' && form.invalid.length) {\n         return\n        }\n    else {\n      xhr.submit(form)\n        .then(data => {\n          handleResponse(data)\n        }).catch(() => {\n          notifier.show({\n            name: window.config.locales.notifier.notifyMe.label,\n            message: window.config.locales.notifier.request.message,\n            close: window.config.locales.notifier.notifyMe.close,\n            onShow: () => {\n              notifierOnShow()\n            }\n          })\n        })\n    }\n  }\n}\nfunction closeErrorNotifier(e) {\n  e.stopPropagation()\n}\n\nfunction onNotificationClosed() {\n  const popinWrapper = select('.popin-wrapper')\n  popinWrapper ? popinWrapper.setAttribute(\"aria-hidden\", false) : null\n  const popinTabIndexArr = popinNotify.popinTabIndexArr\n  if (popinTabIndexArr) {\n    popinTabIndexArr.forEach(function (ele) {\n      ele.removeAttribute(\"tabindex\")\n    })\n  }\n\n  const ariaHiddenElements = popinNotify.ariaHiddenElements\n  if (ariaHiddenElements) {\n    ariaHiddenElements.forEach(function (ele) {\n      ele.setAttribute(\"aria-hidden\", false)\n    })\n  }\n\n  const tabindexArr = popinNotify.tabindexArr\n  if (tabindexArr) {\n    tabindexArr.forEach(function (ele) {\n      ele.setAttribute(\"tabindex\", \"-1\")\n    })\n  }\n\n  const popinSubmitBtn = select('.notify-submit')\n  focusElement(popinSubmitBtn)\n}\n\nfunction notifierOpened () {\n  if (notifier.modal) {\n    const notifierWrapper = select('.notifier__wrapper')\n    const notifierCloseBtn = select('.notifier__wrapper .notifier__close .is-sr-only')\n    const notifierMsg = select('.notifier__wrapper .message p')\n    notifierWrapper ? notifierWrapper.setAttribute('aria-label', window.config.locales.notifier.notifyMe.label) : null\n    notifierCloseBtn ? notifierCloseBtn.textContent = window.config.locales.notifier.notifyMe.close : null\n    notifierMsg ? notifierMsg.textContent = window.config.locales.notifier.request.message : null\n    notifierOnShow()\n  }\n}\n\nfunction notifierOnShow() {\n  const notifierWrapper = select('.notifier__wrapper')\n  if (notifierWrapper) {\n    notifierWrapper.classList.add('notify-me-error')\n    const popinClose = select('.popin-notifyMe_wrapper .popin__close')\n    popinClose ? popinClose.setAttribute(\"tabindex\", \"-1\") : null\n    inputEmail ? inputEmail.setAttribute(\"tabindex\", \"-1\") : null\n    select('.notify-submit').setAttribute(\"tabindex\", \"-1\")\n    popinNotify.popinTabIndexArr = selectAll('.popin-wrapper [tabindex=\"-1\"]')\n    notifierWrapper.addEventListener('click', closeErrorNotifier)\n  }\n}\n\nfunction fieldValidation(filledValue, emptyValue) {\n  if (filledValue.value != ''&& emptyValue.value == '') {\n    if (emptyValue.hasAttribute('aria-required')) {\n      emptyValue.removeAttribute('aria-required')\n    }\n  } else if (filledValue.value == '' && emptyValue.value != '') {\n    if (filledValue.hasAttribute('aria-required')) {\n      filledValue.removeAttribute('aria-required')\n    }\n  } else {\n    filledValue.setAttribute('aria-required', true)\n    emptyValue.setAttribute('aria-required', true)\n  }\n}\n\nexport default initPopinNotify\n"],"sourceRoot":""}